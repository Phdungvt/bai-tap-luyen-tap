
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bài kiểm tra - 29/11/2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%); min-height: 100vh; }
        .option { transition: all 0.2s ease; }
        .option:hover { background-color: #f3f4f6; }
        .option.selected { border-color: #4f46e5; background-color: #eef2ff; box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.2); }
        .option.correct { border-color: #22c55e; background-color: #f0fdf4; }
        .option.incorrect { border-color: #ef4444; background-color: #fef2f2; }
        .disabled { pointer-events: none; opacity: 0.7; }
        .monitoring-warning { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background-color: #ef4444; color: white; padding: 12px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; display: none; font-weight: bold; animation: fade-in-out 5s ease-in-out; }
        @keyframes fade-in-out { 0%, 100% { opacity: 0; transform: translate(-50%, -20px); } 10%, 90% { opacity: 1; transform: translate(-50%, 0); } }
        /* MathJax basic styling */
        mjx-container { display: inline-block !important; }
        .prose img.latex-image { display: inline-block; vertical-align: middle; }
        
        /* Progress Bar */
        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #e5e7eb; z-index: 50; }
        .progress-bar { height: 100%; background: #4f46e5; transition: width 0.3s; width: 0%; }

        /* Navigation Panel */
        .nav-panel {
            position: fixed; right: 0; top: 0; bottom: 0; width: 280px;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            box-shadow: -4px 0 15px rgba(0,0,0,0.05);
            z-index: 40; overflow-y: auto; padding-top: 60px;
            transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .nav-panel.open { transform: translateX(0); }
        .nav-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 16px; }
        .nav-btn {
            width: 40px; height: 40px; border-radius: 8px; border: 1px solid #e5e7eb;
            background: white; color: #4b5563; font-size: 14px; font-weight: 600;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .nav-btn:hover { border-color: #6366f1; color: #6366f1; transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .nav-btn.answered { background-color: #6366f1; color: white; border-color: #6366f1; }
        .nav-btn.current { border-color: #f59e0b; color: #f59e0b; border-width: 2px; background-color: #fffbeb; }

        /* Layout Adjustment for Nav Panel */
        #app { transition: margin-right 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        body.nav-open #app { margin-right: 280px; }
        
        @media (max-width: 1024px) {
            body.nav-open #app { margin-right: 0; } /* On mobile, nav covers content */
        }

        #toggle-nav-btn {
            position: fixed; right: 24px; bottom: 24px; width: 56px; height: 56px;
            background: linear-gradient(135deg, #6366f1, #4f46e5); color: white; border-radius: 50%;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
            display: flex; align-items: center; justify-content: center;
            z-index: 50; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        }
        #toggle-nav-btn:hover { transform: scale(1.05); box-shadow: 0 6px 16px rgba(79, 70, 229, 0.5); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }

        .question-card { transition: box-shadow 0.3s; }
        .question-card:hover { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.01); }
    </style>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$']], displayMath: [['$$', '$$']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <script type="importmap">
    { "imports": { 
        "@google/genai": "https://esm.sh/@google/genai@^1.13.0",
        "canvas-confetti": "https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/+esm"
    } }
    </script>
</head>
<body class="p-4 md:p-6">
    <div id="progress-container" class="progress-container hidden"><div id="progress-bar" class="progress-bar"></div></div>
    
    <button id="toggle-nav-btn" class="hidden" title="Danh sách câu hỏi">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
        </svg>
    </button>

    <div id="nav-panel" class="nav-panel">
        <div class="px-4 py-3 border-b bg-gray-50 sticky top-0 z-10">
            <h3 class="font-bold text-gray-800 text-lg">Danh sách câu hỏi</h3>
            <div class="flex items-center gap-4 mt-3 text-sm text-gray-600">
                <div class="flex items-center gap-1.5"><div class="w-3 h-3 border rounded bg-white"></div> Chưa làm</div>
                <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded bg-indigo-500"></div> Đã làm</div>
            </div>
        </div>
        <div id="nav-grid" class="nav-grid pb-20"></div>
    </div>

    <div id="app" class="max-w-5xl mx-auto transition-all duration-300">
        
        <div id="welcome-screen" class="bg-white rounded-2xl shadow-xl overflow-hidden max-w-2xl mx-auto mt-10">
            <div class="bg-gradient-to-r from-indigo-600 to-violet-600 p-8 text-center text-white relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMSIgY3k9IjEiIHI9IjEiIGZpbGw9IiNmZmYiLz48L3N2Zz4=')]"></div>
                <h1 class="text-2xl md:text-3xl font-bold mb-2 relative z-10">Bài kiểm tra - 29/11/2025</h1>
                <p class="text-indigo-100 text-sm md:text-base relative z-10">Mã đề: <span class="font-mono font-bold bg-white/20 px-2 py-1 rounded text-white">DFNR6G</span></p>
                 <div class="mt-4 inline-flex items-center bg-white/10 backdrop-blur-sm px-4 py-2 rounded-full relative z-10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z" clip-rule="evenodd" />
                    </svg>
                    <span>Giáo viên: <span class="font-bold text-yellow-300">Thạch Nê</span></span>
                </div>
            </div>
            <div class="p-8">
                <div class="space-y-5">
                    <div>
                        <label for="name" class="block text-sm font-semibold text-gray-700 mb-1">Họ và tên học sinh</label>
                        <input type="text" id="name" class="w-full border-gray-300 rounded-lg shadow-sm py-3 px-4 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-gray-800 placeholder-gray-400" placeholder="Nhập họ tên của bạn...">
                    </div>
                    <div>
                        <label for="class" class="block text-sm font-semibold text-gray-700 mb-1">Lớp</label>
                        <input type="text" id="class" class="w-full border-gray-300 rounded-lg shadow-sm py-3 px-4 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all text-gray-800 placeholder-gray-400" placeholder="Ví dụ: 12A1">
                    </div>
                </div>
                 <div class="mt-6 bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-amber-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-amber-700">
                                <span class="font-bold">Lưu ý:</span> Hệ thống sẽ giám sát việc chuyển tab, sao chép/dán. Các hành vi này sẽ được ghi lại và báo cáo cho giáo viên.
                            </p>
                        </div>
                    </div>
                </div>
                <button id="start-btn" class="mt-8 w-full bg-gradient-to-r from-indigo-600 to-violet-600 text-white py-3.5 px-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl hover:translate-y-[-2px] transition-all flex items-center justify-center gap-2">
                    <span>Bắt đầu làm bài</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>

        <div id="quiz-screen" class="hidden">
             <div class="sticky top-0 z-30 -mx-4 md:-mx-6 mb-6">
                 <div class="bg-white/90 backdrop-blur-md shadow-md border-b border-gray-200 py-3 px-4 md:px-8 flex justify-between items-center">
                    <div>
                         <h2 class="text-lg md:text-xl font-bold text-gray-800 truncate max-w-[200px] md:max-w-md">Bài kiểm tra - 29/11/2025</h2>
                         <p class="text-xs text-gray-500 hidden md:block">Thí sinh: <span id="student-name-display" class="font-semibold"></span></p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div id="timer" class="text-lg md:text-xl font-mono font-bold text-red-600 bg-red-50 px-3 py-1.5 rounded-lg border border-red-100 min-w-[80px] text-center shadow-sm"></div>
                        <button id="submit-btn-top" class="md:hidden bg-green-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold shadow-sm">Nộp</button>
                    </div>
                 </div>
            </div>
            
            <div id="all-questions-container" class="space-y-6 pb-10"></div>
            
            <div class="mt-8 flex justify-end sticky bottom-4 z-20">
                <div class="bg-white/80 backdrop-blur p-2 rounded-2xl shadow-lg border border-gray-100">
                    <button id="submit-btn" class="bg-gradient-to-r from-emerald-500 to-green-600 text-white py-3 px-8 rounded-xl font-bold text-lg shadow-md hover:shadow-lg hover:from-emerald-600 hover:to-green-700 transition-all flex items-center gap-2">
                        <span>Nộp bài</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div id="results-screen" class="hidden max-w-3xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-blue-500 to-cyan-500 p-8 text-center text-white">
                <h2 class="text-3xl font-bold mb-2">Kết quả bài làm</h2>
                <p class="opacity-90">Chúc mừng bạn đã hoàn thành bài thi!</p>
            </div>
            <div class="p-8">
                <div id="score-display" class="hidden flex flex-col items-center justify-center my-4">
                    <span class="text-gray-500 text-lg uppercase tracking-widest font-semibold mb-2">Tổng điểm</span>
                    <span class="text-6xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-br from-blue-600 to-cyan-500 drop-shadow-sm"></span>
                </div>
                
                <div id="assessment-display" class="hidden mt-6 p-6 bg-indigo-50 border border-indigo-100 rounded-xl text-gray-700 shadow-inner relative">
                     <div class="absolute top-0 left-0 w-1 h-full bg-indigo-400 rounded-l-xl"></div>
                     <h3 class="font-bold text-indigo-800 mb-2 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z" />
                            <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z" />
                        </svg>
                        Nhận xét từ AI Giáo viên
                     </h3>
                     <div class="assessment-content prose prose-indigo max-w-none"></div>
                </div>

                <div id="review-container" class="mt-10 border-t pt-8"></div>
                
                <div class="mt-10 flex flex-col sm:flex-row justify-center gap-4">
                    <button id="retry-btn" class="hidden bg-white text-indigo-600 border-2 border-indigo-600 py-3 px-6 rounded-xl font-bold hover:bg-indigo-50 transition-colors">Làm lại bài</button>
                    <button id="restart-btn" class="bg-gray-800 text-white py-3 px-6 rounded-xl font-bold hover:bg-gray-900 transition-colors shadow-md">Về trang chủ</button>
                </div>
            </div>
        </div>
        
        <div id="monitoring-warning" class="monitoring-warning">⚠️ Đã phát hiện hành vi không hợp lệ!</div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";
        import confetti from "https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/+esm";

        const API_KEY = "AIzaSyB8Y9QN8AN7zB51HTkxt_Xxotj2PKCAoxY";
        let quizData = [{"question":"Thiết bị nào sau đây là thiết bị vào (input device) của máy tính?","options":["Màn hình","Máy in","Bàn phím","Loa"],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Thiết bị nào sau đây là thiết bị vào (input device) của máy tính?","rendered_options":["Màn hình","Máy in","Bàn phím","Loa"]},{"question":"Thiết bị nào sau đây vừa là thiết bị vào, vừa là thiết bị ra của máy tính?","options":["Màn hình","Máy in","Tai nghe có micro","Bàn phím"],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Thiết bị nào sau đây vừa là thiết bị vào, vừa là thiết bị ra của máy tính?","rendered_options":["Màn hình","Máy in","Tai nghe có micro","Bàn phím"]},{"question":"Lan đang sử dụng một máy in đa năng để quét một tài liệu và lưu vào máy tính, sau đó cô ấy dùng chính chiếc máy đó để in một bài báo từ máy tính ra. Dựa trên các hoạt động này, máy in đa năng của Lan đã thực hiện những chức năng vào/ra nào?","options":["Chỉ thực hiện chức năng vào.","Chỉ thực hiện chức năng ra.","Vừa thực hiện chức năng vào, vừa thực hiện chức năng ra.","Không thực hiện chức năng vào hay ra."],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Lan đang sử dụng một máy in đa năng để quét một tài liệu và lưu vào máy tính, sau đó cô ấy dùng chính chiếc máy đó để in một bài báo từ máy tính ra. Dựa trên các hoạt động này, máy in đa năng của Lan đã thực hiện những chức năng vào/ra nào?","rendered_options":["Chỉ thực hiện chức năng vào.","Chỉ thực hiện chức năng ra.","Vừa thực hiện chức năng vào, vừa thực hiện chức năng ra.","Không thực hiện chức năng vào hay ra."]},{"question":"Chức năng chính của hệ điều hành là gì?","options":["Soạn thảo văn bản và tạo bài trình chiếu.","Quản lí và điều khiển các tài nguyên phần cứng và phần mềm của máy tính.","Chơi trò chơi và xem phim.","Duyệt web và gửi email."],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Chức năng chính của hệ điều hành là gì?","rendered_options":["Soạn thảo văn bản và tạo bài trình chiếu.","Quản lí và điều khiển các tài nguyên phần cứng và phần mềm của máy tính.","Chơi trò chơi và xem phim.","Duyệt web và gửi email."]},{"question":"Chức năng chính của hệ điều hành trên máy tính là gì?","options":["Hỗ trợ người dùng soạn thảo văn bản và tạo các bài trình chiếu.","Quản lí, điều khiển các thiết bị phần cứng, tổ chức và quản lí thông tin trong máy tính, cũng như cung cấp môi trường cho các phần mềm ứng dụng hoạt động.","Cho phép người dùng kết nối mạng xã hội và duyệt web.","Hỗ trợ máy tính tự động sửa chữa các lỗi phần cứng."],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Chức năng chính của hệ điều hành trên máy tính là gì?","rendered_options":["Hỗ trợ người dùng soạn thảo văn bản và tạo các bài trình chiếu.","Quản lí, điều khiển các thiết bị phần cứng, tổ chức và quản lí thông tin trong máy tính, cũng như cung cấp môi trường cho các phần mềm ứng dụng hoạt động.","Cho phép người dùng kết nối mạng xã hội và duyệt web.","Hỗ trợ máy tính tự động sửa chữa các lỗi phần cứng."]},{"question":"Bạn An muốn sử dụng máy tính để thực hiện hai công việc chính: 1) Soạn thảo một bài thuyết trình cho môn Lịch sử và 2) Sắp xếp lại các tệp ảnh và tài liệu trong máy tính, đồng thời xóa bớt các tệp không cần thiết để giải phóng dung lượng. Phát biểu nào sau đây phân biệt đúng vai trò của hệ điều hành và phần mềm ứng dụng trong việc hỗ trợ bạn An thực hiện các công việc trên?","options":["Việc soạn thảo bài thuyết trình được thực hiện bởi phần mềm ứng dụng, còn việc sắp xếp và xóa tệp là chức năng quản lý của hệ điều hành.","Cả việc soạn thảo bài thuyết trình và sắp xếp tệp đều là chức năng chính của hệ điều hành.","Cả việc soạn thảo bài thuyết trình và sắp xếp tệp đều là chức năng của phần mềm ứng dụng.","Hệ điều hành chịu trách nhiệm soạn thảo bài thuyết trình, còn phần mềm ứng dụng thực hiện việc sắp xếp và xóa tệp."],"correctAnswerIndex":0,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Bạn An muốn sử dụng máy tính để thực hiện hai công việc chính: 1) Soạn thảo một bài thuyết trình cho môn Lịch sử và 2) Sắp xếp lại các tệp ảnh và tài liệu trong máy tính, đồng thời xóa bớt các tệp không cần thiết để giải phóng dung lượng. Phát biểu nào sau đây phân biệt đúng vai trò của hệ điều hành và phần mềm ứng dụng trong việc hỗ trợ bạn An thực hiện các công việc trên?","rendered_options":["Việc soạn thảo bài thuyết trình được thực hiện bởi phần mềm ứng dụng, còn việc sắp xếp và xóa tệp là chức năng quản lý của hệ điều hành.","Cả việc soạn thảo bài thuyết trình và sắp xếp tệp đều là chức năng chính của hệ điều hành.","Cả việc soạn thảo bài thuyết trình và sắp xếp tệp đều là chức năng của phần mềm ứng dụng.","Hệ điều hành chịu trách nhiệm soạn thảo bài thuyết trình, còn phần mềm ứng dụng thực hiện việc sắp xếp và xóa tệp."]},{"question":"Phần mở rộng của tên tệp (ví dụ: .docx, .mp3, .jpg) cho biết thông tin gì về tệp đó?","options":["Kích thước của tệp","Ngày tạo tệp","Loại tệp (ví dụ: văn bản, âm thanh, hình ảnh)","Tên người tạo tệp"],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Phần mở rộng của tên tệp (ví dụ: .docx, .mp3, .jpg) cho biết thông tin gì về tệp đó?","rendered_options":["Kích thước của tệp","Ngày tạo tệp","Loại tệp (ví dụ: văn bản, âm thanh, hình ảnh)","Tên người tạo tệp"]},{"question":"Trong các biện pháp sau, biện pháp nào KHÔNG phải là một cách hiệu quả để bảo vệ dữ liệu quan trọng trong máy tính?","options":["Sao lưu dữ liệu định kì","Cài đặt và cập nhật phần mềm diệt virus","Thường xuyên xóa các tệp dữ liệu quan trọng để giải phóng dung lượng","Sử dụng mật khẩu mạnh để bảo vệ tài khoản"],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Trong các biện pháp sau, biện pháp nào KHÔNG phải là một cách hiệu quả để bảo vệ dữ liệu quan trọng trong máy tính?","rendered_options":["Sao lưu dữ liệu định kì","Cài đặt và cập nhật phần mềm diệt virus","Thường xuyên xóa các tệp dữ liệu quan trọng để giải phóng dung lượng","Sử dụng mật khẩu mạnh để bảo vệ tài khoản"]},{"question":"Phần mở rộng của tệp (file extension) là gì và nó thường cho biết thông tin nào về tệp đó?","options":["Phần tên chính của tệp, cho biết tệp được tạo khi nào.","Một phần thêm vào sau dấu chấm trong tên tệp, cho biết loại tệp và chương trình có thể mở nó.","Tên của thư mục chứa tệp, giúp tìm kiếm tệp dễ hơn.","Kích thước của tệp, giúp người dùng biết tệp nặng hay nhẹ."],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Phần mở rộng của tệp (file extension) là gì và nó thường cho biết thông tin nào về tệp đó?","rendered_options":["Phần tên chính của tệp, cho biết tệp được tạo khi nào.","Một phần thêm vào sau dấu chấm trong tên tệp, cho biết loại tệp và chương trình có thể mở nó.","Tên của thư mục chứa tệp, giúp tìm kiếm tệp dễ hơn.","Kích thước của tệp, giúp người dùng biết tệp nặng hay nhẹ."]},{"question":"An đang thực hiện một bài thuyết trình quan trọng cho dự án nhóm mang tên `Du_an_cuoi_ky.pptx` và đã lưu tệp này trong thư mục `D:\\Tai_lieu_nhom`. An cần nộp tệp này cho giáo viên, chia sẻ với các thành viên trong nhóm để xem xét, và đảm bảo an toàn cho tệp gốc khỏi rủi ro mất dữ liệu hoặc hỏng hóc. Hành động nào sau đây của An là hiệu quả và an toàn nhất để hoàn thành các mục tiêu trên?","options":["An di chuyển tệp `Du_an_cuoi_ky.pptx` sang một ổ đĩa USB để nộp cho giáo viên và sau đó gửi email tệp này cho từng thành viên trong nhóm.","An sao chép tệp `Du_an_cuoi_ky.pptx` vào một thư mục `Sao_luu` trên một ổ đĩa khác. Sau đó, An tải tệp lên dịch vụ lưu trữ đám mây (ví dụ: Google Drive) và chia sẻ liên kết cho giáo viên và các thành viên.","An đổi tên tệp thành `Du_an_cuoi_ky_final.pptx`, sau đó gửi tệp này qua email cho giáo viên và các thành viên.","An nén tệp `Du_an_cuoi_ky.pptx` lại, sau đó tải lên một trang web chia sẻ tệp tạm thời và gửi liên kết cho giáo viên. An không thực hiện sao lưu tệp."],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"An đang thực hiện một bài thuyết trình quan trọng cho dự án nhóm mang tên `Du_an_cuoi_ky.pptx` và đã lưu tệp này trong thư mục `D:\\Tai_lieu_nhom`. An cần nộp tệp này cho giáo viên, chia sẻ với các thành viên trong nhóm để xem xét, và đảm bảo an toàn cho tệp gốc khỏi rủi ro mất dữ liệu hoặc hỏng hóc. Hành động nào sau đây của An là hiệu quả và an toàn nhất để hoàn thành các mục tiêu trên?","rendered_options":["An di chuyển tệp `Du_an_cuoi_ky.pptx` sang một ổ đĩa USB để nộp cho giáo viên và sau đó gửi email tệp này cho từng thành viên trong nhóm.","An sao chép tệp `Du_an_cuoi_ky.pptx` vào một thư mục `Sao_luu` trên một ổ đĩa khác. Sau đó, An tải tệp lên dịch vụ lưu trữ đám mây (ví dụ: Google Drive) và chia sẻ liên kết cho giáo viên và các thành viên.","An đổi tên tệp thành `Du_an_cuoi_ky_final.pptx`, sau đó gửi tệp này qua email cho giáo viên và các thành viên.","An nén tệp `Du_an_cuoi_ky.pptx` lại, sau đó tải lên một trang web chia sẻ tệp tạm thời và gửi liên kết cho giáo viên. An không thực hiện sao lưu tệp."]},{"question":"Chức năng cơ bản nào sau đây là đặc trưng nhất của mạng xã hội?","options":["Soạn thảo văn bản và tính toán bảng biểu.","Chia sẻ thông tin, kết nối bạn bè và trao đổi trực tuyến.","Lưu trữ dữ liệu trên máy tính cá nhân.","Tạo ra các chương trình máy tính."],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Chức năng cơ bản nào sau đây là đặc trưng nhất của mạng xã hội?","rendered_options":["Soạn thảo văn bản và tính toán bảng biểu.","Chia sẻ thông tin, kết nối bạn bè và trao đổi trực tuyến.","Lưu trữ dữ liệu trên máy tính cá nhân.","Tạo ra các chương trình máy tính."]},{"question":"Kênh trao đổi thông tin nào trên Internet cho phép bạn gửi và nhận thư điện tử?","options":["Mạng xã hội Facebook.","Công cụ tìm kiếm Google.","Thư điện tử (Email).","Trang báo điện tử VnExpress."],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Kênh trao đổi thông tin nào trên Internet cho phép bạn gửi và nhận thư điện tử?","rendered_options":["Mạng xã hội Facebook.","Công cụ tìm kiếm Google.","Thư điện tử (Email).","Trang báo điện tử VnExpress."]},{"question":"Kênh trao đổi thông tin nào trên Internet chủ yếu tập trung vào việc chia sẻ hình ảnh và các đoạn video ngắn với hiệu ứng sáng tạo?","options":["Zalo","Email","Instagram","Facebook"],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Kênh trao đổi thông tin nào trên Internet chủ yếu tập trung vào việc chia sẻ hình ảnh và các đoạn video ngắn với hiệu ứng sáng tạo?","rendered_options":["Zalo","Email","Instagram","Facebook"]},{"question":"Lan muốn chia sẻ một album ảnh về hoạt động ngoại khóa của trường mình với tất cả bạn bè trong lớp và các thành viên gia đình. Cô ấy cũng mong muốn mọi người có thể dễ dàng xem, bình luận và bày tỏ cảm xúc về những bức ảnh đó. Trong các kênh trao đổi thông tin dưới đây, kênh nào phù hợp nhất để Lan thực hiện mục đích trên?","options":["Gửi email đính kèm album ảnh cho từng người trong danh bạ của Lan.","Tạo một nhóm chat trên ứng dụng nhắn tin và gửi album ảnh vào đó.","Đăng tải album ảnh lên trang cá nhân trên mạng xã hội của Lan với chế độ công khai hoặc bạn bè.","Sao chép album ảnh vào USB và nhờ từng người đến nhà Lan để xem."],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Lan muốn chia sẻ một album ảnh về hoạt động ngoại khóa của trường mình với tất cả bạn bè trong lớp và các thành viên gia đình. Cô ấy cũng mong muốn mọi người có thể dễ dàng xem, bình luận và bày tỏ cảm xúc về những bức ảnh đó. Trong các kênh trao đổi thông tin dưới đây, kênh nào phù hợp nhất để Lan thực hiện mục đích trên?","rendered_options":["Gửi email đính kèm album ảnh cho từng người trong danh bạ của Lan.","Tạo một nhóm chat trên ứng dụng nhắn tin và gửi album ảnh vào đó.","Đăng tải album ảnh lên trang cá nhân trên mạng xã hội của Lan với chế độ công khai hoặc bạn bè.","Sao chép album ảnh vào USB và nhờ từng người đến nhà Lan để xem."]},{"question":"Khi gặp một thông tin có nội dung xấu hoặc không phù hợp với lứa tuổi trên mạng, em nên làm gì đầu tiên?","options":["Chia sẻ ngay với bạn bè để cảnh báo.","Báo cáo (report) thông tin đó và không tiếp tục xem.","Tìm hiểu kĩ hơn về thông tin đó để xem có đáng tin cậy không.","Giả vờ không nhìn thấy và tiếp tục lướt web."],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Khi gặp một thông tin có nội dung xấu hoặc không phù hợp với lứa tuổi trên mạng, em nên làm gì đầu tiên?","rendered_options":["Chia sẻ ngay với bạn bè để cảnh báo.","Báo cáo (report) thông tin đó và không tiếp tục xem.","Tìm hiểu kĩ hơn về thông tin đó để xem có đáng tin cậy không.","Giả vờ không nhìn thấy và tiếp tục lướt web."]},{"question":"Việc dành quá nhiều thời gian cho việc chơi trò chơi trực tuyến hoặc lướt mạng xã hội có thể dẫn đến hậu quả nào sau đây?","options":["Tăng cường khả năng giao tiếp xã hội.","Cải thiện kết quả học tập.","Gây nghiện Internet và ảnh hưởng xấu đến sức khỏe, học tập.","Giúp thư giãn và giải tỏa căng thẳng hiệu quả."],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Việc dành quá nhiều thời gian cho việc chơi trò chơi trực tuyến hoặc lướt mạng xã hội có thể dẫn đến hậu quả nào sau đây?","rendered_options":["Tăng cường khả năng giao tiếp xã hội.","Cải thiện kết quả học tập.","Gây nghiện Internet và ảnh hưởng xấu đến sức khỏe, học tập.","Giúp thư giãn và giải tỏa căng thẳng hiệu quả."]},{"question":"Khi bạn vô tình gặp phải một nội dung xấu, độc hại hoặc không phù hợp với lứa tuổi trên mạng xã hội, hành động nào sau đây là hợp lí và an toàn nhất?","options":["Chia sẻ nội dung đó cho bạn bè để cảnh báo họ.","Báo cáo (report) nội dung đó cho nền tảng mạng xã hội và không tương tác thêm.","Bình luận bày tỏ sự phản đối của bạn dưới bài đăng đó.","Lờ đi và tiếp tục tìm kiếm những nội dung khác."],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Khi bạn vô tình gặp phải một nội dung xấu, độc hại hoặc không phù hợp với lứa tuổi trên mạng xã hội, hành động nào sau đây là hợp lí và an toàn nhất?","rendered_options":["Chia sẻ nội dung đó cho bạn bè để cảnh báo họ.","Báo cáo (report) nội dung đó cho nền tảng mạng xã hội và không tương tác thêm.","Bình luận bày tỏ sự phản đối của bạn dưới bài đăng đó.","Lờ đi và tiếp tục tìm kiếm những nội dung khác."]},{"question":"Lan đang lướt mạng xã hội và tình cờ thấy một bài viết có hình ảnh và nội dung không phù hợp với lứa tuổi, thậm chí có phần kích động, tiêu cực. Lan cảm thấy hoang mang và không biết phải làm gì. Theo em, Lan nên làm gì để ứng xử văn minh và bảo vệ bản thân trong tình huống này?","options":["Chia sẻ bài viết đó cho bạn bè để cảnh báo mọi người.","Báo cáo bài viết đó cho quản trị viên nền tảng mạng xã hội và nói chuyện với người lớn đáng tin cậy (cha mẹ, thầy cô).","Tỏ thái độ tiêu cực bằng cách bình luận chỉ trích gay gắt dưới bài viết đó.","Cố gắng tìm hiểu thêm thông tin về bài viết đó để biết rõ hơn."],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Lan đang lướt mạng xã hội và tình cờ thấy một bài viết có hình ảnh và nội dung không phù hợp với lứa tuổi, thậm chí có phần kích động, tiêu cực. Lan cảm thấy hoang mang và không biết phải làm gì. Theo em, Lan nên làm gì để ứng xử văn minh và bảo vệ bản thân trong tình huống này?","rendered_options":["Chia sẻ bài viết đó cho bạn bè để cảnh báo mọi người.","Báo cáo bài viết đó cho quản trị viên nền tảng mạng xã hội và nói chuyện với người lớn đáng tin cậy (cha mẹ, thầy cô).","Tỏ thái độ tiêu cực bằng cách bình luận chỉ trích gay gắt dưới bài viết đó.","Cố gắng tìm hiểu thêm thông tin về bài viết đó để biết rõ hơn."]},{"question":"Chức năng cơ bản nào sau đây là của phần mềm bảng tính?","options":["Xử lí văn bản","Quản lí và tính toán dữ liệu","Thiết kế đồ họa","Soạn thảo email"],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Chức năng cơ bản nào sau đây là của phần mềm bảng tính?","rendered_options":["Xử lí văn bản","Quản lí và tính toán dữ liệu","Thiết kế đồ họa","Soạn thảo email"]},{"question":"Để thay đổi kiểu chữ, cỡ chữ hoặc màu chữ của dữ liệu trong một ô tính của phần mềm bảng tính, em sẽ thực hiện thao tác nào?","options":["Thay đổi độ rộng cột","Định dạng dữ liệu","Lưu tệp tin","In trang tính"],"correctAnswerIndex":1,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Để thay đổi kiểu chữ, cỡ chữ hoặc màu chữ của dữ liệu trong một ô tính của phần mềm bảng tính, em sẽ thực hiện thao tác nào?","rendered_options":["Thay đổi độ rộng cột","Định dạng dữ liệu","Lưu tệp tin","In trang tính"]},{"question":"Chức năng cơ bản và quan trọng nhất của phần mềm bảng tính là gì?","options":["Soạn thảo văn bản và in ấn tài liệu.","Tạo ra các bài trình chiếu sinh động.","Xử lí và tính toán dữ liệu dưới dạng bảng biểu.","Thiết kế đồ họa và chỉnh sửa hình ảnh."],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Chức năng cơ bản và quan trọng nhất của phần mềm bảng tính là gì?","rendered_options":["Soạn thảo văn bản và in ấn tài liệu.","Tạo ra các bài trình chiếu sinh động.","Xử lí và tính toán dữ liệu dưới dạng bảng biểu.","Thiết kế đồ họa và chỉnh sửa hình ảnh."]},{"question":"Trong phần mềm bảng tính, thao tác nào sau đây KHÔNG thuộc nhóm các thao tác định dạng dữ liệu cơ bản?","options":["Thay đổi phông chữ và cỡ chữ cho nội dung trong ô tính.","Căn chỉnh dữ liệu (trái, phải, giữa) trong ô tính.","Thay đổi độ rộng của một cột hoặc chiều cao của một hàng.","Lập trình macro để tự động hóa các tác vụ phức tạp."],"correctAnswerIndex":3,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Trong phần mềm bảng tính, thao tác nào sau đây KHÔNG thuộc nhóm các thao tác định dạng dữ liệu cơ bản?","rendered_options":["Thay đổi phông chữ và cỡ chữ cho nội dung trong ô tính.","Căn chỉnh dữ liệu (trái, phải, giữa) trong ô tính.","Thay đổi độ rộng của một cột hoặc chiều cao của một hàng.","Lập trình macro để tự động hóa các tác vụ phức tạp."]},{"question":"Bạn An muốn sắp xếp một bảng điểm nhỏ trong phần mềm bảng tính. Ở ô A1, bạn ấy nhập dòng chữ \"TỔNG KẾT HỌC KÌ I\". Ở cột B, từ ô B2 đến B10, bạn ấy nhập các điểm số. An muốn đạt được các yêu cầu sau:\n1. Tiêu đề ở ô A1 phải nổi bật (in đậm, cỡ chữ lớn hơn).\n2. Đảm bảo toàn bộ tiêu đề \"TỔNG KẾT HỌC KÌ I\" hiển thị đầy đủ, không bị ẩn hay tràn.\n3. Các điểm số ở cột B được căn giữa để dễ đọc.\n\nĐể đạt được các yêu cầu trên một cách hiệu quả nhất, bạn An nên thực hiện chuỗi thao tác nào sau đây?","options":["Chọn ô A1, tăng cỡ chữ, chọn kiểu chữ đậm. Sau đó, điều chỉnh độ rộng cột A cho phù hợp. Cuối cùng, chọn vùng B2:B10 và chọn căn giữa dữ liệu.","Chọn vùng B2:B10 và chọn căn giữa dữ liệu. Sau đó, chọn ô A1, tăng cỡ chữ, chọn kiểu chữ đậm. Cuối cùng, điều chỉnh độ rộng cột A cho phù hợp.","Điều chỉnh độ rộng cột A cho phù hợp. Sau đó, chọn ô A1, tăng cỡ chữ, chọn kiểu chữ đậm. Cuối cùng, chọn vùng B2:B10 và chọn căn giữa dữ liệu.","Chọn ô A1, tăng cỡ chữ, chọn kiểu chữ đậm. Sau đó, chọn vùng B2:B10 và chọn căn giữa dữ liệu. Cuối cùng, điều chỉnh độ rộng cột A cho phù hợp."],"correctAnswerIndex":0,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Bạn An muốn sắp xếp một bảng điểm nhỏ trong phần mềm bảng tính. Ở ô A1, bạn ấy nhập dòng chữ \"TỔNG KẾT HỌC KÌ I\". Ở cột B, từ ô B2 đến B10, bạn ấy nhập các điểm số. An muốn đạt được các yêu cầu sau:<br>1. Tiêu đề ở ô A1 phải nổi bật (in đậm, cỡ chữ lớn hơn).<br>2. Đảm bảo toàn bộ tiêu đề \"TỔNG KẾT HỌC KÌ I\" hiển thị đầy đủ, không bị ẩn hay tràn.<br>3. Các điểm số ở cột B được căn giữa để dễ đọc.<br><br>Để đạt được các yêu cầu trên một cách hiệu quả nhất, bạn An nên thực hiện chuỗi thao tác nào sau đây?","rendered_options":["Chọn ô A1, tăng cỡ chữ, chọn kiểu chữ đậm. Sau đó, điều chỉnh độ rộng cột A cho phù hợp. Cuối cùng, chọn vùng B2:B10 và chọn căn giữa dữ liệu.","Chọn vùng B2:B10 và chọn căn giữa dữ liệu. Sau đó, chọn ô A1, tăng cỡ chữ, chọn kiểu chữ đậm. Cuối cùng, điều chỉnh độ rộng cột A cho phù hợp.","Điều chỉnh độ rộng cột A cho phù hợp. Sau đó, chọn ô A1, tăng cỡ chữ, chọn kiểu chữ đậm. Cuối cùng, chọn vùng B2:B10 và chọn căn giữa dữ liệu.","Chọn ô A1, tăng cỡ chữ, chọn kiểu chữ đậm. Sau đó, chọn vùng B2:B10 và chọn căn giữa dữ liệu. Cuối cùng, điều chỉnh độ rộng cột A cho phù hợp."]},{"question":"Trong các hàm tính toán cơ bản trên bảng tính, hàm nào dùng để tính tổng các giá trị số được chọn?","options":["AVERAGE","COUNT","MAX","SUM"],"correctAnswerIndex":3,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Trong các hàm tính toán cơ bản trên bảng tính, hàm nào dùng để tính tổng các giá trị số được chọn?","rendered_options":["AVERAGE","COUNT","MAX","SUM"]},{"question":"Giả sử bạn có các giá trị trong các ô $A1=10$, $A2=5$, $A3=18$, $A4=7$. Khi sử dụng hàm $MAX(A1:A4)$, kết quả trả về sẽ là bao nhiêu?","options":["5","7","10","18"],"correctAnswerIndex":3,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Giả sử bạn có các giá trị trong các ô $A1=10$, $A2=5$, $A3=18$, $A4=7$. Khi sử dụng hàm $MAX(A1:A4)$, kết quả trả về sẽ là bao nhiêu?","rendered_options":["5","7","10","18"]},{"question":"Trong một bảng tính, để tính tổng giá trị của một dãy các ô dữ liệu (ví dụ: tổng điểm của một học sinh), em cần sử dụng hàm nào sau đây?","options":["MAX","MIN","SUM","AVERAGE"],"correctAnswerIndex":2,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Trong một bảng tính, để tính tổng giá trị của một dãy các ô dữ liệu (ví dụ: tổng điểm của một học sinh), em cần sử dụng hàm nào sau đây?","rendered_options":["MAX","MIN","SUM","AVERAGE"]},{"question":"Cho bảng dữ liệu sau:<br>$$<br>\\begin{array}{|c|c|c|c|}<br>\\hline<br>\\textbf{Sản phẩm} & \\textbf{Tháng 1} & \\textbf{Tháng 2} & \\textbf{Tháng 3} \\\\<br>\\hline<br>A & 150 & 180 & 160 \\\\<br>\\hline<br>B & 200 & 190 & 210 \\\\<br>\\hline<br>C & 170 & 220 & 190 \\\\<br>\\hline<br>\\end{array}<br>$$<br>Nếu muốn tính giá trị trung bình doanh thu của tất cả các sản phẩm trong cả 3 tháng bằng hàm AVERAGE trong bảng tính, kết quả trả về sẽ là bao nhiêu?","options":["185.56","180","190","188.89"],"correctAnswerIndex":0,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Cho bảng dữ liệu sau:<br>$$<br>\\begin{array}{|c|c|c|c|}<br>\\hline<br>\\textbf{Sản phẩm} & \\textbf{Tháng 1} & \\textbf{Tháng 2} & \\textbf{Tháng 3} \\\\<br>\\hline<br>A & 150 & 180 & 160 \\\\<br>\\hline<br>B & 200 & 190 & 210 \\\\<br>\\hline<br>C & 170 & 220 & 190 \\\\<br>\\hline<br>\\end{array}<br>$$<br>Nếu muốn tính giá trị trung bình doanh thu của tất cả các sản phẩm trong cả 3 tháng bằng hàm AVERAGE trong bảng tính, kết quả trả về sẽ là bao nhiêu?","rendered_options":["185.56","180","190","188.89"]},{"question":"Một giáo viên muốn tìm điểm cao nhất và điểm thấp nhất trong một danh sách điểm thi môn Tin học của lớp 7A. Danh sách điểm là: $8, 7, 9, 6.5, 9.5, 7.5, 8, 10, 6, 9$. Nếu giáo viên sử dụng hàm MAX để tìm điểm cao nhất và hàm MIN để tìm điểm thấp nhất, thì kết quả trả về của hai hàm này sẽ là bao nhiêu?","options":["Điểm cao nhất là $10$, điểm thấp nhất là $6$.","Điểm cao nhất là $9.5$, điểm thấp nhất là $6.5$.","Điểm cao nhất là $9$, điểm thấp nhất là $7$.","Điểm cao nhất là $10$, điểm thấp nhất là $6.5$."],"correctAnswerIndex":0,"type":"multiple-choice","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Một giáo viên muốn tìm điểm cao nhất và điểm thấp nhất trong một danh sách điểm thi môn Tin học của lớp 7A. Danh sách điểm là: $8, 7, 9, 6.5, 9.5, 7.5, 8, 10, 6, 9$. Nếu giáo viên sử dụng hàm MAX để tìm điểm cao nhất và hàm MIN để tìm điểm thấp nhất, thì kết quả trả về của hai hàm này sẽ là bao nhiêu?","rendered_options":["Điểm cao nhất là $10$, điểm thấp nhất là $6$.","Điểm cao nhất là $9.5$, điểm thấp nhất là $6.5$.","Điểm cao nhất là $9$, điểm thấp nhất là $7$.","Điểm cao nhất là $10$, điểm thấp nhất là $6.5$."]},{"question":"Cho bảng điểm môn Ngữ văn của lớp 8B như sau:\n$$ \\begin{array}{|c|l|c|c|c|c|} \\hline \\textbf{STT} & \\textbf{Họ và tên} & \\textbf{Kiểm tra miệng} & \\textbf{Kiểm tra 15 phút} & \\textbf{Kiểm tra giữa kì} & \\textbf{Kiểm tra cuối kì} \\\\ \\hline 1 & Nguyễn An & 7 & 8 & 9 & 8 \\\\ \\hline 2 & Trần Bình & 6 & 7 & 7 & 9 \\\\ \\hline 3 & Lê Cường & 8 & 9 & 8 & 7 \\\\ \\hline 4 & Phạm Dung & 5 & 8 & 9 & 8 \\\\ \\hline 5 & Hoàng Giang & 9 & 6 & 7 & 9 \\\\ \\hline 6 & Đặng Lan & 7 & 8 & 8 & 8 \\\\ \\hline 7 & Mai Ngọc & 6 & 9 & 6 & 10 \\\\ \\hline 8 & Nguyễn Phong & 8 & 7 & 7 & 8 \\\\ \\hline 9 & Lê Quỳnh & 7 & 8 & 9 & 9 \\\\ \\hline 10 & Hồ Sơn & 6 & 7 & 8 & 7 \\\\ \\hline \\end{array} $$\nGiả sử bạn cần phân tích kết quả học tập của lớp 8B bằng chương trình bảng tính. Hãy trình bày cách bạn sẽ sử dụng các hàm tính toán cơ bản (SUM, AVERAGE, MAX, MIN, COUNT) để thực hiện các yêu cầu sau:\na) Tính tổng điểm và điểm trung bình của từng loại bài kiểm tra (Kiểm tra miệng, 15 phút, giữa kì, cuối kì).\nb) Xác định điểm cao nhất và thấp nhất của từng loại bài kiểm tra.\nc) Đếm xem có bao nhiêu học sinh có điểm Kiểm tra cuối kì từ $9$ trở lên.\nd) Dựa trên các kết quả tính toán trên, hãy nhận xét về tình hình học tập môn Ngữ văn của lớp 8B và đề xuất một số giải pháp để cải thiện chất lượng học tập (nếu cần).","answer":"Gợi ý đáp án: a) Để tính tổng điểm và điểm trung bình của từng loại bài kiểm tra, giả sử các điểm Kiểm tra miệng nằm trong cột C, điểm 15 phút ở cột D, điểm giữa kì ở cột E và điểm cuối kì ở cột F, bắt đầu từ hàng 2 đến hàng 11 (C2:C11, D2:D11,...):\n- Tổng điểm:\n    - Kiểm tra miệng: `=SUM(C2:C11)`\n    - Kiểm tra 15 phút: `=SUM(D2:D11)`\n    - Kiểm tra giữa kì: `=SUM(E2:E11)`\n    - Kiểm tra cuối kì: `=SUM(F2:F11)`\n- Điểm trung bình:\n    - Kiểm tra miệng: `=AVERAGE(C2:C11)`\n    - Kiểm tra 15 phút: `=AVERAGE(D2:D11)`\n    - Kiểm tra giữa kì: `=AVERAGE(E2:E11)`\n    - Kiểm tra cuối kì: `=AVERAGE(F2:F11)`\nb) Để xác định điểm cao nhất và thấp nhất của từng loại bài kiểm tra:\n- Điểm cao nhất:\n    - Kiểm tra miệng: `=MAX(C2:C11)`\n    - Kiểm tra 15 phút: `=MAX(D2:D11)`\n    - Kiểm tra giữa kì: `=MAX(E2:E11)`\n    - Kiểm tra cuối kì: `=MAX(F2:F11)`\n- Điểm thấp nhất:\n    - Kiểm tra miệng: `=MIN(C2:C11)`\n    - Kiểm tra 15 phút: `=MIN(D2:D11)`\n    - Kiểm tra giữa kì: `=MIN(E2:E11)`\n    - Kiểm tra cuối kì: `=MIN(F2:F11)`\nc) Đếm xem có bao nhiêu học sinh có điểm Kiểm tra cuối kì từ $9$ trở lên:\nHọc sinh có điểm Kiểm tra cuối kì từ $9$ trở lên là: $10$ (Mai Ngọc), $9$ (Trần Bình), $9$ (Hoàng Giang), $9$ (Lê Quỳnh). Vậy có $4$ học sinh đạt điểm Kiểm tra cuối kì từ $9$ trở lên.\nd) Nhận xét và đề xuất (ví dụ):\n- Tính toán cụ thể (ví dụ):\n    - Tổng điểm cuối kì: $83$\n    - Điểm trung bình cuối kì: $8.3$\n    - Điểm cao nhất cuối kì: $10$\n    - Điểm thấp nhất cuối kì: $7$\n    - Số học sinh đạt từ $9$ điểm trở lên ở Kiểm tra cuối kì: $4$ học sinh.\n- Nhận xét: Kết quả Kiểm tra cuối kì của lớp 8B tương đối tốt với điểm trung bình là $8.3$. Tuy nhiên, điểm số có sự chênh lệch giữa các học sinh, với điểm thấp nhất là $7$ và số học sinh đạt điểm $9$ trở lên là $4$. Điều này cho thấy có một bộ phận học sinh còn chưa thực sự nắm vững kiến thức môn Ngữ văn.\n- Đề xuất:\n    - Tổ chức các buổi thảo luận nhóm về các tác phẩm văn học, khuyến khích học sinh chia sẻ cảm nhận và phân tích sâu hơn.\n    - Tạo cơ hội cho học sinh luyện tập kỹ năng viết văn thông qua các bài tập về nhà và bài kiểm tra thường xuyên.\n    - Đối với những học sinh còn yếu, cần có sự kèm cặp, hướng dẫn riêng để cải thiện khả năng đọc hiểu và diễn đạt.","type":"essay","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Cho bảng điểm môn Ngữ văn của lớp 8B như sau:<br>$$ \\begin{array}{|c|l|c|c|c|c|} \\hline \\textbf{STT} & \\textbf{Họ và tên} & \\textbf{Kiểm tra miệng} & \\textbf{Kiểm tra 15 phút} & \\textbf{Kiểm tra giữa kì} & \\textbf{Kiểm tra cuối kì} \\\\ \\hline 1 & Nguyễn An & 7 & 8 & 9 & 8 \\\\ \\hline 2 & Trần Bình & 6 & 7 & 7 & 9 \\\\ \\hline 3 & Lê Cường & 8 & 9 & 8 & 7 \\\\ \\hline 4 & Phạm Dung & 5 & 8 & 9 & 8 \\\\ \\hline 5 & Hoàng Giang & 9 & 6 & 7 & 9 \\\\ \\hline 6 & Đặng Lan & 7 & 8 & 8 & 8 \\\\ \\hline 7 & Mai Ngọc & 6 & 9 & 6 & 10 \\\\ \\hline 8 & Nguyễn Phong & 8 & 7 & 7 & 8 \\\\ \\hline 9 & Lê Quỳnh & 7 & 8 & 9 & 9 \\\\ \\hline 10 & Hồ Sơn & 6 & 7 & 8 & 7 \\\\ \\hline \\end{array} $$<br>Giả sử bạn cần phân tích kết quả học tập của lớp 8B bằng chương trình bảng tính. Hãy trình bày cách bạn sẽ sử dụng các hàm tính toán cơ bản (SUM, AVERAGE, MAX, MIN, COUNT) để thực hiện các yêu cầu sau:<br>a) Tính tổng điểm và điểm trung bình của từng loại bài kiểm tra (Kiểm tra miệng, 15 phút, giữa kì, cuối kì).<br>b) Xác định điểm cao nhất và thấp nhất của từng loại bài kiểm tra.<br>c) Đếm xem có bao nhiêu học sinh có điểm Kiểm tra cuối kì từ $9$ trở lên.<br>d) Dựa trên các kết quả tính toán trên, hãy nhận xét về tình hình học tập môn Ngữ văn của lớp 8B và đề xuất một số giải pháp để cải thiện chất lượng học tập (nếu cần).","rendered_answer":"Gợi ý đáp án: a) Để tính tổng điểm và điểm trung bình của từng loại bài kiểm tra, giả sử các điểm Kiểm tra miệng nằm trong cột C, điểm 15 phút ở cột D, điểm giữa kì ở cột E và điểm cuối kì ở cột F, bắt đầu từ hàng 2 đến hàng 11 (C2:C11, D2:D11,...):<br>- Tổng điểm:<br>    - Kiểm tra miệng: `=SUM(C2:C11)`<br>    - Kiểm tra 15 phút: `=SUM(D2:D11)`<br>    - Kiểm tra giữa kì: `=SUM(E2:E11)`<br>    - Kiểm tra cuối kì: `=SUM(F2:F11)`<br>- Điểm trung bình:<br>    - Kiểm tra miệng: `=AVERAGE(C2:C11)`<br>    - Kiểm tra 15 phút: `=AVERAGE(D2:D11)`<br>    - Kiểm tra giữa kì: `=AVERAGE(E2:E11)`<br>    - Kiểm tra cuối kì: `=AVERAGE(F2:F11)`<br>b) Để xác định điểm cao nhất và thấp nhất của từng loại bài kiểm tra:<br>- Điểm cao nhất:<br>    - Kiểm tra miệng: `=MAX(C2:C11)`<br>    - Kiểm tra 15 phút: `=MAX(D2:D11)`<br>    - Kiểm tra giữa kì: `=MAX(E2:E11)`<br>    - Kiểm tra cuối kì: `=MAX(F2:F11)`<br>- Điểm thấp nhất:<br>    - Kiểm tra miệng: `=MIN(C2:C11)`<br>    - Kiểm tra 15 phút: `=MIN(D2:D11)`<br>    - Kiểm tra giữa kì: `=MIN(E2:E11)`<br>    - Kiểm tra cuối kì: `=MIN(F2:F11)`<br>c) Đếm xem có bao nhiêu học sinh có điểm Kiểm tra cuối kì từ $9$ trở lên:<br>Học sinh có điểm Kiểm tra cuối kì từ $9$ trở lên là: $10$ (Mai Ngọc), $9$ (Trần Bình), $9$ (Hoàng Giang), $9$ (Lê Quỳnh). Vậy có $4$ học sinh đạt điểm Kiểm tra cuối kì từ $9$ trở lên.<br>d) Nhận xét và đề xuất (ví dụ):<br>- Tính toán cụ thể (ví dụ):<br>    - Tổng điểm cuối kì: $83$<br>    - Điểm trung bình cuối kì: $8.3$<br>    - Điểm cao nhất cuối kì: $10$<br>    - Điểm thấp nhất cuối kì: $7$<br>    - Số học sinh đạt từ $9$ điểm trở lên ở Kiểm tra cuối kì: $4$ học sinh.<br>- Nhận xét: Kết quả Kiểm tra cuối kì của lớp 8B tương đối tốt với điểm trung bình là $8.3$. Tuy nhiên, điểm số có sự chênh lệch giữa các học sinh, với điểm thấp nhất là $7$ và số học sinh đạt điểm $9$ trở lên là $4$. Điều này cho thấy có một bộ phận học sinh còn chưa thực sự nắm vững kiến thức môn Ngữ văn.<br>- Đề xuất:<br>    - Tổ chức các buổi thảo luận nhóm về các tác phẩm văn học, khuyến khích học sinh chia sẻ cảm nhận và phân tích sâu hơn.<br>    - Tạo cơ hội cho học sinh luyện tập kỹ năng viết văn thông qua các bài tập về nhà và bài kiểm tra thường xuyên.<br>    - Đối với những học sinh còn yếu, cần có sự kèm cặp, hướng dẫn riêng để cải thiện khả năng đọc hiểu và diễn đạt."},{"question":"Bạn được giao nhiệm vụ tạo một danh sách chi tiêu cho chuyến dã ngoại của lớp. Danh sách cần bao gồm các cột sau: 'STT', 'Tên vật phẩm', 'Số lượng', 'Đơn giá', 'Thành tiền'. Sau khi nhập dữ liệu, bạn muốn bảng tính của mình dễ đọc, đẹp mắt và chuyên nghiệp. Hãy trình bày các bước bạn sẽ thực hiện trên phần mềm bảng tính (ví dụ: Microsoft Excel hoặc Google Sheets) để đạt được mục tiêu đó:a) Mô tả cách bạn sẽ tạo cấu trúc bảng (các tiêu đề cột) và nhập dữ liệu mẫu (ít nhất 3 dòng dữ liệu) vào bảng tính.b) Để các tiêu đề cột ('STT', 'Tên vật phẩm', 'Số lượng', 'Đơn giá', 'Thành tiền') trông nổi bật và dễ nhìn, bạn sẽ sử dụng những thao tác định dạng nào? Nêu rõ mục đích của mỗi thao tác.c) Nếu một số 'Tên vật phẩm' quá dài khiến chúng bị tràn sang ô bên cạnh hoặc bị cắt ngắn, bạn sẽ làm gì để đảm bảo tất cả tên vật phẩm đều hiển thị đầy đủ trong cột 'Tên vật phẩm'?","answer":"a) Để tạo cấu trúc bảng và nhập dữ liệu: Mở phần mềm bảng tính (ví dụ: Excel). Tại các ô đầu tiên của hàng 1 (ví dụ: A1, B1, C1, D1, E1), nhập lần lượt các tiêu đề cột 'STT', 'Tên vật phẩm', 'Số lượng', 'Đơn giá', 'Thành tiền'. Sau đó, từ hàng 2 trở đi, nhập dữ liệu mẫu vào các cột tương ứng (ví dụ: Hàng 2: 1, Bút chì, 10, 5000, 50000; Hàng 3: 2, Tập vở 100 trang, 5, 12000, 60000; Hàng 4: 3, Hộp màu nước, 1, 85000, 85000).b) Để các tiêu đề cột nổi bật và dễ nhìn, bạn có thể thực hiện các thao tác định dạng sau: chọn các ô chứa tiêu đề (A1:E1). Sau đó, bạn có thể thay đổi phông chữ và cỡ chữ để dễ đọc, bật in đậm (Bold) để làm cho tiêu đề nổi bật so với dữ liệu bên dưới, căn giữa nội dung trong ô để bảng tính trông gọn gàng và chuyên nghiệp hơn, hoặc thay đổi màu nền/màu chữ cho các ô tiêu đề để dễ phân biệt.c) Nếu 'Tên vật phẩm' quá dài, bạn có thể điều chỉnh độ rộng của cột 'Tên vật phẩm' bằng cách: Di chuyển con trỏ chuột đến đường biên giữa cột 'Tên vật phẩm' (ví dụ: cột B) và cột liền kề (ví dụ: cột C) trên tiêu đề cột. Khi con trỏ chuột chuyển thành hình mũi tên hai chiều, bạn có thể kéo chuột sang phải để tăng độ rộng cột thủ công. Hoặc nháy đúp chuột vào đường biên đó, phần mềm bảng tính sẽ tự động điều chỉnh độ rộng cột vừa với nội dung dài nhất trong cột.","type":"essay","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Bạn được giao nhiệm vụ tạo một danh sách chi tiêu cho chuyến dã ngoại của lớp. Danh sách cần bao gồm các cột sau: 'STT', 'Tên vật phẩm', 'Số lượng', 'Đơn giá', 'Thành tiền'. Sau khi nhập dữ liệu, bạn muốn bảng tính của mình dễ đọc, đẹp mắt và chuyên nghiệp. Hãy trình bày các bước bạn sẽ thực hiện trên phần mềm bảng tính (ví dụ: Microsoft Excel hoặc Google Sheets) để đạt được mục tiêu đó:a) Mô tả cách bạn sẽ tạo cấu trúc bảng (các tiêu đề cột) và nhập dữ liệu mẫu (ít nhất 3 dòng dữ liệu) vào bảng tính.b) Để các tiêu đề cột ('STT', 'Tên vật phẩm', 'Số lượng', 'Đơn giá', 'Thành tiền') trông nổi bật và dễ nhìn, bạn sẽ sử dụng những thao tác định dạng nào? Nêu rõ mục đích của mỗi thao tác.c) Nếu một số 'Tên vật phẩm' quá dài khiến chúng bị tràn sang ô bên cạnh hoặc bị cắt ngắn, bạn sẽ làm gì để đảm bảo tất cả tên vật phẩm đều hiển thị đầy đủ trong cột 'Tên vật phẩm'?","rendered_answer":"a) Để tạo cấu trúc bảng và nhập dữ liệu: Mở phần mềm bảng tính (ví dụ: Excel). Tại các ô đầu tiên của hàng 1 (ví dụ: A1, B1, C1, D1, E1), nhập lần lượt các tiêu đề cột 'STT', 'Tên vật phẩm', 'Số lượng', 'Đơn giá', 'Thành tiền'. Sau đó, từ hàng 2 trở đi, nhập dữ liệu mẫu vào các cột tương ứng (ví dụ: Hàng 2: 1, Bút chì, 10, 5000, 50000; Hàng 3: 2, Tập vở 100 trang, 5, 12000, 60000; Hàng 4: 3, Hộp màu nước, 1, 85000, 85000).b) Để các tiêu đề cột nổi bật và dễ nhìn, bạn có thể thực hiện các thao tác định dạng sau: chọn các ô chứa tiêu đề (A1:E1). Sau đó, bạn có thể thay đổi phông chữ và cỡ chữ để dễ đọc, bật in đậm (Bold) để làm cho tiêu đề nổi bật so với dữ liệu bên dưới, căn giữa nội dung trong ô để bảng tính trông gọn gàng và chuyên nghiệp hơn, hoặc thay đổi màu nền/màu chữ cho các ô tiêu đề để dễ phân biệt.c) Nếu 'Tên vật phẩm' quá dài, bạn có thể điều chỉnh độ rộng của cột 'Tên vật phẩm' bằng cách: Di chuyển con trỏ chuột đến đường biên giữa cột 'Tên vật phẩm' (ví dụ: cột B) và cột liền kề (ví dụ: cột C) trên tiêu đề cột. Khi con trỏ chuột chuyển thành hình mũi tên hai chiều, bạn có thể kéo chuột sang phải để tăng độ rộng cột thủ công. Hoặc nháy đúp chuột vào đường biên đó, phần mềm bảng tính sẽ tự động điều chỉnh độ rộng cột vừa với nội dung dài nhất trong cột."},{"question":"Lan, một bạn cùng lớp của em, bất ngờ đăng một bức ảnh của em lên mạng xã hội kèm theo những lời bình luận không đúng sự thật, có ý chế giễu và xúc phạm em. Nhiều bạn khác trong nhóm cũng bắt đầu chia sẻ và bình luận tiêu cực về em. Em cảm thấy rất buồn, xấu hổ và không biết phải làm gì. 1. Trong tình huống này, em sẽ làm gì đầu tiên để xử lý thông tin sai lệch và những bình luận tiêu cực đó? (Kể ra ít nhất 3 hành động cụ thể). 2. Em sẽ tìm kiếm sự giúp đỡ từ những ai? Giải thích lý do vì sao em chọn những người đó để chia sẻ và nhận lời khuyên. 3. Để phòng tránh những tình huống tương tự trong tương lai và bảo vệ bản thân trên môi trường mạng, em cần có những quy tắc ứng xử như thế nào?","answer":"1. Hành động xử lý thông tin sai lệch và bình luận tiêu cực: Giữ bình tĩnh, không phản ứng nóng vội hay đôi co. Chụp lại màn hình các bài viết và bình luận làm bằng chứng. Yêu cầu bạn Lan gỡ bài viết đó, nếu không được thì báo cáo bài viết hoặc tài khoản. Chặn tài khoản của Lan và những người có bình luận tiêu cực nếu cần. 2. Tìm kiếm sự giúp đỡ từ: Bố mẹ/người thân (họ có kinh nghiệm, đáng tin cậy và có thể giúp em liên hệ với nhà trường hoặc các cơ quan có thẩm quyền nếu cần); Thầy cô giáo/cán bộ Đoàn, Đội (họ có trách nhiệm trong môi trường học đường, có thể đứng ra giải quyết mâu thuẫn hoặc tư vấn cho em). 3. Quy tắc ứng xử để phòng tránh và bảo vệ bản thân: Luôn suy nghĩ kỹ trước khi đăng tải hoặc chia sẻ bất kỳ thông tin, hình ảnh cá nhân nào lên mạng xã hội. Cài đặt chế độ riêng tư cho tài khoản cá nhân. Không kết bạn hoặc tin tưởng người lạ trên mạng. Cảnh giác với các tin nhắn, lời mời từ người lạ. Học cách nhận diện và không tin vào những thông tin xấu, sai sự thật. Duy trì thái độ tích cực và không quá bận tâm đến những bình luận tiêu cực không đáng có.","type":"essay","isDirty":false,"explanation":null,"shuffleOptions":{"stem":true,"answers":true},"rendered_question":"Lan, một bạn cùng lớp của em, bất ngờ đăng một bức ảnh của em lên mạng xã hội kèm theo những lời bình luận không đúng sự thật, có ý chế giễu và xúc phạm em. Nhiều bạn khác trong nhóm cũng bắt đầu chia sẻ và bình luận tiêu cực về em. Em cảm thấy rất buồn, xấu hổ và không biết phải làm gì. 1. Trong tình huống này, em sẽ làm gì đầu tiên để xử lý thông tin sai lệch và những bình luận tiêu cực đó? (Kể ra ít nhất 3 hành động cụ thể). 2. Em sẽ tìm kiếm sự giúp đỡ từ những ai? Giải thích lý do vì sao em chọn những người đó để chia sẻ và nhận lời khuyên. 3. Để phòng tránh những tình huống tương tự trong tương lai và bảo vệ bản thân trên môi trường mạng, em cần có những quy tắc ứng xử như thế nào?","rendered_answer":"1. Hành động xử lý thông tin sai lệch và bình luận tiêu cực: Giữ bình tĩnh, không phản ứng nóng vội hay đôi co. Chụp lại màn hình các bài viết và bình luận làm bằng chứng. Yêu cầu bạn Lan gỡ bài viết đó, nếu không được thì báo cáo bài viết hoặc tài khoản. Chặn tài khoản của Lan và những người có bình luận tiêu cực nếu cần. 2. Tìm kiếm sự giúp đỡ từ: Bố mẹ/người thân (họ có kinh nghiệm, đáng tin cậy và có thể giúp em liên hệ với nhà trường hoặc các cơ quan có thẩm quyền nếu cần); Thầy cô giáo/cán bộ Đoàn, Đội (họ có trách nhiệm trong môi trường học đường, có thể đứng ra giải quyết mâu thuẫn hoặc tư vấn cho em). 3. Quy tắc ứng xử để phòng tránh và bảo vệ bản thân: Luôn suy nghĩ kỹ trước khi đăng tải hoặc chia sẻ bất kỳ thông tin, hình ảnh cá nhân nào lên mạng xã hội. Cài đặt chế độ riêng tư cho tài khoản cá nhân. Không kết bạn hoặc tin tưởng người lạ trên mạng. Cảnh giác với các tin nhắn, lời mời từ người lạ. Học cách nhận diện và không tin vào những thông tin xấu, sai sự thật. Duy trì thái độ tích cực và không quá bận tâm đến những bình luận tiêu cực không đáng có."}];
        const options = {"title":"Bài kiểm tra - 29/11/2025","timeLimit":0,"retriesAllowed":10,"showAnswers":true,"showExplanation":true,"aiAssessment":true,"shortAnswerFormat":"form","examCode":"DFNR6G","teacherName":"Thạch Nê","scoring":{"mc":5,"tf":0,"sa":0,"essay":3,"tfMethod":"progressive"}};
        const googleScriptUrl = "https://script.google.com/macros/s/AKfycbyXVOPPNSSP5FmrTv_9C3ZOWiBAoMwPyRo7TwMrArLCHPEHFv9FgeBznHiBAR5yIl-4rQ/exec";
        const examCode = "DFNR6G";
        
        let userAnswers = new Array(quizData.length).fill(null);
        let studentName = '';
        let studentClass = '';
        let timerInterval;
        let timeRemaining = options.timeLimit * 60;
        let retriesCount = 0;
        let submissionStatus = 'pending';
        let monitoringLog = { thoatManHinh: 0, saoChep: 0, dan: 0 };
        let lastScore, lastAnswerDetails; // For retrying AI assessment

        // --- UTILS FOR SHUFFLING ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function mapType(typeStr) {
             if (!typeStr) return 'multiple-choice';
             if (typeStr.startsWith('mc-') || ['cloze-test', 'sentence-ordering', 'multiple-choice', 'paragraph-sentence-ordering'].includes(typeStr)) return 'multiple-choice';
             if (typeStr.startsWith('tf-') || typeStr === 'true-false') return 'true-false';
             if (typeStr === 'short-answer' || typeStr === 'sentence-transformation') return 'short-answer';
             return 'essay';
        }

        // --- SHUFFLE LOGIC FOR ONLINE QUIZ ---
        function applyShuffling() {
            // 1. Shuffle Options/Statements within each question
            quizData.forEach(item => {
                const shuffleOpts = item.shuffleOptions || { answers: true };
                const type = mapType(item.type);
                
                if (shuffleOpts.answers) {
                    if (type === 'multiple-choice' && item.rendered_options && item.rendered_options.length > 0) {
                        // Create indices array to shuffle
                        const indices = item.rendered_options.map((_, i) => i);
                        shuffleArray(indices);
                        
                        // Reorder rendered_options based on shuffled indices
                        item.rendered_options = indices.map(i => item.rendered_options[i]);
                        
                        // Reorder raw options (needed for review/explanation context, though mostly rendered is used)
                        if (item.options) {
                            item.options = indices.map(i => item.options[i]);
                        }
                        
                        // Update correctAnswerIndex
                        // Old index was item.correctAnswerIndex. We need to find where it went.
                        // New index is the position of the old correct index in the shuffled 'indices' array.
                        item.correctAnswerIndex = indices.indexOf(item.correctAnswerIndex);

                    } else if (type === 'true-false' && item.statements && item.statements.length > 0) {
                        // Shuffle statements array directly
                        shuffleArray(item.statements);
                    }
                }
            });

            // 2. Shuffle Question Order within Parts (respecting "Câu dẫn" aka Stem shuffle option)
            // We group questions by type first to ensure we don't mix sections
            const groupedQuestions = quizData.reduce((acc, q, index) => {
                const type = mapType(q.type);
                if (!acc[type]) acc[type] = [];
                acc[type].push({ ...q, originalIndex: index });
                return acc;
            }, {});
            
            const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
            let newQuizData = [];

            partOrder.forEach(partType => {
                const questions = groupedQuestions[partType];
                if (questions) {
                    const finalPartQuestions = new Array(questions.length).fill(null);
                    const shufflableQuestions = [];
                    
                    // Separate fixed and shufflable questions
                    questions.forEach((q, i) => {
                        const shuffleOpts = q.shuffleOptions || { stem: true };
                        if (shuffleOpts.stem) {
                            shufflableQuestions.push(q);
                        } else {
                            finalPartQuestions[i] = q;
                        }
                    });

                    // Shuffle the shufflable ones
                    shuffleArray(shufflableQuestions);

                    // Merge back
                    let shufflableIndex = 0;
                    for (let i = 0; i < finalPartQuestions.length; i++) {
                        if (finalPartQuestions[i] === null) {
                            finalPartQuestions[i] = shufflableQuestions[shufflableIndex];
                            shufflableIndex++;
                        }
                    }
                    newQuizData = newQuizData.concat(finalPartQuestions);
                }
            });
            
            // Update the global quizData with the shuffled version
            if (newQuizData.length === quizData.length) {
                quizData = newQuizData;
            }
            
            // Reset user answers array to match new length (though length is same) and clear it
            userAnswers = new Array(quizData.length).fill(null);
        }
        
        // --- FALLBACK MODELS CONFIGURATION ---
        const GEMINI_MODELS_FALLBACK = [
          "gemini-2.5-flash",
          "gemini-2.5-flash-lite",
          "gemini-2.0-flash",
          "gemini-2.0-flash-lite",
          "gemini-2.5-pro",
          "gemini-1.5-pro",
          "gemini-1.5-flash"
        ];

        // --- FALLBACK API FUNCTION FOR CLIENT (STUDENT VIEW) ---
        async function generateContentWithFallback(ai, contents, preferredModel = "gemini-2.5-flash") {
            if (!ai) throw new Error("AI instance not provided.");
            
            const uniqueModels = [...new Set([preferredModel, ...GEMINI_MODELS_FALLBACK])];
            
            let lastError;
            for (const model of uniqueModels) {
                try {
                    const response = await ai.models.generateContent({
                        model: model,
                        contents: contents
                    });
                    return response;
                } catch (error) {
                    console.warn('Model failed:', model, error);
                    lastError = error;
                    const errStr = error.toString().toLowerCase();
                    if (errStr.includes("429") || errStr.includes("quota") || errStr.includes("exhausted") || 
                        errStr.includes("503") || errStr.includes("overloaded") || errStr.includes("500") || 
                        errStr.includes("internal") || errStr.includes("resource") || errStr.includes("not found")) {
                        continue;
                    }
                     continue;
                }
            }
            throw lastError || new Error("Tất cả các mô hình AI đều bận hoặc gặp sự cố. Vui lòng thử lại sau.");
        }

        const welcomeScreen = document.getElementById('welcome-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startBtn = document.getElementById('start-btn');
        const nameInput = document.getElementById('name');
        const classInput = document.getElementById('class');
        const timerEl = document.getElementById('timer');
        const submitBtn = document.getElementById('submit-btn');
        const submitBtnTop = document.getElementById('submit-btn-top');
        const scoreDisplay = document.getElementById('score-display');
        const assessmentDisplay = document.getElementById('assessment-display');
        const reviewContainer = document.getElementById('review-container');
        const retryBtn = document.getElementById('retry-btn');
        const restartBtn = document.getElementById('restart-btn');
        const warningEl = document.getElementById('monitoring-warning');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');
        const toggleNavBtn = document.getElementById('toggle-nav-btn');
        const navPanel = document.getElementById('nav-panel');
        const navGrid = document.getElementById('nav-grid');

        window.selectOption = selectOption;
        window.selectTFOption = selectTFOption;
        window.saveTextAnswer = saveTextAnswer;
        window.toggleExplanation = toggleExplanation;
        window.fetchAndRenderExplanation = fetchAndRenderExplanation;
        window.retryAIAssessment = retryAIAssessment;
        window.setupFormInputs = setupFormInputs;
        window.saveFormAnswer = saveFormAnswer;
        window.scrollToQuestion = scrollToQuestion;

        startBtn.addEventListener('click', startQuiz);
        submitBtn.addEventListener('click', confirmSubmit);
        submitBtnTop.addEventListener('click', confirmSubmit);
        retryBtn.addEventListener('click', retryQuiz);
        restartBtn.addEventListener('click', () => window.location.reload());
        
        toggleNavBtn.addEventListener('click', () => {
            navPanel.classList.toggle('open');
            document.body.classList.toggle('nav-open');
        });

        nameInput.value = localStorage.getItem('studentName') || '';
        classInput.value = localStorage.getItem('studentClass') || '';
        
        function safeTypeset(elements) {
            if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                window.MathJax.typesetPromise(elements).catch(function (err) {
                    console.error('MathJax error: ' + err.message);
                });
            }
        }
        
        function startQuiz() {
            studentName = nameInput.value.trim();
            studentClass = classInput.value.trim();
            if (!studentName || !studentClass) {
                alert('Vui lòng nhập đầy đủ Họ và tên và Lớp.');
                return;
            }
            localStorage.setItem('studentName', studentName);
            localStorage.setItem('studentClass', studentClass);
            
            document.getElementById('student-name-display').textContent = studentName;

            applyShuffling();
            
            welcomeScreen.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            resultsScreen.classList.add('hidden');
            progressContainer.classList.remove('hidden');
            toggleNavBtn.classList.remove('hidden');
            
            if (window.innerWidth > 1024) {
                navPanel.classList.add('open');
                document.body.classList.add('nav-open');
            }

            userAnswers = new Array(quizData.length).fill(null);
            submissionStatus = 'pending';
            
            renderAllQuestions();
            renderNavPanel();
            updateProgress();
            
            if (options.timeLimit > 0) {
                timeRemaining = options.timeLimit * 60;
                startTimer();
            } else {
                timerEl.textContent = '∞';
            }
            startMonitoring();
        }

        function renderNavPanel() {
            navGrid.innerHTML = '';
            quizData.forEach((_, index) => {
                const btn = document.createElement('button');
                btn.className = 'nav-btn';
                btn.id = `nav-btn-${index}`;
                btn.textContent = index + 1;
                btn.onclick = () => scrollToQuestion(index);
                navGrid.appendChild(btn);
            });
        }

        function scrollToQuestion(index) {
            const el = document.getElementById(`q-${index}`);
            if (el) {
                const offset = 100; 
                const elementPosition = el.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - offset;
                window.scrollTo({ top: offsetPosition, behavior: "smooth" });
                
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('current'));
                document.getElementById(`nav-btn-${index}`)?.classList.add('current');
            }
            if (window.innerWidth <= 1024) {
                navPanel.classList.remove('open');
                document.body.classList.remove('nav-open');
            }
        }

        function updateProgress() {
            let answeredCount = 0;
            quizData.forEach((item, index) => {
                const answer = userAnswers[index];
                const type = mapType(item.type);
                let isAnswered = false;

                if (type === 'multiple-choice') {
                    isAnswered = answer !== null;
                } else if (type === 'true-false') {
                    isAnswered = Array.isArray(answer) && answer.filter(x => x !== null).length === item.statements.length;
                } else { 
                    isAnswered = answer && String(answer).trim().length > 0;
                }

                const btn = document.getElementById(`nav-btn-${index}`);
                if (isAnswered) {
                    answeredCount++;
                    btn?.classList.add('answered');
                } else {
                    btn?.classList.remove('answered');
                }
            });

            const percent = Math.round((answeredCount / quizData.length) * 100);
            progressBar.style.width = `${percent}%`;
        }
        
        function renderAllQuestions() {
            const container = document.getElementById('all-questions-container');
            let allHTML = '';

            const groupedQuestions = quizData.reduce((acc, q) => {
                const type = mapType(q.type);
                if (!acc[type]) acc[type] = [];
                acc[type].push(q);
                return acc;
            }, {});

            const groupInfo = {
                'multiple-choice': { title: 'PHẦN I. TRẮC NGHIỆM NHIỀU LỰA CHỌN', color: 'blue' },
                'true-false': { title: 'PHẦN II. TRẮC NGHIỆM ĐÚNG/SAI', color: 'purple' },
                'short-answer': { title: 'PHẦN III. TRẢ LỜI NGẮN', color: 'teal' },
                'essay': { title: 'PHẦN IV. TỰ LUẬN', color: 'orange' },
            };
            
            let questionCounter = 0;
            const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];

            partOrder.forEach(partType => {
                const questions = groupedQuestions[partType];
                if (!questions || questions.length === 0) return;

                const info = groupInfo[partType];
                allHTML += `
                    <div class="mb-6 pb-2 border-b-2 border-${info.color}-200 flex items-center gap-2">
                        <span class="bg-${info.color}-100 text-${info.color}-700 p-1.5 rounded-md">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                            </svg>
                        </span>
                        <h2 class="text-xl md:text-2xl font-bold text-gray-800">${info.title}</h2>
                    </div>`;
                
                questions.forEach((item) => {
                    const index = quizData.indexOf(item);
                    questionCounter++;
                    
                    let contentHTML = `<div class="question-card mb-8 p-6 border border-gray-200 bg-white rounded-2xl shadow-sm hover:shadow-md transition-shadow scroll-mt-32" id="q-${index}">`;
                    contentHTML += `
                        <div class="flex items-start gap-3 mb-4">
                             <span class="bg-gray-100 text-gray-700 font-bold px-3 py-1 rounded-lg text-sm shadow-sm">Câu ${questionCounter}</span>
                        </div>
                    `;
                    contentHTML += `<div class="prose max-w-none text-gray-800 mb-6 font-medium text-lg leading-relaxed">${item.rendered_question || ''}</div>`;

                    let answerHTML = '';
                    const savedAnswer = userAnswers[index];
                    const type = mapType(item.type);
                    
                    if (type === 'multiple-choice') {
                        answerHTML = `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">`;
                        (item.rendered_options || []).forEach((opt, i) => {
                            const isSelected = savedAnswer === i;
                            answerHTML += `
                                <div class="option ${isSelected ? 'selected' : ''} p-4 border border-gray-200 rounded-xl cursor-pointer flex items-start gap-3 hover:bg-gray-50" data-q-index="${index}" data-opt-index="${i}" onclick="selectOption(this, ${index}, ${i})">
                                    <div class="flex-shrink-0 w-8 h-8 rounded-full border-2 ${isSelected ? 'border-indigo-600 bg-indigo-600 text-white' : 'border-gray-300 text-gray-500'} flex items-center justify-center font-bold text-sm transition-colors">${String.fromCharCode(65 + i)}</div>
                                    <div class="flex-grow pt-1 text-gray-700">${opt}</div>
                                </div>`;
                        });
                        answerHTML += `</div>`;
                    } else if (type === 'true-false') {
                         answerHTML = `<div class="space-y-3">`;
                         (item.statements || []).forEach((stmt, i) => {
                            const savedStmtAnswer = savedAnswer ? savedAnswer[i] : null;
                            const isTrueSelected = savedStmtAnswer === true;
                            const isFalseSelected = savedStmtAnswer === false;
                            answerHTML += `<div class="p-4 border border-gray-200 rounded-xl bg-gray-50 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                                                <div class="flex-grow flex gap-3">
                                                    <span class="font-bold text-gray-500">${String.fromCharCode(97 + i)})</span>
                                                    <div class="prose max-w-none text-gray-700">${stmt.rendered_statement}</div>
                                                </div>
                                                <div class="flex-shrink-0 flex gap-2 self-end sm:self-auto">
                                                    <button class="${isTrueSelected ? 'bg-blue-600 text-white shadow-md ring-2 ring-blue-300' : 'bg-white text-gray-600 border border-gray-300 hover:bg-blue-50'} px-5 py-2 rounded-lg font-semibold transition-all" onclick="selectTFOption(this, ${index}, ${i}, true)">Đúng</button>
                                                    <button class="${isFalseSelected ? 'bg-red-500 text-white shadow-md ring-2 ring-red-300' : 'bg-white text-gray-600 border border-gray-300 hover:bg-red-50'} px-5 py-2 rounded-lg font-semibold transition-all" onclick="selectTFOption(this, ${index}, ${i}, false)">Sai</button>
                                                </div>
                                            </div>`;
                        });
                        answerHTML += `</div>`;
                    } else if (type === 'short-answer') {
                        const savedAnswerStr = userAnswers[index] || '';
                        if (options.shortAnswerFormat === 'form') {
                             answerHTML = `<div id="sa-form-${index}" class="flex items-center gap-3 p-4 bg-teal-50 rounded-xl border border-teal-100">`;
                            for (let i = 0; i < 4; i++) {
                                answerHTML += `<input type="text" maxlength="1" data-q-index="${index}" class="w-12 h-14 text-center text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-teal-500 focus:ring focus:ring-teal-200 focus:outline-none bg-white shadow-sm transition-all" value="">`;
                            }
                            answerHTML += `</div>`;
                        } else {
                            answerHTML = `<input type="text" class="w-full border-gray-300 rounded-xl p-4 shadow-sm focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all text-lg" placeholder="Nhập câu trả lời của bạn..." value="${savedAnswerStr}" onchange="saveTextAnswer(this, ${index})">`;
                        }
                    } else if (type === 'essay') {
                        answerHTML = `<textarea class="w-full border-gray-300 rounded-xl p-4 shadow-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all" rows="6" placeholder="Nhập bài làm tự luận..." onchange="saveTextAnswer(this, ${index})">${savedAnswer || ''}</textarea>`;
                    }

                    contentHTML += answerHTML + '</div>';
                    allHTML += contentHTML;
                });
            });
            container.innerHTML = allHTML;

            document.querySelectorAll('[id^="sa-form-"]').forEach(formContainer => {
                const inputs = formContainer.querySelectorAll('input');
                if (inputs.length > 0) {
                    setupFormInputs(inputs);
                }
            });

            safeTypeset([container]);
        }

        function setupFormInputs(inputs) {
            const qIndex = inputs[0].dataset.qIndex;
            inputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (e.target.value && index < inputs.length - 1) {
                        inputs[index + 1].focus();
                    }
                    saveFormAnswer(qIndex, inputs);
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value && index > 0) {
                        inputs[index - 1].focus();
                    }
                     saveFormAnswer(qIndex, inputs);
                });
                 input.addEventListener('change', () => saveFormAnswer(qIndex, inputs));
            });
        }

        function saveFormAnswer(qIndex, inputs) {
            let combinedValue = '';
            inputs.forEach(inp => { combinedValue += inp.value; });
            userAnswers[qIndex] = combinedValue;
            updateProgress();
        }

        function selectOption(element, qIndex, optIndex) {
            userAnswers[qIndex] = optIndex;
            const questionCard = document.getElementById(`q-${qIndex}`);
            questionCard.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
                opt.querySelector('div:first-child').classList.remove('border-indigo-600', 'bg-indigo-600', 'text-white');
                opt.querySelector('div:first-child').classList.add('border-gray-300', 'text-gray-500');
            });
            element.classList.add('selected');
            element.querySelector('div:first-child').classList.remove('border-gray-300', 'text-gray-500');
            element.querySelector('div:first-child').classList.add('border-indigo-600', 'bg-indigo-600', 'text-white');
            updateProgress();
        }
        
        function selectTFOption(button, qIndex, stmtIndex, answer) {
            if (!userAnswers[qIndex] || !Array.isArray(userAnswers[qIndex])) {
                userAnswers[qIndex] = new Array(quizData[qIndex].statements.length).fill(null);
            }
            userAnswers[qIndex][stmtIndex] = answer;
            const parent = button.parentElement;
            
            // Reset styles
            const trueBtn = parent.children[0];
            const falseBtn = parent.children[1];
            
            trueBtn.className = 'bg-white text-gray-600 border border-gray-300 hover:bg-blue-50 px-5 py-2 rounded-lg font-semibold transition-all';
            falseBtn.className = 'bg-white text-gray-600 border border-gray-300 hover:bg-red-50 px-5 py-2 rounded-lg font-semibold transition-all';

            if (answer) {
                trueBtn.className = 'bg-blue-600 text-white shadow-md ring-2 ring-blue-300 px-5 py-2 rounded-lg font-semibold transition-all';
            } else {
                falseBtn.className = 'bg-red-500 text-white shadow-md ring-2 ring-red-300 px-5 py-2 rounded-lg font-semibold transition-all';
            }
            updateProgress();
        }
        
        function saveTextAnswer(element, qIndex) {
            userAnswers[qIndex] = element.value;
            updateProgress();
        }

        function confirmSubmit() {
            const unansweredQuestions = userAnswers.map((answer, index) => ({ answer, index }))
                                                .filter(item => item.answer === null || 
                                                                (Array.isArray(item.answer) && item.answer.some(a => a === null)));

            let message = "Bạn có chắc chắn muốn nộp bài không?";
            if (unansweredQuestions.length > 0) {
                message = `Bạn còn ${unansweredQuestions.length} câu chưa hoàn thành. Bạn có chắc chắn muốn nộp bài không?`;
            }

            if (confirm(message)) {
                submitQuiz();
            }
        }

        async function submitQuiz() {
            if (submissionStatus !== 'pending') return;
            submissionStatus = 'submitting';
            stopTimer();
            stopMonitoring();
            
            const submitBtnEl = document.getElementById('submit-btn');
            submitBtnEl.disabled = true;
            submitBtnEl.innerHTML = '<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Đang nộp bài...';
            
            progressContainer.classList.add('hidden');
            toggleNavBtn.classList.add('hidden');
            navPanel.classList.remove('open');
            document.body.classList.remove('nav-open');

            const { score, totalPossibleScore, answerDetails } = calculateScore();
            lastScore = score;
            lastAnswerDetails = answerDetails;
            const finalScore = (totalPossibleScore > 0 ? (score / totalPossibleScore * 10) : 0).toFixed(2);
            let aiAssessment = 'Không có';

            if (options.aiAssessment) {
                aiAssessment = await getAIAssessment(finalScore, answerDetails);
            }
            
            const submissionData = new FormData();
            submissionData.append('timestamp', new Date().toLocaleString('vi-VN'));
            submissionData.append('name', studentName);
            submissionData.append('class', studentClass);
            submissionData.append('score', finalScore);
            submissionData.append('assessment', aiAssessment);
            submissionData.append('examCode', examCode);
            submissionData.append('monitoringLog', JSON.stringify(monitoringLog));
            submissionData.append('answerDetails', JSON.stringify(answerDetails));
            
            if (googleScriptUrl) {
                try {
                    await fetch(googleScriptUrl, { method: 'POST', body: new URLSearchParams(submissionData) });
                } catch (error) {
                    console.error('Error submitting to Google Script:', error);
                    alert('Lỗi: Không thể nộp kết quả lên hệ thống. Vui lòng kiểm tra lại kết nối mạng và thử lại.');
                }
            }
            submissionStatus = 'submitted';
            showResults(finalScore, aiAssessment, answerDetails);
        }
        
        function showResults(score, assessment, answerDetails) {
            quizScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            // Trigger Confetti
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#6366f1', '#8b5cf6', '#ec4899', '#14b8a6']
            });
            
            if (options.showAnswers) {
                const scoreDisplay = document.getElementById('score-display');
                scoreDisplay.querySelector('span:last-child').textContent = score;
                scoreDisplay.classList.remove('hidden');
            } else {
                const scoreDisplay = document.getElementById('score-display');
                scoreDisplay.innerHTML = '<p class="text-3xl text-center text-green-600 font-bold mb-4">Nộp bài thành công!</p><p class="text-gray-500">Kết quả đã được ghi nhận.</p>';
                scoreDisplay.classList.remove('hidden');
            }
            
            if (options.aiAssessment) {
                if (assessment.startsWith("Lỗi")) {
                    // handled
                } else {
                     document.querySelector('#assessment-display .assessment-content').innerHTML = assessment.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                     assessmentDisplay.classList.remove('hidden');
                }
            } else {
                assessmentDisplay.classList.add('hidden');
            }
            
            if (options.showAnswers) {
                renderReview(answerDetails);
            } else {
                reviewContainer.innerHTML = '<div class="text-center p-8 bg-gray-50 rounded-xl border border-gray-200"><p class="text-gray-600">Giáo viên đã chọn không hiển thị đáp án và giải thích chi tiết.</p></div>';
            }
            
            if (retriesCount < options.retriesAllowed) retryBtn.classList.remove('hidden');
        }

        function calculateScore() {
            let score = 0;
            let totalPossibleScore = 0;
            const answerDetails = [];
            
            const mcCount = quizData.filter(q => mapType(q.type) === 'multiple-choice').length;
            const tfCount = quizData.filter(q => mapType(q.type) === 'true-false').length;
            const saCount = quizData.filter(q => mapType(q.type) === 'short-answer').length;

            const pointsPerMc = mcCount > 0 ? options.scoring.mc / mcCount : 0;
            const pointsPerTf = tfCount > 0 ? options.scoring.tf / tfCount : 0;
            const pointsPerSa = saCount > 0 ? options.scoring.sa / saCount : 0;
            
            totalPossibleScore = (options.scoring.mc || 0) + (options.scoring.tf || 0) + (options.scoring.sa || 0) + (options.scoring.essay || 0);
            if (totalPossibleScore === 0 && (mcCount + tfCount + saCount > 0)) {
                 totalPossibleScore = (pointsPerMc * mcCount) + (pointsPerTf * tfCount) + (pointsPerSa * saCount);
            }
            if (totalPossibleScore === 0 && quizData.length > 0) totalPossibleScore = 10; 

            quizData.forEach((item, index) => {
                const userAnswer = userAnswers[index];
                let isCorrect = false;
                let detail = null;
                const type = mapType(item.type);

                if (type === 'multiple-choice') {
                    isCorrect = userAnswer === item.correctAnswerIndex;
                    if(isCorrect) score += pointsPerMc;
                } else if (type === 'true-false') {
                    let correctStatements = 0;
                    detail = [];
                    (item.statements || []).forEach((stmt, i) => {
                        const isStmtCorrect = (userAnswer && userAnswer[i] === stmt.is_correct);
                        if(isStmtCorrect) correctStatements++;
                        detail.push({isCorrect: isStmtCorrect});
                    });

                    if (options.scoring.tfMethod === 'even') {
                        score += (correctStatements / 4) * pointsPerTf;
                    } else { // progressive
                        if (correctStatements === 4) score += pointsPerTf;
                        else if (correctStatements === 3) score += 0.5 * pointsPerTf;
                        else if (correctStatements === 2) score += 0.25 * pointsPerTf;
                        else if (correctStatements === 1) score += 0.1 * pointsPerTf;
                    }
                    isCorrect = correctStatements === 4;
                } else if (type === 'short-answer') {
                    const correctAnswer = (item.answer || '').toString().trim().toLowerCase();
                    const studentAnswer = (userAnswer || '').toString().trim().toLowerCase();
                    isCorrect = studentAnswer === correctAnswer;
                    if (isCorrect) {
                        score += pointsPerSa;
                    }
                } else {
                    isCorrect = null; // For 'essay' type
                }
                answerDetails.push({ questionNumber: index + 1, isCorrect, type, details: detail });
            });
            return { score, totalPossibleScore, answerDetails };
        }
        
        function renderReview(answerDetails) {
            let reviewHTML = '<h3 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Xem lại bài làm chi tiết</h3>';
            quizData.forEach((item, index) => {
                const type = mapType(item.type);
                const detail = answerDetails.find(d => d.questionNumber === index + 1);
                const isCorrectQuestion = detail?.isCorrect;

                let borderColor = isCorrectQuestion ? 'border-green-200' : (isCorrectQuestion === false ? 'border-red-200' : 'border-gray-200');
                let bgColor = isCorrectQuestion ? 'bg-green-50' : (isCorrectQuestion === false ? 'bg-red-50' : 'bg-gray-50');
                
                reviewHTML += `<div class="mb-8 p-6 border ${borderColor} rounded-2xl ${bgColor} shadow-sm relative overflow-hidden">`;
                
                // Status Badge
                if (type !== 'essay') {
                     reviewHTML += `<div class="absolute top-0 right-0 px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-bl-lg ${isCorrectQuestion ? 'bg-green-500 text-white' : 'bg-red-500 text-white'}">${isCorrectQuestion ? 'Đúng' : 'Sai'}</div>`;
                }

                reviewHTML += `<div class="flex gap-2 mb-3"><span class="bg-white border border-gray-200 text-gray-700 font-bold px-2.5 py-0.5 rounded-md text-sm">Câu ${index + 1}</span></div>`;
                reviewHTML += `<div class="prose max-w-none mb-4 text-gray-800">${item.rendered_question}</div>`;

                if (type === 'multiple-choice') {
                     reviewHTML += '<div class="space-y-2">';
                     (item.rendered_options || []).forEach((opt, i) => {
                        let classes = 'p-3 border rounded-lg flex items-start gap-3';
                        let icon = '';
                        
                        if (i === item.correctAnswerIndex) {
                            classes += ' bg-green-100 border-green-400 ring-1 ring-green-400'; // Correct answer style
                            icon = '<svg class="w-5 h-5 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                        } else if (userAnswers[index] === i) {
                            classes += ' bg-red-100 border-red-400'; // Selected wrong answer
                            icon = '<svg class="w-5 h-5 text-red-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>';
                        } else {
                            classes += ' bg-white border-gray-200 opacity-70';
                        }

                        reviewHTML += `<div class="${classes}">
                            <span class="font-bold flex-shrink-0 w-6">${String.fromCharCode(65 + i)}.</span>
                            <div class="flex-grow">${opt}</div>
                            ${icon}
                        </div>`;
                     });
                     reviewHTML += '</div>';
                } else if (type === 'true-false') {
                     reviewHTML += '<div class="space-y-2 mt-4">';
                     (item.statements || []).forEach((stmt, i) => {
                         const userChoice = userAnswers[index] ? userAnswers[index][i] : null;
                         const isStmtCorrect = userChoice === stmt.is_correct;
                         let classes = 'p-3 border rounded-lg flex items-center justify-between gap-4 bg-white';
                         
                         if (userChoice !== null) {
                            classes = isStmtCorrect ? 'p-3 border border-green-300 bg-green-100 rounded-lg flex items-center justify-between gap-4' : 'p-3 border border-red-300 bg-red-100 rounded-lg flex items-center justify-between gap-4';
                         }

                         reviewHTML += `<div class="${classes}">
                                         <div class="prose max-w-none text-sm">${stmt.rendered_statement}</div>
                                         <div class="flex-shrink-0 text-right text-sm">
                                             <div class="${stmt.is_correct ? 'text-green-700 font-bold' : 'text-red-700 font-bold'}">Đáp án: ${stmt.is_correct ? 'Đúng' : 'Sai'}</div>
                                             <div class="text-gray-600">Bạn chọn: <span class="font-medium">${userChoice === true ? 'Đúng' : userChoice === false ? 'Sai' : '...'}</span></div>
                                         </div>
                                     </div>`;
                     });
                     reviewHTML += '</div>';
                } else {
                    reviewHTML += `<div class="mt-4 p-4 bg-white border border-gray-200 rounded-xl">
                        <p class="text-sm font-bold text-gray-500 mb-1">Câu trả lời của bạn:</p>
                        <div class="text-gray-800">${userAnswers[index] || '<em class="text-gray-400">Chưa trả lời</em>'}</div>
                    </div>`;
                    if (item.rendered_answer) {
                        reviewHTML += `<div class="mt-3 p-4 bg-green-50 border border-green-200 rounded-xl">
                            <p class="text-sm font-bold text-green-700 mb-1">Đáp án gợi ý:</p>
                            <div class="prose max-w-none text-green-900">${item.rendered_answer}</div>
                        </div>`;
                    }
                }
                
                if (options.showExplanation) {
                     reviewHTML += `<div class="mt-4 pt-4 border-t border-gray-200/50">
                                      <button class="flex items-center gap-1 text-sm font-semibold text-indigo-600 hover:text-indigo-800 transition-colors" onclick="toggleExplanation(${index}, this)">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                        Xem giải thích chi tiết từ AI
                                      </button>
                                      <div id="explanation-${index}" class="mt-3 p-4 bg-indigo-50 border border-indigo-100 rounded-xl hidden text-sm text-gray-700 leading-relaxed"></div>
                                   </div>`;
                }
                reviewHTML += '</div>';
            });
            reviewContainer.innerHTML = reviewHTML;
            safeTypeset([reviewContainer]);
        }

        function retryQuiz() {
            retriesCount++;
            startQuiz();
        }
        
        function startTimer() {
            stopTimer();
            timerInterval = setInterval(() => {
                timeRemaining--;
                const minutes = Math.floor(timeRemaining / 60);
                const seconds = timeRemaining % 60;
                timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                if (timeRemaining <= 0) {
                    stopTimer();
                    alert('Đã hết thời gian làm bài!');
                    submitQuiz();
                }
            }, 1000);
        }

        function stopTimer() { clearInterval(timerInterval); }
        
        function showWarning(message) {
            warningEl.textContent = message;
            warningEl.style.display = 'block';
            warningEl.style.animation = 'none';
            warningEl.offsetHeight; 
            warningEl.style.animation = 'fade-in-out 5s ease-in-out';
        }

        function handleVisibilityChange() {
            if (document.hidden) {
                monitoringLog.thoatManHinh++;
                showWarning('⚠️ Đã phát hiện chuyển tab hoặc thu nhỏ cửa sổ!');
            }
        }
        function handleCopy() { monitoringLog.saoChep++; showWarning('⚠️ Đã phát hiện hành vi sao chép!'); }
        function handlePaste() { monitoringLog.dan++; showWarning('⚠️ Đã phát hiện hành vi dán!'); }
        function startMonitoring() {
            monitoringLog = { thoatManHinh: 0, saoChep: 0, dan: 0 };
            document.addEventListener('visibilitychange', handleVisibilityChange);
            document.addEventListener('copy', handleCopy);
            document.addEventListener('paste', handlePaste);
        }
        function stopMonitoring() {
            document.removeEventListener('visibilitychange', handleVisibilityChange);
            document.removeEventListener('copy', handleCopy);
            document.removeEventListener('paste', handlePaste);
        }

        async function toggleExplanation(index, button) {
            const explanationContainer = document.getElementById(`explanation-${index}`);
            if (!explanationContainer) return;

            const isHidden = explanationContainer.classList.toggle('hidden');
            button.innerHTML = isHidden 
                ? '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> Xem giải thích chi tiết từ AI' 
                : '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" /></svg> Ẩn giải thích';

            const hasLoaded = explanationContainer.hasAttribute('data-loaded');
            const hadError = explanationContainer.getAttribute('data-loaded') === 'error';

            if (!isHidden && (!hasLoaded || hadError)) {
                await fetchAndRenderExplanation(index);
            }
        }

        async function fetchAndRenderExplanation(index) {
            const explanationContainer = document.getElementById(`explanation-${index}`);
            explanationContainer.innerHTML = '<div class="flex items-center gap-2 text-indigo-500"><svg class="animate-spin h-4 w-4" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> AI đang soạn lời giải...</div>';
            explanationContainer.setAttribute('data-loaded', 'loading');

            if (!API_KEY) {
                explanationContainer.innerHTML = '<p class="text-red-500 font-medium">⚠️ Lỗi: Giáo viên chưa cung cấp khóa AI. Vui lòng liên hệ giáo viên.</p>';
                explanationContainer.setAttribute('data-loaded', 'error');
                return;
            }
            
            try {
                const ai = new GoogleGenAI({ apiKey: API_KEY });
                const item = quizData[index];
                const questionText = (mapType(item.type) === 'true-false') ? (item.main_question || '') : (item.question || '');
                let prompt = `Bạn là một trợ lý giáo viên AI xuất sắc. Hãy viết lời giải chi tiết, dễ hiểu cho câu hỏi này.\n---\nCÂU HỎI:\n${questionText}\n---`;
                
                if (mapType(item.type) === 'multiple-choice') {
                    prompt += `\n**ĐÁP ÁN ĐÚNG:** ${String.fromCharCode(65 + item.correctAnswerIndex)}. ${item.options[item.correctAnswerIndex] || ''}`;
                } else if (mapType(item.type) === 'true-false') {
                    prompt += `\n**CÁC MỆNH ĐỀ VÀ ĐÁP ÁN:**\n${item.statements.map((s, i) => `${String.fromCharCode(97 + i)}) ${s.statement || ''} -> ${s.is_correct ? 'Đúng' : 'Sai'}`).join('\n')}`;
                } else {
                    prompt += `---\n**ĐÁP ÁN / GỢI Ý:** ${item.answer || ''}`;
                }
                prompt += `\n---\n**YÊU CẦU:** Giải thích từng bước logic. Định dạng công thức toán bằng LaTeX (trong dấu $). Dùng **...** để in đậm các ý quan trọng.`;
                
                const response = await generateContentWithFallback(ai, prompt);
                const explanationText = response.text || "Không thể tạo giải thích.";
                
                let htmlContent = explanationText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                explanationContainer.innerHTML = htmlContent;
                safeTypeset([explanationContainer]);
                explanationContainer.setAttribute('data-loaded', 'true');

            } catch (error) {
                console.error("AI Explanation Error:", error);
                explanationContainer.innerHTML = `<div class="text-red-600 text-sm">Đã xảy ra lỗi khi tải lời giải. <button onclick="event.preventDefault(); fetchAndRenderExplanation(${index})" class="underline font-semibold ml-1">Thử lại</button></div>`;
                explanationContainer.setAttribute('data-loaded', 'error');
            }
        }

        async function getAIAssessment(score, answerDetails) {
            if (!API_KEY) {
                const errorMsg = "Không thể tạo nhận xét do giáo viên chưa cung cấp khóa AI.";
                document.querySelector('#assessment-display .assessment-content').innerHTML = `<p class="text-red-600">${errorMsg}</p>`;
                assessmentDisplay.classList.remove('hidden');
                return errorMsg;
            }
            
            document.querySelector('#assessment-display .assessment-content').innerHTML = '<div class="flex items-center gap-2 text-indigo-600"><svg class="animate-spin h-5 w-5" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> AI đang phân tích bài làm của bạn...</div>';
            assessmentDisplay.classList.remove('hidden');

            try {
                const ai = new GoogleGenAI({ apiKey: API_KEY });
                const wrongAnswers = answerDetails.filter(d => d.isCorrect === false || (d.type === 'true-false' && d.details && d.details.some(sub => !sub.isCorrect)));
                if (wrongAnswers.length === 0) {
                    const congrats = "Tuyệt vời! Em đã làm bài xuất sắc và không sai câu nào. Kiến thức của em rất vững vàng. Hãy tiếp tục duy trì phong độ này nhé! 🌟";
                    document.querySelector('#assessment-display .assessment-content').innerHTML = congrats;
                    return congrats;
                }
                const wrongQuestionsSummary = wrongAnswers.map(d => {
                    const item = quizData[d.questionNumber - 1];
                    const questionText = item.question || item.main_question || '';
                    return `- Câu ${d.questionNumber}: ${questionText}`;
                }).join('\n');
                
                const prompt = `Bạn là một giáo viên AI tâm lý và tận tụy. Dựa vào kết quả bài làm sau, hãy viết một đoạn nhận xét ngắn gọn (khoảng 100 từ) cho học sinh.\n**Kết quả:**\n- Điểm số: ${score} / 10\n- Các câu làm sai (nội dung tóm tắt):\n${wrongQuestionsSummary}\n**YÊU CẦU:**\n1. Bắt đầu bằng lời khen ngợi nỗ lực.\n2. Chỉ ra các mảng kiến thức cần ôn tập lại dựa trên các câu sai.\n3. Đưa ra 1 lời khuyên cụ thể để cải thiện.\n4. Kết thúc bằng lời động viên ấm áp.\n5. Sử dụng icon cảm xúc phù hợp.`;

                const response = await generateContentWithFallback(ai, prompt);
                const assessmentText = response.text || "Không thể tạo nhận xét.";
                
                document.querySelector('#assessment-display .assessment-content').innerHTML = assessmentText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                return assessmentText;

            } catch (error) {
                console.error("AI Assessment Error:", error);
                document.querySelector('#assessment-display .assessment-content').innerHTML = `<div class="text-red-600">Lỗi kết nối với AI. <button onclick="retryAIAssessment()" class="underline font-bold ml-1">Thử lại</button></div>`;
                return "Lỗi khi tạo nhận xét AI.";
            }
        }
        
        async function retryAIAssessment() {
            if (lastAnswerDetails) {
                const finalScore = (lastScore / (quizData.length > 0 ? 10 : 1) * 10).toFixed(2);
                await getAIAssessment(finalScore, lastAnswerDetails);
            }
        }
    </script>
</body>
</html>
    