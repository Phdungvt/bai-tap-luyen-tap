
    <!DOCTYPE html>
    <html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bài Tập Luyện Tập</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
        <script>
            window.MathJax = {
                tex: {
                    packages: {'[+]': ['ams']},
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']]
                },
                chtml: {
                    fontCache: 'global',
                    linebreaks: {
                        automatic: true
                    }
                }
            };
        </script>
        <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
        </script>
        <style>
            body { font-family: 'Be Vietnam Pro', sans-serif; background-color: #f0f4f8; }
            .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
            .question-card {
                background-color: white;
                border-radius: 1rem;
                padding: 1.5rem 2rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
                border-left: 5px solid transparent;
                transition: all 0.3s ease;
            }
            .ai-explanation {
                background-color: #f0f9ff;
                color: #0c4a6e;
                padding: 1rem;
                border-radius: 0.75rem;
                font-size: 0.9rem;
                margin-top: 1rem;
                border-left: 4px solid #38bdf8;
            }
            .feedback-icon { width: 1.5rem; height: 1.5rem; }
            .option-label {
                transition: all 0.2s ease-in-out;
                border: 2px solid #e5e7eb;
            }
            .option-label:hover {
                border-color: #6366f1;
                background-color: #eef2ff;
            }
            .option-label.correct {
                border-color: #10b981 !important;
                background-color: #ecfdf5 !important;
                color: #065f46;
            }
            .option-label.incorrect {
                border-color: #ef4444 !important;
                background-color: #fef2f2 !important;
                color: #991b1b;
            }
            .statement-item.correct { background-color: #ecfdf5; border-color: #10b981; }
            .statement-item.incorrect { background-color: #fef2f2; border-color: #ef4444; }
            .prose { max-width: 100%; }
            .prose h1, .prose h2, .prose h3 { font-weight: 600; }
            .prose p { margin-top: 0.5em; margin-bottom: 0.5em; }
            .prose ul, .prose ol { margin-top: 1em; margin-bottom: 1em; padding-left: 1.5em; }
            .prose li > p { margin-top: 0; margin-bottom: 0; }
            .prose code { background-color: #e5e7eb; padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 3px; }
            .prose pre { background-color: #e5e7eb; padding: 1em; border-radius: 0.5em; overflow-x: auto; }
            .prose pre code { background-color: transparent; padding: 0; }
            details[open] > summary .details-arrow {
                transform: rotate(180deg);
            }
        </style>
    </head>
    <body class="bg-slate-100 text-slate-800">
        <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md transform transition-all" style="animation: fadeIn 0.3s ease-out;">
                <h2 class="text-2xl font-bold mb-2 text-center text-slate-800">Thông Tin Học Sinh</h2>
                <p class="text-center text-slate-500 mb-6">Vui lòng nhập để bắt đầu làm bài.</p>
                <form id="student-info-form">
                    <div class="mb-4">
                        <label for="student-name" class="block text-sm font-medium text-slate-700 mb-1">Họ và tên</label>
                        <input type="text" id="student-name" required class="mt-1 block w-full block border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="student-class" class="block text-sm font-medium text-slate-700 mb-1">Lớp</label>
                        <input type="text" id="student-class" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="exam-code" class="block text-sm font-medium text-slate-700 mb-1">Mã đề</label>
                        <input type="text" id="exam-code" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Nhập mã đề giáo viên cung cấp">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Giáo viên:</label>
                        <p class="mt-1 text-slate-800 bg-slate-100 p-2.5 rounded-lg">Lê Văn Đông</p>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">Bắt đầu làm bài</button>
                </form>
            </div>
        </div>
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="mb-10 p-8 rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 class="text-4xl font-bold">Bài Tập Luyện Tập</h1>
                        <p class="text-lg text-blue-100 mt-2">Hãy hoàn thành các câu hỏi dưới đây một cách tốt nhất!</p>
                        <p class="text-sm text-blue-200 mt-4">Tác giả: Lê Văn Đông</p>
                    </div>
                    <div id="timer-container" class="text-right">
                         <div id="timer-display" class="text-3xl font-bold tracking-wider bg-white/20 px-4 py-2 rounded-lg">--:--</div>
                         <div id="retries-display" class="text-sm mt-1 text-blue-200"></div>
                    </div>
                </div>
            </header>
            <main id="student-quiz-container" class="space-y-8 hidden">
                <!-- Questions will be rendered here by JS -->
            </main>
            <footer class="mt-10 text-center">
                <button id="submit-quiz-btn" class="bg-indigo-600 text-white py-3 px-12 rounded-full font-bold text-lg hover:bg-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl hidden transform hover:scale-105">Nộp Bài</button>
                <div id="result-container" class="mt-6 hidden"></div>
                <div id="ai-feedback-container" class="mt-8 text-left hidden"></div>
                <div id="post-submit-options" class="hidden mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="retry-quiz-btn" class="w-full sm:w-auto bg-slate-600 text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-slate-700 transition-transform transform hover:scale-105">Làm Lại Đề Này</button>
                </div>
            </footer>
        </div>

        <div id="proctoring-widget" class="fixed bottom-4 right-4 bg-yellow-100 text-yellow-800 p-3 rounded-lg shadow-lg text-sm z-50 hidden border border-yellow-300" style="max-width: 200px;">
            <h4 class="font-bold mb-2 border-b border-yellow-300 pb-1 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 3.001-1.742 3.001H4.42c-1.53 0-2.493-1.667-1.743-3.001l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                Giám sát
            </h4>
            <p>Thoát màn hình: <span id="tab-switch-count" class="font-bold">0</span></p>
            <p>Sao chép: <span id="copy-count" class="font-bold">0</span></p>
            <p>Dán: <span id="paste-count" class="font-bold">0</span></p>
        </div>

        <script type="module">
            import { GoogleGenAI, Type } from "https://esm.sh/@google/genai@^1.13.0";
            let quizData = [{"type":"multiple-choice","question":"<strong></strong> Trí tuệ nhân tạo (AI) là lĩnh vực khoa học máy tính tập trung vào việc tạo ra các hệ thống có khả năng:","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Mô phỏng khả năng tư duy của con người","Thực hiện các phép tính phức tạp một cách nhanh chóng","Lưu trữ lượng lớn dữ liệu","Kết nối và truyền tải thông tin qua mạng"],"optionsImage":[null,null,null,null],"correctAnswerIndex":0},{"type":"multiple-choice","question":"<strong></strong> Hệ thống khuyến nghị sản phẩm trên các sàn thương mại điện tử (ví dụ: gợi ý sản phẩm bạn có thể thích dựa trên lịch sử mua hàng) là một ví dụ về ứng dụng AI nào?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Xử lý ngôn ngữ tự nhiên","Thị giác máy tính","Robot tự hành","Hệ thống khuyến nghị"],"optionsImage":[null,null,null,null],"correctAnswerIndex":3},{"type":"multiple-choice","question":"<strong></strong> Trong các ví dụ sau, đâu là một ứng dụng phổ biến của Trí tuệ nhân tạo trong đời sống?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Sử dụng máy tính để soạn thảo văn bản","Lưu trữ ảnh trên điện toán đám mây","Trợ lý ảo trên điện thoại thông minh","Duyệt web bằng trình duyệt"],"optionsImage":[null,null,null,null],"correctAnswerIndex":2},{"type":"multiple-choice","question":"<strong></strong> Vì sao Trí tuệ nhân tạo được coi là một công nghệ mang tính cách mạng và có tầm quan trọng lớn trong tương lai?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Vì nó có thể tự động hóa quy trình, tối ưu hóa và giải quyết các vấn đề phức tạp","Vì nó giúp con người truy cập Internet nhanh hơn","Vì nó chỉ giúp tạo ra các sản phẩm giải trí mới","Vì nó không yêu cầu dữ liệu để hoạt động"],"optionsImage":[null,null,null,null],"correctAnswerIndex":0},{"type":"multiple-choice","question":"<strong></strong> Thiết bị mạng nào có chức năng chính là kết nối các máy tính trong một mạng cục bộ (LAN) và chuyển tiếp dữ liệu dựa trên địa chỉ MAC?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Router","Switch","Hub","Modem"],"optionsImage":[null,null,null,null],"correctAnswerIndex":1},{"type":"multiple-choice","question":"<strong></strong> Để kết nối mạng gia đình của bạn với Internet, thiết bị nào là không thể thiếu để chuyển đổi tín hiệu từ nhà cung cấp dịch vụ Internet (ISP)?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Switch","Hub","Access Point","Modem"],"optionsImage":[null,null,null,null],"correctAnswerIndex":3},{"type":"multiple-choice","question":"<strong></strong> Vai trò chính của Router trong một mạng máy tính là gì?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Định tuyến gói tin giữa các mạng","Khuếch đại tín hiệu mạng","Kết nối các thiết bị trong cùng một mạng LAN","Chuyển đổi tín hiệu tương tự sang tín hiệu số"],"optionsImage":[null,null,null,null],"correctAnswerIndex":0},{"type":"multiple-choice","question":"<strong></strong> Lợi ích chính của việc chia sẻ tài nguyên trên mạng là gì?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Tiết kiệm chi phí và tăng hiệu quả công việc","Làm chậm tốc độ mạng","Gây nguy cơ mất dữ liệu cao","Chỉ dành cho mục đích giải trí"],"optionsImage":[null,null,null,null],"correctAnswerIndex":0},{"type":"multiple-choice","question":"<strong></strong> Trong một văn phòng, các tài nguyên nào sau đây thường được chia sẻ trên mạng để nhiều người dùng có thể sử dụng?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Bàn làm việc và ghế","Cây cảnh và tranh ảnh","Bàn phím và chuột","Máy in và các tệp, thư mục"],"optionsImage":[null,null,null,null],"correctAnswerIndex":3},{"type":"multiple-choice","question":"<strong></strong> Trước khi chia sẻ một thư mục trên mạng, điều quan trọng nhất cần xem xét là gì để đảm bảo an toàn thông tin?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Tên của thư mục phải thật ngắn gọn","Thiết lập quyền truy cập cho người dùng","Màu sắc của biểu tượng thư mục","Kích thước tối thiểu của thư mục"],"optionsImage":[null,null,null,null],"correctAnswerIndex":1},{"type":"multiple-choice","question":"<strong></strong> Khi tham gia vào các diễn đàn, nhóm chat trực tuyến, hành vi nào sau đây được coi là thiếu văn minh và không nên thực hiện?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Sử dụng ngôn ngữ lịch sự, tôn trọng","Chia sẻ kiến thức hữu ích","Giúp đỡ người khác khi họ có thắc mắc","Đăng tải thông tin sai sự thật (tin giả)"],"optionsImage":[null,null,null,null],"correctAnswerIndex":3},{"type":"multiple-choice","question":"<strong></strong> Để bảo vệ thông tin cá nhân trên mạng, người dùng nên thực hiện biện pháp nào sau đây?","main_question":null,"questionImage":null,"mappedType":"multiple-choice","options":["Công khai tất cả thông tin cá nhân trên mạng xã hội","Không chia sẻ thông tin cá nhân nhạy cảm với người lạ","Sử dụng một mật khẩu duy nhất cho tất cả các tài khoản","Tải về các ứng dụng từ nguồn không xác định"],"optionsImage":[null,null,null,null],"correctAnswerIndex":1},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về Trí tuệ nhân tạo:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"AI có khả năng học hỏi và tự thích nghi với dữ liệu mới.","is_correct":true},{"statement":"Mọi ứng dụng máy tính đều được coi là có Trí tuệ nhân tạo.","is_correct":false},{"statement":"Hệ thống AI không cần dữ liệu để đưa ra quyết định.","is_correct":false},{"statement":"Trí tuệ nhân tạo chỉ có thể xử lý các nhiệm vụ đơn giản.","is_correct":false}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về Trí tuệ nhân tạo:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Robot tự hành là một ứng dụng điển hình của Trí tuệ nhân tạo.","is_correct":true},{"statement":"AI chỉ tập trung vào việc tính toán số học nhanh hơn con người.","is_correct":false},{"statement":"AI không thể hiểu và phản hồi ngôn ngữ tự nhiên của con người.","is_correct":false},{"statement":"Hệ thống nhận diện khuôn mặt sử dụng công nghệ AI.","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về ảnh hưởng của Trí tuệ nhân tạo:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"AI có thể tạo ra những tác động tích cực lớn đến y tế và giáo dục.","is_correct":true},{"statement":"Việc phát triển AI không gây ra bất kỳ lo ngại đạo đức nào.","is_correct":false},{"statement":"AI sẽ thay thế hoàn toàn công việc của con người trong mọi lĩnh vực.","is_correct":false},{"statement":"AI giúp con người đưa ra quyết định tốt hơn thông qua phân tích dữ liệu.","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các tình huống sử dụng Trí tuệ nhân tạo:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Một hệ thống AI được huấn luyện để chẩn đoán bệnh dựa trên hình ảnh y tế có thể mắc lỗi nếu dữ liệu huấn luyện không đa dạng.","is_correct":true},{"statement":"Sử dụng AI để tự động hóa quy trình sản xuất luôn đảm bảo chất lượng sản phẩm tốt hơn con người mà không cần giám sát.","is_correct":false},{"statement":"Việc áp dụng AI vào hệ thống giao thông thông minh giúp giảm tắc nghẽn và tai nạn giao thông hiệu quả.","is_correct":true},{"statement":"Một chatbot AI chỉ trả lời được các câu hỏi đã được lập trình sẵn mà không có khả năng học hỏi từ tương tác mới.","is_correct":false}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về các thiết bị mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Hub là thiết bị mạng hoạt động ở tầng vật lí, gửi tín hiệu đến tất cả các cổng.","is_correct":true},{"statement":"Router chỉ dùng để kết nối các máy tính trong cùng một mạng LAN.","is_correct":false},{"statement":"Switch thông minh hơn Hub vì nó chuyển tiếp dữ liệu đến cổng đích cụ thể.","is_correct":true},{"statement":"Modem là thiết bị bắt buộc phải có để kết nối Internet qua đường truyền cáp quang.","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về các thiết bị mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Access Point (AP) được dùng để tạo ra mạng không dây (Wi-Fi).","is_correct":true},{"statement":"Repeater có chức năng chính là định tuyến gói tin giữa các mạng khác nhau.","is_correct":false},{"statement":"Thiết bị mạng Bridge giúp mở rộng một mạng LAN bằng cách kết nối hai phân đoạn mạng.","is_correct":true},{"statement":"Firewall là thiết bị phần mềm hoặc phần cứng giúp bảo vệ mạng khỏi các cuộc tấn công.","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về hoạt động của thiết bị mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Khi một máy tính gửi dữ liệu qua Switch, Switch sẽ gửi dữ liệu đó đến tất cả các máy tính khác trong mạng.","is_correct":false},{"statement":"Router sử dụng địa chỉ IP để xác định đường đi cho gói tin trên Internet.","is_correct":true},{"statement":"Access Point chỉ có thể hoạt động khi được kết nối trực tiếp với Modem.","is_correct":false},{"statement":"Một mạng có sử dụng Switch sẽ hiệu quả hơn mạng chỉ sử dụng Hub về mặt băng thông.","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các tình huống chọn thiết bị mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Để mở rộng vùng phủ sóng Wi-Fi trong một ngôi nhà lớn, nên sử dụng một Repeater hoặc thêm Access Point.","is_correct":true},{"statement":"Nếu muốn kết nối hai mạng LAN riêng biệt (ví dụ: mạng văn phòng và mạng nhà máy), cần sử dụng Switch.","is_correct":false},{"statement":"Để quản lý lưu lượng truy cập và bảo mật cho mạng công ty, việc triển khai Firewall là rất cần thiết.","is_correct":true},{"statement":"Khi có nhiều thiết bị muốn kết nối Internet cùng lúc, cần một Router có khả năng cấp phát địa chỉ IP (DHCP).","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về Giao thức mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Giao thức mạng là tập hợp các quy tắc quy định cách các thiết bị giao tiếp với nhau.","is_correct":true},{"statement":"HTTP là giao thức được sử dụng để gửi và nhận email.","is_correct":false},{"statement":"TCP/IP là bộ giao thức nền tảng của Internet.","is_correct":true},{"statement":"FTP là giao thức dùng để truy cập các trang web an toàn.","is_correct":false}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về Giao thức mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Mô hình OSI có 7 tầng, mỗi tầng có chức năng riêng biệt.","is_correct":true},{"statement":"Địa chỉ IP là tên miền của một trang web.","is_correct":false},{"statement":"Giao thức POP3 được sử dụng để gửi email đi.","is_correct":false},{"statement":"SMTP là giao thức được sử dụng để gửi email từ máy khách đến máy chủ email.","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về vai trò của giao thức mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Giao thức HTTPs đảm bảo an toàn hơn HTTP bằng cách mã hóa dữ liệu.","is_correct":true},{"statement":"Giao thức không có vai trò quan trọng trong việc đảm bảo tính toàn vẹn của dữ liệu.","is_correct":false},{"statement":"DNS (Domain Name System) có nhiệm vụ chuyển đổi tên miền thành địa chỉ IP.","is_correct":true},{"statement":"Nếu không có giao thức, các thiết bị mạng vẫn có thể giao tiếp hiệu quả với nhau.","is_correct":false}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các tình huống sử dụng giao thức mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Khi bạn gõ 'www.example.com' vào trình duyệt, giao thức HTTP được sử dụng để yêu cầu trang web.","is_correct":true},{"statement":"Để truyền một tập tin lớn từ máy tính của bạn lên máy chủ, giao thức DNS là lựa chọn tối ưu.","is_correct":false},{"statement":"Trong quá trình gửi email, giao thức IMAP chủ yếu được dùng để tải email về máy tính cục bộ.","is_correct":true},{"statement":"Khi tham gia cuộc gọi video trực tuyến, các giao thức thời gian thực như RTP thường được sử dụng.","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về giao tiếp và ứng xử trên mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Sử dụng biệt danh (nickname) trên mạng xã hội là hành vi sai trái và vi phạm pháp luật.","is_correct":false},{"statement":"Tôn trọng quyền riêng tư của người khác là nguyên tắc quan trọng khi giao tiếp trên mạng.","is_correct":true},{"statement":"Luật An ninh mạng của Việt Nam quy định về các hành vi bị cấm trên không gian mạng.","is_correct":true},{"statement":"Mọi thông tin trên Internet đều đáng tin cậy và không cần kiểm chứng.","is_correct":false}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về giao tiếp và ứng xử trên mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Nên sử dụng từ ngữ thô tục, xúc phạm để bày tỏ ý kiến cá nhân trên mạng.","is_correct":false},{"statement":"Việc phát tán tin đồn, tin giả trên mạng xã hội có thể bị xử phạt theo pháp luật.","is_correct":true},{"statement":"Không nên tiết lộ thông tin cá nhân của người khác mà không có sự đồng ý của họ.","is_correct":true},{"statement":"Luôn luôn phải tin vào những gì người lạ gửi cho bạn trên mạng.","is_correct":false}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các phát biểu sau về văn hoá trong môi trường số:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Văn hóa ứng xử trên mạng là tổng hợp các quy tắc, giá trị, và chuẩn mực đạo đức khi tham gia không gian mạng.","is_correct":true},{"statement":"Việc sử dụng icon và emoji quá mức luôn được chấp nhận trong mọi tình huống giao tiếp trực tuyến.","is_correct":false},{"statement":"Việc chia sẻ thành tích cá nhân của người khác mà không xin phép là thể hiện sự ủng hộ tích cực.","is_correct":false},{"statement":"Tham gia vào các cộng đồng trực tuyến tích cực giúp nâng cao kiến thức và kỹ năng của bản thân.","is_correct":true}]},{"type":"true-false","question":null,"main_question":"<strong></strong> Đánh giá các tình huống ứng xử trong không gian mạng:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Nếu bạn phát hiện một thông tin không đúng sự thật được lan truyền trên mạng, bạn nên chia sẻ ngay để cảnh báo mọi người.","is_correct":false},{"statement":"Khi tham gia một diễn đàn trực tuyến, bạn nên tìm hiểu nội quy và văn hóa của cộng đồng trước khi đăng bài.","is_correct":true},{"statement":"Nếu bị ai đó bắt nạt hoặc quấy rối trên mạng, cách tốt nhất là im lặng và chịu đựng.","is_correct":false},{"statement":"Bạn nên suy nghĩ kỹ trước khi đăng tải bất kỳ nội dung nào lên mạng vì chúng có thể tồn tại mãi mãi và ảnh hưởng đến bạn.","is_correct":true}]},{"type":"essay","question":"<strong></strong> Hãy giải thích bộ giao thức TCP/IP, nêu rõ vai trò của từng giao thức TCP và IP trong quá trình truyền dữ liệu trên mạng.<br><em>Đáp án/Gợi ý:</em><br>Bộ giao thức TCP/IP là nền tảng của Internet, bao gồm hai giao thức chính: TCP và IP. - IP (Internet Protocol): Có nhiệm vụ định tuyến các gói dữ liệu từ nguồn đến đích qua mạng. Nó cung cấp địa chỉ logic (địa chỉ IP) cho các thiết bị và xác định đường đi tốt nhất cho gói tin. - TCP (Transmission Control Protocol): Có nhiệm vụ đảm bảo dữ liệu được truyền đi một cách đáng tin cậy, theo thứ tự và không bị mất mát. TCP thiết lập kết nối, phân đoạn dữ liệu, đánh số thứ tự các gói tin, kiểm soát luồng và kiểm tra lỗi, sau đó tập hợp lại các gói tin ở phía nhận.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> So sánh sự khác biệt chính giữa giao thức HTTP và HTTPS, giải thích tại sao HTTPS lại quan trọng hơn trong các giao dịch trực tuyến.<br><em>Đáp án/Gợi ý:</em><br>- HTTP (Hypertext Transfer Protocol): Là giao thức truyền tải siêu văn bản, được sử dụng để truyền dữ liệu trên World Wide Web. Dữ liệu được truyền dưới dạng văn bản thuần túy, không được mã hóa. - HTTPS (Hypertext Transfer Protocol Secure): Là phiên bản bảo mật của HTTP. Nó sử dụng mã hóa SSL/TLS để bảo vệ dữ liệu trong quá trình truyền tải. - Tầm quan trọng của HTTPS: Trong các giao dịch trực tuyến (thanh toán, đăng nhập), HTTPS mã hóa thông tin nhạy cảm (mật khẩu, số thẻ tín dụng) để ngăn chặn việc bị đánh cắp hoặc nghe lén bởi bên thứ ba độc hại, đảm bảo tính bảo mật và toàn vẹn dữ liệu.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> Trình bày các bước cơ bản để chia sẻ một thư mục trên hệ điều hành Windows và nêu các loại quyền truy cập bạn có thể thiết lập.<br><em>Đáp án/Gợi ý:</em><br>Các bước cơ bản để chia sẻ thư mục trên Windows: 1. Click chuột phải vào thư mục muốn chia sẻ, chọn 'Properties'. 2. Chọn tab 'Sharing', sau đó click 'Advanced Sharing...'. 3. Tích chọn 'Share this folder', sau đó click 'Permissions'. 4. Thêm người dùng hoặc nhóm muốn chia sẻ, sau đó thiết lập quyền truy cập. 5. Click 'OK' để hoàn tất. Các loại quyền truy cập cơ bản: - Read (Đọc): Cho phép người dùng xem nội dung, mở tệp nhưng không được thay đổi hoặc xóa. - Change (Thay đổi): Cho phép người dùng đọc, ghi, sửa đổi và xóa tệp. - Full Control (Toàn quyền kiểm soát): Cung cấp tất cả các quyền, bao gồm thay đổi quyền truy cập.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> Phân tích lợi ích của việc chia sẻ tài nguyên trên mạng trong môi trường làm việc nhóm hoặc học tập.<br><em>Đáp án/Gợi ý:</em><br>Việc chia sẻ tài nguyên trên mạng mang lại nhiều lợi ích trong môi trường làm việc nhóm hoặc học tập: 1. Tiết kiệm chi phí: Giảm số lượng thiết bị cần mua (ví dụ: nhiều máy tính có thể dùng chung một máy in). 2. Nâng cao hiệu quả: Thành viên nhóm có thể truy cập và làm việc trên cùng một tài liệu, thư mục chung một cách dễ dàng và nhanh chóng, tránh việc sao chép thủ công. 3. Tăng cường cộng tác: Dữ liệu được tập trung, giúp quá trình làm việc nhóm liền mạch hơn, mọi người có thể cập nhật thông tin và tiến độ của nhau. 4. Thuận tiện: Dễ dàng phân phối thông tin và tài liệu đến nhiều người cùng lúc. 5. Sao lưu và phục hồi: Dữ liệu tập trung có thể được sao lưu dễ dàng hơn.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> Giải thích sự khác biệt giữa chia sẻ công khai và chia sẻ có giới hạn đối với tài nguyên mạng, và nêu ví dụ cho mỗi loại.<br><em>Đáp án/Gợi ý:</em><br>- Chia sẻ công khai (Public Sharing): Là hình thức chia sẻ tài nguyên (tệp, thư mục, máy in) mà không yêu cầu xác thực người dùng hoặc cho phép truy cập của mọi người trong mạng (hoặc thậm chí Internet nếu cấu hình). Ai cũng có thể truy cập, thường với quyền đọc. - Ví dụ: Một thư mục 'Public' trong mạng gia đình, nơi mọi thành viên có thể truy cập các ảnh hoặc tài liệu chung. - Chia sẻ có giới hạn (Restricted/Private Sharing): Là hình thức chia sẻ mà quyền truy cập được cấp phát cụ thể cho từng người dùng hoặc nhóm người dùng đã được xác thực. Người quản trị có thể chỉ định các quyền cụ thể (đọc, ghi, sửa đổi) cho từng đối tượng. - Ví dụ: Một thư mục dự án trong công ty chỉ được chia sẻ cho các thành viên trong nhóm dự án với các quyền khác nhau tùy theo vai trò.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> Nêu và giải thích một số vấn đề bảo mật cần lưu ý khi thực hiện chia sẻ tài nguyên trên mạng.<br><em>Đáp án/Gợi ý:</em><br>Khi chia sẻ tài nguyên trên mạng, cần lưu ý các vấn đề bảo mật sau: 1. Rò rỉ dữ liệu: Nếu quyền truy cập không được thiết lập chặt chẽ, dữ liệu nhạy cảm có thể bị truy cập bởi những người không có thẩm quyền hoặc thậm chí là người ngoài mạng. 2. Lây nhiễm mã độc: Khi chia sẻ thư mục, nếu có một tệp chứa mã độc trong thư mục đó, nó có thể lây lan sang các máy tính khác truy cập vào thư mục chia sẻ. 3. Thay đổi hoặc xóa dữ liệu trái phép: Nếu cấp quyền ghi/sửa đổi cho người dùng không đáng tin cậy, họ có thể cố ý hoặc vô ý làm hỏng, thay đổi hoặc xóa dữ liệu quan trọng. 4. Tấn công từ chối dịch vụ (DoS): Kẻ tấn công có thể lợi dụng các lỗ hổng trong cấu hình chia sẻ để làm quá tải tài nguyên, khiến người dùng hợp pháp không thể truy cập được.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> Nêu ít nhất 4 nguyên tắc ứng xử văn minh trong không gian mạng mà một công dân số cần tuân thủ.<br><em>Đáp án/Gợi ý:</em><br>Các nguyên tắc ứng xử văn minh trong không gian mạng: 1. Tôn trọng người khác: Luôn lịch sự, không dùng từ ngữ xúc phạm, miệt thị, quấy rối hoặc bạo lực. Tôn trọng sự khác biệt về quan điểm, văn hóa. 2. Bảo vệ thông tin cá nhân và quyền riêng tư: Không tiết lộ thông tin cá nhân của bản thân và người khác khi chưa được phép. Không chia sẻ những hình ảnh, video nhạy cảm. 3. Kiểm chứng thông tin: Không tin ngay vào mọi thông tin trên mạng, cần kiểm tra tính xác thực trước khi chia sẻ để tránh phát tán tin giả. 4. Có trách nhiệm với lời nói và hành động: Mọi phát ngôn, hành động trên mạng đều có thể để lại hậu quả, hãy suy nghĩ kỹ trước khi đăng tải. 5. Tuân thủ pháp luật: Không vi phạm các quy định về an ninh mạng, bản quyền, quyền sở hữu trí tuệ.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> Phân tích những hậu quả tiêu cực mà 'tin giả' (fake news) có thể gây ra cho cá nhân và xã hội.<br><em>Đáp án/Gợi ý:</em><br>Tin giả (fake news) có thể gây ra nhiều hậu quả tiêu cực: 1. Đối với cá nhân: Gây hoang mang, lo sợ, mất niềm tin vào các nguồn thông tin chính thống. Có thể dẫn đến các quyết định sai lầm (ví dụ: về sức khỏe, tài chính). Ảnh hưởng đến danh dự, uy tín nếu là tin giả về cá nhân. 2. Đối với xã hội: Gây chia rẽ cộng đồng, xung đột xã hội. Ảnh hưởng đến an ninh quốc gia, trật tự công cộng (ví dụ: tin giả về dịch bệnh, thảm họa). Gây tổn hại đến kinh tế, chính trị, và sự ổn định của đất nước. Làm suy giảm niềm tin vào các thể chế, tổ chức.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> Giải thích khái niệm 'tấn công mạng' và 'lừa đảo trực tuyến'. Nêu một số cách mà người dùng có thể phòng tránh các hình thức tấn công này.<br><em>Đáp án/Gợi ý:</em><br>- Tấn công mạng: Là hành vi xâm nhập trái phép vào hệ thống máy tính, mạng hoặc dữ liệu của người khác với mục đích đánh cắp thông tin, phá hoại, làm gián đoạn dịch vụ hoặc kiếm lợi bất chính. - Lừa đảo trực tuyến (Phishing): Là hình thức tấn công mạng nhằm lừa người dùng tiết lộ thông tin cá nhân nhạy cảm (mật khẩu, thông tin thẻ tín dụng) thông qua các email, tin nhắn, hoặc trang web giả mạo trông giống như thật. Cách phòng tránh: 1. Sử dụng mật khẩu mạnh và kích hoạt xác thực hai yếu tố (2FA). 2. Cẩn trọng với các đường link lạ, email đáng ngờ, không mở tệp đính kèm không rõ nguồn gốc. 3. Kiểm tra địa chỉ URL của trang web trước khi nhập thông tin cá nhân. 4. Cập nhật phần mềm, hệ điều hành và phần mềm diệt virus thường xuyên. 5. Không cung cấp thông tin cá nhân qua điện thoại hoặc tin nhắn khi không chắc chắn về danh tính người yêu cầu.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null},{"type":"essay","question":"<strong></strong> Là một công dân số, bạn nghĩ mình cần làm gì để góp phần xây dựng một môi trường mạng an toàn, lành mạnh và văn minh?<br><em>Đáp án/Gợi ý:</em><br>Để góp phần xây dựng môi trường mạng an toàn, lành mạnh và văn minh, một công dân số cần: 1. **Tuân thủ pháp luật và đạo đức:** Không thực hiện các hành vi vi phạm pháp luật (phát tán tin giả, lừa đảo, tấn công mạng) hay thiếu đạo đức (xúc phạm, bắt nạt trực tuyến). 2. **Sử dụng ngôn ngữ văn minh:** Giao tiếp lịch sự, tôn trọng người khác, tránh dùng từ ngữ thô tục, công kích cá nhân. 3. **Kiểm chứng thông tin:** Không chia sẻ thông tin khi chưa xác minh, góp phần ngăn chặn tin giả lan truyền. 4. **Bảo vệ thông tin cá nhân:** Cẩn trọng khi chia sẻ thông tin của bản thân và người khác, thiết lập quyền riêng tư phù hợp. 5. **Tích cực lan tỏa giá trị tốt:** Chia sẻ kiến thức bổ ích, thông tin tích cực, tham gia các cộng đồng văn minh, lành mạnh. 6. **Lên tiếng chống lại hành vi tiêu cực:** Khi thấy các hành vi vi phạm pháp luật hoặc thiếu văn minh, nên báo cáo hoặc lên tiếng một cách xây dựng.","main_question":null,"questionImage":null,"mappedType":"essay","answer":null}];
            const quizOptions = {"timeLimit":45,"retriesAllowed":1,"showAnswers":true,"showExplanation":true,"aiAssessment":true,"scoring":{"mc":4,"tf":3,"sa":0,"essay":3,"tfMethod":"progressive"}};
            const googleScriptUrl = "https://script.google.com/macros/s/AKfycbx0wjtV7_6YRNN_qtus4nArp20_NkLjfTxHb127Lu0wFKvm5v1MtqURFiW5zUAQBXCX/exec";
            const correctExamCode = "HX0VUT";
            const teacherApiKey = "AIzaSyDzpJyodrQYlL0_OmSq4k3snugEgphM6IE";
            let studentInfo = {};
            let isSubmitted = false;
            let timerInterval;
            let retriesLeft = quizOptions.retriesAllowed;
            let studentApiKey = "";
            let ai = null;

            let proctoringLog = {
                thoatManHinh: 0,
                saoChep: 0,
                dan: 0,
                suKien: []
            };

            const studentQuizContainer = document.getElementById('student-quiz-container');
            const submitBtn = document.getElementById('submit-quiz-btn');
            const resultContainer = document.getElementById('result-container');
            const postSubmitOptions = document.getElementById('post-submit-options');
            const retryBtn = document.getElementById('retry-quiz-btn');
            const loginModal = document.getElementById('login-modal');
            const studentInfoForm = document.getElementById('student-info-form');
            const timerDisplay = document.getElementById('timer-display');
            const retriesDisplay = document.getElementById('retries-display');
            function shuffleQuiz() {
                // Shuffle options/statements within each question first
                quizData.forEach(item => {
                    // Shuffle multiple-choice options and their corresponding images
                    if (item.mappedType === 'multiple-choice' && item.options && item.options.length > 0) {
                        const correctAnswerText = item.options[item.correctAnswerIndex];
                        let optionsWithImages = item.options.map((opt, index) => ({
                            text: opt,
                            image: (item.optionsImage && item.optionsImage[index]) ? item.optionsImage[index] : null
                        }));
                        // Fisher-Yates shuffle
                        for (let i = optionsWithImages.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [optionsWithImages[i], optionsWithImages[j]] = [optionsWithImages[j], optionsWithImages[i]];
                        }
                        // Update the item with shuffled data
                        item.options = optionsWithImages.map(opt => opt.text);
                        item.optionsImage = optionsWithImages.map(opt => opt.image);
                        item.correctAnswerIndex = item.options.indexOf(correctAnswerText);
                    }
                    // Shuffle true-false statements
                    if (item.mappedType === 'true-false' && item.statements && item.statements.length > 0) {
                         for (let i = item.statements.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [item.statements[i], item.statements[j]] = [item.statements[j], item.statements[i]];
                        }
                    }
                });
                // Then, group questions by type and shuffle within each group
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});
                let shuffledQuizData = [];
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
                partOrder.forEach(partType => {
                    if (grouped[partType]) {
                        const partQuestions = grouped[partType];
                        for (let i = partQuestions.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [partQuestions[i], partQuestions[j]] = [partQuestions[j], partQuestions[i]];
                        }
                        shuffledQuizData = shuffledQuizData.concat(partQuestions);
                    }
                });
               
                quizData = shuffledQuizData;
            }
            // --- Timer Function ---
            function startTimer(duration, display) {
                let timer = duration, minutes, seconds;
                clearInterval(timerInterval); // Clear any existing timer
                if(duration <= 0) {
                     display.textContent = "∞";
                     return;
                }
                timerInterval = setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);
                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;
                    display.textContent = minutes + ":" + seconds;
                    if (--timer < 0) {
                        clearInterval(timerInterval);
                        alert("Hết giờ làm bài!");
                        handleSubmit();
                    }
                }, 1000);
            }
            
            async function showExplanation(index, button) {
                const item = quizData[index];
                const questionCard = document.getElementById(`student-q-${index}`);
                const feedbackDiv = document.getElementById(`q-${index}-feedback`);
                if (!questionCard || !feedbackDiv) return;

                const existingExplanation = feedbackDiv.querySelector('.ai-explanation');
                if (existingExplanation) {
                    existingExplanation.remove();
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Xem giải thích
                    `;
                    return;
                }

                button.disabled = true;
                button.innerHTML = '<div class="loader mr-2"></div> Đang tải...';

                if (item.explanation) {
                    displayExplanation(item.explanation, feedbackDiv, button);
                    return;
                }

                if (!ai) {
                    alert("Tính năng giải thích yêu cầu API Key, nhưng chưa được cấu hình bởi giáo viên.");
                    button.disabled = false;
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Xem giải thích
                    `;
                    return;
                }

                const questionText = item.question || item.main_question;
                let prompt = `Bạn là một trợ lý giáo viên AI, am hiểu sâu sắc Chương trình GDPT 2018. Hãy cung cấp một lời giải chi tiết, từng bước một cho câu hỏi sau đây. Lời giải phải chính xác, dễ hiểu và phù hợp với phương pháp giảng dạy của chương trình học, TUYỆT ĐỐI KHÔNG sử dụng kiến thức của lớp cao hơn để giải thích.\n\n--- CÂU HỎI ---\n${questionText}\n\n`;
                if (item.mappedType === 'multiple-choice') {
                    prompt += `--- CÁC LỰA CHỌN ---\n${item.options.map((opt, i) => `${String.fromCharCode(65 + i)}. ${opt}`).join('\n')}\n\n`;
                    prompt += `--- ĐÁP ÁN ĐÚNG ---\n${String.fromCharCode(65 + item.correctAnswerIndex)}. ${item.options[item.correctAnswerIndex]}`;
                } else if (item.mappedType === 'true-false') {
                    prompt += `--- CÁC MỆNH ĐỀ & ĐÁP ÁN ---\n${item.statements.map(s => ` - ${s.statement} -> ${s.is_correct ? 'Đúng' : 'Sai'}`).join('\n')}`;
                } else {
                    prompt += `--- ĐÁP ÁN / GỢI Ý ---\n${item.answer}`;
                }
                prompt += `\n\n--- YÊU CẦU ---\nGiải thích rõ ràng tại sao đáp án lại đúng, từng bước một. Định dạng tất cả các công thức toán học bằng LaTeX.`;

                try {
                    const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: prompt });
                    const explanationText = response.text.replace(/\n/g, '<br>');
                    item.explanation = explanationText; // Cache it
                    displayExplanation(explanationText, feedbackDiv, button);
                } catch (error) {
                    console.error("Lỗi khi tạo giải thích:", error);
                    feedbackDiv.insertAdjacentHTML('beforeend', '<div class="ai-explanation text-red-600">Lỗi: Không thể tạo giải thích.</div>');
                    button.disabled = false;
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Thử lại
                    `;
                }
            }

            function displayExplanation(explanationText, container, button) {
                container.insertAdjacentHTML('beforeend', `<div class="ai-explanation prose prose-sm">${explanationText}</div>`);
                if (window.MathJax) MathJax.typesetPromise([container]);
                button.disabled = false;
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    Ẩn giải thích
                `;
            }
           
            function renderStudentQuiz() {
                studentQuizContainer.innerHTML = '';
               
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});
                const groupInfo = {
                    'multiple-choice': { title: 'PHẦN I. TRẮC NGHIỆM KHÁCH QUAN', subtitle: 'Chọn đáp án đúng nhất trong các lựa chọn sau.' },
                    'true-false': { title: 'PHẦN II. CÂU HỎI ĐÚNG - SAI', subtitle: 'Xác định tính đúng hoặc sai cho mỗi mệnh đề dưới đây.' },
                    'short-answer': { title: 'PHẦN III. CÂU HỎI TRẢ LỜI NGẮN', subtitle: 'Điền đáp án ngắn gọn vào phần trả lời.' },
                    'essay': { title: 'PHẦN IV. CÂU HỎI TỰ LUẬN', subtitle: 'Trình bày chi tiết bài giải của bạn.' }
                };
               
                let questionCounter = 0;
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
                partOrder.forEach(partType => {
                    const questions = grouped[partType];
                    if (!questions || questions.length === 0) return;
                   
                    let groupHTML = `<div class="group-container space-y-8 mb-12">`;
                    const info = groupInfo[partType];
                    groupHTML += `
                        <div class="group-header pb-3 border-b-2 border-slate-300 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800">${info.title}</h2>
                            ${info.subtitle ? `<p class="text-md text-slate-600 italic mt-1">${info.subtitle}</p>` : ''}
                        </div>
                    `;
                    questions.forEach((item, localIndex) => {
                        const globalIndex = quizData.indexOf(item);
                        questionCounter++;
                        groupHTML += `<div class="question-card" id="student-q-${globalIndex}">`;
                        let questionText = (item.question || item.main_question || '').replace(/\n/g, '<br>');
                       
                        groupHTML += `<div class="flex items-start">
                                     <div class="flex-grow">
                                         <div class="flex items-center mb-2">
                                             <span class="font-bold text-lg mr-3 text-indigo-600">Câu ${questionCounter}:</span>
                                             <div id="q-${globalIndex}-feedback-icon"></div>
                                         </div>
                                         <div class="question-content mt-2 text-lg text-slate-700">${questionText}</div>
                                         ${item.questionImage ? `<img src="${item.questionImage}" class="mt-4 rounded-lg max-w-full md:max-w-md border shadow-sm">` : ''}
                                     </div>
                                 </div>`;
                       
                        groupHTML += `<div class="mt-6">`;
                        switch(item.mappedType) {
                            case 'multiple-choice':
                                groupHTML += `<div class="options-grid grid grid-cols-1 md:grid-cols-2 gap-4">`;
                                item.options.forEach((opt, i) => {
                                    groupHTML += `<label for="q${globalIndex}-opt${i}" id="q${globalIndex}-opt-label${i}" class="option-label flex items-start p-4 border-2 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-400">
                                                     <input type="radio" name="q${globalIndex}" id="q${globalIndex}-opt${i}" value="${i}" class="flex-shrink-0 mt-1 h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                                     <div class="ml-3 flex-grow">
                                                         <span class="font-semibold text-slate-800">${String.fromCharCode(65 + i)}.</span>
                                                         <span class="option-content text-slate-700">${opt || ''}</span>
                                                         ${(item.optionsImage && item.optionsImage[i]) ? `<img src="${item.optionsImage[i]}" class="mt-2 rounded-lg max-w-xs border shadow-sm">` : ''}
                                                     </div>
                                                 </label>`;
                                });
                                groupHTML += `</div>`;
                                break;
                            case 'true-false':
                                 groupHTML += `<div class="space-y-4">`;
                                 item.statements.forEach((s, i) => {
                                     groupHTML += `<div class="statement-item border-t pt-4">
                                                  <p class="mb-3 text-slate-700">${String.fromCharCode(97 + i)}) ${s.statement || ''}</p>
                                                  <div class="flex gap-x-6">
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="true" class="mr-2 h-4 w-4"> Đúng</label>
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="false" class="mr-2 h-4 w-4"> Sai</label>
                                                  </div>
                                              </div>`;
                                 });
                                 groupHTML += `</div>`;
                                 break;
                            case 'short-answer':
                                groupHTML += `<input type="text" name="q${globalIndex}" class="mt-1 block w-full md:w-1/2 border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Nhập đáp án của bạn...">`;
                                break;
                            case 'essay':
                                groupHTML += `<textarea name="q${globalIndex}" class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" rows="5" placeholder="Nhập câu trả lời tự luận của bạn..."></textarea>`;
                                break;
                        }
                        groupHTML += `</div><div id="q-${globalIndex}-feedback" class="mt-4"></div></div>`;
                    });
                    groupHTML += `</div>`;
                    studentQuizContainer.innerHTML += groupHTML;
                });
               
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    MathJax.typesetPromise([studentQuizContainer]);
                }
            }
           
            async function generatePerformanceReview(allAnswersData) {
                const feedbackContainer = document.getElementById('ai-feedback-container');
                if (!feedbackContainer || !ai) return null;
                feedbackContainer.classList.remove('hidden');
                feedbackContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">📝 Phân Tích & Gợi Ý Từ Trợ Lý AI</h3>
                        <div id="ai-feedback-loader" class="text-center py-6">
                            <svg class="animate-spin mx-auto h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p class="mt-3 text-slate-600">AI đang phân tích bài làm của bạn...</p>
                        </div>
                        <div id="ai-feedback-summary" class="hidden prose prose-sm max-w-none"></div>
                        <div id="ai-feedback-details" class="hidden mt-4 space-y-2"></div>
                    </div>
                `;
               
                const loader = document.getElementById('ai-feedback-loader');
                const summaryDiv = document.getElementById('ai-feedback-summary');
                const detailsDiv = document.getElementById('ai-feedback-details');
                const incorrectAnswers = allAnswersData.filter(a => !a.isCorrect);
                if (incorrectAnswers.length === 0) {
                    feedbackContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                            <h3 class="text-xl font-bold text-green-600">🎉 Chúc mừng!</h3>
                            <p class="mt-2 text-slate-700">Bạn đã trả lời đúng tất cả các câu hỏi. Làm tốt lắm!</p>
                        </div>
                    `;
                    return { overallFeedback: { summary: "Xuất sắc! Học sinh đã đã trả lời đúng tất cả các câu hỏi." } };
                }
                const summaryPrompt = `Bạn là một trợ lý giáo viên, nói tiếng Việt. Dựa vào tóm tắt các câu trả lời sai của học sinh, hãy đưa ra một nhận xét tổng quan ngắn gọn (khoảng 3-4 câu) về năng lực của học sinh, bao gồm điểm mạnh (suy luận từ các câu làm đúng), điểm yếu (dựa trên các câu sai) và một vài gợi ý ôn tập chung. Lời văn phải khích lệ, rõ ràng.
                Tóm tắt lỗi sai:
                ${JSON.stringify(incorrectAnswers.map(a => ({ cau: a.questionNumber, loai: a.type, cauHoi: a.question.substring(0, 50) + '...' })), null, 2)}`;
                try {
                    const response = await ai.models.generateContent({
                        model: "gemini-2.5-flash",
                        contents: summaryPrompt
                    });
                    summaryDiv.innerHTML = response.text.replace(/\n/g, '<br>');
                    loader.classList.add('hidden');
                    summaryDiv.classList.remove('hidden');
                    detailsDiv.classList.remove('hidden'); 
                } catch (e) {
                    console.error("Lỗi khi lấy nhận xét tổng quan:", e);
                    summaryDiv.innerHTML = '<p class="text-red-600">Lỗi khi tạo nhận xét tổng quan.</p>';
                    loader.classList.add('hidden');
                    summaryDiv.classList.remove('hidden');
                }
               
                const summaryForSheet = summaryDiv.innerText.substring(0, 200) + "...";
                return { overallFeedback: { summary: summaryForSheet } };
            }
            async function handleSubmit() {
                if (isSubmitted) return;
                isSubmitted = true;
                clearInterval(timerInterval);
                
                document.querySelectorAll('input, textarea').forEach(input => input.disabled = true);
                submitBtn.classList.add('hidden');
                postSubmitOptions.classList.remove('hidden');
                if (retriesLeft > 0) {
                    retryBtn.classList.remove('hidden');
                } else {
                    retryBtn.classList.add('hidden');
                }

                const proctoringDataString = JSON.stringify(proctoringLog);

                let totalStudentScore = 0;
                let totalCorrectAnswers = 0;
                let allAnswersData = [];
                const questionCounts = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    acc[type] = (acc[type] || 0) + 1;
                    return acc;
                }, {});
                
                quizData.forEach((item, index) => {
                    let questionNumber = index + 1;
                    let answerData = { questionNumber, type: item.type };
                    switch (item.mappedType) {
                        case 'multiple-choice':
                            const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                            const isCorrectMC = selectedOption ? parseInt(selectedOption.value) === item.correctAnswerIndex : false;
                            if (isCorrectMC) {
                                totalCorrectAnswers++;
                                if (questionCounts['multiple-choice'] > 0) {
                                   totalStudentScore += quizOptions.scoring.mc / questionCounts['multiple-choice'];
                                }
                            }
                            answerData.question = item.question;
                            answerData.options = item.options;
                            answerData.yourAnswer = selectedOption ? String.fromCharCode(65 + parseInt(selectedOption.value)) : "Không trả lời";
                            answerData.correctAnswer = String.fromCharCode(65 + item.correctAnswerIndex);
                            answerData.isCorrect = isCorrectMC;
                            break;
                        case 'true-false':
                            let correctStatementsCount = 0;
                            let yourAnswerPattern = [];
                            let correctAnswerPattern = [];
                            let details = [];
                            item.statements.forEach((s, i) => {
                                const selectedTF = document.querySelector(`input[name="q${index}-s${i}"]:checked`);
                                const studentChoice = selectedTF ? selectedTF.value === 'true' : null;
                                const isStatementCorrect = studentChoice === s.is_correct;
                               
                                if (isStatementCorrect) correctStatementsCount++;
                               
                                yourAnswerPattern.push(studentChoice === null ? '?' : (studentChoice ? 'Đ' : 'S'));
                                correctAnswerPattern.push(s.is_correct ? 'Đ' : 'S');
                                details.push({ statement: s.statement, yourChoice: studentChoice === null ? 'Không trả lời' : (studentChoice ? 'Đúng' : 'Sai'), correctChoice: s.is_correct ? 'Đúng' : 'Sai', isCorrect: isStatementCorrect });
                            });
                            
                            let scorePerTfQuestion = 0;
                            if (questionCounts['true-false'] > 0) {
                                scorePerTfQuestion = quizOptions.scoring.tf / questionCounts['true-false'];
                            }
                            let questionPoints = 0;
                            if (quizOptions.scoring.tfMethod === 'progressive') {
                                const progressivePoints = { 0: 0, 1: 0.1, 2: 0.25, 3: 0.5, 4: 1.0 };
                                questionPoints = progressivePoints[correctStatementsCount] * scorePerTfQuestion;
                            } else { // even
                                questionPoints = (correctStatementsCount / 4) * scorePerTfQuestion;
                            }
                            totalStudentScore += questionPoints;

                            if(correctStatementsCount === 4) totalCorrectAnswers++;
                            answerData.question = item.main_question;
                            answerData.yourAnswer = yourAnswerPattern.join('-');
                            answerData.correctAnswer = correctAnswerPattern.join('-');
                            answerData.isCorrect = correctStatementsCount === 4;
                            answerData.details = details;
                            break;
                       
                        case 'short-answer':
                            const saInput = document.querySelector(`input[name="q${index}"]`);
                            const studentAnswerRaw = saInput ? (saInput.value ?? '').trim() : "";
                            const correctAnswerRaw = (item.answer ?? '').toString().trim().replace(/\$/g, '');
                            let isCorrectSA = false;
                            const studentAnswerNormalized = studentAnswerRaw.replace(',', '.');
                            const correctAnswerNormalized = correctAnswerRaw.replace(',', '.');
                            if (studentAnswerNormalized.toLowerCase() === correctAnswerNormalized.toLowerCase()) {
                                isCorrectSA = true;
                            }
                             if (isCorrectSA) {
                                totalCorrectAnswers++;
                                if (questionCounts['short-answer'] > 0) {
                                   totalStudentScore += quizOptions.scoring.sa / questionCounts['short-answer'];
                                }
                            }
                            answerData.question = item.question;
                            answerData.yourAnswer = studentAnswerRaw || "Không trả lời";
                            answerData.correctAnswer = correctAnswerRaw;
                            answerData.isCorrect = isCorrectSA;
                            break;
                           
                        case 'essay':
                             const essayInput = document.querySelector(`textarea[name="q${index}"]`);
                             answerData.question = item.question;
                             answerData.yourAnswer = essayInput.value || "Không trả lời";
                             answerData.correctAnswer = item.answer;
                             answerData.isCorrect = null; // Needs manual grading
                             break;
                    }
                    allAnswersData.push(answerData);
                });
                
                const finalScore = totalStudentScore;
                
                let competencyAssessment = "Giáo viên không yêu cầu AI phân tích bài làm.";
                if (quizOptions.aiAssessment) {
                    const feedbackData = await generatePerformanceReview(allAnswersData);
                    if (feedbackData && feedbackData.overallFeedback && feedbackData.overallFeedback.summary) {
                        competencyAssessment = feedbackData.overallFeedback.summary;
                    } else {
                        competencyAssessment = "Có lỗi xảy ra trong quá trình AI phân tích bài làm.";
                    }
                }
                
                if (quizOptions.showAnswers) {
                    const totalQuestions = quizData.length;
                    resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg text-center">
                        <h3 class="text-2xl font-bold text-slate-800">KẾT QUẢ BÀI LÀM</h3>
                        <p class="mt-4 text-lg">Số câu đúng hoàn toàn: <span class="font-bold text-green-600">${totalCorrectAnswers}/${totalQuestions}</span></p>
                        <p class="text-2xl mt-2">Điểm (thang 10): <span class="font-bold text-blue-600">${finalScore.toFixed(2)}</span></p>
                        ${questionCounts['essay'] > 0 ? `<p class="text-sm text-gray-600 italic mt-1">Lưu ý: Điểm trên chưa bao gồm ${quizOptions.scoring.essay} điểm của phần Tự luận.</p>` : ''}
                    </div>`;
                    resultContainer.classList.remove('hidden');

                    allAnswersData.forEach((ans, index) => {
                        const questionCard = document.getElementById(`student-q-${index}`);
                        const feedbackIconDiv = document.getElementById(`q-${index}-feedback-icon`);
                        const feedbackDiv = document.getElementById(`q-${index}-feedback`);
                        if (!questionCard || !feedbackIconDiv || !feedbackDiv) return;

                        const iconHTML = ans.isCorrect === true
                            ? '<svg class="feedback-icon text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>'
                            : (ans.isCorrect === false ? '<svg class="feedback-icon text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>' : '');
                        feedbackIconDiv.innerHTML = iconHTML;

                        if (ans.type.includes('multiple-choice')) {
                            const studentChoice = ans.yourAnswer === "Không trả lời" ? -1 : ans.yourAnswer.charCodeAt(0) - 65;
                            const correctChoice = ans.correctAnswer.charCodeAt(0) - 65;
                            document.getElementById(`q-${index}-opt-label${correctChoice}`)?.classList.add('correct');
                            if (studentChoice !== -1 && studentChoice !== correctChoice) {
                                document.getElementById(`q-${index}-opt-label${studentChoice}`)?.classList.add('incorrect');
                            }
                        } else if (ans.type === 'true-false') {
                            const statementItems = questionCard.querySelectorAll('.statement-item');
                            ans.details.forEach((detail, i) => { if(statementItems[i]) { statementItems[i].classList.add(detail.isCorrect ? 'correct' : 'incorrect'); }});
                        }

                        if (quizOptions.showExplanation) {
                            feedbackDiv.innerHTML = `<button data-explain-index="${index}" class="explain-btn mt-4 flex items-center px-4 py-2 bg-blue-100 text-blue-800 text-sm font-semibold rounded-lg hover:bg-blue-200 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                Xem giải thích
                            </button>`;
                        }
                    });
                    
                    document.querySelectorAll('.explain-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const button = e.currentTarget;
                            const index = parseInt(button.dataset.explainIndex, 10);
                            showExplanation(index, button);
                        });
                    });

                    if (window.MathJax) await window.MathJax.typesetPromise([studentQuizContainer]);
                } else {
                     resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg text-center"><h3 class="text-xl font-bold text-green-600">Nộp bài thành công!</h3><p class="mt-2 text-slate-700">Bạn đã hoàn thành bài làm. Kết quả sẽ được giáo viên công bố sau.</p></div>`;
                    resultContainer.classList.remove('hidden');
                }
                
                const formData = new FormData();
                formData.append('name', studentInfo.name);
                formData.append('class', studentInfo.class);
                formData.append('score', `${finalScore.toFixed(2)}/10`);
                formData.append('assessment', competencyAssessment);
                formData.append('timestamp', new Date().toLocaleString('vi-VN'));
                formData.append('examCode', correctExamCode);
                formData.append('monitoringLog', proctoringDataString);
                formData.append('answerDetails', JSON.stringify(allAnswersData));
               
                fetch(googleScriptUrl, { method: 'POST', body: formData})
                    .then(res => console.log("Successfully submitted to Google Sheet"))
                    .catch(err => console.error("Error submitting to Google Sheet:", err));
            }
           
            function startNewAttempt() {
                isSubmitted = false;
                proctoringLog = { thoatManHinh: 0, saoChep: 0, dan: 0, suKien: [] };
                const proctoringWidget = document.getElementById('proctoring-widget');
                if (proctoringWidget) {
                    proctoringWidget.classList.add('hidden');
                    document.getElementById('tab-switch-count').textContent = '0';
                    document.getElementById('copy-count').textContent = '0';
                    document.getElementById('paste-count').textContent = '0';
                }

                renderStudentQuiz();
                resultContainer.classList.add('hidden');
                document.getElementById('ai-feedback-container').classList.add('hidden');
                postSubmitOptions.classList.add('hidden');
                submitBtn.classList.remove('hidden');
                 if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                }
                retriesLeft--;
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                window.scrollTo(0, 0);
            }
            studentInfoForm.addEventListener('submit', (e) => {
                e.preventDefault();
               
                const enteredCode = document.getElementById('exam-code').value.trim().toUpperCase();
                if (correctExamCode && enteredCode !== correctExamCode) {
                    alert('Mã đề không chính xác. Vui lòng kiểm tra lại!');
                    return;
                }
               
                studentApiKey = teacherApiKey;
                if (!studentApiKey) {
                    console.warn('Cảnh báo: Giáo viên chưa cấu hình API Key. Các tính năng AI sẽ không hoạt động.');
                }
       
                try {
                    if (studentApiKey) {
                       ai = new GoogleGenAI({ apiKey: studentApiKey });
                    }
                } catch(e) {
                    console.error("Lỗi khởi tạo Gemini API với key của giáo viên.", e);
                    alert("Cảnh báo: API Key của giáo viên không hợp lệ. Vui lòng báo cho giáo viên. Các tính năng AI sẽ không hoạt động.");
                    ai = null;
                }
                shuffleQuiz();
               
                studentInfo.name = document.getElementById('student-name').value;
                studentInfo.class = document.getElementById('student-class').value;
                loginModal.classList.add('hidden');
                studentQuizContainer.classList.remove('hidden');
                submitBtn.classList.remove('hidden');
               
                if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                } else {
                    timerDisplay.textContent = "Không giới hạn";
                }
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                renderStudentQuiz();

                const proctoringWidget = document.getElementById('proctoring-widget');
                const tabSwitchCountEl = document.getElementById('tab-switch-count');
                const copyCountEl = document.getElementById('copy-count');
                const pasteCountEl = document.getElementById('paste-count');

                function updateProctoringUI() {
                    if (proctoringLog.thoatManHinh > 0 || proctoringLog.saoChep > 0 || proctoringLog.dan > 0) {
                        proctoringWidget.classList.remove('hidden');
                    }
                    tabSwitchCountEl.textContent = proctoringLog.thoatManHinh;
                    copyCountEl.textContent = proctoringLog.saoChep;
                    pasteCountEl.textContent = proctoringLog.dan;
                }

                // Disable Right Click
                document.addEventListener('contextmenu', e => e.preventDefault());

                // Track Tab Switching
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && !isSubmitted) {
                        proctoringLog.thoatManHinh++;
                        proctoringLog.suKien.push({ loai: 'chuyen_tab', thoiGian: new Date().toISOString() });
                        updateProctoringUI();
                    }
                });

                // Track Copying
                document.addEventListener('copy', () => {
                    if (isSubmitted) return;
                    proctoringLog.saoChep++;
                    proctoringLog.suKien.push({ loai: 'sao_chep', thoiGian: new Date().toISOString() });
                    updateProctoringUI();
                });

                // Track Pasting
                document.addEventListener('paste', () => {
                    if (isSubmitted) return;
                    proctoringLog.dan++;
                    proctoringLog.suKien.push({ loai: 'dan', thoiGian: new Date().toISOString() });
                    updateProctoringUI();
                });
            });
            
            submitBtn.addEventListener('click', handleSubmit);
            retryBtn.addEventListener('click', () => {
                shuffleQuiz();
                startNewAttempt();
            });
        </script>
    </body>
    </html>
    