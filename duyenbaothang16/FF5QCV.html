
    <!DOCTYPE html>
    <html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ÔN TẬP GIỮA HỌC KÌ I TOÁN LỚP 6</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
        <script>
            window.MathJax = {
                tex: {
                    packages: {'[+]': ['ams']},
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']]
                },
                chtml: {
                    fontCache: 'global',
                    linebreaks: {
                        automatic: true
                    }
                }
            };
        </script>
        <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
        </script>
        <style>
            body { font-family: 'Be Vietnam Pro', sans-serif; background-color: #f0f4f8; }
            .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
            .question-card {
                background-color: white;
                border-radius: 1rem;
                padding: 1.5rem 2rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
                border-left: 5px solid transparent;
                transition: all 0.3s ease;
            }
            .ai-explanation {
                background-color: #f0f9ff;
                color: #0c4a6e;
                padding: 1rem;
                border-radius: 0.75rem;
                font-size: 0.9rem;
                margin-top: 1rem;
                border-left: 4px solid #38bdf8;
            }
            .feedback-icon { width: 1.5rem; height: 1.5rem; }
            .option-label {
                transition: all 0.2s ease-in-out;
                border: 2px solid #e5e7eb;
            }
            .option-label:hover {
                border-color: #6366f1;
                background-color: #eef2ff;
            }
            .option-label.correct {
                border-color: #10b981 !important;
                background-color: #ecfdf5 !important;
                color: #065f46;
            }
            .option-label.incorrect {
                border-color: #ef4444 !important;
                background-color: #fef2f2 !important;
                color: #991b1b;
            }
            .statement-item.correct { background-color: #ecfdf5; border-color: #10b981; }
            .statement-item.incorrect { background-color: #fef2f2; border-color: #ef4444; }
            .prose { max-width: 100%; }
            .prose h1, .prose h2, .prose h3 { font-weight: 600; }
            .prose p { margin-top: 0.5em; margin-bottom: 0.5em; }
            .prose ul, .prose ol { margin-top: 1em; margin-bottom: 1em; padding-left: 1.5em; }
            .prose li > p { margin-top: 0; margin-bottom: 0; }
            .prose code { background-color: #e5e7eb; padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 3px; }
            .prose pre { background-color: #e5e7eb; padding: 1em; border-radius: 0.5em; overflow-x: auto; }
            .prose pre code { background-color: transparent; padding: 0; }
            details[open] > summary .details-arrow {
                transform: rotate(180deg);
            }
        </style>
    </head>
    <body class="bg-slate-100 text-slate-800">
        <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md transform transition-all" style="animation: fadeIn 0.3s ease-out;">
                <h2 class="text-2xl font-bold mb-2 text-center text-slate-800">Thông Tin Học Sinh</h2>
                <p class="text-center text-slate-500 mb-6">Vui lòng nhập để bắt đầu làm bài.</p>
                <form id="student-info-form">
                    <div class="mb-4">
                        <label for="student-name" class="block text-sm font-medium text-slate-700 mb-1">Họ và tên</label>
                        <input type="text" id="student-name" required class="mt-1 block w-full block border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="student-class" class="block text-sm font-medium text-slate-700 mb-1">Lớp</label>
                        <input type="text" id="student-class" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="exam-code" class="block text-sm font-medium text-slate-700 mb-1">Mã đề</label>
                        <input type="text" id="exam-code" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Nhập mã đề giáo viên cung cấp">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Giáo viên:</label>
                        <p class="mt-1 text-slate-800 bg-slate-100 p-2.5 rounded-lg">Nguyễn Thị Duyên</p>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">Bắt đầu làm bài</button>
                </form>
            </div>
        </div>
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="mb-10 p-8 rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 class="text-4xl font-bold">ÔN TẬP GIỮA HỌC KÌ I TOÁN LỚP 6</h1>
                        <p class="text-lg text-blue-100 mt-2">Hãy hoàn thành các câu hỏi dưới đây một cách tốt nhất!</p>
                        <p class="text-sm text-blue-200 mt-4">Tác giả: Nguyễn Thị Duyên</p>
                    </div>
                    <div id="timer-container" class="text-right">
                         <div id="timer-display" class="text-3xl font-bold tracking-wider bg-white/20 px-4 py-2 rounded-lg">--:--</div>
                         <div id="retries-display" class="text-sm mt-1 text-blue-200"></div>
                    </div>
                </div>
            </header>
            <main id="student-quiz-container" class="space-y-8 hidden">
                <!-- Questions will be rendered here by JS -->
            </main>
            <footer class="mt-10 text-center">
                <button id="submit-quiz-btn" class="bg-indigo-600 text-white py-3 px-12 rounded-full font-bold text-lg hover:bg-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl hidden transform hover:scale-105">Nộp Bài</button>
                <div id="result-container" class="mt-6 hidden"></div>
                <div id="ai-feedback-container" class="mt-8 text-left hidden"></div>
                <div id="post-submit-options" class="hidden mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="retry-quiz-btn" class="w-full sm:w-auto bg-slate-600 text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-slate-700 transition-transform transform hover:scale-105">Làm Lại Đề Này</button>
                </div>
            </footer>
        </div>

        <div id="proctoring-widget" class="fixed bottom-4 right-4 bg-yellow-100 text-yellow-800 p-3 rounded-lg shadow-lg text-sm z-50 hidden border border-yellow-300" style="max-width: 200px;">
            <h4 class="font-bold mb-2 border-b border-yellow-300 pb-1 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 3.001-1.742 3.001H4.42c-1.53 0-2.493-1.667-1.743-3.001l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                Giám sát
            </h4>
            <p>Thoát màn hình: <span id="tab-switch-count" class="font-bold">0</span></p>
            <p>Sao chép: <span id="copy-count" class="font-bold">0</span></p>
            <p>Dán: <span id="paste-count" class="font-bold">0</span></p>
        </div>

        <script type="module">
            import { GoogleGenAI, Type } from "https://esm.sh/@google/genai@^1.13.0";
            let quizData = [{"type":"multiple-choice","question":"Cho tập hợp $A = \\{0; 1; 2; 3; 4\\}$. Khẳng định nào sau đây là đúng?","questionImage":null,"mappedType":"multiple-choice","options":["$5 \\in A$","$2 \\notin A$","$0 \\in A$","$10 \\in A$"],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Cho tập hợp $A$ gồm các số tự nhiên nhỏ hơn $5$. Cách viết nào sau đây là đúng để biểu diễn tập hợp $A$ bằng cách liệt kê các phần tử?","questionImage":null,"mappedType":"multiple-choice","options":["$A = \\{1; 2; 3; 4\\}$","$A = \\{0; 1; 2; 3; 4\\}$","$A = \\{1; 2; 3; 4; 5\\}$","$A = \\{0; 1; 2; 3; 4; 5\\}$"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Cho tập hợp $A = \\{0; 1; 2; 3; 4; 5\\}$. Cách viết nào sau đây biểu diễn đúng tập hợp $A$ bằng cách chỉ ra tính chất đặc trưng của các phần tử?","questionImage":null,"mappedType":"multiple-choice","options":["$A = \\{x \\in \\mathbb{N} \\mid x \\le 5\\}$","$A = \\{x \\in \\mathbb{N} \\mid x < 5\\}$","$A = \\{x \\in \\mathbb{N} \\mid x > 5\\}$","$A = \\{x \\in \\mathbb{N} \\mid x = 5\\}$"],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Cho tập hợp $M = \\{x \\in \\mathbb{N} \\mid x \\text{ là số lẻ và } x < 15\\}$. Khẳng định nào sau đây là đúng?","questionImage":null,"mappedType":"multiple-choice","options":["$15 \\in M$","$10 \\in M$","$13 \\in M$","$7 \\notin M$"],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Số tự nhiên \"Ba trăm linh năm nghìn không trăm bảy mươi hai\" được viết là:","questionImage":null,"mappedType":"multiple-choice","options":["$305072$","$350072$","$305720$","$300572$"],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Số tự nhiên $725$ được biểu diễn thành tổng giá trị các chữ số của nó là:","questionImage":null,"mappedType":"multiple-choice","options":["$7 + 2 + 5$","$7 \\times 100 + 2 \\times 10 + 5 \\times 1$","$7 \\times 1000 + 2 \\times 100 + 5 \\times 10$","$7 \\times 10 + 2 \\times 100 + 5 \\times 1$"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Trong số tự nhiên $34567$, chữ số $5$ có giá trị là bao nhiêu?","questionImage":null,"mappedType":"multiple-choice","options":["$5$","$50$","$500$","$5000$"],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Số tự nhiên được biểu diễn bởi số La Mã $XXIV$ là:","questionImage":null,"mappedType":"multiple-choice","options":["26","24","14","34"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Dấu thích hợp điền vào ô trống trong phép so sánh $34\\,567 \\dots 34\\,576$ là:","questionImage":null,"mappedType":"multiple-choice","options":["$>$","$<$","$=$","$\\ge$"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Sắp xếp các số tự nhiên sau theo thứ tự tăng dần: $2023, 2302, 2032, 2203$.","questionImage":null,"mappedType":"multiple-choice","options":["$2023; 2032; 2203; 2302$","$2302; 2203; 2032; 2023$","$2032; 2023; 2203; 2302$","$2023; 2203; 2032; 2302$"],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Cho ba số tự nhiên $a = 105$, $b = 99$, $c = 110$. Khẳng định nào sau đây là đúng?","questionImage":null,"mappedType":"multiple-choice","options":["$a < b < c$","$b < a < c$","$c < a < b$","$b < c < a$"],"optionsImage":[],"correctAnswerIndex":1},{"type":"short-answer","question":"Tìm số liền sau của số tự nhiên $100$.","questionImage":null,"mappedType":"short-answer","answer":"101"},{"type":"short-answer","question":"Một trường học ban đầu có $1250$ học sinh. Trong học kì $1$, có $48$ học sinh chuyển đi và $75$ học sinh mới chuyển đến. Hỏi cuối học kì $1$, trường học đó có bao nhiêu học sinh?","questionImage":null,"mappedType":"short-answer","answer":"1277"},{"type":"short-answer","question":"Tính nhanh giá trị của biểu thức $A = 125 + 37 + 75 + 63$.","questionImage":null,"mappedType":"short-answer","answer":"300"},{"type":"short-answer","question":"Một trường học nhận được $25$ thùng sách giáo khoa. Mỗi thùng có $30$ cuốn sách. Sau khi giữ lại $500$ cuốn sách để dùng cho thư viện, số sách còn lại được chia đều cho các lớp, mỗi lớp nhận $23$ cuốn sách. Hỏi trường đó còn thừa bao nhiêu cuốn sách sau khi chia đều?","questionImage":null,"mappedType":"short-answer","answer":" 20"},{"type":"short-answer","question":"Một cửa hàng bánh ngọt nhập về $25$ chiếc bánh kem với giá $12000$ đồng/chiếc, $25$ chiếc bánh su kem với giá $18000$ đồng/chiếc và $25$ chiếc bánh mì ngọt với giá $8000$ đồng/chiếc. Tính tổng số tiền mà cửa hàng phải trả cho số bánh đã nhập.","questionImage":null,"mappedType":"short-answer","answer":"950000"},{"type":"true-false","main_question":"Một trang trại nuôi gà có $15$ chuồng, mỗi chuồng có $120$ con gà. Trang trại vừa bán đi $600$ con gà. Xét các mệnh đề sau đây:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Ban đầu, trang trại có tổng cộng $15 \\times 120 = 1800$ con gà.","is_correct":true},{"statement":"Sau khi bán $600$ con gà, trang trại còn lại $1800 - 600 = 1200$ con gà.","is_correct":true},{"statement":"Nếu số gà còn lại được chia đều vào $10$ chuồng mới, thì mỗi chuồng sẽ có $100$ con gà.","is_correct":false},{"statement":"Nếu mỗi con gà mái trong số $1200$ con gà còn lại (giả sử $\\frac{2}{3}$ là gà mái) đẻ $5$ quả trứng mỗi tuần, thì trong $2$ tuần trang trại thu được $1200 \\times \\frac{2}{3} \\times 5 \\times 2 = 8000$ quả trứng.","is_correct":true}]},{"type":"true-false","main_question":"Một cửa hàng trong tháng Giêng bán được $1235$ chiếc áo. Trong tháng Hai, cửa hàng bán ít hơn tháng Giêng $120$ chiếc áo. Trong tháng Ba, cửa hàng bán nhiều hơn tháng Hai $50$ chiếc áo. Hãy xác định tính đúng/sai của các mệnh đề sau:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Trong tháng Hai, cửa hàng bán được $1115$ chiếc áo.","is_correct":true},{"statement":"Trong tháng Ba, cửa hàng bán được $1165$ chiếc áo.","is_correct":true},{"statement":"Tổng số áo cửa hàng bán được trong hai tháng đầu tiên là $2350$ chiếc.","is_correct":true},{"statement":"Tổng số áo cửa hàng bán được trong cả ba tháng là $3520$ chiếc.","is_correct":false}]},{"type":"multiple-choice","question":"Viết tích $7 \\cdot 7 \\cdot 7 \\cdot 7 \\cdot 7$ dưới dạng lũy thừa.","questionImage":null,"mappedType":"multiple-choice","options":["$5^7$","$7^5$","$7 \\cdot 5$","$5 \\cdot 7$"],"optionsImage":[],"correctAnswerIndex":1},{"type":"short-answer","question":"Tính giá trị của luỹ thừa $3^4$.","questionImage":null,"mappedType":"short-answer","answer":"81"},{"type":"short-answer","question":"Tính giá trị của biểu thức $P = \\left(5^7 \\cdot 5^3\\right) : \\left(5^2 \\cdot 5^5\\right)$.","questionImage":null,"mappedType":"short-answer","answer":"125"},{"type":"true-false","main_question":"Xét tính đúng sai của các mệnh đề sau:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Vì $3 < 5$ nên $2^3 < 2^5$.","is_correct":true},{"statement":"Vì $9 = 3^2$ nên $9^2 < 3^5$.","is_correct":true},{"statement":"Vì $4 = 2^2$ và $8 = 2^3$ nên $4^3 = 8^2$.","is_correct":true},{"statement":"Vì $1024 = 2^{10}$ nên $2^{10} < 1024$.","is_correct":false}]},{"type":"true-false","main_question":"Cho biểu thức $A = 100 - 5^2 \\cdot 2 + 12 : 6$. Hãy cho biết các khẳng định sau là đúng hay sai:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Giá trị của $5^2$ là $10$.","is_correct":false},{"statement":"Thực hiện phép tính $5^2 \\cdot 2$ ta được $50$.","is_correct":true},{"statement":"Khi thực hiện các phép tính lũy thừa, nhân và chia trước, biểu thức $A$ trở thành $100 - 50 + 2$.","is_correct":true},{"statement":"Giá trị của biểu thức $A$ là $48$.","is_correct":false}]},{"type":"true-false","main_question":"Cho biểu thức $P = 150 - \\{ 5 \\times [20 - (6 + 3 \\times 2)] \\div 2 + 10 \\}$. Hãy cho biết các khẳng định sau là đúng hay sai:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Giá trị của biểu thức $(6 + 3 \\times 2)$ là $12$.","is_correct":true},{"statement":"Giá trị của biểu thức $[20 - (6 + 3 \\times 2)]$ là $14$.","is_correct":false},{"statement":"Giá trị của biểu thức $\\{ 5 \\times [20 - (6 + 3 \\times 2)] \\div 2 + 10 \\}$ là $30$.","is_correct":true},{"statement":"Giá trị của biểu thức $P$ là $90$.","is_correct":false}]},{"type":"multiple-choice","question":"Số nào sau đây chia hết cho $3$?","questionImage":null,"mappedType":"multiple-choice","options":["$25$","$36$","$40$","$100$"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Tập hợp tất cả các ước của số tự nhiên $24$ là:","questionImage":null,"mappedType":"multiple-choice","options":["$\\{1, 2, 3, 4, 6, 8, 12, 24\\}$","$\\{1, 2, 3, 4, 6, 12, 24\\}$","$\\{1, 2, 3, 4, 5, 6, 8, 12, 24\\}$","$\\{1, 2, 3, 6, 8, 12, 24\\}$"],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Trong các tập hợp sau, tập hợp nào chứa tất cả các bội của $7$ nhỏ hơn $50$?","questionImage":null,"mappedType":"multiple-choice","options":["$\\{0; 7; 14; 21; 28; 35; 42; 49\\}$","$\\{7; 14; 21; 28; 35; 42; 49\\}$","$\\{0; 7; 14; 21; 28; 35; 42; 49; 56\\}$","$\\{7; 14; 21; 28; 35; 42; 49; 56\\}$"],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Cho biểu thức $A = 42 + 2x - 36$. Để biểu thức $A$ chia hết cho $6$, số tự nhiên $x$ cần thỏa mãn điều kiện nào sau đây?","questionImage":null,"mappedType":"multiple-choice","options":["$x$ là số chẵn.","$x$ là số chia hết cho $3$.","$x$ là số lẻ.","$x$ là số chia hết cho $5$."],"optionsImage":[],"correctAnswerIndex":1},{"type":"true-false","main_question":"Cho số tự nhiên $N = \\overline{a32b}$ (với $a, b$ là các chữ số, $a \\ne 0$). Hãy xác định các mệnh đề sau đúng hay sai.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Nếu $b = 5$ thì $N$ chia hết cho $5$.","is_correct":true},{"statement":"Nếu $b = 0$ thì $N$ vừa chia hết cho $2$ vừa chia hết cho $5$.","is_correct":true},{"statement":"Nếu $b \\in \\{0; 2; 4; 6\\}$ thì $N$ chia hết cho $2$.","is_correct":false},{"statement":"Nếu $N$ chia hết cho $2$ nhưng không chia hết cho $5$ thì $b$ có $4$ giá trị thỏa mãn.","is_correct":true}]},{"type":"true-false","main_question":"Cho số tự nhiên $N = \\overline{a27b}$ là số tự nhiên có bốn chữ số. Hãy xác định các mệnh đề sau đây là đúng hay sai về tính chia hết của $N$ cho $3$ và $9$.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Nếu $a = 1$ và $b = 2$ thì số $N$ chia hết cho $3$.","is_correct":true},{"statement":"Nếu $a = 3$ thì số $N$ chia hết cho $9$ khi và chỉ khi $b = 0$.","is_correct":false},{"statement":"Nếu $N$ chia hết cho $3$ và $b$ là chữ số chẵn lớn nhất thì $a$ có $2$ giá trị.","is_correct":false},{"statement":"Nếu $N$ chia hết cho $3$ và $N$ chia hết cho $9$ đồng thời $a, b$ là các chữ số khác $0$ và $a \\neq b$ thì có tất cả $8$ cặp $(a; b)$ thỏa mãn.","is_correct":true}]},{"type":"short-answer","question":"Cho số $A = \\overline{13x}$. Tìm chữ số $x$ để số $A$ chia hết cho cả $2$ và $5$.","questionImage":null,"mappedType":"short-answer","answer":"0"},{"type":"short-answer","question":"Cho số $B = \\overline{5y2}$. Tìm chữ số $y$ để số $B$ chia hết cho $9$.","questionImage":null,"mappedType":"short-answer","answer":"2"},{"type":"short-answer","question":"Cho số $C = \\overline{3x4}$. Tìm các chữ số $x$ để số $C$ chia hết cho $2$ và $3$.","questionImage":null,"mappedType":"short-answer","answer":"2, 5, 8"},{"type":"short-answer","question":"Cho số $D = \\overline{8a1b}$. Tìm các chữ số $a, b$ để số $D$ chia hết cho $5$ và $9$.","questionImage":null,"mappedType":"short-answer","answer":" Các cặp chữ số (a, b) thỏa mãn là (0, 0), (9, 0), (4, 5)"},{"type":"true-false","main_question":"Hãy xác định xem các khẳng định sau đây là đúng hay sai về số nguyên tố và hợp số.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Mọi số nguyên tố đều là số lẻ.","is_correct":false},{"statement":"Số tự nhiên 1 không phải là số nguyên tố cũng không phải là hợp số.","is_correct":true},{"statement":"Tất cả các số chẵn lớn hơn 2 đều là hợp số.","is_correct":true},{"statement":"Trong các số tự nhiên từ 20 đến 30, có đúng 3 số nguyên tố.","is_correct":false}]},{"type":"true-false","main_question":"Cho số tự nhiên $N = 60$. Hãy cho biết các mệnh đề sau đây là đúng hay sai về việc phân tích số $N$ ra thừa số nguyên tố.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Số 60 là một hợp số.","is_correct":true},{"statement":"Các thừa số nguyên tố khác nhau của số 60 là 2, 3 và 5.","is_correct":true},{"statement":"Phân tích số 60 ra thừa số nguyên tố là 2^2 .3. 5","is_correct":true},{"statement":"Số 60 có đúng 12 ước tự nhiên.","is_correct":true}]},{"type":"multiple-choice","question":"Quan sát hình vẽ tam giác đều $ABC$. Hỏi số đo của góc $B$ là bao nhiêu?<img src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0nMS4wJyBlbmNvZGluZz0nVVRGLTgnPz4KPCEtLSBUaGlzIGZpbGUgd2FzIGdlbmVyYXRlZCBieSBkdmlzdmdtIDMuMC4zIC0tPgo8c3ZnIHZlcnNpb249JzEuMScgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB4bWxuczp4bGluaz0naHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycgd2lkdGg9JzE0MC4zMTcxMjNwdCcgaGVpZ2h0PScxMjIuNjE4ODY2cHQnIHZpZXdCb3g9Jy02NS4yNjU2MDQgLTY1LjI2NjA1NyAxNDAuMzE3MTIzIDEyMi42MTg4NjYnPgo8ZGVmcz4KPHBhdGggaWQ9J2cwLTY1JyBkPSdNMi4wMzIzNzktMS4zMjcwMjRDMS42MTM5NDgtLjYyMTY2OSAxLjIwNzQ3Mi0uMzgyNTY1IC42MzM2MjQtLjM0NjdDLjUwMjExNy0uMzM0NzQ1IC40MDY0NzYtLjMzNDc0NSAuNDA2NDc2LS4xMTk1NTJDLjQwNjQ3Ni0uMDQ3ODIxIC40NjYyNTIgMCAuNTQ5OTM4IDBDLjc2NTEzMSAwIDEuMzAzMTEzLS4wMjM5MSAxLjUxODMwNi0uMDIzOTFDMS44NjUwMDYtLjAyMzkxIDIuMjQ3NTcyIDAgMi41ODIzMTYgMEMyLjY1NDA0NyAwIDIuNzk3NTA5IDAgMi43OTc1MDktLjIyNzE0OEMyLjc5NzUwOS0uMzM0NzQ1IDIuNzAxODY4LS4zNDY3IDIuNjMwMTM3LS4zNDY3QzIuMzU1MTY4LS4zNzA2MSAyLjEyODAyLS40NjYyNTIgMi4xMjgwMi0uNzUzMTc2QzIuMTI4MDItLjkyMDU0OCAyLjE5OTc1MS0xLjA1MjA1NSAyLjM1NTE2OC0xLjMxNTA2OEwzLjI2Mzc2MS0yLjgyMTQySDYuMzEyMzI5QzYuMzI0Mjg0LTIuNzEzODIzIDYuMzI0Mjg0LTIuNjE4MTgyIDYuMzM2MjM5LTIuNTEwNTg1QzYuMzcyMTA1LTIuMTk5NzUxIDYuNTE1NTY3LS45NTY0MTMgNi41MTU1NjctLjcyOTI2NUM2LjUxNTU2Ny0uMzcwNjEgNS45MDU4NTMtLjM0NjcgNS43MTQ1Ny0uMzQ2N0M1LjU4MzA2NC0uMzQ2NyA1LjQ1MTU1Ny0uMzQ2NyA1LjQ1MTU1Ny0uMTMxNTA3QzUuNDUxNTU3IDAgNS41NTkxNTMgMCA1LjYzMDg4NCAwQzUuODM0MTIyIDAgNi4wNzMyMjUtLjAyMzkxIDYuMjc2NDYzLS4wMjM5MUg2Ljk1NzkwOEM3LjY4NzE3My0uMDIzOTEgOC4yMTMyIDAgOC4yMjUxNTYgMEM4LjMwODg0MiAwIDguNDQwMzQ5IDAgOC40NDAzNDktLjIyNzE0OEM4LjQ0MDM0OS0uMzQ2NyA4LjMzMjc1Mi0uMzQ2NyA4LjE1MzQyNS0uMzQ2N0M3LjQ5NTg5LS4zNDY3IDcuNDgzOTM1LS40NTQyOTYgNy40NDgwNy0uODEyOTUxTDYuNzE4ODA0LTguMjcyOTc2QzYuNjk0ODk0LTguNTEyMDggNi42NDcwNzMtOC41MzU5OSA2LjUxNTU2Ny04LjUzNTk5QzYuMzk2MDE1LTguNTM1OTkgNi4zMjQyODQtOC41MTIwOCA2LjIxNjY4Ny04LjMzMjc1MkwyLjAzMjM3OS0xLjMyNzAyNFpNMy40NjY5OTktMy4xNjgxMkw1Ljg2OTk4OC03LjE4NTA1Nkw2LjI3NjQ2My0zLjE2ODEySDMuNDY2OTk5WicvPgo8cGF0aCBpZD0nZzAtNjYnIGQ9J000LjM3NTU5Mi03LjM1MjQyOEM0LjQ4MzE4OC03Ljc5NDc3IDQuNTMxMDA5LTcuODE4NjggNC45OTcyNi03LjgxODY4SDYuNTUxNDMyQzcuOTAyMzY2LTcuODE4NjggNy45MDIzNjYtNi42NzA5ODQgNy45MDIzNjYtNi41NjMzODdDNy45MDIzNjYtNS41OTUwMTkgNi45MzM5OTgtNC4zNjM2MzYgNS4zNTU5MTUtNC4zNjM2MzZIMy42MzQzNzFMNC4zNzU1OTItNy4zNTI0MjhaTTYuMzk2MDE1LTQuMjY3OTk1QzcuNjk5MTI4LTQuNTA3MDk4IDguODgyNjktNS40MTU2OTEgOC44ODI2OS02LjUxNTU2N0M4Ljg4MjY5LTcuNDQ4MDcgOC4wNTc3ODMtOC4xNjUzOCA2LjcwNjg0OS04LjE2NTM4SDIuODY5MjRDMi42NDIwOTItOC4xNjUzOCAyLjUzNDQ5Ni04LjE2NTM4IDIuNTM0NDk2LTcuOTM4MjMyQzIuNTM0NDk2LTcuODE4NjggMi42NDIwOTItNy44MTg2OCAyLjgyMTQyLTcuODE4NjhDMy41NTA2ODUtNy44MTg2OCAzLjU1MDY4NS03LjcyMzAzOSAzLjU1MDY4NS03LjU5MTUzMkMzLjU1MDY4NS03LjU2NzYyMSAzLjU1MDY4NS03LjQ5NTg5IDMuNTAyODY0LTcuMzE2NTYzTDEuODg4OTE3LS44ODQ2ODJDMS43ODEzMi0uNDY2MjUyIDEuNzU3NDEtLjM0NjcgLjkyMDU0OC0uMzQ2N0MuNjkzNC0uMzQ2NyAuNTczODQ4LS4zNDY3IC41NzM4NDgtLjEzMTUwN0MuNTczODQ4IDAgLjY0NTU3OSAwIC44ODQ2ODIgMEg0Ljk4NTMwNUM2LjgxNDQ0NiAwIDguMjI1MTU2LTEuMzg2OCA4LjIyNTE1Ni0yLjU5NDI3MUM4LjIyNTE1Ni0zLjU3NDU5NSA3LjM2NDM4NC00LjE3MjM1NCA2LjM5NjAxNS00LjI2Nzk5NVpNNC42OTgzODEtLjM0NjdIMy4wODQ0MzNDMi45MTcwNjEtLjM0NjcgMi44OTMxNTEtLjM0NjcgMi44MjE0Mi0uMzU4NjU1QzIuNjg5OTEzLS4zNzA2MSAyLjY3Nzk1OC0uMzk0NTIxIDIuNjc3OTU4LS40OTAxNjJDMi42Nzc5NTgtLjU3Mzg0OCAyLjcwMTg2OC0uNjQ1NTc5IDIuNzI1Nzc4LS43NTMxNzZMMy41NjI2NC00LjEyNDUzM0g1LjgxMDIxMkM3LjIyMDkyMi00LjEyNDUzMyA3LjIyMDkyMi0yLjgwOTQ2NSA3LjIyMDkyMi0yLjcxMzgyM0M3LjIyMDkyMi0xLjU2NjEyNyA2LjE4MDgyMi0uMzQ2NyA0LjY5ODM4MS0uMzQ2N1onLz4KPHBhdGggaWQ9J2cwLTY3JyBkPSdNOC45MzA1MTEtOC4zMDg4NDJDOC45MzA1MTEtOC40MTY0MzggOC44NDY4MjQtOC40MTY0MzggOC44MjI5MTQtOC40MTY0MzhTOC43NTExODMtOC40MTY0MzggOC42NTU1NDItOC4yOTY4ODdMNy44MzA2MzUtNy4yOTI2NTNDNy40MTIyMDQtOC4wMDk5NjMgNi43NTQ2Ny04LjQxNjQzOCA1Ljg1ODAzMi04LjQxNjQzOEMzLjI3NTcxNi04LjQxNjQzOCAuNTk3NzU4LTUuNzk4MjU3IC41OTc3NTgtMi45ODg3OTJDLjU5Nzc1OC0uOTkyMjc5IDEuOTk2NTEzIC4yNTEwNTkgMy43NDE5NjggLjI1MTA1OUM0LjY5ODM4MSAuMjUxMDU5IDUuNTM1MjQzLS4xNTU0MTcgNi4yMjg2NDMtLjc0MTIyQzcuMjY4NzQyLTEuNjEzOTQ4IDcuNTc5NTc3LTIuNzczNTk5IDcuNTc5NTc3LTIuODY5MjRDNy41Nzk1NzctMi45NzY4MzcgNy40ODM5MzUtMi45NzY4MzcgNy40NDgwNy0yLjk3NjgzN0M3LjM0MDQ3My0yLjk3NjgzNyA3LjMyODUxOC0yLjkwNTEwNiA3LjMwNDYwOC0yLjg1NzI4NUM2Ljc1NDY3LS45OTIyNzkgNS4xNDA3MjItLjA5NTY0MSAzLjk0NTIwNS0uMDk1NjQxQzIuNjc3OTU4LS4wOTU2NDEgMS41NzgwODItLjkwODU5MyAxLjU3ODA4Mi0yLjYwNjIyN0MxLjU3ODA4Mi0yLjk4ODc5MiAxLjY5NzYzNC01LjA2ODk5MSAzLjA0ODU2OC02LjYzNTExOEMzLjcwNjEwMi03LjQwMDI0OSA0LjgyOTg4OC04LjA2OTczOCA1Ljk2NTYyOS04LjA2OTczOEM3LjI4MDY5Ny04LjA2OTczOCA3Ljg2NjUwMS02Ljk4MTgxOCA3Ljg2NjUwMS01Ljc2MjM5MUM3Ljg2NjUwMS01LjQ1MTU1NyA3LjgzMDYzNS01LjE4ODU0MyA3LjgzMDYzNS01LjE0MDcyMkM3LjgzMDYzNS01LjAzMzEyNiA3Ljk1MDE4Ny01LjAzMzEyNiA3Ljk4NjA1Mi01LjAzMzEyNkM4LjExNzU1OS01LjAzMzEyNiA4LjEyOTUxNC01LjA0NTA4MSA4LjE3NzMzNS01LjI2MDI3NEw4LjkzMDUxMS04LjMwODg0MlonLz4KPC9kZWZzPgo8ZyBpZD0ncGFnZTEnPgo8cGF0aCBkPSdNNS4wMjM0MzctNTIuOTk2MUwtNTEuNjY3OTcgNDUuMDgyMDMxSDYxLjcxODczWicgc3Ryb2tlPScjMDAwJyBmaWxsPSdub25lJyBzdHJva2Utd2lkdGg9Jy4zOTg1JyBzdHJva2UtbWl0ZXJsaW1pdD0nMTAnLz4KPGcgdHJhbnNmb3JtPSdtYXRyaXgoMSAwIDAgMSAtNC4zODc3MSAtMTAyLjE4MDEpJz4KPHVzZSB4PSc1LjAyNDMyNicgeT0nNDUuMDgzNDA5JyB4bGluazpocmVmPScjZzAtNjUnLz4KPC9nPgo8ZyB0cmFuc2Zvcm09J21hdHJpeCgxIDAgMCAxIC03MC4yODk5MyAxMi4yNjk0KSc+Cjx1c2UgeD0nNS4wMjQzMjYnIHk9JzQ1LjA4MzQwOScgeGxpbms6aHJlZj0nI2cwLTY2Jy8+CjwvZz4KPGcgdHJhbnNmb3JtPSdtYXRyaXgoMSAwIDAgMSA2MC43OTM1NyAxMi4yNjk0KSc+Cjx1c2UgeD0nNS4wMjQzMjYnIHk9JzQ1LjA4MzQwOScgeGxpbms6aHJlZj0nI2cwLTY3Jy8+CjwvZz4KPHBhdGggZD0nTS0zNy40OTYwNyA0NS4wODIwMzFDLTM3LjQ5NjA3IDQwLjAyMzQ0LTQwLjE5NTI3IDM1LjM0Mzc1LTQ0LjU3ODE3IDMyLjgxMjUnIHN0cm9rZT0nIzAwMCcgZmlsbD0nbm9uZScgc3Ryb2tlLXdpZHRoPScuMzk4NScgc3Ryb2tlLW1pdGVybGltaXQ9JzEwJy8+CjwvZz4KPC9zdmc+\" class=\"mt-4 rounded-lg max-w-full md:max-w-md border shadow-sm mx-auto my-2\" alt=\"Hình ảnh toán học\">","questionImage":null,"mappedType":"multiple-choice","options":["$30^{\\circ}$","$60^{\\circ}$","$90^{\\circ}$","$120^{\\circ}$"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Quan sát hình vẽ hình vuông $MNPQ$. Hỏi hình vuông có bao nhiêu cạnh bằng nhau?<img src=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0nMS4wJyBlbmNvZGluZz0nVVRGLTgnPz4KPCEtLSBUaGlzIGZpbGUgd2FzIGdlbmVyYXRlZCBieSBkdmlzdmdtIDMuMC4zIC0tPgo8c3ZnIHZlcnNpb249JzEuMScgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB4bWxuczp4bGluaz0naHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycgd2lkdGg9Jzg4LjA4OTkxNHB0JyBoZWlnaHQ9JzgzLjU1Njg3M3B0JyB2aWV3Qm94PSctNjUuMjY0OTA1IC02NS4yNjU0NjMgODguMDg5OTE0IDgzLjU1Njg3Myc+CjxkZWZzPgo8cGF0aCBpZD0nZzAtNzcnIGQ9J00xMC44NTUyOTMtNy4yOTI2NTNDMTAuOTYyODg5LTcuNjk5MTI4IDEwLjk4NjgtNy44MTg2OCAxMS44MzU2MTYtNy44MTg2OEMxMi4wNjI3NjUtNy44MTg2OCAxMi4xNzAzNjEtNy44MTg2OCAxMi4xNzAzNjEtOC4wNDU4MjhDMTIuMTcwMzYxLTguMTY1MzggMTIuMDg2Njc1LTguMTY1MzggMTEuODU5NTI3LTguMTY1MzhIMTAuNDI0OTA3QzEwLjEyNjAyNy04LjE2NTM4IDEwLjExNDA3Mi04LjE1MzQyNSA5Ljk4MjU2NS03Ljk2MjE0Mkw1LjYxODkyOS0xLjA2NDAxTDQuNzIyMjkxLTcuOTAyMzY2QzQuNjg2NDI2LTguMTY1MzggNC42NzQ0NzEtOC4xNjUzOCA0LjM2MzYzNi04LjE2NTM4SDIuODgxMTk2QzIuNjU0MDQ3LTguMTY1MzggMi41NDY0NTEtOC4xNjUzOCAyLjU0NjQ1MS03LjkzODIzMkMyLjU0NjQ1MS03LjgxODY4IDIuNjU0MDQ3LTcuODE4NjggMi44MzMzNzUtNy44MTg2OEMzLjU2MjY0LTcuODE4NjggMy41NjI2NC03LjcyMzAzOSAzLjU2MjY0LTcuNTkxNTMyQzMuNTYyNjQtNy41Njc2MjEgMy41NjI2NC03LjQ5NTg5IDMuNTE0ODE5LTcuMzE2NTYzTDEuOTg0NTU4LTEuMjE5NDI3QzEuODQxMDk2LS42NDU1NzkgMS41NjYxMjctLjM4MjU2NSAuNzY1MTMxLS4zNDY3Qy43MjkyNjUtLjM0NjcgLjU4NTgwMy0uMzM0NzQ1IC41ODU4MDMtLjEzMTUwN0MuNTg1ODAzIDAgLjY5MzQgMCAuNzQxMjIgMEMuOTgwMzI0IDAgMS41OTAwMzctLjAyMzkxIDEuODI5MTQxLS4wMjM5MUgyLjQwMjk4OUMyLjU3MDM2MS0uMDIzOTEgMi43NzM1OTkgMCAyLjk0MDk3MSAwQzMuMDI0NjU4IDAgMy4xNTYxNjQgMCAzLjE1NjE2NC0uMjI3MTQ4QzMuMTU2MTY0LS4zMzQ3NDUgMy4wMzY2MTMtLjM0NjcgMi45ODg3OTItLjM0NjdDMi41OTQyNzEtLjM1ODY1NSAyLjIxMTcwNi0uNDMwMzg2IDIuMjExNzA2LS44NjA3NzJDMi4yMTE3MDYtLjk4MDMyNCAyLjIxMTcwNi0uOTkyMjc5IDIuMjU5NTI3LTEuMTU5NjUxTDMuOTA5MzQtNy43NDY5NDlIMy45MjEyOTVMNC45MTM1NzQtLjMyMjc5QzQuOTQ5NDQtLjAzNTg2NiA0Ljk2MTM5NSAwIDUuMDY4OTkxIDBDNS4yMDA0OTggMCA1LjI2MDI3NC0uMDk1NjQxIDUuMzIwMDUtLjIwMzIzOEwxMC4xMjYwMjctNy44MDY3MjVIMTAuMTM3OTgzTDguNDA0NDgzLS44ODQ2ODJDOC4yOTY4ODctLjQ2NjI1MiA4LjI3Mjk3Ni0uMzQ2NyA3LjQzNjExNS0uMzQ2N0M3LjIwODk2Ni0uMzQ2NyA3LjA4OTQxNS0uMzQ2NyA3LjA4OTQxNS0uMTMxNTA3QzcuMDg5NDE1IDAgNy4xOTcwMTEgMCA3LjI2ODc0MiAwQzcuNDcxOTggMCA3LjcxMTA4My0uMDIzOTEgNy45MTQzMjEtLjAyMzkxSDkuMzI1MDMxQzkuNTI4MjY5LS4wMjM5MSA5Ljc3OTMyOCAwIDkuOTgyNTY1IDBDMTAuMDc4MjA3IDAgMTAuMjA5NzE0IDAgMTAuMjA5NzE0LS4yMjcxNDhDMTAuMjA5NzE0LS4zNDY3IDEwLjEwMjExNy0uMzQ2NyA5LjkyMjc5LS4zNDY3QzkuMTkzNTI0LS4zNDY3IDkuMTkzNTI0LS40NDIzNDEgOS4xOTM1MjQtLjU2MTg5M0M5LjE5MzUyNC0uNTczODQ4IDkuMTkzNTI0LS42NTc1MzQgOS4yMTc0MzUtLjc1MzE3NkwxMC44NTUyOTMtNy4yOTI2NTNaJy8+CjxwYXRoIGlkPSdnMC03OCcgZD0nTTguODQ2ODI0LTYuOTEwMDg3QzguOTc4MzMxLTcuNDI0MTU5IDkuMTY5NjE0LTcuNzgyODE0IDEwLjA3ODIwNy03LjgxODY4QzEwLjExNDA3Mi03LjgxODY4IDEwLjI1NzUzNC03LjgzMDYzNSAxMC4yNTc1MzQtOC4wMzM4NzNDMTAuMjU3NTM0LTguMTY1MzggMTAuMTQ5OTM4LTguMTY1MzggMTAuMTAyMTE3LTguMTY1MzhDOS44NjMwMTQtOC4xNjUzOCA5LjI1MzMtOC4xNDE0NjkgOS4wMTQxOTctOC4xNDE0NjlIOC40NDAzNDlDOC4yNzI5NzYtOC4xNDE0NjkgOC4wNTc3ODMtOC4xNjUzOCA3Ljg5MDQxMS04LjE2NTM4QzcuODE4NjgtOC4xNjUzOCA3LjY3NTIxOC04LjE2NTM4IDcuNjc1MjE4LTcuOTM4MjMyQzcuNjc1MjE4LTcuODE4NjggNy43NzA4NTktNy44MTg2OCA3Ljg1NDU0NS03LjgxODY4QzguNTcxODU2LTcuNzk0NzcgOC42MTk2NzYtNy41MTk4MDEgOC42MTk2NzYtNy4zMDQ2MDhDOC42MTk2NzYtNy4xOTcwMTEgOC42MDc3MjEtNy4xNjExNDYgOC41NzE4NTYtNi45OTM3NzNMNy4yMjA5MjItMS42MDE5OTNMNC42NjI1MTYtNy45NjIxNDJDNC41Nzg4MjktOC4xNTM0MjUgNC41NjY4NzQtOC4xNjUzOCA0LjMwMzg2MS04LjE2NTM4SDIuODQ1MzNDMi42MDYyMjctOC4xNjUzOCAyLjQ5ODYzLTguMTY1MzggMi40OTg2My03LjkzODIzMkMyLjQ5ODYzLTcuODE4NjggMi41ODIzMTYtNy44MTg2OCAyLjgwOTQ2NS03LjgxODY4QzIuODY5MjQtNy44MTg2OCAzLjU3NDU5NS03LjgxODY4IDMuNTc0NTk1LTcuNzExMDgzQzMuNTc0NTk1LTcuNjg3MTczIDMuNTUwNjg1LTcuNTkxNTMyIDMuNTM4NzMtNy41NTU2NjZMMS45NDg2OTItMS4yMTk0MjdDMS44MDUyMy0uNjMzNjI0IDEuNTE4MzA2LS4zODI1NjUgLjcyOTI2NS0uMzQ2N0MuNjY5NDg5LS4zNDY3IC41NDk5MzgtLjMzNDc0NSAuNTQ5OTM4LS4xMTk1NTJDLjU0OTkzOCAwIC42Njk0ODkgMCAuNzA1MzU1IDBDLjk0NDQ1OCAwIDEuNTU0MTcyLS4wMjM5MSAxLjc5MzI3NS0uMDIzOTFIMi4zNjcxMjNDMi41MzQ0OTYtLjAyMzkxIDIuNzM3NzMzIDAgMi45MDUxMDYgMEMyLjk4ODc5MiAwIDMuMTIwMjk5IDAgMy4xMjAyOTktLjIyNzE0OEMzLjEyMDI5OS0uMzM0NzQ1IDMuMDAwNzQ3LS4zNDY3IDIuOTUyOTI3LS4zNDY3QzIuNTU4NDA2LS4zNTg2NTUgMi4xNzU4NDEtLjQzMDM4NiAyLjE3NTg0MS0uODYwNzcyQzIuMTc1ODQxLS45NTY0MTMgMi4xOTk3NTEtMS4wNjQwMSAyLjIyMzY2MS0xLjE1OTY1MUwzLjgzNzYwOS03LjU1NTY2NkMzLjkwOTM0LTcuNDM2MTE1IDMuOTA5MzQtNy40MTIyMDQgMy45NTcxNjEtNy4zMDQ2MDhMNi44MDI0OTEtLjIxNTE5M0M2Ljg2MjI2Ny0uMDcxNzMxIDYuODg2MTc3IDAgNi45OTM3NzMgMEM3LjExMzMyNSAwIDcuMTI1MjgtLjAzNTg2NiA3LjE3MzEwMS0uMjM5MTAzTDguODQ2ODI0LTYuOTEwMDg3WicvPgo8cGF0aCBpZD0nZzAtODAnIGQ9J00zLjUzODczLTMuODAxNzQzSDUuNTQ3MTk4QzcuMTk3MDExLTMuODAxNzQzIDguODQ2ODI0LTUuMDIxMTcxIDguODQ2ODI0LTYuMzg0MDZDOC44NDY4MjQtNy4zMTY1NjMgOC4wNTc3ODMtOC4xNjUzOCA2LjU1MTQzMi04LjE2NTM4SDIuODU3Mjg1QzIuNjMwMTM3LTguMTY1MzggMi41MjI1NC04LjE2NTM4IDIuNTIyNTQtNy45MzgyMzJDMi41MjI1NC03LjgxODY4IDIuNjMwMTM3LTcuODE4NjggMi44MDk0NjUtNy44MTg2OEMzLjUzODczLTcuODE4NjggMy41Mzg3My03LjcyMzAzOSAzLjUzODczLTcuNTkxNTMyQzMuNTM4NzMtNy41Njc2MjEgMy41Mzg3My03LjQ5NTg5IDMuNDkwOTA5LTcuMzE2NTYzTDEuODc2OTYxLS44ODQ2ODJDMS43NjkzNjUtLjQ2NjI1MiAxLjc0NTQ1NS0uMzQ2NyAuOTA4NTkzLS4zNDY3Qy42ODE0NDUtLjM0NjcgLjU2MTg5My0uMzQ2NyAuNTYxODkzLS4xMzE1MDdDLjU2MTg5MyAwIC42Njk0ODkgMCAuNzQxMjIgMEMuOTY4MzY5IDAgMS4yMDc0NzItLjAyMzkxIDEuNDM0NjItLjAyMzkxSDIuODMzMzc1QzMuMDYwNTIzLS4wMjM5MSAzLjMxMTU4MiAwIDMuNTM4NzMgMEMzLjYzNDM3MSAwIDMuNzY1ODc4IDAgMy43NjU4NzgtLjIyNzE0OEMzLjc2NTg3OC0uMzQ2NyAzLjY1ODI4MS0uMzQ2NyAzLjQ3ODk1NC0uMzQ2N0MyLjc2MTY0NC0uMzQ2NyAyLjc0OTY4OS0uNDMwMzg2IDIuNzQ5Njg5LS41NDk5MzhDMi43NDk2ODktLjYwOTcxNCAyLjc2MTY0NC0uNjkzNCAyLjc3MzU5OS0uNzUzMTc2TDMuNTM4NzMtMy44MDE3NDNaTTQuMzk5NTAyLTcuMzUyNDI4QzQuNTA3MDk4LTcuNzk0NzcgNC41NTQ5MTktNy44MTg2OCA1LjAyMTE3MS03LjgxODY4SDYuMjA0NzMyQzcuMTAxMzctNy44MTg2OCA3Ljg0MjU5LTcuNTMxNzU2IDcuODQyNTktNi42MzUxMThDNy44NDI1OS02LjMyNDI4NCA3LjY4NzE3My01LjMwODA5NSA3LjEzNzIzNS00Ljc1ODE1N0M2LjkzMzk5OC00LjU0Mjk2NCA2LjM2MDE0OS00LjA4ODY2NyA1LjI3MjIyOS00LjA4ODY2N0gzLjU4NjU1TDQuMzk5NTAyLTcuMzUyNDI4WicvPgo8cGF0aCBpZD0nZzAtODEnIGQ9J001LjA5MjkwMi0uMDcxNzMxQzcuMTQ5MTkxLS44OTY2MzggOC42Nzk0NTItMy4wNzI0NzggOC42Nzk0NTItNS4yMzYzNjRDOC42Nzk0NTItNy4yMDg5NjYgNy4zODgyOTQtOC40MTY0MzggNS43MTQ1Ny04LjQxNjQzOEMzLjE1NjE2NC04LjQxNjQzOCAuNTczODQ4LTUuNjY2NzUgLjU3Mzg0OC0yLjkwNTEwNkMuNTczODQ4LTEuMDI4MTQ0IDEuODE3MTg2IC4yNTEwNTkgMy41NTA2ODUgLjI1MTA1OUMzLjk1NzE2MSAuMjUxMDU5IDQuMzUxNjgxIC4xOTEyODMgNC43MzQyNDcgLjA3MTczMUM0LjY2MjUxNiAuNzg5MDQxIDQuNjYyNTE2IC44NDg4MTcgNC42NjI1MTYgMS4wNzU5NjVDNC42NjI1MTYgMS40MjI2NjUgNC42NjI1MTYgMi4zMTkzMDMgNS42MTg5MjkgMi4zMTkzMDNDNy4wNDE1OTQgMi4zMTkzMDMgNy41Njc2MjEgLjA4MzY4NiA3LjU2NzYyMSAuMDExOTU1UzcuNTE5ODAxLS4xMDc1OTcgNy40NjAwMjUtLjEwNzU5N0M3LjM4ODI5NC0uMTA3NTk3IDcuMzY0Mzg0LS4wNDc4MjEgNy4zMjg1MTggLjA4MzY4NkM3LjA2NTUwNCAuODM2ODYyIDYuNDQzODM2IDEuMjY3MjQ4IDUuOTE3ODA4IDEuMjY3MjQ4QzUuMzA4MDk1IDEuMjY3MjQ4IDUuMTUyNjc3IC44NDg4MTcgNS4wOTI5MDItLjA3MTczMVpNMi45NDA5NzEtLjEzMTUwN0MxLjk5NjUxMy0uNDU0Mjk2IDEuNTQyMjE3LTEuNDQ2NTc1IDEuNTQyMjE3LTIuNTQ2NDUxQzEuNTQyMjE3LTMuMzgzMzEzIDEuODUzMDUxLTQuOTczMzUgMi42NDIwOTItNi4xODA4MjJDMy41MjY3NzUtNy41NDM3MTEgNC43MTAzMzYtOC4xNTM0MjUgNS42NDI4MzktOC4xNTM0MjVDNi44ODYxNzctOC4xNTM0MjUgNy43MjMwMzktNy4xNDkxOTEgNy43MjMwMzktNS41OTUwMTlDNy43MjMwMzktNC43MTAzMzYgNy4zMDQ2MDgtMS43NDU0NTUgNS4wNTcwMzYtLjQzMDM4NkM0Ljk5NzI2LTEuMDQwMSA0LjgyOTg4OC0xLjc1NzQxIDQuMDQwODQ3LTEuNzU3NDFDMy4zOTUyNjgtMS43NTc0MSAyLjg0NTMzLTEuMTExODMxIDIuODQ1MzMtLjUyNjAyN0MyLjg0NTMzLS4zOTQ1MjEgMi44OTMxNTEtLjIxNTE5MyAyLjk0MDk3MS0uMTMxNTA3Wk00Ljc1ODE1Ny0uMjc0OTY5QzQuMzI3NzcxLS4wODM2ODYgMy45NTcxNjEtLjAxMTk1NSAzLjYyMjQxNi0uMDExOTU1QzMuNTAyODY0LS4wMTE5NTUgMy4wODQ0MzMtLjAxMTk1NSAzLjA4NDQzMy0uNTM3OTgzQzMuMDg0NDMzLS45NjgzNjkgMy41MDI4NjQtMS41MTgzMDYgNC4wNDA4NDctMS41MTgzMDZDNC42Mzg2MDUtMS41MTgzMDYgNC43NzAxMTItMS4xMTE4MzEgNC43NzAxMTItLjUxNDA3MkM0Ljc3MDExMi0uNDQyMzQxIDQuNzcwMTEyLS4zNDY3IDQuNzU4MTU3LS4yNzQ5NjlaJy8+CjwvZGVmcz4KPGcgaWQ9J3BhZ2UxJz4KPHBhdGggZD0nTS00OC41ODk4NDItNTIuOTk2MDhIOC4xMDE2JyBzdHJva2U9JyMwMDAnIGZpbGw9J25vbmUnIHN0cm9rZS13aWR0aD0nLjM5ODUnIHN0cm9rZS1taXRlcmxpbWl0PScxMCcvPgo8cGF0aCBkPSdNOC4xMDE2LTUyLjk5NjA4VjMuNjk5MjE5JyBzdHJva2U9JyMwMDAnIGZpbGw9J25vbmUnIHN0cm9rZS13aWR0aD0nLjM5ODUnIHN0cm9rZS1taXRlcmxpbWl0PScxMCcvPgo8cGF0aCBkPSdNOC4xMDE2IDMuNjk5MjE5SC00OC41ODk4NDInIHN0cm9rZT0nIzAwMCcgZmlsbD0nbm9uZScgc3Ryb2tlLXdpZHRoPScuMzk4NScgc3Ryb2tlLW1pdGVybGltaXQ9JzEwJy8+CjxwYXRoIGQ9J00tNDguNTg5ODQyIDMuNjk5MjE5Vi01Mi45OTYwOCcgc3Ryb2tlPScjMDAwJyBmaWxsPSdub25lJyBzdHJva2Utd2lkdGg9Jy4zOTg1JyBzdHJva2UtbWl0ZXJsaW1pdD0nMTAnLz4KPGcgdHJhbnNmb3JtPSdtYXRyaXgoMSAwIDAgMSAtMTYuNjczNyAtNjAuNzkzNTIpJz4KPHVzZSB4PSctNDguNTkxMjA1JyB5PSczLjY5NzQyMycgeGxpbms6aHJlZj0nI2cwLTc3Jy8+CjwvZz4KPGcgdHJhbnNmb3JtPSdtYXRyaXgoMSAwIDAgMSA2MC43OTM2IC02MC43OTM1MiknPgo8dXNlIHg9Jy00OC41OTEyMDUnIHk9JzMuNjk3NDIzJyB4bGluazpocmVmPScjZzAtNzgnLz4KPC9nPgo8ZyB0cmFuc2Zvcm09J21hdHJpeCgxIDAgMCAxIDYwLjc5MzYgMTIuMjY5MzgpJz4KPHVzZSB4PSctNDguNTkxMjA1JyB5PSczLjY5NzQyMycgeGxpbms6aHJlZj0nI2cwLTgwJy8+CjwvZz4KPGcgdHJhbnNmb3JtPSdtYXRyaXgoMSAwIDAgMSAtMTMuMzcxMyAxMi4yNjkzOCknPgo8dXNlIHg9Jy00OC41OTEyMDUnIHk9JzMuNjk3NDIzJyB4bGluazpocmVmPScjZzAtODEnLz4KPC9nPgo8cGF0aCBkPSdNLTIwLjI0NjEtNTUuMjY1NThWLTUwLjcyNjU4JyBzdHJva2U9JyMwMDAnIGZpbGw9J25vbmUnIHN0cm9rZS13aWR0aD0nLjM5ODUnIHN0cm9rZS1taXRlcmxpbWl0PScxMCcvPgo8cGF0aCBkPSdNMTAuMzcxMS0yNC42NDg0OEg1LjgzNTknIHN0cm9rZT0nIzAwMCcgZmlsbD0nbm9uZScgc3Ryb2tlLXdpZHRoPScuMzk4NScgc3Ryb2tlLW1pdGVybGltaXQ9JzEwJy8+CjxwYXRoIGQ9J00tMjAuMjQ2MSA1Ljk2NDg0VjEuNDI5NjknIHN0cm9rZT0nIzAwMCcgZmlsbD0nbm9uZScgc3Ryb2tlLXdpZHRoPScuMzk4NScgc3Ryb2tlLW1pdGVybGltaXQ9JzEwJy8+CjxwYXRoIGQ9J00tNTAuODU5MzctMjQuNjQ4NDhILTQ2LjMyNDIyJyBzdHJva2U9JyMwMDAnIGZpbGw9J25vbmUnIHN0cm9rZS13aWR0aD0nLjM5ODUnIHN0cm9rZS1taXRlcmxpbWl0PScxMCcvPgo8L2c+Cjwvc3ZnPg==\" class=\"mt-4 rounded-lg max-w-full md:max-w-md border shadow-sm mx-auto my-2\" alt=\"Hình ảnh toán học\">","questionImage":null,"mappedType":"multiple-choice","options":["$2$","$3$","$4$","$6$"],"optionsImage":[],"correctAnswerIndex":2},{"type":"true-false","main_question":"Cho biết các mệnh đề sau đây là đúng hay sai:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Hình tam giác đều $ABC$ có ba cạnh bằng nhau và ba góc bằng nhau.","is_correct":true},{"statement":"Để vẽ hình vuông $DEFG$ bằng thước và compa, ta cần vẽ hai đường thẳng song song cách đều nhau một khoảng bằng độ dài cạnh hình vuông.","is_correct":false},{"statement":"Nếu độ dài cạnh của hình tam giác đều $ABC$ là $a$ thì chu vi của nó là $P = 3a$ ","is_correct":true},{"statement":"Mọi hình tứ giác có bốn góc vuông đều là hình vuông.","is_correct":false}]},{"type":"multiple-choice","question":"Trong các phát biểu sau, phát biểu nào là đúng về hình chữ nhật?","questionImage":null,"mappedType":"multiple-choice","options":["Hình chữ nhật có bốn cạnh bằng nhau.","Hình chữ nhật có hai cặp cạnh đối song song và bốn góc vuông.","Hình chữ nhật có các đường chéo vuông góc với nhau.","Hình chữ nhật chỉ có một cặp cạnh đối song song."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Một tứ giác có bốn cạnh bằng nhau và hai đường chéo vuông góc với nhau là hình gì?","questionImage":null,"mappedType":"multiple-choice","options":["Hình thang cân","Hình chữ nhật","Hình thoi","Hình bình hành"],"optionsImage":[],"correctAnswerIndex":2},{"type":"true-false","main_question":"Hãy xác định tính đúng/sai của các phát biểu sau đây về các hình phẳng.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Mỗi hình chữ nhật đều có bốn góc vuông.","is_correct":true},{"statement":"Trong hình thoi, hai đường chéo vuông góc với nhau.","is_correct":true},{"statement":"Một hình bình hành có hai cạnh kề bằng nhau là hình thoi.","is_correct":true},{"statement":"Một tứ giác có hai cặp cạnh đối song song và hai đường chéo bằng nhau thì đó là hình vuông.","is_correct":false}]},{"type":"true-false","main_question":"Cho các phát biểu sau về chu vi và diện tích của hình vuông, hình chữ nhật. Hãy xác định xem phát biểu nào là đúng, phát biểu nào là sai.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Diện tích của hình chữ nhật có chiều dài $a$ và chiều rộng $b$ là $S = a+b$.","is_correct":false},{"statement":"Một hình vuông có cạnh $6$ cm thì chu vi của nó là $36$ cm.","is_correct":false},{"statement":"Một hình chữ nhật có chiều dài $10$ m và diện tích $60$ m$^2$. Chu vi của hình chữ nhật đó là $32$ m.","is_correct":true},{"statement":"Một sân trường hình vuông có chu vi là $120$ m. Để lát toàn bộ sân, người ta cần $900$ viên gạch hình vuông có cạnh $1$ m. Biết rằng diện tích của mỗi viên gạch là $1$ m$^2$ và không có sự hao phí vật liệu.","is_correct":true}]},{"type":"true-false","main_question":"Một mảnh vườn có hai khu vực lát gạch. Khu vực hình bình hành $ABCD$ có độ dài cạnh $AB = 8\\,\\text{m}$, cạnh $AD = 5\\,\\text{m}$ và chiều cao ứng với cạnh $AB$ là $4\\,\\text{m}$. Khu vực hình thoi $MNPQ$ có độ dài cạnh $MN = 6\\,\\text{m}$ và độ dài hai đường chéo $MP = 10\\,\\text{m}$, $NQ = 12\\,\\text{m}$. Hãy cho biết các mệnh đề sau đây là đúng hay sai.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Diện tích hình thoi có thể được tính bằng công thức $S = \\frac{1}{2} d_1 d_2$, với $d_1, d_2$ là độ dài hai đường chéo.","is_correct":true},{"statement":"Chu vi của khu vực hình bình hành $ABCD$ là $28\\,\\text{m}$.","is_correct":false},{"statement":"Diện tích của khu vực hình bình hành $ABCD$ là $32\\,\\text{m}^2$.","is_correct":true},{"statement":"Nếu chi phí lát gạch là $120000\\,\\text{đồng}/\\text{m}^2$, thì tổng chi phí để lát cả hai khu vực là $10800000\\,\\text{đồng}$.","is_correct":false}]},{"type":"true-false","main_question":"Một khu vườn hình chữ nhật $ABCD$ có chiều dài $AB = 20 \\text{ m}$ và chiều rộng $AD = 12 \\text{ m}$. Bên trong khu vườn, người ta thiết kế một bồn hoa hình thoi $MNPQ$ với các đỉnh $M, N, P, Q$ lần lượt là điểm chính giữa của các cạnh $AB, BC, CD, DA$. Phần còn lại của khu vườn được lát cỏ. Hãy xét xem các nhận định sau đây là đúng hay sai.\n","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Chu vi của khu vườn hình chữ nhật $ABCD$ là $64 \\text{ m}$.","is_correct":true},{"statement":"Nếu muốn rào xung quanh khu vườn hình chữ nhật $ABCD$ bằng $2$ lượt dây thép gai, thì cần mua $120 \\text{ m}$ dây thép gai.","is_correct":false},{"statement":"Diện tích của bồn hoa hình thoi $MNPQ$ là $150 \\text{ m}^2$.","is_correct":false},{"statement":"Nếu chi phí lát cỏ là $50000$ đồng mỗi mét vuông và chi phí làm bồn hoa là $100000$ đồng mỗi mét vuông, thì tổng chi phí để hoàn thiện khu vườn (bao gồm cả bồn hoa và phần cỏ) là $18 \\text{ triệu đồng}$.","is_correct":true}]},{"type":"true-false","main_question":"Một khu vườn có hình dạng tổng hợp, được tạo thành từ một hình chữ nhật $ABCD$ và một hình bình hành $BCEF$ (với $BC$ là một cạnh chung), như mô tả sau:\n-   Hình chữ nhật $ABCD$ có chiều dài $AB = 20 \\text{ m}$ và chiều rộng $AD = 12 \\text{ m}$.\n-   Hình bình hành $BCEF$ có cạnh $BC = 12 \\text{ m}$, cạnh $CE = 10 \\text{ m}$ và chiều cao từ $F$ xuống đường thẳng chứa $BC$ là $8 \\text{ m}$.\nGia đình muốn lát gạch toàn bộ khu vực hình chữ nhật $ABCD$ với loại gạch giá $110000 \\text{ đồng/m}^2$. Đồng thời, họ muốn làm hàng rào bao quanh khu vực hình bình hành $BCEF$ (trừ phần tiếp giáp với hình chữ nhật $BC$), chi phí làm hàng rào là $60000 \\text{ đồng/m}$.\nBiết rằng khi lát gạch cần mua thêm $10\\%$ lượng gạch dự phòng do hao hụt.\nDựa vào các thông tin trên, hãy xác định các phát biểu sau là đúng hay sai.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Diện tích khu vực hình chữ nhật $ABCD$ là $240 \\text{ m}^2$.","is_correct":true},{"statement":"Diện tích khu vực hình bình hành $BCEF$ là $96 \\text{ m}^2$.","is_correct":true},{"statement":"Tổng chi phí để lát gạch cho khu vực hình chữ nhật $ABCD$ (đã tính hao hụt) là $26400000 \\text{ đồng}$.","is_correct":false},{"statement":"Tổng chi phí làm hàng rào xung quanh khu vực hình bình hành $BCEF$ (trừ cạnh $BC$) là $1920000 \\text{ đồng}$.","is_correct":true}]},{"type":"short-answer","question":"Một khu vườn có một lối đi được lát gạch, bao gồm một phần hình chữ nhật và một phần hình thang cân. Phần hình chữ nhật có chiều dài $5 \\text{ m}$ và chiều rộng $2 \\text{ m}$. Phần hình thang cân tiếp nối với phần hình chữ nhật, có đáy lớn là chiều rộng của hình chữ nhật ($2 \\text{ m}$), đáy bé là $1 \\text{ m}$ và chiều cao của hình thang là $1.5 \\text{ m}$. Biết chi phí để lát $1 \\text{ m}^2$ gạch là $120000 \\text{ đồng}$. Hỏi tổng số tiền cần dùng để lát gạch cho toàn bộ lối đi là bao nhiêu?","questionImage":null,"mappedType":"short-answer","answer":"1470000"}];
            const quizOptions = {"timeLimit":60,"retriesAllowed":1,"showAnswers":true,"showExplanation":true,"aiAssessment":true,"scoring":{"mc":2,"tf":5.6,"sa":2.4,"essay":0,"tfMethod":"progressive"}};
            const googleScriptUrl = "https://script.google.com/macros/s/AKfycbyd8cfv89pGOrlnunWpzf_lKa2WcNos_s1sGceHq44WsGVHz70ehRQImc3Vhy4NDU87-g/exec";
            const correctExamCode = "FF5QCV";
            const teacherApiKey = "AIzaSyA7hb5Iy8tgr_vJyujLmFMrRyPysFujzFA";
            let studentInfo = {};
            let isSubmitted = false;
            let timerInterval;
            let retriesLeft = quizOptions.retriesAllowed;
            let studentApiKey = "";
            let ai = null;

            let proctoringLog = {
                thoatManHinh: 0,
                saoChep: 0,
                dan: 0,
                suKien: []
            };

            const studentQuizContainer = document.getElementById('student-quiz-container');
            const submitBtn = document.getElementById('submit-quiz-btn');
            const resultContainer = document.getElementById('result-container');
            const postSubmitOptions = document.getElementById('post-submit-options');
            const retryBtn = document.getElementById('retry-quiz-btn');
            const loginModal = document.getElementById('login-modal');
            const studentInfoForm = document.getElementById('student-info-form');
            const timerDisplay = document.getElementById('timer-display');
            const retriesDisplay = document.getElementById('retries-display');
            function shuffleQuiz() {
                // Shuffle options/statements within each question first
                quizData.forEach(item => {
                    // Shuffle multiple-choice options and their corresponding images
                    if (item.mappedType === 'multiple-choice' && item.options && item.options.length > 0) {
                        const correctAnswerText = item.options[item.correctAnswerIndex];
                        let optionsWithImages = item.options.map((opt, index) => ({
                            text: opt,
                            image: (item.optionsImage && item.optionsImage[index]) ? item.optionsImage[index] : null
                        }));
                        // Fisher-Yates shuffle
                        for (let i = optionsWithImages.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [optionsWithImages[i], optionsWithImages[j]] = [optionsWithImages[j], optionsWithImages[i]];
                        }
                        // Update the item with shuffled data
                        item.options = optionsWithImages.map(opt => opt.text);
                        item.optionsImage = optionsWithImages.map(opt => opt.image);
                        item.correctAnswerIndex = item.options.indexOf(correctAnswerText);
                    }
                    // Shuffle true-false statements
                    if (item.mappedType === 'true-false' && item.statements && item.statements.length > 0) {
                         for (let i = item.statements.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [item.statements[i], item.statements[j]] = [item.statements[j], item.statements[i]];
                        }
                    }
                });
                // Then, group questions by type and shuffle within each group
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});
                let shuffledQuizData = [];
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
                partOrder.forEach(partType => {
                    if (grouped[partType]) {
                        const partQuestions = grouped[partType];
                        for (let i = partQuestions.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [partQuestions[i], partQuestions[j]] = [partQuestions[j], partQuestions[i]];
                        }
                        shuffledQuizData = shuffledQuizData.concat(partQuestions);
                    }
                });
               
                quizData = shuffledQuizData;
            }
            // --- Timer Function ---
            function startTimer(duration, display) {
                let timer = duration, minutes, seconds;
                clearInterval(timerInterval); // Clear any existing timer
                if(duration <= 0) {
                     display.textContent = "∞";
                     return;
                }
                timerInterval = setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);
                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;
                    display.textContent = minutes + ":" + seconds;
                    if (--timer < 0) {
                        clearInterval(timerInterval);
                        alert("Hết giờ làm bài!");
                        handleSubmit();
                    }
                }, 1000);
            }
            
            async function showExplanation(index, button) {
                const item = quizData[index];
                const questionCard = document.getElementById(`student-q-${index}`);
                const feedbackDiv = document.getElementById(`q-${index}-feedback`);
                if (!questionCard || !feedbackDiv) return;

                const existingExplanation = feedbackDiv.querySelector('.ai-explanation');
                if (existingExplanation) {
                    existingExplanation.remove();
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Xem giải thích
                    `;
                    return;
                }

                button.disabled = true;
                button.innerHTML = '<div class="loader mr-2"></div> Đang tải...';

                if (item.explanation) {
                    displayExplanation(item.explanation, feedbackDiv, button);
                    return;
                }

                if (!ai) {
                    alert("Tính năng giải thích yêu cầu API Key, nhưng chưa được cấu hình bởi giáo viên.");
                    button.disabled = false;
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Xem giải thích
                    `;
                    return;
                }

                const questionText = item.question || item.main_question;
                let prompt = `Bạn là một trợ lý giáo viên AI, am hiểu sâu sắc Chương trình GDPT 2018. Hãy cung cấp một lời giải chi tiết, từng bước một cho câu hỏi sau đây. Lời giải phải chính xác, dễ hiểu và phù hợp với phương pháp giảng dạy của chương trình học, TUYỆT ĐỐI KHÔNG sử dụng kiến thức của lớp cao hơn để giải thích.\n\n--- CÂU HỎI ---\n${questionText}\n\n`;
                if (item.mappedType === 'multiple-choice') {
                    prompt += `--- CÁC LỰA CHỌN ---\n${item.options.map((opt, i) => `${String.fromCharCode(65 + i)}. ${opt}`).join('\n')}\n\n`;
                    prompt += `--- ĐÁP ÁN ĐÚNG ---\n${String.fromCharCode(65 + item.correctAnswerIndex)}. ${item.options[item.correctAnswerIndex]}`;
                } else if (item.mappedType === 'true-false') {
                    prompt += `--- CÁC MỆNH ĐỀ & ĐÁP ÁN ---\n${item.statements.map(s => ` - ${s.statement} -> ${s.is_correct ? 'Đúng' : 'Sai'}`).join('\n')}`;
                } else {
                    prompt += `--- ĐÁP ÁN / GỢI Ý ---\n${item.answer}`;
                }
                prompt += `\n\n--- YÊU CẦU ---\nGiải thích rõ ràng tại sao đáp án lại đúng, từng bước một. Định dạng tất cả các công thức toán học bằng LaTeX.`;

                try {
                    const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: prompt });
                    const explanationText = response.text.replace(/\n/g, '<br>');
                    item.explanation = explanationText; // Cache it
                    displayExplanation(explanationText, feedbackDiv, button);
                } catch (error) {
                    console.error("Lỗi khi tạo giải thích:", error);
                    feedbackDiv.insertAdjacentHTML('beforeend', '<div class="ai-explanation text-red-600">Lỗi: Không thể tạo giải thích.</div>');
                    button.disabled = false;
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Thử lại
                    `;
                }
            }

            function displayExplanation(explanationText, container, button) {
                container.insertAdjacentHTML('beforeend', `<div class="ai-explanation prose prose-sm">${explanationText}</div>`);
                if (window.MathJax) MathJax.typesetPromise([container]);
                button.disabled = false;
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    Ẩn giải thích
                `;
            }
           
            function renderStudentQuiz() {
                studentQuizContainer.innerHTML = '';
               
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});
                const groupInfo = {
                    'multiple-choice': { title: 'PHẦN I. TRẮC NGHIỆM KHÁCH QUAN', subtitle: 'Chọn đáp án đúng nhất trong các lựa chọn sau.' },
                    'true-false': { title: 'PHẦN II. CÂU HỎI ĐÚNG - SAI', subtitle: 'Xác định tính đúng hoặc sai cho mỗi mệnh đề dưới đây.' },
                    'short-answer': { title: 'PHẦN III. CÂU HỎI TRẢ LỜI NGẮN', subtitle: 'Điền đáp án ngắn gọn vào phần trả lời.' },
                    'essay': { title: 'PHẦN IV. CÂU HỎI TỰ LUẬN', subtitle: 'Trình bày chi tiết bài giải của bạn.' }
                };
               
                let questionCounter = 0;
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
                partOrder.forEach(partType => {
                    const questions = grouped[partType];
                    if (!questions || questions.length === 0) return;
                   
                    let groupHTML = `<div class="group-container space-y-8 mb-12">`;
                    const info = groupInfo[partType];
                    groupHTML += `
                        <div class="group-header pb-3 border-b-2 border-slate-300 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800">${info.title}</h2>
                            ${info.subtitle ? `<p class="text-md text-slate-600 italic mt-1">${info.subtitle}</p>` : ''}
                        </div>
                    `;
                    questions.forEach((item, localIndex) => {
                        const globalIndex = quizData.indexOf(item);
                        questionCounter++;
                        groupHTML += `<div class="question-card" id="student-q-${globalIndex}">`;
                        let questionText = (item.question || item.main_question || '').replace(/\n/g, '<br>');
                       
                        groupHTML += `<div class="flex items-start">
                                     <div class="flex-grow">
                                         <div class="flex items-center mb-2">
                                             <span class="font-bold text-lg mr-3 text-indigo-600">Câu ${questionCounter}:</span>
                                             <div id="q-${globalIndex}-feedback-icon"></div>
                                         </div>
                                         <div class="question-content mt-2 text-lg text-slate-700">${questionText}</div>
                                         ${item.questionImage ? `<img src="${item.questionImage}" class="mt-4 rounded-lg max-w-full md:max-w-md border shadow-sm">` : ''}
                                     </div>
                                 </div>`;
                       
                        groupHTML += `<div class="mt-6">`;
                        switch(item.mappedType) {
                            case 'multiple-choice':
                                groupHTML += `<div class="options-grid grid grid-cols-1 md:grid-cols-2 gap-4">`;
                                item.options.forEach((opt, i) => {
                                    groupHTML += `<label for="q${globalIndex}-opt${i}" id="q${globalIndex}-opt-label${i}" class="option-label flex items-start p-4 border-2 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-400">
                                                     <input type="radio" name="q${globalIndex}" id="q${globalIndex}-opt${i}" value="${i}" class="flex-shrink-0 mt-1 h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                                     <div class="ml-3 flex-grow">
                                                         <span class="font-semibold text-slate-800">${String.fromCharCode(65 + i)}.</span>
                                                         <span class="option-content text-slate-700">${opt || ''}</span>
                                                         ${(item.optionsImage && item.optionsImage[i]) ? `<img src="${item.optionsImage[i]}" class="mt-2 rounded-lg max-w-xs border shadow-sm">` : ''}
                                                     </div>
                                                 </label>`;
                                });
                                groupHTML += `</div>`;
                                break;
                            case 'true-false':
                                 groupHTML += `<div class="space-y-4">`;
                                 item.statements.forEach((s, i) => {
                                     groupHTML += `<div class="statement-item border-t pt-4">
                                                  <p class="mb-3 text-slate-700">${String.fromCharCode(97 + i)}) ${s.statement || ''}</p>
                                                  <div class="flex gap-x-6">
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="true" class="mr-2 h-4 w-4"> Đúng</label>
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="false" class="mr-2 h-4 w-4"> Sai</label>
                                                  </div>
                                              </div>`;
                                 });
                                 groupHTML += `</div>`;
                                 break;
                            case 'short-answer':
                                groupHTML += `<input type="text" name="q${globalIndex}" class="mt-1 block w-full md:w-1/2 border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Nhập đáp án của bạn...">`;
                                break;
                            case 'essay':
                                groupHTML += `<textarea name="q${globalIndex}" class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" rows="5" placeholder="Nhập câu trả lời tự luận của bạn..."></textarea>`;
                                break;
                        }
                        groupHTML += `</div><div id="q-${globalIndex}-feedback" class="mt-4"></div></div>`;
                    });
                    groupHTML += `</div>`;
                    studentQuizContainer.innerHTML += groupHTML;
                });
               
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    MathJax.typesetPromise([studentQuizContainer]);
                }
            }
           
            async function generatePerformanceReview(allAnswersData) {
                const feedbackContainer = document.getElementById('ai-feedback-container');
                if (!feedbackContainer || !ai) return null;
                feedbackContainer.classList.remove('hidden');
                feedbackContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">📝 Phân Tích & Gợi Ý Từ Trợ Lý AI</h3>
                        <div id="ai-feedback-loader" class="text-center py-6">
                            <svg class="animate-spin mx-auto h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p class="mt-3 text-slate-600">AI đang phân tích bài làm của bạn...</p>
                        </div>
                        <div id="ai-feedback-summary" class="hidden prose prose-sm max-w-none"></div>
                        <div id="ai-feedback-details" class="hidden mt-4 space-y-2"></div>
                    </div>
                `;
               
                const loader = document.getElementById('ai-feedback-loader');
                const summaryDiv = document.getElementById('ai-feedback-summary');
                const detailsDiv = document.getElementById('ai-feedback-details');
                const incorrectAnswers = allAnswersData.filter(a => !a.isCorrect);
                if (incorrectAnswers.length === 0) {
                    feedbackContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                            <h3 class="text-xl font-bold text-green-600">🎉 Chúc mừng!</h3>
                            <p class="mt-2 text-slate-700">Bạn đã trả lời đúng tất cả các câu hỏi. Làm tốt lắm!</p>
                        </div>
                    `;
                    return { overallFeedback: { summary: "Xuất sắc! Học sinh đã đã trả lời đúng tất cả các câu hỏi." } };
                }
                const summaryPrompt = `Bạn là một trợ lý giáo viên, nói tiếng Việt. Dựa vào tóm tắt các câu trả lời sai của học sinh, hãy đưa ra một nhận xét tổng quan ngắn gọn (khoảng 3-4 câu) về năng lực của học sinh, bao gồm điểm mạnh (suy luận từ các câu làm đúng), điểm yếu (dựa trên các câu sai) và một vài gợi ý ôn tập chung. Lời văn phải khích lệ, rõ ràng.
                Tóm tắt lỗi sai:
                ${JSON.stringify(incorrectAnswers.map(a => ({ cau: a.questionNumber, loai: a.type, cauHoi: a.question.substring(0, 50) + '...' })), null, 2)}`;
                try {
                    const summaryResponse = await ai.models.generateContent({
                        model: "gemini-2.5-flash",
                        contents: summaryPrompt
                    });
                    summaryDiv.innerHTML = summaryResponse.text.replace(/\n/g, '<br>');
                    loader.classList.add('hidden');
                    summaryDiv.classList.remove('hidden');
                    detailsDiv.classList.remove('hidden'); 
                } catch (e) {
                    console.error("Lỗi khi lấy nhận xét tổng quan:", e);
                    summaryDiv.innerHTML = '<p class="text-red-600">Lỗi khi tạo nhận xét tổng quan.</p>';
                    loader.classList.add('hidden');
                    summaryDiv.classList.remove('hidden');
                }
               
                const summaryForSheet = summaryDiv.innerText.substring(0, 200) + "...";
                return { overallFeedback: { summary: summaryForSheet } };
            }
            async function handleSubmit() {
                if (isSubmitted) return;
                isSubmitted = true;
                clearInterval(timerInterval);
                
                document.querySelectorAll('input, textarea').forEach(input => input.disabled = true);
                submitBtn.classList.add('hidden');
                postSubmitOptions.classList.remove('hidden');
                if (retriesLeft > 0) {
                    retryBtn.classList.remove('hidden');
                } else {
                    retryBtn.classList.add('hidden');
                }

                const proctoringDataString = JSON.stringify(proctoringLog);

                let totalStudentScore = 0;
                let totalCorrectAnswers = 0;
                let allAnswersData = [];
                const questionCounts = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    acc[type] = (acc[type] || 0) + 1;
                    return acc;
                }, {});
                
                quizData.forEach((item, index) => {
                    let questionNumber = index + 1;
                    let answerData = { questionNumber, type: item.type };
                    switch (item.mappedType) {
                        case 'multiple-choice':
                            const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                            const isCorrectMC = selectedOption ? parseInt(selectedOption.value) === item.correctAnswerIndex : false;
                            if (isCorrectMC) {
                                totalCorrectAnswers++;
                                if (questionCounts['multiple-choice'] > 0) {
                                   totalStudentScore += quizOptions.scoring.mc / questionCounts['multiple-choice'];
                                }
                            }
                            answerData.question = item.question;
                            answerData.options = item.options;
                            answerData.yourAnswer = selectedOption ? String.fromCharCode(65 + parseInt(selectedOption.value)) : "Không trả lời";
                            answerData.correctAnswer = String.fromCharCode(65 + item.correctAnswerIndex);
                            answerData.isCorrect = isCorrectMC;
                            break;
                        case 'true-false':
                            let correctStatementsCount = 0;
                            let yourAnswerPattern = [];
                            let correctAnswerPattern = [];
                            let details = [];
                            item.statements.forEach((s, i) => {
                                const selectedTF = document.querySelector(`input[name="q${index}-s${i}"]:checked`);
                                const studentChoice = selectedTF ? selectedTF.value === 'true' : null;
                                const isStatementCorrect = studentChoice === s.is_correct;
                               
                                if (isStatementCorrect) correctStatementsCount++;
                               
                                yourAnswerPattern.push(studentChoice === null ? '?' : (studentChoice ? 'Đ' : 'S'));
                                correctAnswerPattern.push(s.is_correct ? 'Đ' : 'S');
                                details.push({ statement: s.statement, yourChoice: studentChoice === null ? 'Không trả lời' : (studentChoice ? 'Đúng' : 'Sai'), correctChoice: s.is_correct ? 'Đúng' : 'Sai', isCorrect: isStatementCorrect });
                            });
                            
                            let scorePerTfQuestion = 0;
                            if (questionCounts['true-false'] > 0) {
                                scorePerTfQuestion = quizOptions.scoring.tf / questionCounts['true-false'];
                            }
                            let questionPoints = 0;
                            if (quizOptions.scoring.tfMethod === 'progressive') {
                                const progressivePoints = { 0: 0, 1: 0.1, 2: 0.25, 3: 0.5, 4: 1.0 };
                                questionPoints = progressivePoints[correctStatementsCount] * scorePerTfQuestion;
                            } else { // even
                                questionPoints = (correctStatementsCount / 4) * scorePerTfQuestion;
                            }
                            totalStudentScore += questionPoints;

                            if(correctStatementsCount === 4) totalCorrectAnswers++;
                            answerData.question = item.main_question;
                            answerData.yourAnswer = yourAnswerPattern.join('-');
                            answerData.correctAnswer = correctAnswerPattern.join('-');
                            answerData.isCorrect = correctStatementsCount === 4;
                            answerData.details = details;
                            break;
                       
                        case 'short-answer':
                            const saInput = document.querySelector(`input[name="q${index}"]`);
                            const studentAnswerRaw = saInput ? (saInput.value ?? '').trim() : "";
                            const correctAnswerRaw = (item.answer ?? '').toString().trim().replace(/\$/g, '');
                            let isCorrectSA = false;
                            const studentAnswerNormalized = studentAnswerRaw.replace(',', '.');
                            const correctAnswerNormalized = correctAnswerRaw.replace(',', '.');
                            if (studentAnswerNormalized.toLowerCase() === correctAnswerNormalized.toLowerCase()) {
                                isCorrectSA = true;
                            }
                             if (isCorrectSA) {
                                totalCorrectAnswers++;
                                if (questionCounts['short-answer'] > 0) {
                                   totalStudentScore += quizOptions.scoring.sa / questionCounts['short-answer'];
                                }
                            }
                            answerData.question = item.question;
                            answerData.yourAnswer = studentAnswerRaw || "Không trả lời";
                            answerData.correctAnswer = correctAnswerRaw;
                            answerData.isCorrect = isCorrectSA;
                            break;
                           
                        case 'essay':
                             const essayInput = document.querySelector(`textarea[name="q${index}"]`);
                             answerData.question = item.question;
                             answerData.yourAnswer = essayInput.value || "Không trả lời";
                             answerData.correctAnswer = item.answer;
                             answerData.isCorrect = null; // Needs manual grading
                             break;
                    }
                    allAnswersData.push(answerData);
                });
                
                const finalScore = totalStudentScore;
                
                let competencyAssessment = "Giáo viên không yêu cầu AI phân tích bài làm.";
                if (quizOptions.aiAssessment) {
                    const feedbackData = await generatePerformanceReview(allAnswersData);
                    if (feedbackData && feedbackData.overallFeedback && feedbackData.overallFeedback.summary) {
                        competencyAssessment = feedbackData.overallFeedback.summary;
                    } else {
                        competencyAssessment = "Có lỗi xảy ra trong quá trình AI phân tích bài làm.";
                    }
                }
                
                if (quizOptions.showAnswers) {
                    const totalQuestions = quizData.length;
                    resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg text-center">
                        <h3 class="text-2xl font-bold text-slate-800">KẾT QUẢ BÀI LÀM</h3>
                        <p class="mt-4 text-lg">Số câu đúng hoàn toàn: <span class="font-bold text-green-600">${totalCorrectAnswers}/${totalQuestions}</span></p>
                        <p class="text-2xl mt-2">Điểm (thang 10): <span class="font-bold text-blue-600">${finalScore.toFixed(2)}</span></p>
                        ${questionCounts['essay'] > 0 ? `<p class="text-sm text-gray-600 italic mt-1">Lưu ý: Điểm trên chưa bao gồm ${quizOptions.scoring.essay} điểm của phần Tự luận.</p>` : ''}
                    </div>`;
                    resultContainer.classList.remove('hidden');

                    allAnswersData.forEach((ans, index) => {
                        const questionCard = document.getElementById(`student-q-${index}`);
                        const feedbackIconDiv = document.getElementById(`q-${index}-feedback-icon`);
                        const feedbackDiv = document.getElementById(`q-${index}-feedback`);
                        if (!questionCard || !feedbackIconDiv || !feedbackDiv) return;

                        const iconHTML = ans.isCorrect === true
                            ? '<svg class="feedback-icon text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>'
                            : (ans.isCorrect === false ? '<svg class="feedback-icon text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>' : '');
                        feedbackIconDiv.innerHTML = iconHTML;

                        if (ans.type.includes('multiple-choice')) {
                            const studentChoice = ans.yourAnswer === "Không trả lời" ? -1 : ans.yourAnswer.charCodeAt(0) - 65;
                            const correctChoice = ans.correctAnswer.charCodeAt(0) - 65;
                            document.getElementById(`q-${index}-opt-label${correctChoice}`)?.classList.add('correct');
                            if (studentChoice !== -1 && studentChoice !== correctChoice) {
                                document.getElementById(`q-${index}-opt-label${studentChoice}`)?.classList.add('incorrect');
                            }
                        } else if (ans.type === 'true-false') {
                            const statementItems = questionCard.querySelectorAll('.statement-item');
                            ans.details.forEach((detail, i) => { if(statementItems[i]) { statementItems[i].classList.add(detail.isCorrect ? 'correct' : 'incorrect'); }});
                        }

                        if (quizOptions.showExplanation) {
                            feedbackDiv.innerHTML = `<button data-explain-index="${index}" class="explain-btn mt-4 flex items-center px-4 py-2 bg-blue-100 text-blue-800 text-sm font-semibold rounded-lg hover:bg-blue-200 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                Xem giải thích
                            </button>`;
                        }
                    });
                    
                    document.querySelectorAll('.explain-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const button = e.currentTarget;
                            const index = parseInt(button.dataset.explainIndex, 10);
                            showExplanation(index, button);
                        });
                    });

                    if (window.MathJax) await window.MathJax.typesetPromise([studentQuizContainer]);
                } else {
                     resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg text-center"><h3 class="text-xl font-bold text-green-600">Nộp bài thành công!</h3><p class="mt-2 text-slate-700">Bạn đã hoàn thành bài làm. Kết quả sẽ được giáo viên công bố sau.</p></div>`;
                    resultContainer.classList.remove('hidden');
                }
                
                const formData = new FormData();
                formData.append('name', studentInfo.name);
                formData.append('class', studentInfo.class);
                formData.append('score', `${finalScore.toFixed(2)}/10`);
                formData.append('assessment', competencyAssessment);
                formData.append('timestamp', new Date().toLocaleString('vi-VN'));
                formData.append('examCode', correctExamCode);
                formData.append('monitoringLog', proctoringDataString);
                formData.append('answerDetails', JSON.stringify(allAnswersData));
               
                fetch(googleScriptUrl, { method: 'POST', body: formData})
                    .then(res => console.log("Successfully submitted to Google Sheet"))
                    .catch(err => console.error("Error submitting to Google Sheet:", err));
            }
           
            function startNewAttempt() {
                isSubmitted = false;
                proctoringLog = { thoatManHinh: 0, saoChep: 0, dan: 0, suKien: [] };
                const proctoringWidget = document.getElementById('proctoring-widget');
                if (proctoringWidget) {
                    proctoringWidget.classList.add('hidden');
                    document.getElementById('tab-switch-count').textContent = '0';
                    document.getElementById('copy-count').textContent = '0';
                    document.getElementById('paste-count').textContent = '0';
                }

                renderStudentQuiz();
                resultContainer.classList.add('hidden');
                document.getElementById('ai-feedback-container').classList.add('hidden');
                postSubmitOptions.classList.add('hidden');
                submitBtn.classList.remove('hidden');
                 if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                }
                retriesLeft--;
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                window.scrollTo(0, 0);
            }
            studentInfoForm.addEventListener('submit', (e) => {
                e.preventDefault();
               
                const enteredCode = document.getElementById('exam-code').value.trim().toUpperCase();
                if (enteredCode !== correctExamCode) {
                    alert('Mã đề không chính xác. Vui lòng kiểm tra lại!');
                    return;
                }
               
                studentApiKey = teacherApiKey;
                if (!studentApiKey) {
                    console.warn('Cảnh báo: Giáo viên chưa cấu hình API Key. Các tính năng AI sẽ không hoạt động.');
                }
       
                try {
                    if (studentApiKey) {
                       ai = new GoogleGenAI({ apiKey: studentApiKey });
                    }
                } catch(e) {
                    console.error("Lỗi khởi tạo Gemini API với key của giáo viên.", e);
                    alert("Cảnh báo: API Key của giáo viên không hợp lệ. Vui lòng báo cho giáo viên. Các tính năng AI sẽ không hoạt động.");
                    ai = null;
                }
                shuffleQuiz();
               
                studentInfo.name = document.getElementById('student-name').value;
                studentInfo.class = document.getElementById('student-class').value;
                loginModal.classList.add('hidden');
                studentQuizContainer.classList.remove('hidden');
                submitBtn.classList.remove('hidden');
               
                if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                } else {
                    timerDisplay.textContent = "Không giới hạn";
                }
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                renderStudentQuiz();

                const proctoringWidget = document.getElementById('proctoring-widget');
                const tabSwitchCountEl = document.getElementById('tab-switch-count');
                const copyCountEl = document.getElementById('copy-count');
                const pasteCountEl = document.getElementById('paste-count');

                function updateProctoringUI() {
                    if (proctoringLog.thoatManHinh > 0 || proctoringLog.saoChep > 0 || proctoringLog.dan > 0) {
                        proctoringWidget.classList.remove('hidden');
                    }
                    tabSwitchCountEl.textContent = proctoringLog.thoatManHinh;
                    copyCountEl.textContent = proctoringLog.saoChep;
                    pasteCountEl.textContent = proctoringLog.dan;
                }

                // Disable Right Click
                document.addEventListener('contextmenu', e => e.preventDefault());

                // Track Tab Switching
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && !isSubmitted) {
                        proctoringLog.thoatManHinh++;
                        proctoringLog.suKien.push({ loai: 'chuyen_tab', thoiGian: new Date().toISOString() });
                        updateProctoringUI();
                    }
                });

                // Track Copying
                document.addEventListener('copy', () => {
                    if (isSubmitted) return;
                    proctoringLog.saoChep++;
                    proctoringLog.suKien.push({ loai: 'sao_chep', thoiGian: new Date().toISOString() });
                    updateProctoringUI();
                });

                // Track Pasting
                document.addEventListener('paste', () => {
                    if (isSubmitted) return;
                    proctoringLog.dan++;
                    proctoringLog.suKien.push({ loai: 'dan', thoiGian: new Date().toISOString() });
                    updateProctoringUI();
                });
            });
            
            submitBtn.addEventListener('click', handleSubmit);
            retryBtn.addEventListener('click', () => {
                shuffleQuiz();
                startNewAttempt();
            });
        </script>
    </body>
    </html>
    