
    <!DOCTYPE html>
    <html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>BÀI KIỂM TRA CHỦ ĐỀ 2 : MẠNG MÁY TÍNH</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
        <script>
            window.MathJax = {
                tex: {
                    packages: {'[+]': ['ams']},
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']]
                },
                chtml: {
                    fontCache: 'global',
                    linebreaks: {
                        automatic: true
                    }
                }
            };
        </script>
        <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
        </script>
        <style>
            body { font-family: 'Be Vietnam Pro', sans-serif; background-color: #f0f4f8; }
            .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
            .question-card {
                background-color: white;
                border-radius: 1rem;
                padding: 1.5rem 2rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
                border-left: 5px solid transparent;
                transition: all 0.3s ease;
            }
            .ai-explanation {
                background-color: #f0f9ff;
                color: #0c4a6e;
                padding: 1rem;
                border-radius: 0.75rem;
                font-size: 0.9rem;
                margin-top: 1rem;
                border-left: 4px solid #38bdf8;
            }
            .feedback-icon { width: 1.5rem; height: 1.5rem; }
            .option-label {
                transition: all 0.2s ease-in-out;
                border: 2px solid #e5e7eb;
            }
            .option-label:hover {
                border-color: #6366f1;
                background-color: #eef2ff;
            }
            .option-label.correct {
                border-color: #10b981 !important;
                background-color: #ecfdf5 !important;
                color: #065f46;
            }
            .option-label.incorrect {
                border-color: #ef4444 !important;
                background-color: #fef2f2 !important;
                color: #991b1b;
            }
            .statement-item.correct { background-color: #ecfdf5; border-color: #10b981; }
            .statement-item.incorrect { background-color: #fef2f2; border-color: #ef4444; }
            .prose { max-width: 100%; }
            .prose h1, .prose h2, .prose h3 { font-weight: 600; }
            .prose p { margin-top: 0.5em; margin-bottom: 0.5em; }
            .prose ul, .prose ol { margin-top: 1em; margin-bottom: 1em; padding-left: 1.5em; }
            .prose li > p { margin-top: 0; margin-bottom: 0; }
            .prose code { background-color: #e5e7eb; padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 3px; }
            .prose pre { background-color: #e5e7eb; padding: 1em; border-radius: 0.5em; overflow-x: auto; }
            .prose pre code { background-color: transparent; padding: 0; }
            details[open] > summary .details-arrow {
                transform: rotate(180deg);
            }
        </style>
    </head>
    <body class="bg-slate-100 text-slate-800">
        <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md transform transition-all" style="animation: fadeIn 0.3s ease-out;">
                <h2 class="text-2xl font-bold mb-2 text-center text-slate-800">Thông Tin Học Sinh</h2>
                <p class="text-center text-slate-500 mb-6">Vui lòng nhập để bắt đầu làm bài.</p>
                <form id="student-info-form">
                    <div class="mb-4">
                        <label for="student-name" class="block text-sm font-medium text-slate-700 mb-1">Họ và tên</label>
                        <input type="text" id="student-name" required class="mt-1 block w-full block border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="student-class" class="block text-sm font-medium text-slate-700 mb-1">Lớp</label>
                        <input type="text" id="student-class" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="exam-code" class="block text-sm font-medium text-slate-700 mb-1">Mã đề</label>
                        <input type="text" id="exam-code" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Nhập mã đề giáo viên cung cấp">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Giáo viên:</label>
                        <p class="mt-1 text-slate-800 bg-slate-100 p-2.5 rounded-lg">LÊ VĂN ĐÔNG</p>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">Bắt đầu làm bài</button>
                </form>
            </div>
        </div>
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="mb-10 p-8 rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 class="text-4xl font-bold">BÀI KIỂM TRA CHỦ ĐỀ 2 : MẠNG MÁY TÍNH</h1>
                        <p class="text-lg text-blue-100 mt-2">Hãy hoàn thành các câu hỏi dưới đây một cách tốt nhất!</p>
                        <p class="text-sm text-blue-200 mt-4">Tác giả: LÊ VĂN ĐÔNG</p>
                    </div>
                    <div id="timer-container" class="text-right">
                         <div id="timer-display" class="text-3xl font-bold tracking-wider bg-white/20 px-4 py-2 rounded-lg">--:--</div>
                         <div id="retries-display" class="text-sm mt-1 text-blue-200"></div>
                    </div>
                </div>
            </header>
            <main id="student-quiz-container" class="space-y-8 hidden">
                <!-- Questions will be rendered here by JS -->
            </main>
            <footer class="mt-10 text-center">
                <button id="submit-quiz-btn" class="bg-indigo-600 text-white py-3 px-12 rounded-full font-bold text-lg hover:bg-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl hidden transform hover:scale-105">Nộp Bài</button>
                <div id="result-container" class="mt-6 hidden"></div>
                <div id="ai-feedback-container" class="mt-8 text-left hidden"></div>
                <div id="post-submit-options" class="hidden mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="retry-quiz-btn" class="w-full sm:w-auto bg-slate-600 text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-slate-700 transition-transform transform hover:scale-105">Làm Lại Đề Này</button>
                </div>
            </footer>
        </div>

        <div id="proctoring-widget" class="fixed bottom-4 right-4 bg-yellow-100 text-yellow-800 p-3 rounded-lg shadow-lg text-sm z-50 hidden border border-yellow-300" style="max-width: 200px;">
            <h4 class="font-bold mb-2 border-b border-yellow-300 pb-1 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 3.001-1.742 3.001H4.42c-1.53 0-2.493-1.667-1.743-3.001l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                Giám sát
            </h4>
            <p>Thoát màn hình: <span id="tab-switch-count" class="font-bold">0</span></p>
            <p>Sao chép: <span id="copy-count" class="font-bold">0</span></p>
            <p>Dán: <span id="paste-count" class="font-bold">0</span></p>
        </div>

        <script type="module">
            import { GoogleGenAI, Type } from "https://esm.sh/@google/genai@^1.13.0";
            let quizData = [{"type":"multiple-choice","question":"Trong một văn phòng nhỏ, để cải thiện hiệu suất mạng và giảm tắc nghẽn dữ liệu khi nhiều máy tính cùng truy cập, người quản trị mạng quyết định thay thế thiết bị kết nối hiện tại. Nếu hiện tại văn phòng đang sử dụng Hub, thiết bị nào sau đây là lựa chọn phù hợp nhất để thay thế và giải thích lý do?","questionImage":null,"mappedType":"multiple-choice","options":["Router, vì Router có khả năng định tuyến các gói dữ liệu.","Modem, vì Modem chuyển đổi tín hiệu số thành tương tự.","Switch, vì Switch sử dụng bảng địa chỉ $MAC$ để gửi dữ liệu trực tiếp đến thiết bị đích, giảm xung đột và tăng hiệu suất.","Wireless Access Point (WAP), vì WAP cho phép kết nối không dây tiện lợi."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Gia đình bạn vừa lắp đặt Internet. Có nhiều thiết bị như máy tính, điện thoại thông minh, $TV$ cần truy cập Internet và cũng cần kết nối với nhau để chia sẻ dữ liệu. Thiết bị nào trong số các thiết bị mạng thông dụng sẽ đảm nhiệm vai trò kết nối các thiết bị trong nhà với nhau và đồng thời kết nối chúng ra mạng Internet, dựa trên việc quản lý địa chỉ $IP$ và bảng định tuyến?","questionImage":null,"mappedType":"multiple-choice","options":["Hub, vì Hub kết nối các thiết bị trong mạng $LAN$.","Switch, vì Switch kết nối các thiết bị trong mạng $LAN$ hiệu quả hơn Hub.","Router $Wi-Fi$, vì nó tích hợp chức năng của Router, Switch và WAP, có khả năng định tuyến gói dữ liệu giữa các mạng và quản lý kết nối $IP$.","Modem, vì Modem chuyển đổi tín hiệu từ $ISP$."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Khi bạn truy cập Internet tại nhà, thông thường sẽ có hai thiết bị chính hoạt động cùng nhau. Thiết bị thứ nhất nhận tín hiệu từ nhà cung cấp dịch vụ Internet ($ISP$) và chuyển đổi chúng sang định dạng mà mạng nội bộ của bạn có thể sử dụng. Thiết bị thứ hai sau đó sẽ nhận tín hiệu đã chuyển đổi này và phân phối Internet cho tất cả các máy tính và thiết bị di động trong nhà bạn. Hai thiết bị đó lần lượt là gì và chức năng chính của chúng là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Router và Hub: Router kết nối $LAN$ với Internet; Hub phân phối dữ liệu cho các thiết bị.","Modem và Router: Modem chuyển đổi tín hiệu $ISP$; Router phân phối $IP$ và định tuyến dữ liệu nội bộ.","WAP và Switch: WAP tạo mạng không dây; Switch kết nối các thiết bị có dây.","Hub và Modem: Hub phân phối dữ liệu; Modem kết nối $LAN$ với Internet."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Trong môi trường phòng thực hành Tin học của trường học, mặc dù kết nối không dây ($Wi-Fi$) rất tiện lợi, các máy tính để bàn thường được ưu tiên kết nối bằng cáp mạng ($UTP$) thông qua cổng $RJ45$. Lý do chính cho sự lựa chọn này là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Kết nối không dây có tính bảo mật cao hơn.","Kết nối có dây dễ cài đặt hơn và ít tốn kém hơn.","Kết nối có dây cung cấp độ ổn định, độ tin cậy và hiệu suất cao hơn, phù hợp với môi trường yêu cầu truyền tải dữ liệu lớn và không gián đoạn.","Máy tính để bàn không hỗ trợ kết nối không dây."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Trên các xe khách đường dài, hành khách có thể truy cập Internet thông qua $Wi-Fi$. Để cung cấp dịch vụ này, xe khách cần lắp đặt một hệ thống mạng. Hệ thống này bao gồm những thiết bị chính nào để vừa kết nối các thiết bị của hành khách trong xe, vừa truy cập được Internet thông qua mạng di động?","questionImage":null,"mappedType":"multiple-choice","options":["Chỉ cần một Router $Wi-Fi$ để phát sóng.","Chỉ cần một Modem $GSM$ để kết nối mạng di động.","Một Router $Wi-Fi$ để kết nối các thiết bị của khách và một Modem $GSM$ (có gắn $SIM$) để kết nối đến mạng di động.","Một Hub và một Modem $ADSL$."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Một phòng thiết kế đồ họa có 10 máy tính cần truyền tải các file dung lượng lớn giữa các máy và truy cập tài nguyên chung. Ban đầu, họ sử dụng Hub để kết nối các máy tính. Sau một thời gian, hiệu suất mạng giảm sút nghiêm trọng và có lo ngại về việc rò rỉ dữ liệu giữa các máy không liên quan. Để giải quyết vấn đề này, phòng ban quyết định nâng cấp lên Switch. Giải thích nào sau đây về lý do nâng cấp là chính xác nhất ở mức độ \"vận dụng cao\"?","questionImage":null,"mappedType":"multiple-choice","options":["Switch hoạt động ở tầng vật lý, giảm xung đột và cải thiện bảo mật bằng cách gửi dữ liệu đến tất cả các cổng.","Switch sử dụng bảng địa chỉ MAC để gửi dữ liệu chỉ đến thiết bị đích, từ đó tăng hiệu suất và bảo mật so với Hub.","Hub rẻ hơn nhưng kém hiệu quả hơn Switch vì nó không có khả năng định tuyến gói tin dựa trên địa chỉ IP.","Switch có khả năng nhận IP công cộng từ ISP, giúp các máy tính trong mạng dễ dàng truy cập Internet hơn."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Một trường học có hai phòng máy tính độc lập (LAN1 và LAN2), mỗi phòng có dải địa chỉ IP riêng biệt. Trường muốn các máy tính từ LAN1 có thể truy cập tài nguyên trên LAN2 và ngược lại, đồng thời cả hai phòng đều có thể kết nối Internet thông qua cùng một đường truyền. Thiết bị mạng nào sẽ đóng vai trò trung tâm để thực hiện việc này một cách hiệu quả và an toàn, và nguyên lý hoạt động chính của nó là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Hub, vì nó có thể kết nối nhiều thiết bị trong cùng mạng LAN và phát sóng dữ liệu đến tất cả các cổng.","Switch, vì nó quản lý địa chỉ MAC để chuyển tiếp dữ liệu đến thiết bị đích, cải thiện hiệu suất trong nội bộ từng LAN.","Router, vì nó phân tích địa chỉ IP của gói dữ liệu và sử dụng bảng định tuyến để chuyển tiếp giữa các mạng khác nhau.","Modem, vì nó chịu trách nhiệm chuyển đổi tín hiệu số sang tương tự và ngược lại để truy cập Internet."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Anh H lắp đặt một thiết bị \"modem Wi-Fi\" tích hợp cho gia đình. Sau khi kết nối, anh H có thể truy cập Internet bằng máy tính để bàn cắm dây trực tiếp vào cổng LAN của thiết bị, nhưng các thiết bị di động không thể kết nối Wi-Fi. Khi kiểm tra trạng thái thiết bị, đèn báo sóng Wi-Fi không sáng. Dựa trên kiến thức về chức năng của Modem và Router, vấn đề này có khả năng cao là do đâu?","questionImage":null,"mappedType":"multiple-choice","options":["Modem gặp sự cố trong việc chuyển đổi tín hiệu từ ISP, làm cho toàn bộ kết nối Internet bị gián đoạn.","Chức năng Modem của thiết bị hoạt động bình thường, nhưng chức năng Router Wi-Fi gặp trục trặc, có thể do cấu hình hoặc lỗi phần cứng của bộ phát sóng.","Thiết bị đang hoạt động như một Hub, chỉ cho phép kết nối có dây và không hỗ trợ kết nối không dây.","Địa chỉ MAC của các thiết bị di động không được thiết bị chấp nhận, ngăn chặn kết nối Wi-Fi."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Một ngôi nhà ba tầng có một Router Wi-Fi đặt ở tầng trệt. Các thiết bị ở tầng hai và tầng ba thường xuyên gặp tình trạng tín hiệu Wi-Fi yếu hoặc mất kết nối. Để giải quyết vấn đề này mà không cần thay đổi Router chính, chủ nhà quyết định lắp đặt thêm một hoặc nhiều thiết bị mạng. Thiết bị nào sau đây là lựa chọn phù hợp nhất để mở rộng vùng phủ sóng Wi-Fi và cách thức hoạt động của nó trong trường hợp này?","questionImage":null,"mappedType":"multiple-choice","options":["Lắp đặt thêm một Hub ở tầng hai để tăng cường tín hiệu mạng có dây và gián tiếp cải thiện Wi-Fi.","Lắp đặt thêm một Switch ở tầng hai và kết nối các thiết bị di động qua đó bằng cáp.","Lắp đặt thêm một Wireless Access Point (WAP) ở mỗi tầng, kết nối chúng bằng cáp Ethernet về Router chính để tạo thêm các điểm phát Wi-Fi.","Thay thế Router chính bằng một Modem ADSL để có tín hiệu Wi-Fi mạnh hơn."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Một công ty vận tải hành khách đường dài muốn triển khai dịch vụ Wi-Fi miễn phí trên tất cả các xe buýt của mình để phục vụ khách hàng. Để đảm bảo hành khách có thể truy cập Internet ổn định trong suốt hành trình qua mạng di động, kiến trúc mạng trên xe buýt cần bao gồm những thiết bị cơ bản nào và chúng hoạt động như thế nào?","questionImage":null,"mappedType":"multiple-choice","options":["Chỉ cần một Router Wi-Fi để kết nối trực tiếp với mạng Internet thông qua sóng radio.","Một Modem ADSL để nhận tín hiệu từ vệ tinh và một Switch để phân phối Wi-Fi cho hành khách.","Một Hub để tạo mạng cục bộ trên xe và một Router để kết nối với mạng di động.","Một Router Wi-Fi để tạo mạng LAN không dây trên xe và một Modem GSM (có gắn SIM) để kết nối với mạng di động của nhà cung cấp Internet (ISP)."],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Thiết bị mạng nào có chức năng chính là chuyển đổi tín hiệu số (digital) thành tín hiệu tương tự (analog) và ngược lại để truyền dữ liệu qua các phương tiện truyền dẫn?","questionImage":null,"mappedType":"multiple-choice","options":["Router","Switch","Modem","Hub"],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Điểm khác biệt cơ bản trong cách xử lý dữ liệu của Hub so với Switch là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Hub chỉ gửi dữ liệu đến thiết bị đích, còn Switch gửi đến tất cả các cổng.","Hub gửi dữ liệu đến tất cả các cổng, còn Switch gửi đến đúng thiết bị đích nhờ địa chỉ MAC.","Hub hoạt động ở Layer 2, còn Switch hoạt động ở Layer 1.","Hub có bảng địa chỉ MAC, còn Switch thì không."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Chức năng chính của Router trong mạng máy tính là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Chuyển đổi tín hiệu số thành tín hiệu tương tự và ngược lại.","Kết nối các thiết bị trong cùng mạng LAN và gửi dữ liệu đến tất cả các cổng.","Kết nối các mạng khác nhau (như mạng LAN với Internet) và định tuyến dữ liệu dựa trên địa chỉ IP.","Tạo ra một mạng không dây và cho phép các thiết bị di động kết nối."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Thiết bị mạng nào có chức năng kết nối các thiết bị trong cùng mạng LAN bằng sóng vô tuyến và thường được gọi là bộ thu phát Wi-Fi?","questionImage":null,"mappedType":"multiple-choice","options":["Modem","Hub","Wireless Access Point (WAP)","Router"],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Theo tài liệu, so với mạng không dây, một ưu điểm về tính bảo mật của mạng có dây là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Tốc độ truyền dữ liệu nhanh hơn.","Độ ổn định cao hơn.","Khả năng bảo mật tốt hơn vì kẻ xâm nhập cần truy cập vào hệ thống vật lý.","Chi phí lắp đặt và duy trì thấp hơn."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Mạng máy tính được định nghĩa là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Hệ thống các thiết bị số được kết nối với nhau để truyền dữ liệu và trao đổi thông tin.","Chỉ là tập hợp các máy tính được kết nối với nhau trong một văn phòng.","Hệ thống dùng để lưu trữ dữ liệu tập trung cho một doanh nghiệp.","Tập hợp các phần mềm được cài đặt trên một máy tính để chia sẻ tài nguyên."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Chức năng chính của Router trong mạng máy tính là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Chuyển đổi tín hiệu số thành tín hiệu tương tự và ngược lại.","Kết nối các thiết bị trong cùng mạng LAN.","Kết nối các mạng LAN với nhau hoặc kết nối mạng LAN với mạng Internet.","Lưu trữ dữ liệu lớn cho các thiết bị trong mạng."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Router định tuyến dữ liệu đến thiết bị đích nhờ vào thông tin nào?","questionImage":null,"mappedType":"multiple-choice","options":["Địa chỉ MAC của thiết bị.","Tên thiết bị trong mạng.","Địa chỉ IP của thiết bị.","Tốc độ kết nối của thiết bị."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Khái niệm \"định tuyến\" (routing) trong mạng máy tính có ý nghĩa gì?","questionImage":null,"mappedType":"multiple-choice","options":["Quá trình chuyển đổi tín hiệu từ số sang tương tự để truyền qua cáp đồng.","Quá trình quyết định và điều khiển gói dữ liệu trong mạng để chúng có thể đi từ nguồn đến đích thông qua các đường đi tối ưu.","Quá trình kết nối các thiết bị không dây với nhau để tạo ra một mạng Wi-Fi.","Quá trình gán địa chỉ IP tự động cho các thiết bị trong mạng nội bộ."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Để quyết định đường đi tối ưu cho gói dữ liệu, Router sử dụng thông tin từ đâu?","questionImage":null,"mappedType":"multiple-choice","options":["Bảng địa chỉ MAC của tất cả các thiết bị trong mạng.","Bảng định tuyến (routing table).","Thông tin về tốc độ kết nối của từng thiết bị.","Địa chỉ vật lý của các cổng kết nối trên Router."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Điểm khác biệt cơ bản giữa Hub và Switch trong việc xử lí dữ liệu trên mạng LAN là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Hub gửi dữ liệu đến tất cả các cổng, còn Switch gửi đến đúng thiết bị đích.","Hub hoạt động ở tầng Liên kết dữ liệu (Layer 2), còn Switch hoạt động ở tầng Vật lý (Layer 1).","Hub có bảng địa chỉ MAC, còn Switch thì không.","Hub có hiệu suất cao hơn và ít xung đột hơn Switch."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Chức năng chính của Router trong một mạng máy tính là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Chuyển đổi tín hiệu số thành tín hiệu tương tự và ngược lại.","Kết nối các thiết bị trong cùng một mạng LAN có dây.","Kết nối các mạng LAN với nhau hoặc kết nối mạng LAN với mạng Internet, và định tuyến dữ liệu dựa vào địa chỉ IP.","Phát sóng vô tuyến để các thiết bị không dây có thể kết nối."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Thiết bị nào có chức năng chính là chuyển đổi tín hiệu số từ máy tính thành tín hiệu tương tự để truyền qua đường dây điện thoại (hoặc cáp quang) và ngược lại?","questionImage":null,"mappedType":"multiple-choice","options":["Switch","Router","Modem","Wireless Access Point (WAP)"],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Để các thiết bị như điện thoại thông minh, máy tính xách tay có thể kết nối vào mạng LAN thông qua sóng vô tuyến, thiết bị mạng nào sau đây đóng vai trò chính?","questionImage":null,"mappedType":"multiple-choice","options":["Hub","Switch","Router","Wireless Access Point (WAP)"],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Trong một hệ thống mạng gia đình hiện đại, thiết bị nào thường tích hợp các chức năng của router, switch và bộ thu phát Wi-Fi để cung cấp kết nối Internet và chia sẻ mạng nội bộ?","questionImage":null,"mappedType":"multiple-choice","options":["Modem ADSL đơn thuần","Hub","Router Wi-Fi (hoặc Modem Wi-Fi tích hợp)","Switch kết hợp"],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Chức năng cốt lõi của việc sử dụng địa chỉ IP trong hoạt động định tuyến của Router là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Phân biệt các thiết bị trong cùng một mạng cục bộ (LAN) một cách duy nhất.","Định danh thiết bị đích để Router có thể chuyển tiếp gói dữ liệu một cách chính xác.","Mã hóa dữ liệu để đảm bảo tính bảo mật khi truyền qua mạng Internet.","Thiết lập kết nối vật lý giữa các máy tính trong một mạng có dây."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Theo tài liệu, quá trình \"định tuyến\" (routing) trong mạng máy tính được hiểu là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Quá trình chuyển đổi tín hiệu số thành tín hiệu tương tự và ngược lại.","Quá trình quyết định và điều khiển gói dữ liệu trong mạng để chúng đi từ nguồn đến đích thông qua các đường đi tối ưu.","Quá trình kết nối các thiết bị trong cùng một mạng LAN để chia sẻ tài nguyên.","Quá trình thiết lập một điểm truy cập không dây (WAP) để các thiết bị di động kết nối."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Thiết bị mạng nào được mô tả là sử dụng địa chỉ IP để phân tích và quyết định đường đi cho các gói dữ liệu giữa các mạng khác nhau?","questionImage":null,"mappedType":"multiple-choice","options":["Hub","Switch","Wireless Access Point (WAP)","Router"],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Sự khác biệt chính giữa Switch và Router trong việc xử lý và chuyển tiếp dữ liệu dựa trên địa chỉ là gì, theo thông tin đã cung cấp?","questionImage":null,"mappedType":"multiple-choice","options":["Switch chuyển tiếp dữ liệu dựa trên địa chỉ IP, còn Router chuyển tiếp dựa trên địa chỉ MAC.","Switch chuyển tiếp dữ liệu đến tất cả các cổng, còn Router chỉ gửi đến thiết bị đích cụ thể.","Switch kết nối các thiết bị trong cùng mạng LAN bằng địa chỉ MAC, Router kết nối các mạng khác nhau bằng địa chỉ IP.","Switch không có bảng địa chỉ MAC, còn Router có bảng định tuyến IP."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Bảng định tuyến (routing table) của Router đóng vai trò thiết yếu nào trong việc truyền tải dữ liệu?","questionImage":null,"mappedType":"multiple-choice","options":["Lưu trữ thông tin về các điểm truy cập Wi-Fi trong khu vực.","Chứa danh sách các thiết bị đầu cuối kết nối trực tiếp vào Router.","Cung cấp thông tin để Router quyết định đường đi tối ưu cho gói dữ liệu đến đích.","Quản lý việc chuyển đổi tín hiệu tương tự sang tín hiệu số cho modem."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Một công ty nhỏ với $20$ máy tính đang gặp phải tình trạng mạng chậm và thường xuyên xảy ra xung đột dữ liệu khi sử dụng Hub để kết nối. Để cải thiện hiệu suất và bảo mật, người quản trị mạng nên nâng cấp thiết bị kết nối trung tâm nào?","questionImage":null,"mappedType":"multiple-choice","options":["Thay thế Hub bằng một thiết bị Modem quang.","Thay thế Hub bằng một thiết bị Switch.","Thêm một Hub nữa để tăng số lượng cổng kết nối.","Thay thế Hub bằng một Wireless Access Point (WAP)."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Gia đình bạn có một đường truyền Internet từ nhà cung cấp dịch vụ (ISP) và muốn kết nối đồng thời $3$ máy tính để bàn (sử dụng cáp mạng), $2$ điện thoại thông minh (sử dụng Wi-Fi) và $1$ Smart TV (sử dụng cáp mạng) vào Internet. Thiết bị mạng nào đóng vai trò quan trọng nhất trong việc phân phối kết nối Internet và điều phối dữ liệu giữa các thiết bị trong nhà, đồng thời quản lý đường đi của dữ liệu ra ngoài Internet?","questionImage":null,"mappedType":"multiple-choice","options":["Hub","Switch","Modem","Router"],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Bạn sống ở một khu vực mới xây dựng, nhà cung cấp dịch vụ Internet (ISP) triển khai hạ tầng cáp quang đến tận nhà. Để kết nối Internet, bạn cần một thiết bị mạng có khả năng chuyển đổi tín hiệu ánh sáng (từ cáp quang) thành tín hiệu số mà máy tính có thể hiểu được và ngược lại. Thiết bị đó là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Hub","Switch","Router Wi-Fi","Modem quang"],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Một người dùng gia đình muốn có một giải pháp đơn giản và gọn gàng để vừa nhận tín hiệu Internet từ nhà cung cấp, vừa chia sẻ kết nối đó cho các thiết bị qua cả cáp mạng lẫn sóng Wi-Fi. Thiết bị nào sau đây tích hợp đầy đủ các chức năng này một cách hiệu quả nhất?","questionImage":null,"mappedType":"multiple-choice","options":["Kết hợp một Hub với một Wireless Access Point (WAP).","Sử dụng riêng lẻ một Modem và một Switch.","Sử dụng một Router Wi-Fi (Modem Wi-Fi tích hợp).","Chỉ cần một Switch với nhiều cổng."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Lan đang đi công tác ở một vùng nông thôn không có sẵn mạng Wi-Fi công cộng hay đường truyền cáp quang. Cô ấy cần sử dụng máy tính xách tay để truy cập Internet gấp để hoàn thành báo cáo. Điện thoại di động của cô ấy có kết nối $4G$ và một gói cước dữ liệu lớn. Lan nên làm gì để máy tính xách tay của mình có thể kết nối Internet?","questionImage":null,"mappedType":"multiple-choice","options":["Mua một thiết bị Hub để kết nối điện thoại và máy tính.","Tìm một Modem ADSL để kết nối máy tính.","Bật chức năng \"Điểm truy cập cá nhân\" (Mobile Hotspot) trên điện thoại di động và kết nối máy tính qua Wi-Fi.","Sử dụng một Switch để tạo mạng cục bộ giữa điện thoại và máy tính."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Trong một mạng lớn có nhiều mạng LAN con được kết nối với nhau, một gói dữ liệu được gửi từ máy tính $A$ (thuộc mạng LAN 1, địa chỉ IP nội bộ $192.168.1.10$) đến máy tính $B$ (thuộc mạng LAN 2, địa chỉ IP nội bộ $192.168.2.20$). Router đóng vai trò quan trọng trong việc đảm bảo gói dữ liệu này đến đúng đích. Giả sử Router $R_1$ là cổng của mạng LAN 1 và Router $R_2$ là cổng của mạng LAN 2, và có nhiều tuyến đường khả dụng giữa $R_1$ và $R_2$. Điều nào sau đây mô tả đúng nhất cách Router $R_1$ quyết định đường đi của gói dữ liệu?","questionImage":null,"mappedType":"multiple-choice","options":["$R_1$ sẽ phân tích địa chỉ MAC của máy tính $B$ và gửi gói dữ liệu trực tiếp đến cổng kết nối với $B$.","$R_1$ sẽ gửi gói dữ liệu đến tất cả các cổng khác của nó để đảm bảo gói tin đến được $R_2$.","$R_1$ sẽ phân tích địa chỉ IP của máy tính $B$, tham chiếu bảng định tuyến để xác định tuyến đường tối ưu đến mạng LAN 2, và chuyển tiếp gói dữ liệu qua cổng tương ứng.","$R_1$ sẽ tự động chọn đường đi có ít thiết bị trung gian nhất mà không cần kiểm tra bảng định tuyến."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Một công ty có hai phòng ban chính: Phòng Kế toán và Phòng Kinh doanh, mỗi phòng có một mạng LAN riêng biệt. Công ty muốn các máy tính trong Phòng Kế toán có thể giao tiếp với các máy tính trong Phòng Kinh doanh, đồng thời có thể truy cập Internet. Để làm được điều này, công ty đã lắp đặt một Switch trong mỗi phòng và một thiết bị trung tâm để kết nối hai mạng LAN này và ra Internet. Thiết bị trung tâm này phải là loại nào và tại sao nó được chọn thay vì chỉ dùng Switch để kết nối hai LAN?","questionImage":null,"mappedType":"multiple-choice","options":["Switch, vì Switch có khả năng phân tích địa chỉ MAC để gửi dữ liệu đến đúng thiết bị đích, đủ để kết nối giữa hai mạng LAN.","Hub, vì Hub đơn giản và rẻ, có thể kết nối nhiều mạng LAN lại với nhau.","Router, vì Router có khả năng phân tích địa chỉ IP và sử dụng bảng định tuyến để chuyển tiếp gói dữ liệu giữa các mạng LAN khác nhau và ra Internet.","Wireless Access Point (WAP), vì WAP cho phép kết nối không dây linh hoạt giữa hai phòng ban."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Trên các xe khách đường dài, để cung cấp dịch vụ Wi-Fi cho hành khách, nhà xe thường trang bị một Router Wi-Fi và một Modem GSM (có gắn SIM). Hành khách có thể kết nối điện thoại của họ với Wi-Fi của xe để truy cập Internet. Trong hệ thống này, chức năng định tuyến của Router Wi-Fi đóng vai trò như thế nào để hành khách có thể lướt web?","questionImage":null,"mappedType":"multiple-choice","options":["Router Wi-Fi chỉ đơn thuần phát sóng Wi-Fi cho các thiết bị, còn Modem GSM chịu trách nhiệm định tuyến tất cả lưu lượng truy cập Internet.","Router Wi-Fi phân tích địa chỉ IP của các yêu cầu từ thiết bị của hành khách, sau đó quyết định và chuyển tiếp các gói dữ liệu đến Modem GSM để gửi ra mạng di động, và ngược lại.","Router Wi-Fi có một bảng địa chỉ MAC của tất cả các trang web trên Internet, giúp nó gửi yêu cầu trực tiếp đến máy chủ web.","Modem GSM có chức năng định tuyến nội bộ, còn Router Wi-Fi chỉ đơn thuần là bộ chuyển đổi tín hiệu."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Một doanh nghiệp có trụ sở chính ở Hà Nội và một chi nhánh ở TP. Hồ Chí Minh. Các máy tính ở trụ sở chính tạo thành một mạng LAN, và các máy tính ở chi nhánh cũng tạo thành một mạng LAN riêng biệt. Doanh nghiệp muốn các máy tính ở hai địa điểm này có thể truy cập tài nguyên của nhau một cách an toàn và hiệu quả, cũng như truy cập Internet. Loại thiết bị mạng nào là \textbf{thiết yếu} để kết nối hai mạng LAN xa cách này và thực hiện chức năng định tuyến thông tin giữa chúng?","questionImage":null,"mappedType":"multiple-choice","options":["Hub, vì Hub là thiết bị đơn giản nhất để kết nối nhiều máy tính.","Switch, vì Switch có hiệu suất cao và bảo mật tốt hơn Hub.","Wireless Access Point (WAP), vì nó cung cấp kết nối không dây tiện lợi.","Router, vì Router được thiết kế để kết nối các mạng LAN khác nhau (như LAN của trụ sở chính và LAN của chi nhánh) và Internet, sử dụng địa chỉ IP và bảng định tuyến để xác định đường đi cho gói dữ liệu."],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Một người dùng kết nối máy tính của mình vào mạng gia đình thông qua một Router Wi-Fi, và Router này lại được kết nối với Modem để truy cập Internet. Khi người dùng này gửi một yêu cầu truy cập đến một trang web bên ngoài mạng gia đình, gói dữ liệu sẽ đi qua Router rồi đến Modem. Trong quá trình này, địa chỉ IP công cộng (public IP) do Nhà cung cấp dịch vụ Internet (ISP) cấp đóng vai trò gì trong hoạt động của Router so với Modem?","questionImage":null,"mappedType":"multiple-choice","options":["Router sử dụng địa chỉ IP công cộng để quản lý việc phân phối Internet cho các thiết bị nội bộ trong mạng gia đình.","Modem nhận địa chỉ IP công cộng từ ISP và chuyển tiếp nó đến Router. Router sau đó dùng địa chỉ IP công cộng này làm \"đại diện\" của mạng gia đình khi giao tiếp với Internet, đồng thời quản lý các địa chỉ IP nội bộ cho các thiết bị trong nhà.","Cả Modem và Router đều chia sẻ và sử dụng cùng một địa chỉ IP công cộng để định tuyến các gói dữ liệu trong mạng gia đình và ra Internet.","Địa chỉ IP công cộng chỉ được sử dụng bởi Modem để chuyển đổi tín hiệu số thành tín hiệu tương tự, Router không liên quan đến nó."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Một quản trị viên mạng cần thiết lập kết nối giữa hai mạng LAN riêng biệt, mỗi mạng có dải địa chỉ IP khác nhau. Anh ta sử dụng một router để nối hai mạng này. Khi một gói tin từ máy tính $A$ ở LAN $1$ (địa chỉ IP $192.168.1.10$) muốn gửi đến máy tính $B$ ở LAN $2$ (địa chỉ IP $192.168.2.20$), router sẽ sử dụng thông tin nào của gói tin để chuyển tiếp một cách chính xác?","questionImage":null,"mappedType":"multiple-choice","options":["Địa chỉ MAC của máy tính $A$ và bảng ánh xạ MAC-IP của router.","Địa chỉ IP đích của gói tin ($192.168.2.20$) và bảng định tuyến của router.","Địa chỉ IP nguồn của gói tin ($192.168.1.10$) và tốc độ truyền dữ liệu của cổng.","Loại cáp kết nối giữa router và switch của LAN $2$."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Trong một công ty lớn, hệ thống mạng sử dụng cả Switch và Router. Một nhân viên gửi email từ máy tính của mình trong mạng nội bộ (LAN) đến một đồng nghiệp ở chi nhánh khác của công ty thông qua Internet (WAN). Hãy phân tích sự khác biệt cơ bản trong cách thức mà Switch và Router xử lý gói dữ liệu dựa trên địa chỉ MAC và địa chỉ IP để hoàn thành việc gửi email này.","questionImage":null,"mappedType":"multiple-choice","options":["Switch sử dụng địa chỉ IP để chuyển tiếp gói tin trong LAN, còn Router sử dụng địa chỉ MAC để định tuyến giữa các mạng.","Switch chỉ hoạt động với địa chỉ MAC trong cùng một LAN, trong khi Router sử dụng địa chỉ IP để định tuyến gói tin giữa các mạng khác nhau.","Cả Switch và Router đều sử dụng địa chỉ MAC để chuyển tiếp dữ liệu, nhưng Router cũng dùng địa chỉ IP để đảm bảo tính bảo mật.","Switch và Router đều dựa vào bảng định tuyến, nhưng Switch chỉ có bảng địa chỉ MAC còn Router chỉ có bảng địa chỉ IP."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Một sinh viên đang thực hiện cuộc gọi video trực tuyến qua mạng Wi-Fi tại một quán cà phê công cộng. Kết nối Wi-Fi tại đây thường xuyên bị gián đoạn và có tốc độ không ổn định. Giao thức TCP đóng vai trò gì trong việc đảm bảo cuộc gọi video vẫn diễn ra với độ tin cậy chấp nhận được, mặc dù chất lượng mạng kém?","questionImage":null,"mappedType":"multiple-choice","options":["TCP tự động chọn đường đi có băng thông tốt nhất để tránh tắc nghẽn.","TCP nén dữ liệu video để giảm dung lượng gói tin, giúp truyền nhanh hơn qua mạng yếu.","TCP thiết lập kết nối, đánh số thứ tự gói tin, xác nhận đã nhận được và gửi lại gói tin bị mất hoặc hỏng.","TCP mã hóa nội dung cuộc gọi video để bảo mật, làm giảm nguy cơ gián đoạn."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Trong một hệ thống mạng lớn kết nối nhiều chi nhánh của một tập đoàn xuyên quốc gia (mạng WAN/GAN), việc đảm bảo các gói dữ liệu đến đúng đích là cực kỳ quan trọng. Hãy giải thích tại sao giao thức IP được coi là \"xương sống\" cho khả năng định tuyến gói tin trong hệ thống mạng quy mô lớn như vậy.","questionImage":null,"mappedType":"multiple-choice","options":["IP cung cấp khả năng mã hóa dữ liệu, bảo vệ thông tin khi truyền qua các đường truyền công cộng.","IP cho phép mỗi thiết bị có một địa chỉ duy nhất trên toàn cầu và định tuyến gói tin dựa trên địa chỉ đó, giúp xác định đường đi tối ưu qua các mạng con.","IP tự động điều chỉnh tốc độ truyền tải dữ liệu để phù hợp với băng thông của từng đường truyền, đảm bảo hiệu suất cao.","IP thiết lập và duy trì các kết nối ổn định giữa các máy chủ và máy khách trong suốt quá trình truyền dữ liệu."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Một gia đình sử dụng Router Wi-Fi tích hợp Modem để kết nối Internet. Khi họ truy cập một trang web, dữ liệu được truyền từ máy tính, qua Router Wi-Fi, qua Modem, rồi đến nhà cung cấp dịch vụ Internet (ISP). Giả sử gói dữ liệu đã được giao thức IP định tuyến thành công đến máy chủ web. Tuy nhiên, trên đường đi ngược về, một vài gói dữ liệu bị mất do nhiễu tín hiệu trên đường cáp quang đến Modem. Giao thức nào dưới đây chịu trách nhiệm chính trong việc xử lý tình huống này để trình duyệt vẫn hiển thị trang web đầy đủ và chính xác?","questionImage":null,"mappedType":"multiple-choice","options":["Giao thức MAC (Media Access Control).","Giao thức IP (Internet Protocol).","Giao thức TCP (Transmission Control Protocol).","Giao thức ARP (Address Resolution Protocol)."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Điểm khác biệt cơ bản nhất trong cách Hub và Switch xử lý dữ liệu trong mạng LAN là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Hub gửi dữ liệu đến tất cả các cổng kết nối, trong khi Switch chỉ gửi đến đúng thiết bị đích.","Hub hoạt động ở tầng Liên kết dữ liệu (Layer 2) của mô hình OSI, còn Switch hoạt động ở tầng Vật lý (Layer 1).","Hub có khả năng học và lưu trữ địa chỉ MAC của các thiết bị, còn Switch thì không.","Hub có hiệu suất cao hơn và ít xảy ra xung đột tín hiệu hơn Switch."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Chức năng chính của Router trong một mạng máy tính là gì và nó sử dụng thông tin nào để thực hiện chức năng đó?","questionImage":null,"mappedType":"multiple-choice","options":["Chuyển đổi tín hiệu số thành tín hiệu tương tự và ngược lại để kết nối với nhà cung cấp dịch vụ Internet, sử dụng các loại modem khác nhau.","Kết nối các mạng LAN với nhau hoặc kết nối mạng LAN với mạng Internet, sử dụng địa chỉ IP và bảng định tuyến để chuyển tiếp dữ liệu.","Kết nối các thiết bị trong cùng một mạng LAN không dây, truyền dữ liệu bằng sóng vô tuyến.","Gửi dữ liệu đến tất cả các cổng kết nối trong cùng một mạng LAN có dây, gây xung đột tín hiệu thường xuyên."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Mô tả nào dưới đây đúng về chức năng của Modem trong hệ thống mạng?","questionImage":null,"mappedType":"multiple-choice","options":["Phân phối kết nối Internet cho nhiều thiết bị trong mạng nội bộ bằng cách sử dụng địa chỉ IP nội bộ.","Là thiết bị tạo ra một mạng không dây (Wi-Fi) để các thiết bị di động có thể kết nối Internet.","Chuyển đổi tín hiệu số từ máy tính thành tín hiệu tương tự để truyền qua đường dây điện thoại hoặc cáp quang và ngược lại, hoạt động như một “phiên dịch viên”.","Kết nối các thiết bị trong cùng một mạng LAN có dây và chuyển tiếp dữ liệu dựa trên địa chỉ MAC."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Thiết bị mạng nào có chức năng chính là kết nối các thiết bị trong cùng mạng LAN bằng sóng vô tuyến và có thể kết hợp mạng có dây với mạng không dây trong cùng một LAN?","questionImage":null,"mappedType":"multiple-choice","options":["Hub.","Switch.","Router.","Wireless Access Point (WAP)."],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Mạng máy tính nào được định nghĩa là có phạm vi hoạt động trên toàn cầu, kết nối các thiết bị khắp thế giới và thường có tốc độ truyền dữ liệu rất cao?","questionImage":null,"mappedType":"multiple-choice","options":["Mạng LAN (Local Area Network).","Mạng MAN (Metropolitan Area Network).","Mạng WAN (Wide Area Network).","Mạng GAN (Global Area Network)."],"optionsImage":[],"correctAnswerIndex":3}];
            const quizOptions = {"timeLimit":45,"retriesAllowed":1,"showAnswers":true,"showExplanation":false,"aiAssessment":true,"scoring":{"mc":10,"tf":0,"sa":0,"essay":0,"tfMethod":"progressive"}};
            const googleScriptUrl = "https://script.google.com/macros/s/AKfycbzAhhPPCUgw-uU55gOj87Tm16ugz8FuBlRwQ7sECOBiOWBC8n6SI2mt_mQblXdoCdje/exec";
            const correctExamCode = "9XBEQC";
            const teacherApiKey = "AIzaSyDzpJyodrQYlL0_OmSq4k3snugEgphM6IE";
            let studentInfo = {};
            let isSubmitted = false;
            let timerInterval;
            let retriesLeft = quizOptions.retriesAllowed;
            let studentApiKey = "";
            let ai = null;

            let proctoringLog = {
                thoatManHinh: 0,
                saoChep: 0,
                dan: 0,
                suKien: []
            };

            const studentQuizContainer = document.getElementById('student-quiz-container');
            const submitBtn = document.getElementById('submit-quiz-btn');
            const resultContainer = document.getElementById('result-container');
            const postSubmitOptions = document.getElementById('post-submit-options');
            const retryBtn = document.getElementById('retry-quiz-btn');
            const loginModal = document.getElementById('login-modal');
            const studentInfoForm = document.getElementById('student-info-form');
            const timerDisplay = document.getElementById('timer-display');
            const retriesDisplay = document.getElementById('retries-display');
            function shuffleQuiz() {
                // Shuffle options/statements within each question first
                quizData.forEach(item => {
                    // Shuffle multiple-choice options and their corresponding images
                    if (item.mappedType === 'multiple-choice' && item.options && item.options.length > 0) {
                        const correctAnswerText = item.options[item.correctAnswerIndex];
                        let optionsWithImages = item.options.map((opt, index) => ({
                            text: opt,
                            image: (item.optionsImage && item.optionsImage[index]) ? item.optionsImage[index] : null
                        }));
                        // Fisher-Yates shuffle
                        for (let i = optionsWithImages.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [optionsWithImages[i], optionsWithImages[j]] = [optionsWithImages[j], optionsWithImages[i]];
                        }
                        // Update the item with shuffled data
                        item.options = optionsWithImages.map(opt => opt.text);
                        item.optionsImage = optionsWithImages.map(opt => opt.image);
                        item.correctAnswerIndex = item.options.indexOf(correctAnswerText);
                    }
                    // Shuffle true-false statements
                    if (item.mappedType === 'true-false' && item.statements && item.statements.length > 0) {
                         for (let i = item.statements.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [item.statements[i], item.statements[j]] = [item.statements[j], item.statements[i]];
                        }
                    }
                });
                // Then, group questions by type and shuffle within each group
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});
                let shuffledQuizData = [];
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
                partOrder.forEach(partType => {
                    if (grouped[partType]) {
                        const partQuestions = grouped[partType];
                        for (let i = partQuestions.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [partQuestions[i], partQuestions[j]] = [partQuestions[j], partQuestions[i]];
                        }
                        shuffledQuizData = shuffledQuizData.concat(partQuestions);
                    }
                });
               
                quizData = shuffledQuizData;
            }
            // --- Timer Function ---
            function startTimer(duration, display) {
                let timer = duration, minutes, seconds;
                clearInterval(timerInterval); // Clear any existing timer
                if(duration <= 0) {
                     display.textContent = "∞";
                     return;
                }
                timerInterval = setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);
                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;
                    display.textContent = minutes + ":" + seconds;
                    if (--timer < 0) {
                        clearInterval(timerInterval);
                        alert("Hết giờ làm bài!");
                        handleSubmit();
                    }
                }, 1000);
            }
            
            async function showExplanation(index, button) {
                const item = quizData[index];
                const questionCard = document.getElementById(`student-q-${index}`);
                const feedbackDiv = document.getElementById(`q-${index}-feedback`);
                if (!questionCard || !feedbackDiv) return;

                const existingExplanation = feedbackDiv.querySelector('.ai-explanation');
                if (existingExplanation) {
                    existingExplanation.remove();
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Xem giải thích
                    `;
                    return;
                }

                button.disabled = true;
                button.innerHTML = '<div class="loader mr-2"></div> Đang tải...';

                if (item.explanation) {
                    displayExplanation(item.explanation, feedbackDiv, button);
                    return;
                }

                if (!ai) {
                    alert("Tính năng giải thích yêu cầu API Key, nhưng chưa được cấu hình bởi giáo viên.");
                    button.disabled = false;
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Xem giải thích
                    `;
                    return;
                }

                const questionText = item.question || item.main_question;
                let prompt = `Bạn là một trợ lý giáo viên AI, am hiểu sâu sắc Chương trình GDPT 2018. Hãy cung cấp một lời giải chi tiết, từng bước một cho câu hỏi sau đây. Lời giải phải chính xác, dễ hiểu và phù hợp với phương pháp giảng dạy của chương trình học, TUYỆT ĐỐI KHÔNG sử dụng kiến thức của lớp cao hơn để giải thích.\n\n--- CÂU HỎI ---\n${questionText}\n\n`;
                if (item.mappedType === 'multiple-choice') {
                    prompt += `--- CÁC LỰA CHỌN ---\n${item.options.map((opt, i) => `${String.fromCharCode(65 + i)}. ${opt}`).join('\n')}\n\n`;
                    prompt += `--- ĐÁP ÁN ĐÚNG ---\n${String.fromCharCode(65 + item.correctAnswerIndex)}. ${item.options[item.correctAnswerIndex]}`;
                } else if (item.mappedType === 'true-false') {
                    prompt += `--- CÁC MỆNH ĐỀ & ĐÁP ÁN ---\n${item.statements.map(s => ` - ${s.statement} -> ${s.is_correct ? 'Đúng' : 'Sai'}`).join('\n')}`;
                } else {
                    prompt += `--- ĐÁP ÁN / GỢI Ý ---\n${item.answer}`;
                }
                prompt += `\n\n--- YÊU CẦU ---\nGiải thích rõ ràng tại sao đáp án lại đúng, từng bước một. Định dạng tất cả các công thức toán học bằng LaTeX.`;

                try {
                    const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: prompt });
                    const explanationText = response.text.replace(/\n/g, '<br>');
                    item.explanation = explanationText; // Cache it
                    displayExplanation(explanationText, feedbackDiv, button);
                } catch (error) {
                    console.error("Lỗi khi tạo giải thích:", error);
                    feedbackDiv.insertAdjacentHTML('beforeend', '<div class="ai-explanation text-red-600">Lỗi: Không thể tạo giải thích.</div>');
                    button.disabled = false;
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Thử lại
                    `;
                }
            }

            function displayExplanation(explanationText, container, button) {
                container.insertAdjacentHTML('beforeend', `<div class="ai-explanation prose prose-sm">${explanationText}</div>`);
                if (window.MathJax) MathJax.typesetPromise([container]);
                button.disabled = false;
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    Ẩn giải thích
                `;
            }
           
            function renderStudentQuiz() {
                studentQuizContainer.innerHTML = '';
               
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});
                const groupInfo = {
                    'multiple-choice': { title: 'PHẦN I. TRẮC NGHIỆM KHÁCH QUAN', subtitle: 'Chọn đáp án đúng nhất trong các lựa chọn sau.' },
                    'true-false': { title: 'PHẦN II. CÂU HỎI ĐÚNG - SAI', subtitle: 'Xác định tính đúng hoặc sai cho mỗi mệnh đề dưới đây.' },
                    'short-answer': { title: 'PHẦN III. CÂU HỎI TRẢ LỜI NGẮN', subtitle: 'Điền đáp án ngắn gọn vào phần trả lời.' },
                    'essay': { title: 'PHẦN IV. CÂU HỎI TỰ LUẬN', subtitle: 'Trình bày chi tiết bài giải của bạn.' }
                };
               
                let questionCounter = 0;
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
                partOrder.forEach(partType => {
                    const questions = grouped[partType];
                    if (!questions || questions.length === 0) return;
                   
                    let groupHTML = `<div class="group-container space-y-8 mb-12">`;
                    const info = groupInfo[partType];
                    groupHTML += `
                        <div class="group-header pb-3 border-b-2 border-slate-300 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800">${info.title}</h2>
                            ${info.subtitle ? `<p class="text-md text-slate-600 italic mt-1">${info.subtitle}</p>` : ''}
                        </div>
                    `;
                    questions.forEach((item, localIndex) => {
                        const globalIndex = quizData.indexOf(item);
                        questionCounter++;
                        groupHTML += `<div class="question-card" id="student-q-${globalIndex}">`;
                        let questionText = (item.question || item.main_question || '').replace(/\n/g, '<br>');
                       
                        groupHTML += `<div class="flex items-start">
                                     <div class="flex-grow">
                                         <div class="flex items-center mb-2">
                                             <span class="font-bold text-lg mr-3 text-indigo-600">Câu ${questionCounter}:</span>
                                             <div id="q-${globalIndex}-feedback-icon"></div>
                                         </div>
                                         <div class="question-content mt-2 text-lg text-slate-700">${questionText}</div>
                                         ${item.questionImage ? `<img src="${item.questionImage}" class="mt-4 rounded-lg max-w-full md:max-w-md border shadow-sm">` : ''}
                                     </div>
                                 </div>`;
                       
                        groupHTML += `<div class="mt-6">`;
                        switch(item.mappedType) {
                            case 'multiple-choice':
                                groupHTML += `<div class="options-grid grid grid-cols-1 md:grid-cols-2 gap-4">`;
                                item.options.forEach((opt, i) => {
                                    groupHTML += `<label for="q${globalIndex}-opt${i}" id="q${globalIndex}-opt-label${i}" class="option-label flex items-start p-4 border-2 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-400">
                                                     <input type="radio" name="q${globalIndex}" id="q${globalIndex}-opt${i}" value="${i}" class="flex-shrink-0 mt-1 h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                                     <div class="ml-3 flex-grow">
                                                         <span class="font-semibold text-slate-800">${String.fromCharCode(65 + i)}.</span>
                                                         <span class="option-content text-slate-700">${opt || ''}</span>
                                                         ${(item.optionsImage && item.optionsImage[i]) ? `<img src="${item.optionsImage[i]}" class="mt-2 rounded-lg max-w-xs border shadow-sm">` : ''}
                                                     </div>
                                                 </label>`;
                                });
                                groupHTML += `</div>`;
                                break;
                            case 'true-false':
                                 groupHTML += `<div class="space-y-4">`;
                                 item.statements.forEach((s, i) => {
                                     groupHTML += `<div class="statement-item border-t pt-4">
                                                  <p class="mb-3 text-slate-700">${String.fromCharCode(97 + i)}) ${s.statement || ''}</p>
                                                  <div class="flex gap-x-6">
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="true" class="mr-2 h-4 w-4"> Đúng</label>
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="false" class="mr-2 h-4 w-4"> Sai</label>
                                                  </div>
                                              </div>`;
                                 });
                                 groupHTML += `</div>`;
                                 break;
                            case 'short-answer':
                                groupHTML += `<input type="text" name="q${globalIndex}" class="mt-1 block w-full md:w-1/2 border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Nhập đáp án của bạn...">`;
                                break;
                            case 'essay':
                                groupHTML += `<textarea name="q${globalIndex}" class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" rows="5" placeholder="Nhập câu trả lời tự luận của bạn..."></textarea>`;
                                break;
                        }
                        groupHTML += `</div><div id="q-${globalIndex}-feedback" class="mt-4"></div></div>`;
                    });
                    groupHTML += `</div>`;
                    studentQuizContainer.innerHTML += groupHTML;
                });
               
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    MathJax.typesetPromise([studentQuizContainer]);
                }
            }
           
            async function generatePerformanceReview(allAnswersData) {
                const feedbackContainer = document.getElementById('ai-feedback-container');
                if (!feedbackContainer || !ai) return null;
                feedbackContainer.classList.remove('hidden');
                feedbackContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">📝 Phân Tích & Gợi Ý Từ Trợ Lý AI</h3>
                        <div id="ai-feedback-loader" class="text-center py-6">
                            <svg class="animate-spin mx-auto h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p class="mt-3 text-slate-600">AI đang phân tích bài làm của bạn...</p>
                        </div>
                        <div id="ai-feedback-summary" class="hidden prose prose-sm max-w-none"></div>
                        <div id="ai-feedback-details" class="hidden mt-4 space-y-2"></div>
                    </div>
                `;
               
                const loader = document.getElementById('ai-feedback-loader');
                const summaryDiv = document.getElementById('ai-feedback-summary');
                const detailsDiv = document.getElementById('ai-feedback-details');
                const incorrectAnswers = allAnswersData.filter(a => !a.isCorrect);
                if (incorrectAnswers.length === 0) {
                    feedbackContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                            <h3 class="text-xl font-bold text-green-600">🎉 Chúc mừng!</h3>
                            <p class="mt-2 text-slate-700">Bạn đã trả lời đúng tất cả các câu hỏi. Làm tốt lắm!</p>
                        </div>
                    `;
                    return { overallFeedback: { summary: "Xuất sắc! Học sinh đã đã trả lời đúng tất cả các câu hỏi." } };
                }
                const summaryPrompt = `Bạn là một trợ lý giáo viên, nói tiếng Việt. Dựa vào tóm tắt các câu trả lời sai của học sinh, hãy đưa ra một nhận xét tổng quan ngắn gọn (khoảng 3-4 câu) về năng lực của học sinh, bao gồm điểm mạnh (suy luận từ các câu làm đúng), điểm yếu (dựa trên các câu sai) và một vài gợi ý ôn tập chung. Lời văn phải khích lệ, rõ ràng.
                Tóm tắt lỗi sai:
                ${JSON.stringify(incorrectAnswers.map(a => ({ cau: a.questionNumber, loai: a.type, cauHoi: a.question.substring(0, 50) + '...' })), null, 2)}`;
                try {
                    const summaryResponse = await ai.models.generateContent({
                        model: "gemini-2.5-flash",
                        contents: summaryPrompt
                    });
                    summaryDiv.innerHTML = summaryResponse.text.replace(/\n/g, '<br>');
                    loader.classList.add('hidden');
                    summaryDiv.classList.remove('hidden');
                    detailsDiv.classList.remove('hidden'); 
                } catch (e) {
                    console.error("Lỗi khi lấy nhận xét tổng quan:", e);
                    summaryDiv.innerHTML = '<p class="text-red-600">Lỗi khi tạo nhận xét tổng quan.</p>';
                    loader.classList.add('hidden');
                    summaryDiv.classList.remove('hidden');
                }
               
                const summaryForSheet = summaryDiv.innerText.substring(0, 200) + "...";
                return { overallFeedback: { summary: summaryForSheet } };
            }
            async function handleSubmit() {
                if (isSubmitted) return;
                isSubmitted = true;
                clearInterval(timerInterval);
                
                document.querySelectorAll('input, textarea').forEach(input => input.disabled = true);
                submitBtn.classList.add('hidden');
                postSubmitOptions.classList.remove('hidden');
                if (retriesLeft > 0) {
                    retryBtn.classList.remove('hidden');
                } else {
                    retryBtn.classList.add('hidden');
                }

                const proctoringDataString = JSON.stringify(proctoringLog);

                let totalStudentScore = 0;
                let totalCorrectAnswers = 0;
                let allAnswersData = [];
                const questionCounts = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    acc[type] = (acc[type] || 0) + 1;
                    return acc;
                }, {});
                
                quizData.forEach((item, index) => {
                    let questionNumber = index + 1;
                    let answerData = { questionNumber, type: item.type };
                    switch (item.mappedType) {
                        case 'multiple-choice':
                            const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                            const isCorrectMC = selectedOption ? parseInt(selectedOption.value) === item.correctAnswerIndex : false;
                            if (isCorrectMC) {
                                totalCorrectAnswers++;
                                if (questionCounts['multiple-choice'] > 0) {
                                   totalStudentScore += quizOptions.scoring.mc / questionCounts['multiple-choice'];
                                }
                            }
                            answerData.question = item.question;
                            answerData.options = item.options;
                            answerData.yourAnswer = selectedOption ? String.fromCharCode(65 + parseInt(selectedOption.value)) : "Không trả lời";
                            answerData.correctAnswer = String.fromCharCode(65 + item.correctAnswerIndex);
                            answerData.isCorrect = isCorrectMC;
                            break;
                        case 'true-false':
                            let correctStatementsCount = 0;
                            let yourAnswerPattern = [];
                            let correctAnswerPattern = [];
                            let details = [];
                            item.statements.forEach((s, i) => {
                                const selectedTF = document.querySelector(`input[name="q${index}-s${i}"]:checked`);
                                const studentChoice = selectedTF ? selectedTF.value === 'true' : null;
                                const isStatementCorrect = studentChoice === s.is_correct;
                               
                                if (isStatementCorrect) correctStatementsCount++;
                               
                                yourAnswerPattern.push(studentChoice === null ? '?' : (studentChoice ? 'Đ' : 'S'));
                                correctAnswerPattern.push(s.is_correct ? 'Đ' : 'S');
                                details.push({ statement: s.statement, yourChoice: studentChoice === null ? 'Không trả lời' : (studentChoice ? 'Đúng' : 'Sai'), correctChoice: s.is_correct ? 'Đúng' : 'Sai', isCorrect: isStatementCorrect });
                            });
                            
                            let scorePerTfQuestion = 0;
                            if (questionCounts['true-false'] > 0) {
                                scorePerTfQuestion = quizOptions.scoring.tf / questionCounts['true-false'];
                            }
                            let questionPoints = 0;
                            if (quizOptions.scoring.tfMethod === 'progressive') {
                                const progressivePoints = { 0: 0, 1: 0.1, 2: 0.25, 3: 0.5, 4: 1.0 };
                                questionPoints = progressivePoints[correctStatementsCount] * scorePerTfQuestion;
                            } else { // even
                                questionPoints = (correctStatementsCount / 4) * scorePerTfQuestion;
                            }
                            totalStudentScore += questionPoints;

                            if(correctStatementsCount === 4) totalCorrectAnswers++;
                            answerData.question = item.main_question;
                            answerData.yourAnswer = yourAnswerPattern.join('-');
                            answerData.correctAnswer = correctAnswerPattern.join('-');
                            answerData.isCorrect = correctStatementsCount === 4;
                            answerData.details = details;
                            break;
                       
                        case 'short-answer':
                            const saInput = document.querySelector(`input[name="q${index}"]`);
                            const studentAnswerRaw = saInput ? (saInput.value ?? '').trim() : "";
                            const correctAnswerRaw = (item.answer ?? '').toString().trim().replace(/\$/g, '');
                            let isCorrectSA = false;
                            const studentAnswerNormalized = studentAnswerRaw.replace(',', '.');
                            const correctAnswerNormalized = correctAnswerRaw.replace(',', '.');
                            if (studentAnswerNormalized.toLowerCase() === correctAnswerNormalized.toLowerCase()) {
                                isCorrectSA = true;
                            }
                             if (isCorrectSA) {
                                totalCorrectAnswers++;
                                if (questionCounts['short-answer'] > 0) {
                                   totalStudentScore += quizOptions.scoring.sa / questionCounts['short-answer'];
                                }
                            }
                            answerData.question = item.question;
                            answerData.yourAnswer = studentAnswerRaw || "Không trả lời";
                            answerData.correctAnswer = correctAnswerRaw;
                            answerData.isCorrect = isCorrectSA;
                            break;
                           
                        case 'essay':
                             const essayInput = document.querySelector(`textarea[name="q${index}"]`);
                             answerData.question = item.question;
                             answerData.yourAnswer = essayInput.value || "Không trả lời";
                             answerData.correctAnswer = item.answer;
                             answerData.isCorrect = null; // Needs manual grading
                             break;
                    }
                    allAnswersData.push(answerData);
                });
                
                const finalScore = totalStudentScore;
                
                let competencyAssessment = "Giáo viên không yêu cầu AI phân tích bài làm.";
                if (quizOptions.aiAssessment) {
                    const feedbackData = await generatePerformanceReview(allAnswersData);
                    if (feedbackData && feedbackData.overallFeedback && feedbackData.overallFeedback.summary) {
                        competencyAssessment = feedbackData.overallFeedback.summary;
                    } else {
                        competencyAssessment = "Có lỗi xảy ra trong quá trình AI phân tích bài làm.";
                    }
                }
                
                if (quizOptions.showAnswers) {
                    const totalQuestions = quizData.length;
                    resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg text-center">
                        <h3 class="text-2xl font-bold text-slate-800">KẾT QUẢ BÀI LÀM</h3>
                        <p class="mt-4 text-lg">Số câu đúng hoàn toàn: <span class="font-bold text-green-600">${totalCorrectAnswers}/${totalQuestions}</span></p>
                        <p class="text-2xl mt-2">Điểm (thang 10): <span class="font-bold text-blue-600">${finalScore.toFixed(2)}</span></p>
                        ${questionCounts['essay'] > 0 ? `<p class="text-sm text-gray-600 italic mt-1">Lưu ý: Điểm trên chưa bao gồm ${quizOptions.scoring.essay} điểm của phần Tự luận.</p>` : ''}
                    </div>`;
                    resultContainer.classList.remove('hidden');

                    allAnswersData.forEach((ans, index) => {
                        const questionCard = document.getElementById(`student-q-${index}`);
                        const feedbackIconDiv = document.getElementById(`q-${index}-feedback-icon`);
                        const feedbackDiv = document.getElementById(`q-${index}-feedback`);
                        if (!questionCard || !feedbackIconDiv || !feedbackDiv) return;

                        const iconHTML = ans.isCorrect === true
                            ? '<svg class="feedback-icon text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>'
                            : (ans.isCorrect === false ? '<svg class="feedback-icon text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>' : '');
                        feedbackIconDiv.innerHTML = iconHTML;

                        if (ans.type.includes('multiple-choice')) {
                            const studentChoice = ans.yourAnswer === "Không trả lời" ? -1 : ans.yourAnswer.charCodeAt(0) - 65;
                            const correctChoice = ans.correctAnswer.charCodeAt(0) - 65;
                            document.getElementById(`q-${index}-opt-label${correctChoice}`)?.classList.add('correct');
                            if (studentChoice !== -1 && studentChoice !== correctChoice) {
                                document.getElementById(`q-${index}-opt-label${studentChoice}`)?.classList.add('incorrect');
                            }
                        } else if (ans.type === 'true-false') {
                            const statementItems = questionCard.querySelectorAll('.statement-item');
                            ans.details.forEach((detail, i) => { if(statementItems[i]) { statementItems[i].classList.add(detail.isCorrect ? 'correct' : 'incorrect'); }});
                        }

                        if (quizOptions.showExplanation) {
                            feedbackDiv.innerHTML = `<button data-explain-index="${index}" class="explain-btn mt-4 flex items-center px-4 py-2 bg-blue-100 text-blue-800 text-sm font-semibold rounded-lg hover:bg-blue-200 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                Xem giải thích
                            </button>`;
                        }
                    });
                    
                    document.querySelectorAll('.explain-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const button = e.currentTarget;
                            const index = parseInt(button.dataset.explainIndex, 10);
                            showExplanation(index, button);
                        });
                    });

                    if (window.MathJax) await window.MathJax.typesetPromise([studentQuizContainer]);
                } else {
                     resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg text-center"><h3 class="text-xl font-bold text-green-600">Nộp bài thành công!</h3><p class="mt-2 text-slate-700">Bạn đã hoàn thành bài làm. Kết quả sẽ được giáo viên công bố sau.</p></div>`;
                    resultContainer.classList.remove('hidden');
                }
                
                const formData = new FormData();
                formData.append('name', studentInfo.name);
                formData.append('class', studentInfo.class);
                formData.append('score', `${finalScore.toFixed(2)}/10`);
                formData.append('assessment', competencyAssessment);
                formData.append('timestamp', new Date().toLocaleString('vi-VN'));
                formData.append('examCode', correctExamCode);
                formData.append('monitoringLog', proctoringDataString);
                formData.append('answerDetails', JSON.stringify(allAnswersData));
               
                fetch(googleScriptUrl, { method: 'POST', body: formData})
                    .then(res => console.log("Successfully submitted to Google Sheet"))
                    .catch(err => console.error("Error submitting to Google Sheet:", err));
            }
           
            function startNewAttempt() {
                isSubmitted = false;
                proctoringLog = { thoatManHinh: 0, saoChep: 0, dan: 0, suKien: [] };
                const proctoringWidget = document.getElementById('proctoring-widget');
                if (proctoringWidget) {
                    proctoringWidget.classList.add('hidden');
                    document.getElementById('tab-switch-count').textContent = '0';
                    document.getElementById('copy-count').textContent = '0';
                    document.getElementById('paste-count').textContent = '0';
                }

                renderStudentQuiz();
                resultContainer.classList.add('hidden');
                document.getElementById('ai-feedback-container').classList.add('hidden');
                postSubmitOptions.classList.add('hidden');
                submitBtn.classList.remove('hidden');
                 if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                }
                retriesLeft--;
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                window.scrollTo(0, 0);
            }
            studentInfoForm.addEventListener('submit', (e) => {
                e.preventDefault();
               
                const enteredCode = document.getElementById('exam-code').value.trim().toUpperCase();
                if (enteredCode !== correctExamCode) {
                    alert('Mã đề không chính xác. Vui lòng kiểm tra lại!');
                    return;
                }
               
                studentApiKey = teacherApiKey;
                if (!studentApiKey) {
                    console.warn('Cảnh báo: Giáo viên chưa cấu hình API Key. Các tính năng AI sẽ không hoạt động.');
                }
       
                try {
                    if (studentApiKey) {
                       ai = new GoogleGenAI({ apiKey: studentApiKey });
                    }
                } catch(e) {
                    console.error("Lỗi khởi tạo Gemini API với key của giáo viên.", e);
                    alert("Cảnh báo: API Key của giáo viên không hợp lệ. Vui lòng báo cho giáo viên. Các tính năng AI sẽ không hoạt động.");
                    ai = null;
                }
                shuffleQuiz();
               
                studentInfo.name = document.getElementById('student-name').value;
                studentInfo.class = document.getElementById('student-class').value;
                loginModal.classList.add('hidden');
                studentQuizContainer.classList.remove('hidden');
                submitBtn.classList.remove('hidden');
               
                if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                } else {
                    timerDisplay.textContent = "Không giới hạn";
                }
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                renderStudentQuiz();

                const proctoringWidget = document.getElementById('proctoring-widget');
                const tabSwitchCountEl = document.getElementById('tab-switch-count');
                const copyCountEl = document.getElementById('copy-count');
                const pasteCountEl = document.getElementById('paste-count');

                function updateProctoringUI() {
                    if (proctoringLog.thoatManHinh > 0 || proctoringLog.saoChep > 0 || proctoringLog.dan > 0) {
                        proctoringWidget.classList.remove('hidden');
                    }
                    tabSwitchCountEl.textContent = proctoringLog.thoatManHinh;
                    copyCountEl.textContent = proctoringLog.saoChep;
                    pasteCountEl.textContent = proctoringLog.dan;
                }

                // Disable Right Click
                document.addEventListener('contextmenu', e => e.preventDefault());

                // Track Tab Switching
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && !isSubmitted) {
                        proctoringLog.thoatManHinh++;
                        proctoringLog.suKien.push({ loai: 'chuyen_tab', thoiGian: new Date().toISOString() });
                        updateProctoringUI();
                    }
                });

                // Track Copying
                document.addEventListener('copy', () => {
                    if (isSubmitted) return;
                    proctoringLog.saoChep++;
                    proctoringLog.suKien.push({ loai: 'sao_chep', thoiGian: new Date().toISOString() });
                    updateProctoringUI();
                });

                // Track Pasting
                document.addEventListener('paste', () => {
                    if (isSubmitted) return;
                    proctoringLog.dan++;
                    proctoringLog.suKien.push({ loai: 'dan', thoiGian: new Date().toISOString() });
                    updateProctoringUI();
                });
            });
            
            submitBtn.addEventListener('click', handleSubmit);
            retryBtn.addEventListener('click', () => {
                shuffleQuiz();
                startNewAttempt();
            });
        </script>
    </body>
    </html>
    