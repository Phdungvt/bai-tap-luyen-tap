
    <!DOCTYPE html>
    <html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bài Tập Luyện Tập</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
        <script>
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$']]
                },
                chtml: {
                    fontCache: 'global',
                    linebreaks: {
                        automatic: true
                    }
                }
            };
        </script>
        <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
        </script>
        <style>
            body { font-family: 'Be Vietnam Pro', sans-serif; background-color: #f0f4f8; }
            .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
            .question-card { 
                background-color: white; 
                border-radius: 1rem; 
                padding: 1.5rem 2rem; 
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
                border-left: 5px solid transparent;
                transition: all 0.3s ease;
            }
            .ai-explanation { 
                background-color: #f0f9ff; 
                color: #0c4a6e;
                padding: 1rem; 
                border-radius: 0.75rem; 
                font-size: 0.9rem; 
                margin-top: 1rem; 
                border-left: 4px solid #38bdf8;
            }
            .feedback-icon { width: 1.5rem; height: 1.5rem; }
            .option-label {
                transition: all 0.2s ease-in-out;
                border: 2px solid #e5e7eb;
            }
            .option-label:hover {
                border-color: #6366f1;
                background-color: #eef2ff;
            }
            .option-label.correct { 
                border-color: #10b981 !important; 
                background-color: #ecfdf5 !important; 
                color: #065f46;
            }
            .option-label.incorrect { 
                border-color: #ef4444 !important; 
                background-color: #fef2f2 !important;
                color: #991b1b;
            }
            .statement-item.correct { background-color: #ecfdf5; border-color: #10b981; }
            .statement-item.incorrect { background-color: #fef2f2; border-color: #ef4444; }
            .tts-btn { transition: all 0.2s ease; }
            .tts-btn:hover { background-color: #e0e7ff; }
            .tts-btn.playing { color: #4f46e5; }
            .prose { max-width: 100%; }
            .prose h1, .prose h2, .prose h3 { font-weight: 600; }
            .prose p { margin-top: 0.5em; margin-bottom: 0.5em; }
            .prose ul, .prose ol { margin-top: 1em; margin-bottom: 1em; padding-left: 1.5em; }
            .prose li > p { margin-top: 0; margin-bottom: 0; }
            .prose code { background-color: #e5e7eb; padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 3px; }
            .prose pre { background-color: #e5e7eb; padding: 1em; border-radius: 0.5em; overflow-x: auto; }
            .prose pre code { background-color: transparent; padding: 0; }
            details[open] > summary .details-arrow {
                transform: rotate(180deg);
            }
        </style>
    </head>
    <body class="bg-slate-100 text-slate-800">
        <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md transform transition-all" style="animation: fadeIn 0.3s ease-out;">
                <h2 class="text-2xl font-bold mb-2 text-center text-slate-800">Thông Tin Học Sinh</h2>
                <p class="text-center text-slate-500 mb-6">Vui lòng nhập để bắt đầu làm bài.</p>
                <form id="student-info-form">
                    <div class="mb-4">
                        <label for="student-name" class="block text-sm font-medium text-slate-700 mb-1">Họ và tên</label>
                        <input type="text" id="student-name" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="student-class" class="block text-sm font-medium text-slate-700 mb-1">Lớp</label>
                        <input type="text" id="student-class" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="exam-code" class="block text-sm font-medium text-slate-700 mb-1">Mã đề</label>
                        <input type="text" id="exam-code" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Nhập mã đề giáo viên cung cấp">
                    </div>
                    <div class="mb-4">
                        <label for="student-api-key" class="block text-sm font-medium text-slate-700 mb-1">Gemini API Key</label>
                        <input type="password" id="student-api-key" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Dán API Key của bạn vào đây">
                        <p class="text-xs text-slate-500 mt-1">Để AI có thể chấm và phân tích bài làm, bạn cần cung cấp API Key. <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-600 hover:underline">Lấy API Key tại đây</a>.</p>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Giáo viên:</label>
                        <p class="mt-1 text-slate-800 bg-slate-100 p-2.5 rounded-lg">ddfgb</p>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">Bắt đầu làm bài</button>
                </form>
            </div>
        </div>

        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="mb-10 p-8 rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 class="text-4xl font-bold">Bài Tập Luyện Tập</h1>
                        <p class="text-lg text-blue-100 mt-2">Hãy hoàn thành các câu hỏi dưới đây một cách tốt nhất!</p>
                        <p class="text-sm text-blue-200 mt-4">Tác giả: ddfgb</p>
                    </div>
                    <div id="timer-container" class="text-right">
                         <div id="timer-display" class="text-3xl font-bold tracking-wider bg-white/20 px-4 py-2 rounded-lg">--:--</div>
                         <div id="retries-display" class="text-sm mt-1 text-blue-200"></div>
                    </div>
                </div>
            </header>
            <main id="student-quiz-container" class="space-y-8 hidden">
                <!-- Questions will be rendered here by JS -->
            </main>
            <footer class="mt-10 text-center">
                <button id="submit-quiz-btn" class="bg-indigo-600 text-white py-3 px-12 rounded-full font-bold text-lg hover:bg-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl hidden transform hover:scale-105">Nộp Bài</button>
                <div id="result-container" class="mt-6 hidden"></div>
                <div id="ai-feedback-container" class="mt-8 text-left hidden"></div>
                <div id="post-submit-options" class="hidden mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="retry-quiz-btn" class="w-full sm:w-auto bg-slate-600 text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-slate-700 transition-transform transform hover:scale-105">Làm Lại Đề Này</button>
                </div>
            </footer>
        </div>

        <script type="module">
            import { GoogleGenAI, Type } from "https://esm.sh/@google/genai@^1.13.0";

            let quizData = [{"type":"multiple-choice","question":"Cho hàm số $f(x) = {x^2} - 2x + 3$. Tính $f(2)$.<a id=\"c1a\"></a><br><img alt=\"A graph of a function\n\nAI-generated content may be incorrect.\" src=\"data:image/png;base64,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\">","main_question":"Cho hàm số $f(x) = {x^2} - 2x + 3$. Tính $f(2)$.<a id=\"c1a\"></a><br><img alt=\"A graph of a function\n\nAI-generated content may be incorrect.\" src=\"data:image/png;base64,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\">","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$3$.","$4$.","$5$.","$6$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Tìm tọa độ đỉnh của đồ thị hàm số $f(x) = 2{x^2} - 4x + 1$.<a id=\"c2a\"></a>","main_question":"Tìm tọa độ đỉnh của đồ thị hàm số $f(x) = 2{x^2} - 4x + 1$.<a id=\"c2a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$(1; - 1)$.","$(2; - 1)$.","$(1;1)$.","$(2;1)$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Đồ thị bên là của hàm số nào.","main_question":"Đồ thị bên là của hàm số nào.","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$y = - {x^2} + 4x - 3$.","$y = - {x^2} - 4x - 3$.","$y = - 2{x^2} - x + 3$.","$y = {x^2} - 4x - 3$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"<a id=\"c4a\"></a><strong>Câu 4.\t</strong>Gọi ${x_1},{x_2}({x_1} &lt; {x_2})$ là nghiệm của phương trình $\\sqrt {2{x^2} + 3x - 5} = 1 - x$. Khí đó ${x_2}^2 - 3{x_1}$ bằng","main_question":"<a id=\"c4a\"></a><strong>Câu 4.\t</strong>Gọi ${x_1},{x_2}({x_1} &lt; {x_2})$ là nghiệm của phương trình $\\sqrt {2{x^2} + 3x - 5} = 1 - x$. Khí đó ${x_2}^2 - 3{x_1}$ bằng","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$2$.","$1$.","$19$.","$0$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Tập nghiệm của phương trình $\\sqrt {3{x^2} - 4x - 1} = \\sqrt {2{x^2} - 4x + 3} $ là<a id=\"c26a\"></a>","main_question":"Tập nghiệm của phương trình $\\sqrt {3{x^2} - 4x - 1} = \\sqrt {2{x^2} - 4x + 3} $ là<a id=\"c26a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$\\left\\{ { - 2} \\right\\}$.","$\\left\\{ { - 2;2} \\right\\}$.","$\\left\\{ 2 \\right\\}$.","$\\left\\{ {2;1} \\right\\}$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Phương trình nào sau đây là phương trình của một hyperbol?<a id=\"c6a\"></a>","main_question":"Phương trình nào sau đây là phương trình của một hyperbol?<a id=\"c6a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$\\frac{{{x^2}}}{9} + \\frac{{{y^2}}}{{16}} = 1$.","$\\frac{{{x^2}}}{9} - \\frac{{{y^2}}}{{16}} = 1$.","$y = {x^2} + 2$.","${x^2} + {y^2} = 9$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Xác định phương trình đường tròn có tâm $A(2; - 1)$ và đi qua điểm $B(5;3)$.<a id=\"c7a\"></a>","main_question":"Xác định phương trình đường tròn có tâm $A(2; - 1)$ và đi qua điểm $B(5;3)$.<a id=\"c7a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["${(x - 2)^2} + {(y + 1)^2} = 5$.","${(x - 2)^2} + {(y + 1)^2} = 25$.","${(x + 2)^2} + {(y - 1)^2} = 25$.","${(x - 2)^2} + {(y + 1)^2} = 10$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Cho parabol có phương trình ${y^2} = 6x$. Tìm tọa độ tiêu điểm của parabol.<a id=\"c8a\"></a>","main_question":"Cho parabol có phương trình ${y^2} = 6x$. Tìm tọa độ tiêu điểm của parabol.<a id=\"c8a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$(1.5;0)$.","$(3;0)$.","$(2;0)$.","$(6;0)$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Một người có $4$ áo và $3$ quần. Hỏi có bao nhiêu cách chọn một bộ trang phục gồm $1$ áo và $1$ quần?<a id=\"c9a\"></a>","main_question":"Một người có $4$ áo và $3$ quần. Hỏi có bao nhiêu cách chọn một bộ trang phục gồm $1$ áo và $1$ quần?<a id=\"c9a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$7$.","$12$.","$16$.","$24$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Từ $6$ học sinh, chọn $3$ học sinh xếp thành một hàng. Hỏi có bao nhiêu cách xếp?<a id=\"c10a\"></a>","main_question":"Từ $6$ học sinh, chọn $3$ học sinh xếp thành một hàng. Hỏi có bao nhiêu cách xếp?<a id=\"c10a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$60$.","$120$.","$180$.","$720$."],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Khai triển ${(a + b)^6}$ có bao nhiêu số hạng?<a id=\"c11a\"></a>","main_question":"Khai triển ${(a + b)^6}$ có bao nhiêu số hạng?<a id=\"c11a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$5$","$6$","$7$","$8$"],"optionsImage":[],"correctAnswerIndex":0},{"type":"multiple-choice","question":"Trong khai triển của ${(2x + 1)^4} = 16{x^4} + 32{x^3} + 24{x^2} + 8x + 1$, tìm hệ số của số hạng chứa ${x^2}$.<a id=\"c12a\"></a>","main_question":"Trong khai triển của ${(2x + 1)^4} = 16{x^4} + 32{x^3} + 24{x^2} + 8x + 1$, tìm hệ số của số hạng chứa ${x^2}$.<a id=\"c12a\"></a>","questionImage":null,"explanation":null,"mappedType":"multiple-choice","options":["$24$","$32$","$16$","$81$"],"optionsImage":[],"correctAnswerIndex":0},{"type":"true-false","question":"Trong mặt phẳng $Oxy$, cho điểm $A(2;3)$, đường thẳng $d$ có phương trình $3x - y + 2 = 0$ và đường tròn $(C)$ có phương trình ${(x - 1)^2} + {(y - 2)^2} = 9$.","main_question":"Trong mặt phẳng $Oxy$, cho điểm $A(2;3)$, đường thẳng $d$ có phương trình $3x - y + 2 = 0$ và đường tròn $(C)$ có phương trình ${(x - 1)^2} + {(y - 2)^2} = 9$.","questionImage":null,"explanation":null,"mappedType":"true-false","statements":[{"statement":"Tâm và bán kính đường tròn $(C)$ là $I(1;2)$, $R = 3$.","is_correct":false},{"statement":"Một vector pháp tuyến của đường thẳng $d$ là $\\overrightarrow n = (1;3)$.","is_correct":false},{"statement":"Phương trình đường thẳng đi qua $A$ và song song với $d$ là $3x - y - 3 = 0$.","is_correct":false},{"statement":"Đường thẳng $d$ cắt đường tròn $(C)$ tại hai điểm.","is_correct":false}]},{"type":"true-false","question":"Trong một hộp có $4$ bi xanh, $3$ bi đỏ.","main_question":"Trong một hộp có $4$ bi xanh, $3$ bi đỏ.","questionImage":null,"explanation":null,"mappedType":"true-false","statements":[{"statement":"Số cách chọn $1$ bi từ hộp là $12$.","is_correct":false},{"statement":"Số phần tử của không gian mẫu khi lấy đồng thời $3$ bi là $210$.","is_correct":false},{"statement":"Số phần tử của biến cố $A$: \"Lấy được $3$ bi trong đó có đúng $2$ bi xanh\" là $18$.","is_correct":false},{"statement":"Xác suất của biến cố $A$ là $\\frac{{18}}{{35}}$.","is_correct":false}]},{"type":"short-answer","question":"Cho hàm số $f\\left(x \\right) = {x^2} - 2mx + m + 2$. Có bao nhiêu giá trị nguyên của $m$ để $f\\left(x \\right) \\geqslant 0$ với mọi $x \\in \\mathbb{R}$?","main_question":"Cho hàm số $f\\left(x \\right) = {x^2} - 2mx + m + 2$. Có bao nhiêu giá trị nguyên của $m$ để $f\\left(x \\right) \\geqslant 0$ với mọi $x \\in \\mathbb{R}$?","questionImage":null,"explanation":null,"mappedType":"short-answer","answer":"$4$"},{"type":"short-answer","question":"Tính số đo của góc giữa hai đường thẳng ${d_1}:2x - y + 3 = 0$ và ${d_2}:x + 3y - 1 = 0$ (<em>kềt quả làm tròn đơn vị độ đến hàng phần chục)</em>","main_question":"Tính số đo của góc giữa hai đường thẳng ${d_1}:2x - y + 3 = 0$ và ${d_2}:x + 3y - 1 = 0$ (<em>kềt quả làm tròn đơn vị độ đến hàng phần chục)</em>","questionImage":null,"explanation":null,"mappedType":"short-answer","answer":"${81,9^0}$"},{"type":"short-answer","question":"Từ $5$ chữ cái $A,B,C,D,E$, lập được bao nhiêu mật khảu có $3$ chữ cái khác nhau và phải chứa chữ $A$?","main_question":"Từ $5$ chữ cái $A,B,C,D,E$, lập được bao nhiêu mật khảu có $3$ chữ cái khác nhau và phải chứa chữ $A$?","questionImage":null,"explanation":null,"mappedType":"short-answer","answer":"$36$"},{"type":"short-answer","question":"Một hộp có $6$ bi trắng và $4$ bi đen. Lấy ngẫu nhiên $2$ bi. Tính xác suất để $2$ bi lấy được cùng màu <em>(kết quả làm tròn đến hàng phần trăm).</em>","main_question":"Một hộp có $6$ bi trắng và $4$ bi đen. Lấy ngẫu nhiên $2$ bi. Tính xác suất để $2$ bi lấy được cùng màu <em>(kết quả làm tròn đến hàng phần trăm).</em>","questionImage":null,"explanation":null,"mappedType":"short-answer","answer":"$0.47$"},{"type":"true-false","question":"(1 điểm)</strong> Cho tam thức bậc hai $f(x) = {x^2} + x - 6$.","main_question":"(1 điểm)</strong> Cho tam thức bậc hai $f(x) = {x^2} + x - 6$.","questionImage":null,"explanation":null,"mappedType":"true-false","statements":[{"statement":"Lập bảng xét dấu của $f(x)$.","is_correct":false},{"statement":"Tìm tập nghiệm của bất phương trình $f(x) < 0$.","is_correct":false},{"statement":"0.5 điểm","is_correct":false},{"statement":"$f(x) < 0 \\Leftrightarrow x \\in (- 3;2)$ 0.5 điểm","is_correct":false}]},{"type":"true-false","question":"(1 điểm) </strong>Viết phương trình tham số của đường thẳng đi qua hai điểm $A(1; - 2)$ và $B(3;4)$.","main_question":"(1 điểm) </strong>Viết phương trình tham số của đường thẳng đi qua hai điểm $A(1; - 2)$ và $B(3;4)$.","questionImage":null,"explanation":null,"mappedType":"true-false","statements":[]},{"type":"true-false","question":"(1 điểm)</strong> Một vật được ném lên từ độ cao $1\\;{\\text{m}}$ với vận tốc ban đầu $12\\;{\\text{m/s}}$. Chiều cao của vật theo thời gian $t$ (giây) được cho bởi $h(t) = - 5{t^2} + 12t + 1$. Tìm thời điểm vật chạm đất (kết quả làm tròn đến một chữ số thập phân).","main_question":"(1 điểm)</strong> Một vật được ném lên từ độ cao $1\\;{\\text{m}}$ với vận tốc ban đầu $12\\;{\\text{m/s}}$. Chiều cao của vật theo thời gian $t$ (giây) được cho bởi $h(t) = - 5{t^2} + 12t + 1$. Tìm thời điểm vật chạm đất (kết quả làm tròn đến một chữ số thập phân).","questionImage":null,"explanation":null,"mappedType":"true-false","statements":[]}];
            const quizOptions = {"timeLimit":45,"retriesAllowed":1,"showAnswers":true,"showExplanation":true,"scoring":{"mc":5,"sa":2,"essay":1,"tfMethod":"progressive"}};
            const googleScriptUrl = "https://script.google.com/macros/s/AKfycbw5NGADgGO4Kt7Tsyu66FCdSnc44uBXaxCZfPf0Tifl3-gG72TuDGlBUM7hKMKFNIXR/exec";
            const correctExamCode = "1CD05U";
            let studentInfo = {};
            let isSubmitted = false;
            let timerInterval;
            let retriesLeft = quizOptions.retriesAllowed;
            let currentAudio = null; // To manage audio playback
            let studentApiKey = "";
            let ai = null;

            function formatAndCleanLatex(text) {
                if (!text || typeof text !== 'string') return text;
                let formattedText = text.replace(/\[/g, '$').replace(/\]/g, '$');
                formattedText = formattedText.replace(/\$(.*?)\$/g, (match, content) => `$ ${content.trim()} $`);
                formattedText = formattedText.replace(/\$\$(.*?)\$\$/gs, (match, content) => `$$ ${content.trim()} $$`);
                return formattedText;
            }

            const studentQuizContainer = document.getElementById('student-quiz-container');
            const submitBtn = document.getElementById('submit-quiz-btn');
            const resultContainer = document.getElementById('result-container');
            const postSubmitOptions = document.getElementById('post-submit-options');
            const retryBtn = document.getElementById('retry-quiz-btn');
            const loginModal = document.getElementById('login-modal');
            const studentInfoForm = document.getElementById('student-info-form');
            const timerDisplay = document.getElementById('timer-display');
            const retriesDisplay = document.getElementById('retries-display');

            function shuffleQuestions() {
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});

                let shuffledQuizData = [];
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];

                partOrder.forEach(partType => {
                    if (grouped[partType]) {
                        const partQuestions = grouped[partType];
                        for (let i = partQuestions.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [partQuestions[i], partQuestions[j]] = [partQuestions[j], partQuestions[i]];
                        }
                        shuffledQuizData = shuffledQuizData.concat(partQuestions);
                    }
                });
                
                quizData = shuffledQuizData;
            }

            // --- Timer Function ---
            function startTimer(duration, display) {
                let timer = duration, minutes, seconds;
                clearInterval(timerInterval); // Clear any existing timer
                if(duration <= 0) {
                     display.textContent = "∞";
                     return;
                }
                timerInterval = setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);

                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    display.textContent = minutes + ":" + seconds;

                    if (--timer < 0) {
                        clearInterval(timerInterval);
                        alert("Hết giờ làm bài!");
                        handleSubmit();
                    }
                }, 1000);
            }

            // --- Gemini API Caller (for TTS) ---
            async function callGeminiAPI(payload, model = 'gemini-2.5-flash-preview-tts') {
                 if (!studentApiKey) {
                    alert("API Key không hợp lệ. Không thể thực hiện yêu cầu.");
                    return null;
                }
                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${studentApiKey}`;
                
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.json();
                        throw new Error(`API Error: ${errorBody.error?.message || response.status}`);
                    }
                    
                    const result = await response.json();
                    const candidate = result.candidates && result.candidates[0];

                    if (candidate && candidate.content && candidate.content.parts && candidate.content.parts[0]) {
                        return candidate.content.parts[0]; // Return the whole part
                    } else {
                         if (result.promptFeedback && result.promptFeedback.blockReason) {
                               throw new Error(`API call blocked: ${result.promptFeedback.blockReason}`);
                         }
                        return null;
                    }
                } catch (error) {
                    console.error("Lỗi khi gọi Gemini API:", error);
                    return null;
                }
            }
            
            // --- TTS Feature Functions ---
            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            }

            function pcmToWav(pcmData, sampleRate) {
                const numChannels = 1;
                const bytesPerSample = 2; // 16-bit
                const blockAlign = numChannels * bytesPerSample;
                const byteRate = sampleRate * blockAlign;
                const dataSize = pcmData.byteLength;
                const buffer = new ArrayBuffer(44 + dataSize);
                const view = new DataView(buffer);

                /* RIFF identifier */
                writeString(view, 0, 'RIFF');
                /* file length */
                view.setUint32(4, 36 + dataSize, true);
                /* RIFF type */
                writeString(view, 8, 'WAVE');
                /* format chunk identifier */
                writeString(view, 12, 'fmt ');
                /* format chunk length */
                view.setUint32(16, 16, true);
                /* sample format (raw) */
                view.setUint16(20, 1, true);
                /* channel count */
                view.setUint16(22, numChannels, true);
                /* sample rate */
                view.setUint32(24, sampleRate, true);
                /* byte rate (sample rate * block align) */
                view.setUint32(28, byteRate, true);
                /* block align (channel count * bytes per sample) */
                view.setUint16(32, blockAlign, true);
                /* bits per sample */
                view.setUint16(34, 16, true);
                /* data chunk identifier */
                writeString(view, 36, 'data');
                /* data chunk length */
                view.setUint32(40, dataSize, true);

                // Write PCM data
                const pcm16 = new Int16Array(pcmData);
                for (let i = 0; i < pcm16.length; i++) {
                    view.setInt16(44 + i * 2, pcm16[i], true);
                }

                function writeString(view, offset, string) {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                }

                return new Blob([view], { type: 'audio/wav' });
            }

            async function playTTS(text, button) {
                if (currentAudio && !currentAudio.paused) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                    document.querySelectorAll('.tts-btn.playing').forEach(b => b.classList.remove('playing'));
                    if (currentAudio.src.startsWith('blob:')) {
                        URL.revokeObjectURL(currentAudio.src);
                    }
                    if (currentAudio.dataset.text === text) {
                        currentAudio = null;
                        return; // Stop if the same button is clicked again
                    }
                }

                button.classList.add('playing');
                const originalIcon = button.innerHTML;
                button.innerHTML = '<div class="small-loader"></div>';
                button.disabled = true;

                try {
                    const payload = {
                        contents: [{ parts: [{ text: `Nói một cách rõ ràng, tự nhiên: ${text}` }] }],
                        generationConfig: { responseModalities: ["AUDIO"] },
                    };

                    const resultPart = await callGeminiAPI(payload, 'gemini-2.5-flash-preview-tts');

                    if (resultPart && resultPart.inlineData) {
                        const audioData = resultPart.inlineData.data;
                        const mimeType = resultPart.inlineData.mimeType;
                        const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                        const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 24000;

                        const pcmData = base64ToArrayBuffer(audioData);
                        const wavBlob = pcmToWav(pcmData, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);

                        currentAudio = new Audio(audioUrl);
                        currentAudio.dataset.text = text;
                        currentAudio.play();
                        currentAudio.onended = () => {
                            button.classList.remove('playing');
                            URL.revokeObjectURL(audioUrl);
                            currentAudio = null;
                        };
                    } else {
                        throw new Error("Không nhận được dữ liệu âm thanh.");
                    }
                } catch (error) {
                    console.error("Lỗi TTS:", error);
                    alert("Không thể phát âm thanh. Vui lòng thử lại.");
                     button.classList.remove('playing');
                } finally {
                    button.innerHTML = originalIcon;
                    button.disabled = false;
                }
            }

            function getTextForTTS(item) {
                let text = item.question || item.main_question || '';
                text = text.replace(/\$/g, ''); // Remove LaTeX delimiters for cleaner speech

                if (item.mappedType === 'multiple-choice' && item.options) {
                    const optionsText = item.options.map((opt, i) => `${String.fromCharCode(65 + i)}. ${opt}`).join(' ');
                    text += ' ' + optionsText.replace(/\$/g, '');
                } else if (item.mappedType === 'true-false' && item.statements) {
                    const statementsText = item.statements.map((s, i) => `${String.fromCharCode(97 + i)}. ${s.statement}`).join(' ');
                    text += ' ' + statementsText.replace(/\$/g, '');
                }
                return text;
            }

            function renderStudentQuiz() {
                studentQuizContainer.innerHTML = '';
                
                const groupedQuestions = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});

                const groupInfo = {
                    'multiple-choice': { title: 'PHẦN I. TRẮC NGHIỆM KHÁCH QUAN', subtitle: 'Chọn đáp án đúng nhất trong các lựa chọn sau.' },
                    'true-false': { title: 'PHẦN II. CÂU HỎI ĐÚNG - SAI', subtitle: 'Xác định tính đúng hoặc sai cho mỗi mệnh đề dưới đây.' },
                    'short-answer': { title: 'PHẦN III. CÂU HỎI TRẢ LỜI NGẮN', subtitle: 'Điền đáp án ngắn gọn vào phần trả lời.' },
                    'essay': { title: 'PHẦN IV. CÂU HỎI TỰ LUẬN', subtitle: 'Trình bày chi tiết bài giải của bạn.' }
                };
                
                let questionCounter = 0;
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];

                partOrder.forEach(partType => {
                    const questions = groupedQuestions[partType];
                    if (!questions || questions.length === 0) return;
                    
                    const info = groupInfo[partType];
                    let groupHTML = `<div class="group-container space-y-8 mb-12">`;
                    groupHTML += `
                        <div class="group-header pb-3 border-b-2 border-slate-300 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800">${info.title}</h2>
                            ${info.subtitle ? `<p class="text-md text-slate-600 italic mt-1">${info.subtitle}</p>` : ''}
                        </div>
                    `;

                    questions.forEach((item, localIndex) => {
                        const globalIndex = quizData.indexOf(item);
                        questionCounter++;
                        groupHTML += `<div class="question-card" id="student-q-${globalIndex}">`;
                        let questionText = formatAndCleanLatex(item.question || item.main_question || '').replace(/\n/g, '<br>');
                        
                        const textToSpeak = getTextForTTS(item);
                        
                        groupHTML += `<div class="flex items-start">
                                     <div class="flex-grow">
                                         <div class="flex items-center mb-2">
                                             <span class="font-bold text-lg mr-3 text-indigo-600">Câu ${questionCounter}:</span>
                                             <div id="q-${globalIndex}-feedback-icon"></div>
                                         </div>
                                         <div class="question-content mt-2 text-lg text-slate-700">${questionText}</div>
                                         ${item.questionImage ? `<img src="${item.questionImage}" class="mt-4 rounded-lg max-w-full md:max-w-md border shadow-sm">` : ''}
                                     </div>
                                     <button class="tts-btn ml-4 p-2 rounded-full text-gray-500 hover:text-indigo-600" data-text-to-speak="${textToSpeak.replace(/"/g, '&quot;')}">
                                         <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                             <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.858 5.858a3 3 0 014.243 0L12 7.757l1.9-1.9a3 3 0 014.242 0 3 3 0 010 4.242L12 16.242l-6.042-6.042a3 3 0 010-4.242z" />
                                         </svg>
                                     </button>
                                 </div>`;
                        
                        groupHTML += `<div class="mt-6">`;
                        switch(item.mappedType) {
                            case 'multiple-choice':
                                groupHTML += `<div class="options-grid grid grid-cols-1 md:grid-cols-2 gap-4">`;
                                item.options.forEach((opt, i) => {
                                    groupHTML += `<label for="q${globalIndex}-opt${i}" id="q${globalIndex}-opt-label${i}" class="option-label flex items-center p-4 border-2 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-400">
                                                 <input type="radio" name="q${globalIndex}" id="q${globalIndex}-opt${i}" value="${i}" class="mt-1 h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                                 <span class="font-semibold mx-3 text-slate-800">${String.fromCharCode(65 + i)}.</span>
                                                 <div class="flex-grow option-content text-slate-700">${formatAndCleanLatex(opt)}</div>
                                             </label>`;
                                });
                                groupHTML += `</div>`;
                                break;
                            case 'true-false':
                                 groupHTML += `<div class="space-y-4">`;
                                 item.statements.forEach((s, i) => {
                                     groupHTML += `<div class="statement-item border-t pt-4">
                                                  <p class="mb-3 text-slate-700">${String.fromCharCode(97 + i)}) ${formatAndCleanLatex(s.statement)}</p>
                                                  <div class="flex gap-x-6">
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="true" class="mr-2 h-4 w-4"> Đúng</label>
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="false" class="mr-2 h-4 w-4"> Sai</label>
                                                  </div>
                                              </div>`;
                                 });
                                 groupHTML += `</div>`;
                                 break;
                            case 'short-answer':
                                groupHTML += `<input type="text" name="q${globalIndex}" class="mt-1 block w-full md:w-1/2 border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Nhập đáp án của bạn...">`;
                                break;
                            case 'essay':
                                groupHTML += `<textarea name="q${globalIndex}" class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" rows="5" placeholder="Nhập câu trả lời tự luận của bạn..."></textarea>`;
                                break;
                        }
                        groupHTML += `</div><div id="q-${globalIndex}-feedback" class="mt-4"></div></div>`;
                    });
                    groupHTML += `</div>`;
                    studentQuizContainer.innerHTML += groupHTML;
                });
                

                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    MathJax.typesetPromise([studentQuizContainer]);
                }
                
                document.querySelectorAll('.tts-btn').forEach(btn => {
                    btn.addEventListener('click', () => playTTS(btn.dataset.textToSpeak, btn));
                });
            }

            async function generatePerformanceReview(allAnswersData) {
                const feedbackContainer = document.getElementById('ai-feedback-container');
                if (!feedbackContainer || !ai) return null;

                feedbackContainer.classList.remove('hidden');
                feedbackContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">📝 Phân Tích & Gợi Ý Từ Trợ Lý AI</h3>
                        <div id="ai-feedback-loader" class="text-center py-6">
                             <svg class="animate-spin mx-auto h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                             <p class="mt-3 text-slate-600">AI đang phân tích bài làm của bạn, vui lòng chờ trong giây lát...</p>
                        </div>
                        <div id="ai-feedback-content" class="hidden"></div>
                    </div>
                `;

                const incorrectAnswers = allAnswersData.filter(a => !a.isCorrect);

                if (incorrectAnswers.length === 0) {
                     feedbackContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                            <h3 class="text-xl font-bold text-green-600">🎉 Chúc mừng!</h3>
                            <p class="mt-2 text-slate-700">Bạn đã trả lời đúng tất cả các câu hỏi. Làm tốt lắm!</p>
                        </div>
                     `;
                    return { overallFeedback: { summary: "Xuất sắc! Học sinh đã trả lời đúng tất cả các câu hỏi.", strengths: "Trả lời đúng tất cả các câu hỏi.", areasForImprovement: "Không có." } };
                }

                 const prompt = `Bạn là một trợ lý giáo viên chuyên nghiệp và thân thiện, nói tiếng Việt. Nhiệm vụ của bạn là phân tích kết quả bài làm của một học sinh và đưa ra nhận xét mang tính xây dựng.
                
                Dưới đây là toàn bộ bài làm của học sinh, bao gồm các câu trả lời sai:
                ${JSON.stringify(incorrectAnswers, null, 2)}
                
                Dựa vào các lỗi sai này, hãy tạo một phản hồi. Lời văn phải khích lệ, rõ ràng, dễ hiểu.
                QUAN TRỌNG: Với các câu hỏi Đúng/Sai (type: 'true-false'), hãy chú ý vào trường 'details' để phân tích lỗi sai ở từng mệnh đề nhỏ.
                
                - 'summary': Tóm tắt năng lực của học sinh trong 1-2 câu ngắn gọn, súc tích để gửi cho giáo viên. Ví dụ: 'Nắm vững kiến thức cơ bản nhưng cần cải thiện kỹ năng tính toán.'
                - 'strengths': Nhận xét chi tiết về điểm mạnh, phần kiến thức học sinh đã nắm vững (suy luận từ các câu làm đúng, không có trong dữ liệu câu sai) để hiển thị cho học sinh.
                - 'areasForImprovement': Nhận xét chi tiết về những mảng kiến thức học sinh cần cải thiện dựa trên các câu sai để hiển thị cho học sinh.
                - 'studySuggestions': Gợi ý 2-3 chủ đề kiến thức cụ thể cần ôn tập lại, dựa trên bản chất của các câu hỏi sai.
                - 'errorAnalysis': Chỉ bao gồm các câu hỏi học sinh trả lời sai. Giải thích chi tiết từng bước tại sao đáp án đúng là đúng, và phân tích lỗi sai trong câu trả lời của học sinh. Lời giải phải rõ ràng, logic, và sử dụng LaTeX cho công thức toán nếu cần.`;
                
                const schema = {
                    type: Type.OBJECT,
                    properties: {
                        "overallFeedback": {
                            type: Type.OBJECT,
                            properties: {
                                "summary": { type: Type.STRING },
                                "strengths": { type: Type.STRING },
                                "areasForImprovement": { type: Type.STRING }
                            },
                            required: ["summary", "strengths", "areasForImprovement"]
                        },
                        "studySuggestions": {
                            type: Type.ARRAY,
                            items: { type: Type.STRING }
                        },
                        "errorAnalysis": {
                            type: Type.ARRAY,
                            items: {
                                type: Type.OBJECT,
                                properties: {
                                    "questionNumber": { type: Type.STRING },
                                    "explanation": { type: Type.STRING }
                                },
                                required: ["questionNumber", "explanation"]
                            }
                        }
                    },
                    required: ["overallFeedback", "studySuggestions", "errorAnalysis"]
                };

                try {
                    const response = await ai.models.generateContent({
                        model: "gemini-2.5-flash",
                        contents: prompt,
                        config: {
                            responseMimeType: "application/json",
                            responseSchema: schema
                        }
                    });

                    const resultText = response.text;
                    const feedbackData = JSON.parse(resultText);

                    const loader = document.getElementById('ai-feedback-loader');
                    const contentDiv = document.getElementById('ai-feedback-content');

                    let html = '';

                    // Overall Feedback
                    html += `
                        <div class="mb-6 space-y-4">
                            <div>
                                <h4 class="font-bold text-lg text-slate-700 mb-2">👍 Phần làm tốt</h4>
                                <p class="text-slate-600 bg-green-50 p-3 rounded-lg border border-green-200">${feedbackData.overallFeedback.strengths}</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-slate-700 mb-2">🤔 Phần cần cải thiện</h4>
                                <p class="text-slate-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200">${feedbackData.overallFeedback.areasForImprovement}</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-slate-700 mb-2">📚 Gợi ý ôn tập</h4>
                                <ul class="list-disc list-inside text-slate-600 bg-blue-50 p-3 rounded-lg border border-blue-200 space-y-1">
                                    ${feedbackData.studySuggestions.map(s => `<li>${s}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;

                    // Error Analysis
                    html += `<h4 class="font-bold text-lg text-slate-700 mb-3 pt-4 border-t">🔎 Sửa lỗi chi tiết</h4>`;
                    html += '<div class="space-y-4">';
                    feedbackData.errorAnalysis.forEach(analysis => {
                        const questionInfo = allAnswersData.find(q => q.questionNumber === analysis.questionNumber);
                        if (!questionInfo) return;
                        html += `
                            <details class="bg-slate-50 border rounded-lg overflow-hidden">
                                <summary class="font-semibold p-4 cursor-pointer hover:bg-slate-100 flex justify-between items-center">
                                    <span>Câu ${analysis.questionNumber}: Bạn chọn <span class="text-red-600">${questionInfo.yourAnswer}</span>, đáp án đúng là <span class="text-green-600">${questionInfo.correctAnswer}</span></span>
                                    <svg class="w-5 h-5 transition-transform transform details-arrow" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                                </summary>
                                <div class="p-4 border-t bg-white prose prose-sm max-w-none">
                                    ${formatAndCleanLatex(analysis.explanation).replace(/\n/g, '<br>')}
                                </div>
                            </details>
                        `;
                    });
                    html += '</div>';

                    contentDiv.innerHTML = html;
                    loader.classList.add('hidden');
                    contentDiv.classList.remove('hidden');

                    if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                        MathJax.typesetPromise([contentDiv]);
                    }
                    
                    return feedbackData;

                } catch (error) {
                    console.error("Error generating or rendering feedback:", error);
                    const feedbackContent = document.getElementById('ai-feedback-content');
                    if (feedbackContent) {
                        feedbackContent.innerHTML = `<p class="text-red-600">Xin lỗi, đã có lỗi xảy ra khi AI phân tích bài làm của bạn. Vui lòng thử lại sau.</p>`;
                        feedbackContent.classList.remove('hidden');
                        document.getElementById('ai-feedback-loader').classList.add('hidden');
                    }
                    return null;
                }
            }


            async function handleSubmit() {
                if (isSubmitted) return;
                isSubmitted = true;
                clearInterval(timerInterval);

                let totalStudentScore = 0;
                let totalCorrectAnswers = 0;
                let allAnswersData = [];

                const questionCounts = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    acc[type] = (acc[type] || 0) + 1;
                    return acc;
                }, {});

                // --- GRADING LOGIC ---
                quizData.forEach((item, index) => {
                    let questionNumber = index + 1;
                    let answerData = { questionNumber };

                    switch (item.mappedType) {
                        case 'multiple-choice':
                            const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                            const isCorrectMC = selectedOption ? parseInt(selectedOption.value) === item.correctAnswerIndex : false;
                            if (isCorrectMC) {
                                totalCorrectAnswers++;
                                if (questionCounts['multiple-choice'] > 0) {
                                   totalStudentScore += quizOptions.scoring.mc / questionCounts['multiple-choice'];
                                }
                            }
                            answerData.type = 'multiple-choice';
                            answerData.question = item.question;
                            answerData.options = item.options;
                            answerData.yourAnswer = selectedOption ? String.fromCharCode(65 + parseInt(selectedOption.value)) : "Không trả lời";
                            answerData.correctAnswer = String.fromCharCode(65 + item.correctAnswerIndex);
                            answerData.isCorrect = isCorrectMC;
                            break;

                        case 'true-false':
                            let correctStatementsCount = 0;
                            let yourAnswerPattern = [];
                            let correctAnswerPattern = [];
                            let details = [];

                            item.statements.forEach((s, i) => {
                                const selectedTF = document.querySelector(`input[name="q${index}-s${i}"]:checked`);
                                const studentChoice = selectedTF ? selectedTF.value === 'true' : null;
                                const isStatementCorrect = studentChoice === s.is_correct;
                                
                                if (isStatementCorrect) correctStatementsCount++;
                                
                                yourAnswerPattern.push(studentChoice === null ? '?' : (studentChoice ? 'Đ' : 'S'));
                                correctAnswerPattern.push(s.is_correct ? 'Đ' : 'S');
                                details.push({ statement: s.statement, yourChoice: studentChoice === null ? 'Không trả lời' : (studentChoice ? 'Đúng' : 'Sai'), correctChoice: s.is_correct ? 'Đúng' : 'Sai', isCorrect: isStatementCorrect });
                            });

                            let questionPoints = 0;
                            if (quizOptions.scoring.tfMethod === 'progressive') {
                                const progressivePoints = { 0: 0, 1: 0.1, 2: 0.25, 3: 0.5, 4: 1.0 };
                                questionPoints = progressivePoints[correctStatementsCount];
                            } else { // even
                                questionPoints = correctStatementsCount * 0.25;
                            }
                            totalStudentScore += questionPoints;
                            if(correctStatementsCount === 4) totalCorrectAnswers++;

                            answerData.type = 'true-false';
                            answerData.question = item.main_question;
                            answerData.yourAnswer = yourAnswerPattern.join('-');
                            answerData.correctAnswer = correctAnswerPattern.join('-');
                            answerData.isCorrect = correctStatementsCount === 4;
                            answerData.details = details;
                            break;
                        
                        case 'short-answer':
                            const saInput = document.querySelector(`input[name="q${index}"]`);
                            const saAnswer = saInput ? saInput.value.trim().toLowerCase() : "";
                            const isCorrectSA = saAnswer === item.answer.trim().toLowerCase();
                             if (isCorrectSA) {
                                totalCorrectAnswers++;
                                if (questionCounts['short-answer'] > 0) {
                                   totalStudentScore += quizOptions.scoring.sa / questionCounts['short-answer'];
                                }
                            }
                            answerData.type = 'short-answer';
                            answerData.question = item.question;
                            answerData.yourAnswer = saInput.value || "Không trả lời";
                            answerData.correctAnswer = item.answer;
                            answerData.isCorrect = isCorrectSA;
                            break;
                            
                        case 'essay':
                             const essayInput = document.querySelector(`textarea[name="q${index}"]`);
                             answerData.type = 'essay';
                             answerData.question = item.question;
                             answerData.yourAnswer = essayInput.value || "Không trả lời";
                             answerData.correctAnswer = item.answer;
                             answerData.isCorrect = null; // Needs manual grading
                             break;
                    }
                    allAnswersData.push(answerData);
                });

                // --- SCORE CALCULATION & DISPLAY ---
                // The teacher sets the points for each section. The final score is the sum of these points.
                // It is displayed on a 10-point scale, so we assume the teacher sets the total points to 10.
                const finalScore = totalStudentScore;
                const totalQuestions = quizData.length;


                // --- RENDER SUMMARY TABLE ---
                let summaryTableHTML = `
                <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                    <h3 class="text-xl font-bold text-slate-800 mb-4">🎯 TỔNG KẾT:</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-center text-slate-600">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-100 rounded-t-lg">
                                <tr>
                                    <th scope="col" class="px-4 py-3 font-semibold">Câu</th>
                                    <th scope="col" class="px-4 py-3 font-semibold">Đáp án của bạn</th>
                                    <th scope="col" class="px-4 py-3 font-semibold">Đáp án đúng</th>
                                    <th scope="col" class="px-4 py-3 font-semibold">Kết quả</th>
                                </tr>
                            </thead>
                            <tbody>`;
                
                allAnswersData.forEach(ans => {
                    summaryTableHTML += `
                        <tr class="bg-white border-b">
                            <td class="px-4 py-3 font-medium">${ans.questionNumber}</td>
                            <td class="px-4 py-3 ${ans.isCorrect ? '' : 'text-red-500 font-bold'}">${ans.yourAnswer}</td>
                            <td class="px-4 py-3">${ans.correctAnswer}</td>
                            <td class="px-4 py-3 flex justify-center">${ans.isCorrect === true ? 
                                '<svg class="w-6 h-6 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>' : 
                                (ans.isCorrect === false ? '<svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>' : '<span>-</span>')
                            }</td>
                        </tr>`;
                });

                summaryTableHTML += `
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 space-y-1 text-left">
                        <p class="font-semibold text-green-600">✅ Số câu đúng hoàn toàn: ${totalCorrectAnswers}/${totalQuestions}</p>
                         <p class="font-semibold text-blue-600">📊 Điểm (thang 10): ${finalScore.toFixed(2)}/10</p>
                         ${questionCounts['essay'] > 0 ? `<p class="text-sm text-gray-600 italic">Lưu ý: Điểm trên chưa bao gồm ${quizOptions.scoring.essay} điểm của phần Tự luận cần giáo viên chấm.</p>` : ''}
                    </div>
                </div>`;
                
                resultContainer.innerHTML = summaryTableHTML;
                resultContainer.classList.remove('hidden');

                // Wait for MathJax rendering to complete and add a small buffer time.
                // This prevents a race condition where the AI is called before the results table is fully rendered,
                // which can cause errors in data collection for the AI prompt.
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    await window.MathJax.typesetPromise([resultContainer]);
                }
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // 3. Call AI feedback generation if enabled and create assessment string
                let competencyAssessment = "Giáo viên không yêu cầu AI phân tích bài làm.";
                if (quizOptions.showAnswers && quizOptions.showExplanation) {
                    const feedbackData = await generatePerformanceReview(allAnswersData);
                    if (feedbackData && feedbackData.overallFeedback && feedbackData.overallFeedback.summary) {
                        competencyAssessment = feedbackData.overallFeedback.summary;
                    } else {
                        competencyAssessment = "Có lỗi xảy ra trong quá trình AI phân tích bài làm.";
                    }
                }

                // 4. Disable inputs, show post-submit options, and send data
                document.querySelectorAll('input, textarea').forEach(input => input.disabled = true);
                submitBtn.classList.add('hidden');
                postSubmitOptions.classList.remove('hidden');
                if (retriesLeft > 0) {
                    retryBtn.classList.remove('hidden');
                } else {
                    retryBtn.classList.add('hidden');
                }
                
                const formData = new FormData();
                formData.append('name', studentInfo.name);
                formData.append('class', studentInfo.class);
                formData.append('score', `${finalScore.toFixed(2)}/10`);
                formData.append('assessment', competencyAssessment);
                formData.append('timestamp', new Date().toLocaleString('vi-VN'));
                
                fetch(googleScriptUrl, { method: 'POST', body: formData})
                    .then(res => console.log("Successfully submitted to Google Sheet"))
                    .catch(err => console.error("Error submitting to Google Sheet:", err));
            }
            
            function startNewAttempt() {
                 isSubmitted = false;
                renderStudentQuiz();
                resultContainer.classList.add('hidden');
                document.getElementById('ai-feedback-container').classList.add('hidden');
                postSubmitOptions.classList.add('hidden');
                submitBtn.classList.remove('hidden');
                 if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                }
                retriesLeft--;
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                window.scrollTo(0, 0);
            }

            studentInfoForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const enteredCode = document.getElementById('exam-code').value.trim().toUpperCase();
                if (enteredCode !== correctExamCode) {
                    alert('Mã đề không chính xác. Vui lòng kiểm tra lại!');
                    return;
                }
                
                studentApiKey = document.getElementById('student-api-key').value.trim();
                if (!studentApiKey) {
                    alert('Vui lòng nhập Gemini API Key của bạn.');
                    return;
                }
        
                try {
                    ai = new GoogleGenAI({ apiKey: studentApiKey });
                } catch(e) {
                    console.error("Lỗi khởi tạo Gemini API với key của học sinh.", e);
                    alert("API Key không hợp lệ. Vui lòng kiểm tra lại. AI sẽ không thể phân tích bài làm.");
                    ai = null;
                }

                shuffleQuestions();
                
                studentInfo.name = document.getElementById('student-name').value;
                studentInfo.class = document.getElementById('student-class').value;
                loginModal.classList.add('hidden');
                studentQuizContainer.classList.remove('hidden');
                submitBtn.classList.remove('hidden');
                
                if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                } else {
                    timerDisplay.textContent = "Không giới hạn";
                }

                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;

                renderStudentQuiz();
            });

            // Attach the submit listener once.
            submitBtn.addEventListener('click', handleSubmit);

            retryBtn.addEventListener('click', () => {
                shuffleQuestions();
                startNewAttempt();
            });
        </script>
    </body>
    </html>
    