
    <!DOCTYPE html>
    <html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Bài Tập Luyện Tập</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
        <script>
            window.MathJax = {
                tex: {
                    packages: {'[+]': ['ams']},
                    inlineMath: [['$', '$'], ['\\(', '\\)']],
                    displayMath: [['$$', '$$'], ['\\[', '\\]']]
                },
                chtml: {
                    fontCache: 'global',
                    linebreaks: {
                        automatic: true
                    }
                }
            };
        </script>
        <script type="text/javascript" id="MathJax-script" async
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
        </script>
        <style>
            body { font-family: 'Be Vietnam Pro', sans-serif; background-color: #f0f4f8; }
            .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
            .question-card {
                background-color: white;
                border-radius: 1rem;
                padding: 1.5rem 2rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
                border-left: 5px solid transparent;
                transition: all 0.3s ease;
            }
            .ai-explanation {
                background-color: #f0f9ff;
                color: #0c4a6e;
                padding: 1rem;
                border-radius: 0.75rem;
                font-size: 0.9rem;
                margin-top: 1rem;
                border-left: 4px solid #38bdf8;
            }
            .feedback-icon { width: 1.5rem; height: 1.5rem; }
            .option-label {
                transition: all 0.2s ease-in-out;
                border: 2px solid #e5e7eb;
            }
            .option-label:hover {
                border-color: #6366f1;
                background-color: #eef2ff;
            }
            .option-label.correct {
                border-color: #10b981 !important;
                background-color: #ecfdf5 !important;
                color: #065f46;
            }
            .option-label.incorrect {
                border-color: #ef4444 !important;
                background-color: #fef2f2 !important;
                color: #991b1b;
            }
            .statement-item.correct { background-color: #ecfdf5; border-color: #10b981; }
            .statement-item.incorrect { background-color: #fef2f2; border-color: #ef4444; }
            .prose { max-width: 100%; }
            .prose h1, .prose h2, .prose h3 { font-weight: 600; }
            .prose p { margin-top: 0.5em; margin-bottom: 0.5em; }
            .prose ul, .prose ol { margin-top: 1em; margin-bottom: 1em; padding-left: 1.5em; }
            .prose li > p { margin-top: 0; margin-bottom: 0; }
            .prose code { background-color: #e5e7eb; padding: 0.2em 0.4em; margin: 0; font-size: 85%; border-radius: 3px; }
            .prose pre { background-color: #e5e7eb; padding: 1em; border-radius: 0.5em; overflow-x: auto; }
            .prose pre code { background-color: transparent; padding: 0; }
            details[open] > summary .details-arrow {
                transform: rotate(180deg);
            }
        </style>
    </head>
    <body class="bg-slate-100 text-slate-800">
        <div id="login-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md transform transition-all" style="animation: fadeIn 0.3s ease-out;">
                <h2 class="text-2xl font-bold mb-2 text-center text-slate-800">Thông Tin Học Sinh</h2>
                <p class="text-center text-slate-500 mb-6">Vui lòng nhập để bắt đầu làm bài.</p>
                <form id="student-info-form">
                    <div class="mb-4">
                        <label for="student-name" class="block text-sm font-medium text-slate-700 mb-1">Họ và tên</label>
                        <input type="text" id="student-name" required class="mt-1 block w-full block border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="student-class" class="block text-sm font-medium text-slate-700 mb-1">Lớp</label>
                        <input type="text" id="student-class" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label for="exam-code" class="block text-sm font-medium text-slate-700 mb-1">Mã đề</label>
                        <input type="text" id="exam-code" required class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:border-indigo-500 focus:ring-indigo-500" placeholder="Nhập mã đề giáo viên cung cấp">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-slate-700 mb-1">Giáo viên:</label>
                        <p class="mt-1 text-slate-800 bg-slate-100 p-2.5 rounded-lg">Trịnh Hữu Hoài An</p>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105">Bắt đầu làm bài</button>
                </form>
            </div>
        </div>
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="mb-10 p-8 rounded-xl bg-gradient-to-r from-blue-500 to-indigo-600 text-white shadow-lg">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 class="text-4xl font-bold">Bài Tập Luyện Tập</h1>
                        <p class="text-lg text-blue-100 mt-2">Hãy hoàn thành các câu hỏi dưới đây một cách tốt nhất!</p>
                        <p class="text-sm text-blue-200 mt-4">Tác giả: Trịnh Hữu Hoài An</p>
                    </div>
                    <div id="timer-container" class="text-right">
                         <div id="timer-display" class="text-3xl font-bold tracking-wider bg-white/20 px-4 py-2 rounded-lg">--:--</div>
                         <div id="retries-display" class="text-sm mt-1 text-blue-200"></div>
                    </div>
                </div>
            </header>
            <main id="student-quiz-container" class="space-y-8 hidden">
                <!-- Questions will be rendered here by JS -->
            </main>
            <footer class="mt-10 text-center">
                <button id="submit-quiz-btn" class="bg-indigo-600 text-white py-3 px-12 rounded-full font-bold text-lg hover:bg-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl hidden transform hover:scale-105">Nộp Bài</button>
                <div id="result-container" class="mt-6 hidden"></div>
                <div id="ai-feedback-container" class="mt-8 text-left hidden"></div>
                <div id="post-submit-options" class="hidden mt-6 flex flex-col sm:flex-row items-center justify-center gap-4">
                    <button id="retry-quiz-btn" class="w-full sm:w-auto bg-slate-600 text-white py-2.5 px-6 rounded-lg font-semibold hover:bg-slate-700 transition-transform transform hover:scale-105">Làm Lại Đề Này</button>
                </div>
            </footer>
        </div>

        <div id="proctoring-widget" class="fixed bottom-4 right-4 bg-yellow-100 text-yellow-800 p-3 rounded-lg shadow-lg text-sm z-50 hidden border border-yellow-300" style="max-width: 200px;">
            <h4 class="font-bold mb-2 border-b border-yellow-300 pb-1 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 3.001-1.742 3.001H4.42c-1.53 0-2.493-1.667-1.743-3.001l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                Giám sát
            </h4>
            <p>Thoát màn hình: <span id="tab-switch-count" class="font-bold">0</span></p>
            <p>Sao chép: <span id="copy-count" class="font-bold">0</span></p>
            <p>Dán: <span id="paste-count" class="font-bold">0</span></p>
        </div>

        <script type="module">
            import { GoogleGenAI, Type } from "https://esm.sh/@google/genai@^1.13.0";
            let quizData = [{"type":"multiple-choice","question":"Ai là người được ghi nhận đã phát minh ra máy tính cơ khí đầu tiên có khả năng thực hiện các phép tính cộng và trừ vào thế kỷ $17$?","questionImage":null,"mappedType":"multiple-choice","options":["Charles Babbage","Blaise Pascal","Alan Turing","John von Neumann"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Đặc điểm kĩ thuật nào sau đây là tiêu biểu cho thế hệ máy tính điện tử đầu tiên (khoảng những năm $1940$ - $1950$)?","questionImage":null,"mappedType":"multiple-choice","options":["Sử dụng bóng bán dẫn (transistor) làm linh kiện chính.","Kích thước nhỏ gọn, dễ dàng di chuyển.","Sử dụng các mạch tích hợp (IC) và vi xử lí.","Sử dụng bóng điện tử chân không (vacuum tubes) và có kích thước lớn."],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Đặc điểm nào sau đây KHÔNG PHẢI là một đặc điểm của thông tin số?","questionImage":null,"mappedType":"multiple-choice","options":["Đa dạng, được thu thập ngày càng nhanh và nhiều.","Có tính bản quyền và độ tin cậy rất khác nhau.","Luôn chính xác và đáng tin cậy 100%.","Được lưu trữ với dung lượng khổng lồ bởi nhiều tổ chức và cá nhân."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Tại sao việc khai thác các nguồn thông tin đáng tin cậy lại quan trọng trong môi trường số?","questionImage":null,"mappedType":"multiple-choice","options":["Để giảm chi phí sử dụng internet.","Để đảm bảo thông tin sử dụng là chính xác và có giá trị.","Để tăng tốc độ xử lí dữ liệu của máy tính.","Để hạn chế khả năng chia sẻ thông tin."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Công cụ nào sau đây thường được sử dụng để tìm kiếm thông tin trên môi trường số (Internet)?","questionImage":null,"mappedType":"multiple-choice","options":["Phần mềm soạn thảo văn bản","Trình duyệt web","Phần mềm bảng tính","Phần mềm trình chiếu"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Lợi ích chính của việc sử dụng các công cụ tìm kiếm thông tin số là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Làm cho thông tin trở nên khó tiếp cận hơn","Hạn chế khả năng trao đổi thông tin","Giúp người dùng đưa ra các quyết định sáng suốt hơn","Gây lãng phí thời gian và tài nguyên"],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Hành vi nào sau đây được xem là vi phạm quyền riêng tư của người khác?","questionImage":null,"mappedType":"multiple-choice","options":["Đặt mật khẩu mạnh cho tài khoản trực tuyến của mình.","Công khai số điện thoại cá nhân của người khác mà không có sự đồng ý của họ.","Chia sẻ thông tin cá nhân của bản thân trên mạng xã hội.","Báo cáo các bài viết có nội dung xấu hoặc xúc phạm người khác."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Để thể hiện sự tôn trọng bản quyền tác giả khi sử dụng tài liệu, hình ảnh từ các nguồn khác trên môi trường số, em cần làm gì?","questionImage":null,"mappedType":"multiple-choice","options":["Sao chép và đăng tải lại toàn bộ tài liệu mà không cần ghi rõ nguồn gốc.","Chỉ cần thay đổi một vài chi tiết nhỏ trong tài liệu để tránh bị phát hiện vi phạm.","Ghi rõ nguồn gốc và tác giả của tài liệu, hình ảnh đã sử dụng.","Sử dụng thoải mái bất kỳ tài liệu, hình ảnh nào vì tất cả thông tin trên mạng internet đều miễn phí."],"optionsImage":[],"correctAnswerIndex":2},{"type":"true-false","main_question":"Các nhận định sau về lịch sử phát triển công cụ tính toán là đúng hay sai?","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Bàn tính cổ (Abacus) là một công cụ tính toán thủ công được sử dụng rộng rãi, chủ yếu để thực hiện phép cộng và trừ.","is_correct":true},{"statement":"Máy tính cơ khí của Blaise Pascal, được phát minh vào thế kỉ $17$, đã có khả năng thực hiện tự động cả bốn phép tính số học cơ bản: cộng, trừ, nhân, chia.","is_correct":false},{"statement":"Charles Babbage được mệnh danh là \"cha đẻ của máy tính\" do những ý tưởng tiên phong về một cỗ máy có khả năng lập trình, sử dụng thẻ đục lỗ để nhập dữ liệu và lệnh, mà ông đã phát triển trong thiết kế Động cơ Phân tích (Analytical Engine).","is_correct":true},{"statement":"Sự ra đời của máy tính điện tử ENIAC vào những năm $1940$ đã sử dụng công nghệ vi mạch tích hợp (IC) làm linh kiện chính, giúp thu nhỏ kích thước và tăng tốc độ xử lí đáng kể so với các máy tính cơ khí trước đó.","is_correct":false}]},{"type":"true-false","main_question":"Đánh giá các phát biểu sau về đặc điểm của thông tin trong môi trường số.","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Thông tin số có thể được biểu diễn dưới nhiều dạng khác nhau như văn bản, hình ảnh, âm thanh và video.","is_correct":true},{"statement":"Quá trình thu thập và lưu trữ thông tin số diễn ra ngày càng nhanh chóng với dung lượng khổng lồ.","is_correct":true},{"statement":"Thông tin số luôn đảm bảo độ tin cậy tuyệt đối vì được tạo ra và xử lí bằng công nghệ hiện đại.","is_correct":false},{"statement":"Mặc dù có tính bản quyền, nhưng thông tin số rất khó bị sao chép và chia sẻ mà không có sự cho phép.","is_correct":false}]},{"type":"true-false","main_question":"Trong quá trình thực hành khai thác thông tin số, hãy đánh giá tính đúng hay sai của các phát biểu sau:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Người dùng có thể sử dụng các công cụ tìm kiếm như Google, Bing để tìm kiếm thông tin trên Internet.","is_correct":true},{"statement":"Mọi thông tin tìm được trên Internet đều đã được kiểm duyệt và có độ tin cậy tuyệt đối.","is_correct":false},{"statement":"Việc lọc, sắp xếp và tóm tắt thông tin là một phần của quá trình xử lí thông tin số.","is_correct":true},{"statement":"Công cụ tìm kiếm chủ yếu được dùng để trao đổi thông tin giữa các cá nhân.","is_correct":false}]},{"type":"true-false","main_question":"Đánh giá các phát biểu sau đây về quyền riêng tư và bản quyền trong môi trường số hóa là Đúng hay Sai:","questionImage":null,"mappedType":"true-false","statements":[{"statement":"Chỉ những thông tin cá nhân như tên, tuổi, địa chỉ nhà mới cần được bảo vệ trên môi trường số; các thông tin khác như số điện thoại, email, thói quen truy cập thì không cần.","is_correct":false},{"statement":"Việc sao chép nguyên văn một đoạn văn từ trang web khác và đưa vào bài làm của mình mà không trích dẫn nguồn sẽ bị coi là đạo văn, dù chỉ là một phần nhỏ.","is_correct":true},{"statement":"Nếu một bức ảnh được đăng công khai trên mạng xã hội, bất kỳ ai cũng có quyền tải về và sử dụng cho mục đích thương mại mà không cần xin phép.","is_correct":false},{"statement":"Các chính sách bảo mật và điều khoản dịch vụ của một ứng dụng di động thường chứa các điều khoản về việc sử dụng dữ liệu cá nhân của người dùng, và việc chấp nhận chúng ngụ ý đồng ý cho ứng dụng thu thập một số thông tin, ngay cả khi người dùng không đọc kĩ.","is_correct":true}]},{"type":"short-answer","question":"Trong lịch sử phát triển máy tính, công cụ tính toán cơ khí nào được biết đến với khả năng thực hiện phép cộng và trừ một cách tự động vào thế kỷ $17$?","questionImage":null,"mappedType":"short-answer","answer":"**Máy tính Pascal** (hoặc **Pascaline**)."},{"type":"short-answer","question":"Hãy nêu hai đặc điểm của thông tin số.","questionImage":null,"mappedType":"short-answer","answer":"Hai đặc điểm của thông tin số là:1. Thông tin số **đa dạng** về loại hình (văn bản, hình ảnh, âm thanh, video,...).2. Thông tin số có **độ tin cậy rất khác nhau** tùy thuộc vào nguồn cung cấp."},{"type":"short-answer","question":"Em hãy nêu tên một công cụ tìm kiếm thông tin phổ biến trên Internet mà em biết.","questionImage":null,"mappedType":"short-answer","answer":"Một công cụ tìm kiếm thông tin phổ biến trên Internet là **Google Search**."},{"type":"short-answer","question":"Em hãy nêu một ví dụ về hành vi vi phạm quyền riêng tư khi sử dụng công nghệ số.","questionImage":null,"mappedType":"short-answer","answer":"Một ví dụ về hành vi vi phạm quyền riêng tư khi sử dụng công nghệ số là **thu âm, quay phim, chụp ảnh người khác khi chưa được sự đồng ý của họ**."},{"type":"multiple-choice","question":"Sự ra đời của máy tính điện tử đã mang lại thay đổi lớn lao nào cho xã hội loài người?","questionImage":null,"mappedType":"multiple-choice","options":["Cho phép con người thực hiện các phép tính thủ công nhanh hơn.","Đánh dấu sự khởi đầu của Thời đại Đồ đá mới.","Tự động hóa quá trình xử lí thông tin, tăng tốc độ và độ chính xác, từ đó thúc đẩy phát triển nhiều ngành khoa học, kinh tế.","Dẫn đến việc phát minh ra các công cụ nông nghiệp hiện đại."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Phát biểu nào sau đây thể hiện đúng một đặc điểm của thông tin số?","questionImage":null,"mappedType":"multiple-choice","options":["Thông tin số luôn có độ tin cậy cao và ổn định.","Thông tin số chỉ có thể được lưu trữ với dung lượng nhỏ.","Thông tin số có thể dễ dàng tìm kiếm, chuyển đổi và truyền tải hiệu quả.","Thông tin số ít khi bị sao chép hoặc tái sử dụng do có tính bản quyền."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"Khi tìm kiếm thông tin trên Internet để giải quyết một vấn đề hoặc thực hiện nhiệm vụ học tập, việc đánh giá độ tin cậy của thông tin có ý nghĩa quan trọng nhất là gì?","questionImage":null,"mappedType":"multiple-choice","options":["Giúp bạn tìm được nhiều thông tin hơn trong thời gian ngắn.","Đảm bảo thông tin được sử dụng là chính xác, phù hợp và hữu ích cho việc giải quyết vấn đề.","Làm cho quá trình tìm kiếm thông tin trở nên thú vị hơn.","Giảm dung lượng dữ liệu Internet tiêu thụ khi tìm kiếm."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"An, bạn học cùng lớp, bí mật quay lại một đoạn video bạn đang biểu diễn văn nghệ ở trường và đăng lên mạng xã hội mà không hỏi ý kiến bạn. Hành vi của An đã vi phạm quyền nào của bạn?","questionImage":null,"mappedType":"multiple-choice","options":["Quyền được học tập","Quyền riêng tư về hình ảnh","Quyền tự do ngôn luận","Quyền được vui chơi giải trí"],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Cuối thế kỉ $20$, sự xuất hiện và phổ biến của máy tính cá nhân ($PC$) đã tạo ra những thay đổi lớn lao, đưa công nghệ máy tính đến gần hơn với mọi người. Nếu không có sự phát triển và phổ biến rộng rãi của máy tính cá nhân, xu hướng nào dưới đây sẽ khó có thể phát triển mạnh mẽ và làm thay đổi sâu sắc đời sống xã hội như chúng ta thấy hiện nay?","questionImage":null,"mappedType":"multiple-choice","options":["Sự ra đời của các siêu máy tính phục vụ dự báo thời tiết và nghiên cứu vũ trụ.","Việc ứng dụng robot trong các dây chuyền sản xuất công nghiệp.","Sự phát triển bùng nổ của Internet, mạng xã hội và thương mại điện tử.","Phát minh ra bộ vi xử lí ($microprocessor$) làm nền tảng cho các thiết bị điện tử."],"optionsImage":[],"correctAnswerIndex":2},{"type":"multiple-choice","question":"An đang thực hiện dự án nghiên cứu về biến đổi khí hậu. Trong quá trình tìm kiếm thông tin trên mạng Internet, An tìm thấy một báo cáo khoa học từ một trường đại học uy tín, một bài đăng trên blog cá nhân của một người dùng không rõ danh tính và một bài báo từ cơ quan truyền thông chính thống. Để đảm bảo thông tin sử dụng trong dự án là chính xác và có giá trị, đặc điểm nào sau đây của thông tin số là quan trọng nhất mà An cần xem xét khi lựa chọn nguồn tài liệu?","questionImage":null,"mappedType":"multiple-choice","options":["Thông tin số có thể được thu thập ngày càng nhanh và nhiều.","Thông tin số được lưu trữ với dung lượng khổng lồ bởi nhiều tổ chức và cá nhân.","Thông tin số có thể được truyền đi và xử lí hiệu quả bằng nhiều công cụ.","Thông tin số có độ tin cậy rất khác nhau."],"optionsImage":[],"correctAnswerIndex":3},{"type":"multiple-choice","question":"Bạn An đang thực hiện dự án môn Tin học về chủ đề \"Tác động của ô nhiễm không khí đến sức khỏe con người\". An đã tìm kiếm trên internet và thu được nhiều kết quả. Để đảm bảo thông tin thu thập được vừa đáng tin cậy, vừa đầy đủ và phù hợp để giải quyết vấn đề của dự án, An nên ưu tiên hành động nào sau đây?","questionImage":null,"mappedType":"multiple-choice","options":["Chỉ đọc các bài viết đầu tiên xuất hiện trên trang kết quả tìm kiếm mà không kiểm tra nguồn gốc.","Tìm kiếm thông tin từ nhiều nguồn khác nhau như các trang web của tổ chức y tế uy tín (ví dụ: WHO, Bộ Y tế), các bài báo khoa học đã được kiểm duyệt, và sau đó so sánh, đối chiếu thông tin.","Sao chép toàn bộ nội dung từ một trang web bất kỳ có nội dung liên quan để tiết kiệm thời gian cho dự án.","Chỉ sử dụng thông tin từ các mạng xã hội hoặc diễn đàn trực tuyến vì chúng có tính cập nhật cao và dễ đọc."],"optionsImage":[],"correctAnswerIndex":1},{"type":"multiple-choice","question":"Bạn Nam đang thực hiện một dự án học tập về lịch sử địa phương dưới dạng một website tin tức. Để minh họa cho bài viết của mình, Nam muốn sử dụng một số hình ảnh cũ về làng quê từ các trang báo điện tử và một đoạn video phỏng vấn người dân địa phương do một đài truyền hình thực hiện. Nam cần làm gì để đảm bảo tuân thủ các quy định về bản quyền và quyền riêng tư khi đưa các tư liệu này vào sản phẩm của mình?","questionImage":null,"mappedType":"multiple-choice","options":["Chỉ cần tìm kiếm và tải về các hình ảnh, video có độ phân giải cao, sau đó đăng tải lên website của mình mà không cần ghi nguồn, vì đó là tài liệu công cộng.","Ghi chung chung \"Nguồn ảnh và video: Từ internet\" ở cuối mỗi bài viết để thể hiện sự tôn trọng.","Tìm kiếm thông tin bản quyền của từng hình ảnh, video; nếu có thể, liên hệ xin phép tác giả hoặc đơn vị chủ quản; luôn ghi rõ nguồn gốc (tên tác giả/đơn vị, tên tác phẩm nếu có, đường dẫn gốc) cho từng tư liệu đã sử dụng.","Chỉ sử dụng hình ảnh và video do chính Nam tự chụp hoặc quay, để tránh mọi vấn đề liên quan đến bản quyền."],"optionsImage":[],"correctAnswerIndex":2},{"type":"essay","question":"Hãy trình bày sơ lược các giai đoạn chính trong lịch sử phát triển của công cụ tính toán. Lấy một ví dụ cụ thể về một phát minh quan trọng trong lịch sử máy tính và giải thích cách phát minh đó đã đem đến những thay đổi lớn lao cho xã hội loài người.","questionImage":null,"mappedType":"essay","answer":"Lịch sử phát triển của công cụ tính toán có thể chia thành các giai đoạn chính sau:1.  **Giai đoạn tiền cơ khí (trước thế kỷ $17$):** Các công cụ tính toán thủ công đơn giản như **bàn tính (Abacus)**, que Napier.2.  **Giai đoạn cơ khí (thế kỷ $17$ đến đầu thế kỷ $20$):** Phát minh các máy tính cơ khí đầu tiên. Nổi bật là **máy Pascaline** của Blaise Pascal (năm $1642$) có thể thực hiện phép cộng, trừ; và máy của Gottfried Leibniz có thể thực hiện thêm phép nhân, chia. Đến thế kỷ $19$, Charles Babbage đã đưa ra ý tưởng về **máy Analytical Engine**, được coi là tiền thân của máy tính hiện đại với khả năng lập trình.3.  **Giai đoạn cơ điện (đầu thế kỷ $20$):** Sử dụng các linh kiện điện cơ như rơ-le. Ví dụ: máy **Hollerith Tabulating Machine** dùng cho việc thống kê dân số Mỹ.4.  **Giai đoạn điện tử (từ giữa thế kỷ $20$ đến nay):**  Đây là giai đoạn phát triển bùng nổ của máy tính với các thế hệ:    *   **Thế hệ 1 (những năm $1940$ - $1950$):** Sử dụng **bóng điện tử chân không** làm linh kiện chính (ví dụ: ENIAC, UNIVAC). Máy tính rất lớn, tiêu thụ nhiều điện năng và sinh nhiệt.    *   **Thế hệ 2 (cuối $1950$ - giữa $1960$):** Sử dụng **transistor** thay thế bóng điện tử chân không. Máy tính nhỏ hơn, nhanh hơn và tin cậy hơn.    *   **Thế hệ 3 (giữa $1960$ - giữa $1970$):** Phát triển **mạch tích hợp (IC - Integrated Circuit)**, cho phép tích hợp hàng trăm transistor lên một chip silicon nhỏ.    *   **Thế hệ 4 (giữa $1970$ - nay):** Phát minh **vi xử lí (Microprocessor)**, tích hợp toàn bộ các bộ phận xử lí trung tâm lên một chip duy nhất. Kỉ nguyên của **máy tính cá nhân (PC)** và **Internet** ra đời.    *   **Thế hệ 5 (tương lai):** Tập trung vào trí tuệ nhân tạo, xử lí song song, mạng nơ-ron.Ví dụ về một phát minh quan trọng và tác động của nó:Phát minh **máy tính cá nhân (Personal Computer - PC)** và sự phát triển của **Internet** vào cuối thế kỷ $20$ đã đem đến những thay đổi lớn lao cho xã hội loài người.    *   **Thay đổi cách làm việc:** Cho phép làm việc từ xa, tự động hóa nhiều công việc văn phòng, tăng năng suất lao động.    *   **Thay đổi cách học tập:** Mở ra kỉ nguyên học trực tuyến, truy cập kho tàng kiến thức khổng lồ trên mạng, cá nhân hóa lộ trình học.    *   **Thay đổi cách giao tiếp:** Tạo ra các hình thức giao tiếp mới như email, mạng xã hội, tin nhắn tức thời, kết nối mọi người trên toàn cầu.    *   **Thay đổi kinh tế - xã hội:** Thúc đẩy thương mại điện tử, phát triển các ngành công nghiệp mới (phần mềm, dịch vụ trực tuyến), tạo ra việc làm mới, đồng thời đặt ra những thách thức về bảo mật thông tin và đạo đức số."},{"type":"essay","question":"Thông tin số có nhiều đặc điểm nổi bật và khác biệt so với thông tin truyền thống. Em hãy trình bày ít nhất $3$ đặc điểm của thông tin số. Từ đó, hãy giải thích tầm quan trọng của việc khai thác các nguồn thông tin đáng tin cậy trong môi trường số và cho ví dụ minh họa.","questionImage":null,"mappedType":"essay","answer":"**1. Các đặc điểm của thông tin số:** Học sinh có thể nêu ít nhất $3$ trong các đặc điểm sau:<ul><li>**Đa dạng:** Tồn tại dưới nhiều định dạng (văn bản, hình ảnh, âm thanh, video, ...).</li><li>**Thu thập ngày càng nhanh và nhiều:** Dễ dàng tạo ra, sao chép và chia sẻ với tốc độ cao.</li><li>**Lưu trữ với dung lượng khổng lồ:** Có thể được lưu trữ trên nhiều thiết bị và hệ thống (đám mây, ổ cứng, máy chủ, ...).</li><li>**Có tính bản quyền:** Được bảo vệ bởi luật pháp và quy định về sở hữu trí tuệ.</li><li>**Độ tin cậy rất khác nhau:** Bao gồm từ thông tin chính thống, đáng tin cậy đến tin giả, thông tin sai lệch.</li><li>**Có các công cụ tìm kiếm, chuyển đổi, truyền và xử lí hiệu quả.**</li></ul>**2. Tầm quan trọng của việc khai thác các nguồn thông tin đáng tin cậy:**<ul><li>Đảm bảo thông tin chúng ta tiếp cận là **chính xác**, **khách quan** và **đầy đủ**.</li><li>Giúp người dùng **đưa ra quyết định đúng đắn**, tránh những thông tin sai lệch có thể gây hại cho bản thân hoặc người khác.</li><li>Nâng cao **kiến thức**, **hiểu biết** và khả năng **tư duy phản biện** của mỗi cá nhân.</li><li>Bảo vệ người dùng khỏi **tin giả**, **lừa đảo** và các nguy cơ khác trên môi trường số.</li></ul>**3. Ví dụ minh họa:**<ul><li>Khi tìm kiếm thông tin về sức khỏe hoặc dịch bệnh, chúng ta nên tham khảo các trang web chính thức của Bộ Y tế, Tổ chức Y tế Thế giới (WHO) thay vì tin vào các bài viết không kiểm chứng trên mạng xã hội.</li><li>Khi tìm tài liệu học tập để làm bài tập hoặc nghiên cứu, nên ưu tiên sách giáo khoa điện tử, cổng thông tin giáo dục chính thức của Bộ Giáo dục và Đào tạo hoặc các thư viện số uy tín (như thư viện trường học, thư viện quốc gia).</li></ul>"},{"type":"essay","question":"Trong môn Lịch sử, em được giao nhiệm vụ tìm hiểu về một sự kiện lịch sử quan trọng của Việt Nam: **Chiến dịch Điện Biên Phủ (năm $1954$)**. Em hãy trình bày các bước em sẽ thực hiện để khai thác thông tin số trên Internet nhằm hoàn thành nhiệm vụ này. Cụ thể, em cần nêu rõ:","questionImage":null,"mappedType":"essay","answer":"Gợi ý trả lời:\n**1. Cách sử dụng công cụ tìm kiếm để thu thập thông tin:**\n*   **Xác định từ khóa:** Sử dụng các từ khóa cụ thể và đa dạng như \"Chiến dịch Điện Biên Phủ $1954$\", \"Diễn biến Điện Biên Phủ\", \"Ý nghĩa Điện Biên Phủ\", \"Anh hùng Điện Biên Phủ\" để tìm kiếm trên Google, Cốc Cốc hoặc các công cụ tìm kiếm khác.\n*   **Chọn lọc kết quả:** Ưu tiên các trang web đáng tin cậy như các trang của Bộ Giáo dục và Đào tạo, các báo lớn (VnExpress, VietnamNet, Nhân Dân), các trang bách khoa toàn thư uy tín (Wikipedia - cần đối chiếu thông tin), hoặc các thư viện số.\n*   **Sử dụng bộ lọc tìm kiếm:** Tùy chọn tìm kiếm nâng cao (tìm kiếm theo định dạng tệp .pdf, .doc, tìm kiếm hình ảnh, video) để có được các tài liệu đa dạng hơn.\n\n**2. Cách xử lý và sắp xếp thông tin đã tìm được:**\n*   **Đọc và tóm tắt:** Đọc lướt các nguồn thông tin để nắm ý chính, sau đó đọc kỹ hơn các đoạn liên quan đến chủ đề.\n*   **Ghi chú và tổng hợp:** Ghi lại các thông tin quan trọng (thời gian, địa điểm, nhân vật, diễn biến chính, kết quả, ý nghĩa) vào sổ tay hoặc tệp văn bản. Sắp xếp thông tin theo các đề mục (mở đầu, diễn biến, kết quả, ý nghĩa, nhân vật).\n*   **Kiểm tra chéo thông tin:** So sánh thông tin từ nhiều nguồn khác nhau để đảm bảo tính chính xác và khách quan. Loại bỏ các thông tin sai lệch hoặc không có căn cứ.\n*   **Lưu trữ khoa học:** Tạo thư mục riêng trên máy tính (hoặc trên Google Drive) để lưu trữ các tài liệu, hình ảnh, video đã tìm được theo chủ đề, giúp dễ dàng truy cập và sử dụng sau này.\n\n**3. Cách trao đổi thông tin với bạn bè hoặc thầy cô để hoàn thiện bài tập:**\n*   **Thảo luận nhóm:** Chia sẻ thông tin với bạn bè qua các công cụ trực tuyến (Google Meet, Zoom, Zalo) hoặc trực tiếp. Trao đổi về những thông tin chưa rõ, cùng nhau phân tích và đưa ra kết luận.\n*   **Hỏi ý kiến thầy cô:** Gửi email hoặc trao đổi trực tiếp với thầy cô về những vướng mắc, những thông tin còn nghi ngờ để được giải đáp và định hướng chính xác.\n*   **Sử dụng diễn đàn/nhóm học tập:** Tham gia các nhóm học tập trực tuyến để đặt câu hỏi, chia sẻ tài liệu và học hỏi từ các bạn khác.\n\n**4. Lợi ích của việc khai thác thông tin hiệu quả từ Internet:**\n*   **Tiết kiệm thời gian và công sức:** Dễ dàng tìm kiếm được lượng lớn thông tin trong thời gian ngắn mà không cần đến thư viện vật lý.\n*   **Nguồn tài liệu đa dạng:** Có thể tiếp cận nhiều loại hình thông tin (văn bản, hình ảnh, video, âm thanh) từ nhiều nguồn khác nhau, giúp bài tập phong phú và sinh động hơn.\n*   **Nâng cao kiến thức và kỹ năng:** Giúp em hiểu sâu sắc hơn về chủ đề, đồng thời rèn luyện kỹ năng tìm kiếm, đánh giá và xử lý thông tin, kỹ năng làm việc nhóm và giao tiếp trong môi trường số.\n*   **Phát triển tư duy phản biện:** Học cách phân biệt thông tin đúng - sai, chính xác - không chính xác, từ đó hình thành tư duy phản biện và khả năng tự học.\n*   **Chủ động trong học tập:** Tự mình tìm kiếm, khám phá kiến thức, không phụ thuộc hoàn toàn vào sách giáo khoa hoặc bài giảng của thầy cô, giúp việc học trở nên hứng thú và hiệu quả hơn."},{"type":"essay","question":"Bạn An thấy bạn mình chia sẻ một bức ảnh chụp lén một thầy giáo đang ngủ gật trong giờ giải lao lên mạng xã hội kèm theo những bình luận không hay. An nhận thấy hành vi này là sai. Hãy giải thích tại sao hành vi của bạn An là vi phạm quyền riêng tư và thiếu văn hóa khi sử dụng công nghệ số. Theo em, An và những người khác nên làm gì để đảm bảo sự tôn trọng quyền riêng tư và thể hiện văn hóa số khi gặp tình huống tương tự?","questionImage":null,"mappedType":"essay","answer":"1.  **Giải thích hành vi vi phạm:** Hành vi của bạn An là vi phạm quyền riêng tư vì đã thu thập (chụp ảnh) và phát tán (chia sẻ lên mạng xã hội) hình ảnh cá nhân của người khác mà không có sự cho phép. Thầy giáo có quyền kiểm soát hình ảnh của mình và quyết định việc hình ảnh đó có được công khai hay không. Việc chụp lén và chia sẻ không chỉ vi phạm quyền riêng tư mà còn thể hiện sự thiếu tôn trọng, thiếu văn hóa số. Các bình luận không hay còn gây tổn hại đến danh dự, uy tín của thầy giáo, có thể dẫn đến **phạm pháp luật** (như tội phỉ báng, xúc phạm danh dự người khác).<br>2.  **Cách hành xử đúng đắn:**<br>    *   **Đối với An:** An nên báo cáo bài viết vi phạm lên quản trị viên của mạng xã hội để bài viết bị gỡ bỏ, đồng thời nhắc nhở bạn mình về hành vi sai trái và yêu cầu bạn gỡ bài viết đó. An cũng có thể trực tiếp góp ý với bạn về việc tôn trọng quyền riêng tư và văn hóa ứng xử trên không gian mạng.<br>    *   **Đối với người khác:** Mọi người không nên bấm \"Thích\" (Like), chia sẻ (Share) hoặc bình luận tiêu cực vào những bài viết tương tự. Thay vào đó, cần **lên án** hành vi sai trái, **báo cáo** nội dung vi phạm và **bảo vệ** quyền riêng tư của người khác. Mỗi cá nhân cần luôn ý thức về **trách nhiệm** và **đạo đức** khi sử dụng công nghệ số, đảm bảo rằng mọi nội dung mình tạo ra hoặc chia sẻ đều tuân thủ pháp luật và thể hiện sự tôn trọng."}];
            const quizOptions = {"timeLimit":45,"retriesAllowed":1,"showAnswers":true,"showExplanation":true,"aiAssessment":true,"scoring":{"mc":5,"tf":2,"sa":2,"essay":1,"tfMethod":"progressive"}};
            const googleScriptUrl = "https://script.google.com/macros/s/AKfycbzjr9BOqH6Xz0Q6l87BzZMEPwqVqYpPokRE7U_uX_5yH26P7cm3779FKUJkyg5CAS5i/exec";
            const correctExamCode = "4HVYKI";
            const teacherApiKey = "AIzaSyBkblMSoQeus1zCnRIjBR4y20ErGQXf_q0";
            let studentInfo = {};
            let isSubmitted = false;
            let timerInterval;
            let retriesLeft = quizOptions.retriesAllowed;
            let studentApiKey = "";
            let ai = null;

            let proctoringLog = {
                thoatManHinh: 0,
                saoChep: 0,
                dan: 0,
                suKien: []
            };

            const studentQuizContainer = document.getElementById('student-quiz-container');
            const submitBtn = document.getElementById('submit-quiz-btn');
            const resultContainer = document.getElementById('result-container');
            const postSubmitOptions = document.getElementById('post-submit-options');
            const retryBtn = document.getElementById('retry-quiz-btn');
            const loginModal = document.getElementById('login-modal');
            const studentInfoForm = document.getElementById('student-info-form');
            const timerDisplay = document.getElementById('timer-display');
            const retriesDisplay = document.getElementById('retries-display');

            function formatAIText(text) {
                if (!text) return '';
                let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                formattedText = formattedText.replace(/\n/g, '<br>');
                return formattedText;
            }

            function shuffleQuiz() {
                // Shuffle options/statements within each question first
                quizData.forEach(item => {
                    // Shuffle multiple-choice options and their corresponding images
                    if (item.mappedType === 'multiple-choice' && item.options && item.options.length > 0) {
                        const correctAnswerText = item.options[item.correctAnswerIndex];
                        let optionsWithImages = item.options.map((opt, index) => ({
                            text: opt,
                            image: (item.optionsImage && item.optionsImage[index]) ? item.optionsImage[index] : null
                        }));
                        // Fisher-Yates shuffle
                        for (let i = optionsWithImages.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [optionsWithImages[i], optionsWithImages[j]] = [optionsWithImages[j], optionsWithImages[i]];
                        }
                        // Update the item with shuffled data
                        item.options = optionsWithImages.map(opt => opt.text);
                        item.optionsImage = optionsWithImages.map(opt => opt.image);
                        item.correctAnswerIndex = item.options.indexOf(correctAnswerText);
                    }
                    // Shuffle true-false statements
                    if (item.mappedType === 'true-false' && item.statements && item.statements.length > 0) {
                         for (let i = item.statements.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [item.statements[i], item.statements[j]] = [item.statements[j], item.statements[i]];
                        }
                    }
                });
                // Then, group questions by type and shuffle within each group
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});
                let shuffledQuizData = [];
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
                partOrder.forEach(partType => {
                    if (grouped[partType]) {
                        const partQuestions = grouped[partType];
                        for (let i = partQuestions.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [partQuestions[i], partQuestions[j]] = [partQuestions[j], partQuestions[i]];
                        }
                        shuffledQuizData = shuffledQuizData.concat(partQuestions);
                    }
                });
               
                quizData = shuffledQuizData;
            }
            // --- Timer Function ---
            function startTimer(duration, display) {
                let timer = duration, minutes, seconds;
                clearInterval(timerInterval); // Clear any existing timer
                if(duration <= 0) {
                     display.textContent = "∞";
                     return;
                }
                timerInterval = setInterval(function () {
                    minutes = parseInt(timer / 60, 10);
                    seconds = parseInt(timer % 60, 10);
                    minutes = minutes < 10 ? "0" + minutes : minutes;
                    seconds = seconds < 10 ? "0" + seconds : seconds;
                    display.textContent = minutes + ":" + seconds;
                    if (--timer < 0) {
                        clearInterval(timerInterval);
                        alert("Hết giờ làm bài!");
                        handleSubmit();
                    }
                }, 1000);
            }
            
            async function showExplanation(index, button) {
                const item = quizData[index];
                const questionCard = document.getElementById(`student-q-${index}`);
                const feedbackDiv = document.getElementById(`q-${index}-feedback`);
                if (!questionCard || !feedbackDiv) return;

                const existingExplanation = feedbackDiv.querySelector('.ai-explanation');
                if (existingExplanation) {
                    existingExplanation.remove();
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Xem giải thích
                    `;
                    return;
                }

                button.disabled = true;
                button.innerHTML = '<div class="loader mr-2"></div> Đang tải...';

                if (item.explanation) {
                    displayExplanation(item.explanation, feedbackDiv, button);
                    return;
                }

                if (!ai) {
                    alert("Tính năng giải thích yêu cầu API Key, nhưng chưa được cấu hình bởi giáo viên.");
                    button.disabled = false;
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Xem giải thích
                    `;
                    return;
                }

                const questionText = item.question || item.main_question;
                let prompt = `Bạn là một trợ lý giáo viên AI, am hiểu sâu sắc Chương trình GDPT 2018. Hãy cung cấp một lời giải chi tiết, từng bước một cho câu hỏi sau đây. Lời giải phải chính xác, dễ hiểu và phù hợp với phương pháp giảng dạy của chương trình học, TUYỆT ĐỐI KHÔNG sử dụng kiến thức của lớp cao hơn để giải thích.\n\n--- CÂU HỎI ---\n${questionText}\n\n`;
                if (item.mappedType === 'multiple-choice') {
                    prompt += `--- CÁC LỰA CHỌN ---\n${item.options.map((opt, i) => `${String.fromCharCode(65 + i)}. ${opt}`).join('\n')}\n\n`;
                    prompt += `--- ĐÁP ÁN ĐÚNG ---\n${String.fromCharCode(65 + item.correctAnswerIndex)}. ${item.options[item.correctAnswerIndex]}`;
                } else if (item.mappedType === 'true-false') {
                    prompt += `--- CÁC MỆNH ĐỀ & ĐÁP ÁN ---\n${item.statements.map(s => ` - ${s.statement} -> ${s.is_correct ? 'Đúng' : 'Sai'}`).join('\n')}`;
                } else {
                    prompt += `--- ĐÁP ÁN / GỢI Ý ---\n${item.answer}`;
                }
                prompt += `\n\n--- YÊU CẦU ---\nGiải thích rõ ràng tại sao đáp án lại đúng, từng bước một. Dùng **...** để in đậm các thuật ngữ quan trọng. Định dạng tất cả các công thức toán học bằng LaTeX.`;

                try {
                    const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: prompt });
                    const explanationText = response.text; // Keep it raw
                    item.explanation = explanationText; // Cache it
                    displayExplanation(explanationText, feedbackDiv, button);
                } catch (error) {
                    console.error("Lỗi khi tạo giải thích:", error);
                    feedbackDiv.insertAdjacentHTML('beforeend', '<div class="ai-explanation text-red-600">Lỗi: Không thể tạo giải thích.</div>');
                    button.disabled = false;
                    button.innerHTML = `
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Thử lại
                    `;
                }
            }

            function displayExplanation(explanationText, container, button) {
                container.insertAdjacentHTML('beforeend', `<div class="ai-explanation prose prose-sm">${formatAIText(explanationText)}</div>`);
                if (window.MathJax) MathJax.typesetPromise([container]);
                button.disabled = false;
                button.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    Ẩn giải thích
                `;
            }
           
            function renderStudentQuiz() {
                studentQuizContainer.innerHTML = '';
               
                const grouped = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    if (!acc[type]) {
                        acc[type] = [];
                    }
                    acc[type].push(q);
                    return acc;
                }, {});
                const groupInfo = {
                    'multiple-choice': { title: 'PHẦN I. TRẮC NGHIỆM KHÁCH QUAN', subtitle: 'Chọn đáp án đúng nhất trong các lựa chọn sau.' },
                    'true-false': { title: 'PHẦN II. CÂU HỎI ĐÚNG - SAI', subtitle: 'Xác định tính đúng hoặc sai cho mỗi mệnh đề dưới đây.' },
                    'short-answer': { title: 'PHẦN III. CÂU HỎI TRẢ LỜI NGẮN', subtitle: 'Điền đáp án ngắn gọn vào phần trả lời.' },
                    'essay': { title: 'PHẦN IV. CÂU HỎI TỰ LUẬN', subtitle: 'Trình bày chi tiết bài giải của bạn.' }
                };
               
                let questionCounter = 0;
                const partOrder = ['multiple-choice', 'true-false', 'short-answer', 'essay'];
                partOrder.forEach(partType => {
                    const questions = grouped[partType];
                    if (!questions || questions.length === 0) return;
                   
                    let groupHTML = `<div class="group-container space-y-8 mb-12">`;
                    const info = groupInfo[partType];
                    groupHTML += `
                        <div class="group-header pb-3 border-b-2 border-slate-300 mb-6">
                            <h2 class="text-2xl font-bold text-slate-800">${info.title}</h2>
                            ${info.subtitle ? `<p class="text-md text-slate-600 italic mt-1">${info.subtitle}</p>` : ''}
                        </div>
                    `;
                    questions.forEach((item, localIndex) => {
                        const globalIndex = quizData.indexOf(item);
                        questionCounter++;
                        groupHTML += `<div class="question-card" id="student-q-${globalIndex}">`;
                        let questionText = (item.question || item.main_question || '').replace(/\n/g, '<br>');
                       
                        groupHTML += `<div class="flex items-start">
                                     <div class="flex-grow">
                                         <div class="flex items-center mb-2">
                                             <span class="font-bold text-lg mr-3 text-indigo-600">Câu ${questionCounter}:</span>
                                             <div id="q-${globalIndex}-feedback-icon"></div>
                                         </div>
                                         <div class="question-content mt-2 text-lg text-slate-700">${questionText}</div>
                                         ${item.questionImage ? `<img src="${item.questionImage}" class="mt-4 rounded-lg max-w-full md:max-w-md border shadow-sm">` : ''}
                                     </div>
                                 </div>`;
                       
                        groupHTML += `<div class="mt-6">`;
                        switch(item.mappedType) {
                            case 'multiple-choice':
                                groupHTML += `<div class="options-grid grid grid-cols-1 md:grid-cols-2 gap-4">`;
                                item.options.forEach((opt, i) => {
                                    groupHTML += `<label for="q${globalIndex}-opt${i}" id="q${globalIndex}-opt-label${i}" class="option-label flex items-start p-4 border-2 rounded-xl cursor-pointer hover:bg-indigo-50 hover:border-indigo-400">
                                                     <input type="radio" name="q${globalIndex}" id="q${globalIndex}-opt${i}" value="${i}" class="flex-shrink-0 mt-1 h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                                     <div class="ml-3 flex-grow">
                                                         <span class="font-semibold text-slate-800">${String.fromCharCode(65 + i)}.</span>
                                                         <span class="option-content text-slate-700">${opt || ''}</span>
                                                         ${(item.optionsImage && item.optionsImage[i]) ? `<img src="${item.optionsImage[i]}" class="mt-2 rounded-lg max-w-xs border shadow-sm">` : ''}
                                                     </div>
                                                 </label>`;
                                });
                                groupHTML += `</div>`;
                                break;
                            case 'true-false':
                                 groupHTML += `<div class="space-y-4">`;
                                 item.statements.forEach((s, i) => {
                                     groupHTML += `<div class="statement-item border-t pt-4">
                                                  <p class="mb-3 text-slate-700">${String.fromCharCode(97 + i)}) ${s.statement || ''}</p>
                                                  <div class="flex gap-x-6">
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="true" class="mr-2 h-4 w-4"> Đúng</label>
                                                      <label class="flex items-center cursor-pointer"><input type="radio" name="q${globalIndex}-s${i}" value="false" class="mr-2 h-4 w-4"> Sai</label>
                                                  </div>
                                              </div>`;
                                 });
                                 groupHTML += `</div>`;
                                 break;
                            case 'short-answer':
                                groupHTML += `<input type="text" name="q${globalIndex}" class="mt-1 block w-full md:w-1/2 border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="Nhập đáp án của bạn...">`;
                                break;
                            case 'essay':
                                groupHTML += `<textarea name="q${globalIndex}" class="mt-1 block w-full border border-slate-300 rounded-lg shadow-sm py-2.5 px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" rows="5" placeholder="Nhập câu trả lời tự luận của bạn..."></textarea>`;
                                break;
                        }
                        groupHTML += `</div><div id="q-${globalIndex}-feedback" class="mt-4"></div></div>`;
                    });
                    groupHTML += `</div>`;
                    studentQuizContainer.innerHTML += groupHTML;
                });
               
                if (window.MathJax && typeof window.MathJax.typesetPromise === 'function') {
                    MathJax.typesetPromise([studentQuizContainer]);
                }
            }
           
            async function generatePerformanceReview(allAnswersData) {
                const feedbackContainer = document.getElementById('ai-feedback-container');
                if (!feedbackContainer || !ai) return null;
                feedbackContainer.classList.remove('hidden');
                feedbackContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-slate-800 mb-4">📝 Phân Tích & Gợi Ý Từ Trợ Lý AI</h3>
                        <div id="ai-feedback-loader" class="text-center py-6">
                            <svg class="animate-spin mx-auto h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p class="mt-3 text-slate-600">AI đang phân tích bài làm của bạn...</p>
                        </div>
                        <div id="ai-feedback-summary" class="hidden prose prose-sm max-w-none"></div>
                        <div id="ai-feedback-details" class="hidden mt-4 space-y-2"></div>
                    </div>
                `;
               
                const loader = document.getElementById('ai-feedback-loader');
                const summaryDiv = document.getElementById('ai-feedback-summary');
                const detailsDiv = document.getElementById('ai-feedback-details');
                const incorrectAnswers = allAnswersData.filter(a => !a.isCorrect);
                if (incorrectAnswers.length === 0) {
                    feedbackContainer.innerHTML = `
                        <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                            <h3 class="text-xl font-bold text-green-600">🎉 Chúc mừng!</h3>
                            <p class="mt-2 text-slate-700">Bạn đã trả lời đúng tất cả các câu hỏi. Làm tốt lắm!</p>
                        </div>
                    `;
                    return { overallFeedback: { summary: "Xuất sắc! Học sinh đã đã trả lời đúng tất cả các câu hỏi." } };
                }
                const summaryPrompt = `Bạn là một trợ lý giáo viên, nói tiếng Việt. Dựa vào tóm tắt các câu trả lời sai của học sinh, hãy đưa ra một nhận xét tổng quan ngắn gọn (khoảng 3-4 câu) về năng lực của học sinh, bao gồm điểm mạnh (suy luận từ các câu làm đúng), điểm yếu (dựa trên các câu sai) và một vài gợi ý ôn tập chung. Lời văn phải khích lệ, rõ ràng. Dùng **...** để in đậm các thuật ngữ quan trọng.
                Tóm tắt lỗi sai:
                ${JSON.stringify(incorrectAnswers.map(a => ({ cau: a.questionNumber, loai: a.type, cauHoi: a.question.substring(0, 50) + '...' })), null, 2)}`;
                try {
                    const response = await ai.models.generateContent({
                        model: "gemini-2.5-flash",
                        contents: summaryPrompt
                    });
                    summaryDiv.innerHTML = formatAIText(response.text);
                    loader.classList.add('hidden');
                    summaryDiv.classList.remove('hidden');
                    detailsDiv.classList.remove('hidden'); 
                } catch (e) {
                    console.error("Lỗi khi lấy nhận xét tổng quan:", e);
                    summaryDiv.innerHTML = '<p class="text-red-600">Lỗi khi tạo nhận xét tổng quan.</p>';
                    loader.classList.add('hidden');
                    summaryDiv.classList.remove('hidden');
                }
               
                const summaryForSheet = summaryDiv.innerText.substring(0, 200) + "...";
                return { overallFeedback: { summary: summaryForSheet } };
            }
            async function handleSubmit() {
                if (isSubmitted) return;
                isSubmitted = true;
                clearInterval(timerInterval);
                
                document.querySelectorAll('input, textarea').forEach(input => input.disabled = true);
                submitBtn.classList.add('hidden');
                postSubmitOptions.classList.remove('hidden');
                if (retriesLeft > 0) {
                    retryBtn.classList.remove('hidden');
                } else {
                    retryBtn.classList.add('hidden');
                }

                const proctoringDataString = JSON.stringify(proctoringLog);

                let totalStudentScore = 0;
                let totalCorrectAnswers = 0;
                let allAnswersData = [];
                const questionCounts = quizData.reduce((acc, q) => {
                    const type = q.mappedType;
                    acc[type] = (acc[type] || 0) + 1;
                    return acc;
                }, {});
                
                quizData.forEach((item, index) => {
                    let questionNumber = index + 1;
                    let answerData = { questionNumber, type: item.type };
                    switch (item.mappedType) {
                        case 'multiple-choice':
                            const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
                            const isCorrectMC = selectedOption ? parseInt(selectedOption.value) === item.correctAnswerIndex : false;
                            if (isCorrectMC) {
                                totalCorrectAnswers++;
                                if (questionCounts['multiple-choice'] > 0) {
                                   totalStudentScore += quizOptions.scoring.mc / questionCounts['multiple-choice'];
                                }
                            }
                            answerData.question = item.question;
                            answerData.options = item.options;
                            answerData.yourAnswer = selectedOption ? String.fromCharCode(65 + parseInt(selectedOption.value)) : "Không trả lời";
                            answerData.correctAnswer = String.fromCharCode(65 + item.correctAnswerIndex);
                            answerData.isCorrect = isCorrectMC;
                            break;
                        case 'true-false':
                            let correctStatementsCount = 0;
                            let yourAnswerPattern = [];
                            let correctAnswerPattern = [];
                            let details = [];
                            item.statements.forEach((s, i) => {
                                const selectedTF = document.querySelector(`input[name="q${index}-s${i}"]:checked`);
                                const studentChoice = selectedTF ? selectedTF.value === 'true' : null;
                                const isStatementCorrect = studentChoice === s.is_correct;
                               
                                if (isStatementCorrect) correctStatementsCount++;
                               
                                yourAnswerPattern.push(studentChoice === null ? '?' : (studentChoice ? 'Đ' : 'S'));
                                correctAnswerPattern.push(s.is_correct ? 'Đ' : 'S');
                                details.push({ statement: s.statement, yourChoice: studentChoice === null ? 'Không trả lời' : (studentChoice ? 'Đúng' : 'Sai'), correctChoice: s.is_correct ? 'Đúng' : 'Sai', isCorrect: isStatementCorrect });
                            });
                            
                            let scorePerTfQuestion = 0;
                            if (questionCounts['true-false'] > 0) {
                                scorePerTfQuestion = quizOptions.scoring.tf / questionCounts['true-false'];
                            }
                            let questionPoints = 0;
                            if (quizOptions.scoring.tfMethod === 'progressive') {
                                const progressivePoints = { 0: 0, 1: 0.1, 2: 0.25, 3: 0.5, 4: 1.0 };
                                questionPoints = progressivePoints[correctStatementsCount] * scorePerTfQuestion;
                            } else { // even
                                questionPoints = (correctStatementsCount / 4) * scorePerTfQuestion;
                            }
                            totalStudentScore += questionPoints;

                            if(correctStatementsCount === 4) totalCorrectAnswers++;
                            answerData.question = item.main_question;
                            answerData.yourAnswer = yourAnswerPattern.join('-');
                            answerData.correctAnswer = correctAnswerPattern.join('-');
                            answerData.isCorrect = correctStatementsCount === 4;
                            answerData.details = details;
                            break;
                       
                        case 'short-answer':
                            const saInput = document.querySelector(`input[name="q${index}"]`);
                            const studentAnswerRaw = saInput ? (saInput.value ?? '').trim() : "";
                            const correctAnswerRaw = (item.answer ?? '').toString().trim().replace(/\$/g, '');
                            let isCorrectSA = false;
                            const studentAnswerNormalized = studentAnswerRaw.replace(',', '.');
                            const correctAnswerNormalized = correctAnswerRaw.replace(',', '.');
                            if (studentAnswerNormalized.toLowerCase() === correctAnswerNormalized.toLowerCase()) {
                                isCorrectSA = true;
                            }
                             if (isCorrectSA) {
                                totalCorrectAnswers++;
                                if (questionCounts['short-answer'] > 0) {
                                   totalStudentScore += quizOptions.scoring.sa / questionCounts['short-answer'];
                                }
                            }
                            answerData.question = item.question;
                            answerData.yourAnswer = studentAnswerRaw || "Không trả lời";
                            answerData.correctAnswer = correctAnswerRaw;
                            answerData.isCorrect = isCorrectSA;
                            break;
                           
                        case 'essay':
                             const essayInput = document.querySelector(`textarea[name="q${index}"]`);
                             answerData.question = item.question;
                             answerData.yourAnswer = essayInput.value || "Không trả lời";
                             answerData.correctAnswer = item.answer;
                             answerData.isCorrect = null; // Needs manual grading
                             break;
                    }
                    allAnswersData.push(answerData);
                });
                
                const finalScore = totalStudentScore;
                
                let competencyAssessment = "Giáo viên không yêu cầu AI phân tích bài làm.";
                if (quizOptions.aiAssessment) {
                    const feedbackData = await generatePerformanceReview(allAnswersData);
                    if (feedbackData && feedbackData.overallFeedback && feedbackData.overallFeedback.summary) {
                        competencyAssessment = feedbackData.overallFeedback.summary;
                    } else {
                        competencyAssessment = "Có lỗi xảy ra trong quá trình AI phân tích bài làm.";
                    }
                }
                
                if (quizOptions.showAnswers) {
                    const totalQuestions = quizData.length;
                    resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg text-center">
                        <h3 class="text-2xl font-bold text-slate-800">KẾT QUẢ BÀI LÀM</h3>
                        <p class="mt-4 text-lg">Số câu đúng hoàn toàn: <span class="font-bold text-green-600">${totalCorrectAnswers}/${totalQuestions}</span></p>
                        <p class="text-2xl mt-2">Điểm (thang 10): <span class="font-bold text-blue-600">${finalScore.toFixed(2)}</span></p>
                        ${questionCounts['essay'] > 0 ? `<p class="text-sm text-gray-600 italic mt-1">Lưu ý: Điểm trên chưa bao gồm ${quizOptions.scoring.essay} điểm của phần Tự luận.</p>` : ''}
                    </div>`;
                    resultContainer.classList.remove('hidden');

                    allAnswersData.forEach((ans, index) => {
                        const questionCard = document.getElementById(`student-q-${index}`);
                        const feedbackIconDiv = document.getElementById(`q-${index}-feedback-icon`);
                        const feedbackDiv = document.getElementById(`q-${index}-feedback`);
                        if (!questionCard || !feedbackIconDiv || !feedbackDiv) return;

                        const iconHTML = ans.isCorrect === true
                            ? '<svg class="feedback-icon text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>'
                            : (ans.isCorrect === false ? '<svg class="feedback-icon text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>' : '');
                        feedbackIconDiv.innerHTML = iconHTML;

                        if (ans.type.includes('multiple-choice')) {
                            const studentChoice = ans.yourAnswer === "Không trả lời" ? -1 : ans.yourAnswer.charCodeAt(0) - 65;
                            const correctChoice = ans.correctAnswer.charCodeAt(0) - 65;
                            document.getElementById(`q-${index}-opt-label${correctChoice}`)?.classList.add('correct');
                            if (studentChoice !== -1 && studentChoice !== correctChoice) {
                                document.getElementById(`q-${index}-opt-label${studentChoice}`)?.classList.add('incorrect');
                            }
                        } else if (ans.type === 'true-false') {
                            const statementItems = questionCard.querySelectorAll('.statement-item');
                            ans.details.forEach((detail, i) => { if(statementItems[i]) { statementItems[i].classList.add(detail.isCorrect ? 'correct' : 'incorrect'); }});
                        }

                        if (quizOptions.showExplanation) {
                            feedbackDiv.innerHTML = `<button data-explain-index="${index}" class="explain-btn mt-4 flex items-center px-4 py-2 bg-blue-100 text-blue-800 text-sm font-semibold rounded-lg hover:bg-blue-200 transition-colors">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                Xem giải thích
                            </button>`;
                        }
                    });
                    
                    document.querySelectorAll('.explain-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const button = e.currentTarget;
                            const index = parseInt(button.dataset.explainIndex, 10);
                            showExplanation(index, button);
                        });
                    });

                    if (window.MathJax) await window.MathJax.typesetPromise([studentQuizContainer]);
                } else {
                     resultContainer.innerHTML = `<div class="bg-white p-6 rounded-xl shadow-lg text-center"><h3 class="text-xl font-bold text-green-600">Nộp bài thành công!</h3><p class="mt-2 text-slate-700">Bạn đã hoàn thành bài làm. Kết quả sẽ được giáo viên công bố sau.</p></div>`;
                    resultContainer.classList.remove('hidden');
                }
                
                const formData = new FormData();
                formData.append('name', studentInfo.name);
                formData.append('class', studentInfo.class);
                formData.append('score', `${finalScore.toFixed(2)}/10`);
                formData.append('assessment', competencyAssessment);
                formData.append('timestamp', new Date().toLocaleString('vi-VN'));
                formData.append('examCode', correctExamCode);
                formData.append('monitoringLog', proctoringDataString);
                formData.append('answerDetails', JSON.stringify(allAnswersData));
               
                fetch(googleScriptUrl, { method: 'POST', body: formData})
                    .then(res => console.log("Successfully submitted to Google Sheet"))
                    .catch(err => console.error("Error submitting to Google Sheet:", err));
            }
           
            function startNewAttempt() {
                isSubmitted = false;
                proctoringLog = { thoatManHinh: 0, saoChep: 0, dan: 0, suKien: [] };
                const proctoringWidget = document.getElementById('proctoring-widget');
                if (proctoringWidget) {
                    proctoringWidget.classList.add('hidden');
                    document.getElementById('tab-switch-count').textContent = '0';
                    document.getElementById('copy-count').textContent = '0';
                    document.getElementById('paste-count').textContent = '0';
                }

                renderStudentQuiz();
                resultContainer.classList.add('hidden');
                document.getElementById('ai-feedback-container').classList.add('hidden');
                postSubmitOptions.classList.add('hidden');
                submitBtn.classList.remove('hidden');
                 if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                }
                retriesLeft--;
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                window.scrollTo(0, 0);
            }
            studentInfoForm.addEventListener('submit', (e) => {
                e.preventDefault();
               
                const enteredCode = document.getElementById('exam-code').value.trim().toUpperCase();
                if (correctExamCode && enteredCode !== correctExamCode) {
                    alert('Mã đề không chính xác. Vui lòng kiểm tra lại!');
                    return;
                }
               
                studentApiKey = teacherApiKey;
                if (!studentApiKey) {
                    console.warn('Cảnh báo: Giáo viên chưa cấu hình API Key. Các tính năng AI sẽ không hoạt động.');
                }
       
                try {
                    if (studentApiKey) {
                       ai = new GoogleGenAI({ apiKey: studentApiKey });
                    }
                } catch(e) {
                    console.error("Lỗi khởi tạo Gemini API với key của giáo viên.", e);
                    alert("Cảnh báo: API Key của giáo viên không hợp lệ. Vui lòng báo cho giáo viên. Các tính năng AI sẽ không hoạt động.");
                    ai = null;
                }
                shuffleQuiz();
               
                studentInfo.name = document.getElementById('student-name').value;
                studentInfo.class = document.getElementById('student-class').value;
                loginModal.classList.add('hidden');
                studentQuizContainer.classList.remove('hidden');
                submitBtn.classList.remove('hidden');
               
                if (quizOptions.timeLimit > 0) {
                    const timeInSeconds = quizOptions.timeLimit * 60;
                    startTimer(timeInSeconds, timerDisplay);
                } else {
                    timerDisplay.textContent = "Không giới hạn";
                }
                retriesDisplay.textContent = `Lượt làm lại còn: ${retriesLeft}`;
                renderStudentQuiz();

                const proctoringWidget = document.getElementById('proctoring-widget');
                const tabSwitchCountEl = document.getElementById('tab-switch-count');
                const copyCountEl = document.getElementById('copy-count');
                const pasteCountEl = document.getElementById('paste-count');

                function updateProctoringUI() {
                    if (proctoringLog.thoatManHinh > 0 || proctoringLog.saoChep > 0 || proctoringLog.dan > 0) {
                        proctoringWidget.classList.remove('hidden');
                    }
                    tabSwitchCountEl.textContent = proctoringLog.thoatManHinh;
                    copyCountEl.textContent = proctoringLog.saoChep;
                    pasteCountEl.textContent = proctoringLog.dan;
                }

                // Disable Right Click
                document.addEventListener('contextmenu', e => e.preventDefault());

                // Track Tab Switching
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && !isSubmitted) {
                        proctoringLog.thoatManHinh++;
                        proctoringLog.suKien.push({ loai: 'chuyen_tab', thoiGian: new Date().toISOString() });
                        updateProctoringUI();
                    }
                });

                // Track Copying
                document.addEventListener('copy', () => {
                    if (isSubmitted) return;
                    proctoringLog.saoChep++;
                    proctoringLog.suKien.push({ loai: 'sao_chep', thoiGian: new Date().toISOString() });
                    updateProctoringUI();
                });

                // Track Pasting
                document.addEventListener('paste', () => {
                    if (isSubmitted) return;
                    proctoringLog.dan++;
                    proctoringLog.suKien.push({ loai: 'dan', thoiGian: new Date().toISOString() });
                    updateProctoringUI();
                });
            });
            
            submitBtn.addEventListener('click', handleSubmit);
            retryBtn.addEventListener('click', () => {
                shuffleQuiz();
                startNewAttempt();
            });
        </script>
    </body>
    </html>
    